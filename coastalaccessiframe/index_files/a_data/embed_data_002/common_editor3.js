/*! v4.5.94 - 2017-01-10 */
require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){},{}],2:[function(a,b,c){(function(b){"use strict";function d(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()&&"function"==typeof a.subarray&&0===a.subarray(1,1).byteLength}catch(b){return!1}}function e(){return g.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a,b){if(e()<b)throw new RangeError("Invalid typed array length");return g.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(b),a.__proto__=g.prototype):(null===a&&(a=new g(b)),a.length=b),a}function g(a,b,c){if(!(g.TYPED_ARRAY_SUPPORT||this instanceof g))return new g(a,b,c);if("number"==typeof a){if("string"==typeof b)throw new Error("If encoding is specified then the first argument must be a string");return k(this,a)}return h(this,a,b,c)}function h(a,b,c,d){if("number"==typeof b)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer?n(a,b,c,d):"string"==typeof b?l(a,b,c):o(a,b)}function i(a){if("number"!=typeof a)throw new TypeError('"size" argument must be a number');if(0>a)throw new RangeError('"size" argument must not be negative')}function j(a,b,c,d){return i(b),0>=b?f(a,b):void 0!==c?"string"==typeof d?f(a,b).fill(c,d):f(a,b).fill(c):f(a,b)}function k(a,b){if(i(b),a=f(a,0>b?0:0|p(b)),!g.TYPED_ARRAY_SUPPORT)for(var c=0;b>c;++c)a[c]=0;return a}function l(a,b,c){if(("string"!=typeof c||""===c)&&(c="utf8"),!g.isEncoding(c))throw new TypeError('"encoding" must be a valid string encoding');var d=0|r(b,c);a=f(a,d);var e=a.write(b,c);return e!==d&&(a=a.slice(0,e)),a}function m(a,b){var c=b.length<0?0:0|p(b.length);a=f(a,c);for(var d=0;c>d;d+=1)a[d]=255&b[d];return a}function n(a,b,c,d){if(b.byteLength,0>c||b.byteLength<c)throw new RangeError("'offset' is out of bounds");if(b.byteLength<c+(d||0))throw new RangeError("'length' is out of bounds");return b=void 0===c&&void 0===d?new Uint8Array(b):void 0===d?new Uint8Array(b,c):new Uint8Array(b,c,d),g.TYPED_ARRAY_SUPPORT?(a=b,a.__proto__=g.prototype):a=m(a,b),a}function o(a,b){if(g.isBuffer(b)){var c=0|p(b.length);return a=f(a,c),0===a.length?a:(b.copy(a,0,0,c),a)}if(b){if("undefined"!=typeof ArrayBuffer&&b.buffer instanceof ArrayBuffer||"length"in b)return"number"!=typeof b.length||Y(b.length)?f(a,0):m(a,b);if("Buffer"===b.type&&_(b.data))return m(a,b.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function q(a){return+a!=a&&(a=0),g.alloc(+a)}function r(a,b){if(g.isBuffer(a))return a.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(a)||a instanceof ArrayBuffer))return a.byteLength;"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return T(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return W(a).length;default:if(d)return T(a).length;b=(""+b).toLowerCase(),d=!0}}function s(a,b,c){var d=!1;if((void 0===b||0>b)&&(b=0),b>this.length)return"";if((void 0===c||c>this.length)&&(c=this.length),0>=c)return"";if(c>>>=0,b>>>=0,b>=c)return"";for(a||(a="utf8");;)switch(a){case"hex":return H(this,b,c);case"utf8":case"utf-8":return D(this,b,c);case"ascii":return F(this,b,c);case"latin1":case"binary":return G(this,b,c);case"base64":return C(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function t(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function u(a,b,c,d,e){if(0===a.length)return-1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:-2147483648>c&&(c=-2147483648),c=+c,isNaN(c)&&(c=e?0:a.length-1),0>c&&(c=a.length+c),c>=a.length){if(e)return-1;c=a.length-1}else if(0>c){if(!e)return-1;c=0}if("string"==typeof b&&(b=g.from(b,d)),g.isBuffer(b))return 0===b.length?-1:v(a,b,c,d,e);if("number"==typeof b)return b=255&b,g.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):v(a,[b],c,d,e);throw new TypeError("val must be string, number or Buffer")}function v(a,b,c,d,e){function f(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}var g=1,h=a.length,i=b.length;if(void 0!==d&&(d=String(d).toLowerCase(),"ucs2"===d||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return-1;g=2,h/=2,i/=2,c/=2}var j;if(e){var k=-1;for(j=c;h>j;j++)if(f(a,j)===f(b,-1===k?0:j-k)){if(-1===k&&(k=j),j-k+1===i)return k*g}else-1!==k&&(j-=j-k),k=-1}else for(c+i>h&&(c=h-i),j=c;j>=0;j--){for(var l=!0,m=0;i>m;m++)if(f(a,j+m)!==f(b,m)){l=!1;break}if(l)return j}return-1}function w(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new TypeError("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;++g){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))return g;a[c+g]=h}return g}function x(a,b,c,d){return X(T(b,a.length-c),a,c,d)}function y(a,b,c,d){return X(U(b),a,c,d)}function z(a,b,c,d){return y(a,b,c,d)}function A(a,b,c,d){return X(W(b),a,c,d)}function B(a,b,c,d){return X(V(b,a.length-c),a,c,d)}function C(a,b,c){return 0===b&&c===a.length?Z.fromByteArray(a):Z.fromByteArray(a.slice(b,c))}function D(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;c>e;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(c>=e+h){var i,j,k,l;switch(h){case 1:128>f&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(55296>l||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&1114112>l&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return E(d)}function E(a){var b=a.length;if(aa>=b)return String.fromCharCode.apply(String,a);for(var c="",d=0;b>d;)c+=String.fromCharCode.apply(String,a.slice(d,d+=aa));return c}function F(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;++e)d+=String.fromCharCode(127&a[e]);return d}function G(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;++e)d+=String.fromCharCode(a[e]);return d}function H(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;++f)e+=S(a[f]);return e}function I(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function J(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function K(a,b,c,d,e,f){if(!g.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>e||f>b)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}function L(a,b,c,d){0>b&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);f>e;++e)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function M(a,b,c,d){0>b&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);f>e;++e)a[c+e]=b>>>8*(d?e:3-e)&255}function N(a,b,c,d,e,f){if(c+d>a.length)throw new RangeError("Index out of range");if(0>c)throw new RangeError("Index out of range")}function O(a,b,c,d,e){return e||N(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),$.write(a,b,c,d,23,4),c+4}function P(a,b,c,d,e){return e||N(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),$.write(a,b,c,d,52,8),c+8}function Q(a){if(a=R(a).replace(ba,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function R(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function S(a){return 16>a?"0"+a.toString(16):a.toString(16)}function T(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;d>g;++g){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(1114112>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function U(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function V(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function W(a){return Z.toByteArray(Q(a))}function X(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function Y(a){return a!==a}var Z=a("base64-js"),$=a("ieee754"),_=a("isarray");c.Buffer=g,c.SlowBuffer=q,c.INSPECT_MAX_BYTES=50,g.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),c.kMaxLength=e(),g.poolSize=8192,g._augment=function(a){return a.__proto__=g.prototype,a},g.from=function(a,b,c){return h(null,a,b,c)},g.TYPED_ARRAY_SUPPORT&&(g.prototype.__proto__=Uint8Array.prototype,g.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&g[Symbol.species]===g&&Object.defineProperty(g,Symbol.species,{value:null,configurable:!0})),g.alloc=function(a,b,c){return j(null,a,b,c)},g.allocUnsafe=function(a){return k(null,a)},g.allocUnsafeSlow=function(a){return k(null,a)},g.isBuffer=function(a){return!(null==a||!a._isBuffer)},g.compare=function(a,b){if(!g.isBuffer(a)||!g.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,f=Math.min(c,d);f>e;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return d>c?-1:c>d?1:0},g.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},g.concat=function(a,b){if(!_(a))throw new TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return g.alloc(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var d=g.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var f=a[c];if(!g.isBuffer(f))throw new TypeError('"list" argument must be an Array of Buffers');f.copy(d,e),e+=f.length}return d},g.byteLength=r,g.prototype._isBuffer=!0,g.prototype.swap16=function(){var a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;a>b;b+=2)t(this,b,b+1);return this},g.prototype.swap32=function(){var a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;a>b;b+=4)t(this,b,b+3),t(this,b+1,b+2);return this},g.prototype.swap64=function(){var a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;a>b;b+=8)t(this,b,b+7),t(this,b+1,b+6),t(this,b+2,b+5),t(this,b+3,b+4);return this},g.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?D(this,0,a):s.apply(this,arguments)},g.prototype.equals=function(a){if(!g.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?!0:0===g.compare(this,a)},g.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},g.prototype.compare=function(a,b,c,d,e){if(!g.isBuffer(a))throw new TypeError("Argument must be a Buffer");if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),0>b||c>a.length||0>d||e>this.length)throw new RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return-1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;for(var f=e-d,h=c-b,i=Math.min(f,h),j=this.slice(d,e),k=a.slice(b,c),l=0;i>l;++l)if(j[l]!==k[l]){f=j[l],h=k[l];break}return h>f?-1:f>h?1:0},g.prototype.includes=function(a,b,c){return-1!==this.indexOf(a,b,c)},g.prototype.indexOf=function(a,b,c){return u(this,a,b,c,!0)},g.prototype.lastIndexOf=function(a,b,c){return u(this,a,b,c,!1)},g.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b=0|b,isFinite(c)?(c=0|c,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(0>c||0>b)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var f=!1;;)switch(d){case"hex":return w(this,a,b,c);case"utf8":case"utf-8":return x(this,a,b,c);case"ascii":return y(this,a,b,c);case"latin1":case"binary":return z(this,a,b,c);case"base64":return A(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,a,b,c);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},g.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var aa=4096;g.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var d;if(g.TYPED_ARRAY_SUPPORT)d=this.subarray(a,b),d.__proto__=g.prototype;else{var e=b-a;d=new g(e,void 0);for(var f=0;e>f;++f)d[f]=this[f+a]}return d},g.prototype.readUIntLE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},g.prototype.readUIntBE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},g.prototype.readUInt8=function(a,b){return b||J(a,1,this.length),this[a]},g.prototype.readUInt16LE=function(a,b){return b||J(a,2,this.length),this[a]|this[a+1]<<8},g.prototype.readUInt16BE=function(a,b){return b||J(a,2,this.length),this[a]<<8|this[a+1]},g.prototype.readUInt32LE=function(a,b){return b||J(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},g.prototype.readUInt32BE=function(a,b){return b||J(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},g.prototype.readIntLE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},g.prototype.readIntBE=function(a,b,c){a=0|a,b=0|b,c||J(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},g.prototype.readInt8=function(a,b){return b||J(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},g.prototype.readInt16LE=function(a,b){b||J(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},g.prototype.readInt16BE=function(a,b){b||J(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},g.prototype.readInt32LE=function(a,b){return b||J(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},g.prototype.readInt32BE=function(a,b){return b||J(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},g.prototype.readFloatLE=function(a,b){return b||J(a,4,this.length),$.read(this,a,!0,23,4)},g.prototype.readFloatBE=function(a,b){return b||J(a,4,this.length),$.read(this,a,!1,23,4)},g.prototype.readDoubleLE=function(a,b){return b||J(a,8,this.length),$.read(this,a,!0,52,8)},g.prototype.readDoubleBE=function(a,b){return b||J(a,8,this.length),$.read(this,a,!1,52,8)},g.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b=0|b,c=0|c,!d){var e=Math.pow(2,8*c)-1;K(this,a,b,c,e,0)}var f=1,g=0;for(this[b]=255&a;++g<c&&(f*=256);)this[b+g]=a/f&255;return b+c},g.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b=0|b,c=0|c,!d){var e=Math.pow(2,8*c)-1;K(this,a,b,c,e,0)}var f=c-1,g=1;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=a/g&255;return b+c},g.prototype.writeUInt8=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,1,255,0),g.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},g.prototype.writeUInt16LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):L(this,a,b,!0),b+2},g.prototype.writeUInt16BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,65535,0),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):L(this,a,b,!1),b+2},g.prototype.writeUInt32LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):M(this,a,b,!0),b+4},g.prototype.writeUInt32BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,4294967295,0),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):M(this,a,b,!1),b+4},g.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);K(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)0>a&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},g.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b=0|b,!d){var e=Math.pow(2,8*c-1);K(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)0>a&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},g.prototype.writeInt8=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,1,127,-128),g.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),0>a&&(a=255+a+1),this[b]=255&a,b+1},g.prototype.writeInt16LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):L(this,a,b,!0),b+2},g.prototype.writeInt16BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,2,32767,-32768),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):L(this,a,b,!1),b+2},g.prototype.writeInt32LE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,2147483647,-2147483648),g.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):M(this,a,b,!0),b+4},g.prototype.writeInt32BE=function(a,b,c){return a=+a,b=0|b,c||K(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),g.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):M(this,a,b,!1),b+4},g.prototype.writeFloatLE=function(a,b,c){return O(this,a,b,!0,c)},g.prototype.writeFloatBE=function(a,b,c){return O(this,a,b,!1,c)},g.prototype.writeDoubleLE=function(a,b,c){return P(this,a,b,!0,c)},g.prototype.writeDoubleBE=function(a,b,c){return P(this,a,b,!1,c)},g.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&c>d&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,f=d-c;if(this===a&&b>c&&d>b)for(e=f-1;e>=0;--e)a[e+b]=this[e+c];else if(1e3>f||!g.TYPED_ARRAY_SUPPORT)for(e=0;f>e;++e)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+f),b);return f},g.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),1===a.length){var e=a.charCodeAt(0);256>e&&(a=e)}if(void 0!==d&&"string"!=typeof d)throw new TypeError("encoding must be a string");if("string"==typeof d&&!g.isEncoding(d))throw new TypeError("Unknown encoding: "+d)}else"number"==typeof a&&(a=255&a);if(0>b||this.length<b||this.length<c)throw new RangeError("Out of range index");if(b>=c)return this;b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0);var f;if("number"==typeof a)for(f=b;c>f;++f)this[f]=a;else{var h=g.isBuffer(a)?a:T(new g(a,d).toString()),i=h.length;for(f=0;c-b>f;++f)this[f+b]=h[f%i]}return this};var ba=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":3,ieee754:4,isarray:5}],3:[function(a,b,c){"use strict";function d(a){var b=a.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===a[b-2]?2:"="===a[b-1]?1:0}function e(a){return 3*a.length/4-d(a)}function f(a){var b,c,e,f,g,h,i=a.length;g=d(a),h=new l(3*i/4-g),e=g>0?i-4:i;var j=0;for(b=0,c=0;e>b;b+=4,c+=3)f=k[a.charCodeAt(b)]<<18|k[a.charCodeAt(b+1)]<<12|k[a.charCodeAt(b+2)]<<6|k[a.charCodeAt(b+3)],h[j++]=f>>16&255,h[j++]=f>>8&255,h[j++]=255&f;return 2===g?(f=k[a.charCodeAt(b)]<<2|k[a.charCodeAt(b+1)]>>4,h[j++]=255&f):1===g&&(f=k[a.charCodeAt(b)]<<10|k[a.charCodeAt(b+1)]<<4|k[a.charCodeAt(b+2)]>>2,h[j++]=f>>8&255,h[j++]=255&f),h}function g(a){return j[a>>18&63]+j[a>>12&63]+j[a>>6&63]+j[63&a]}function h(a,b,c){for(var d,e=[],f=b;c>f;f+=3)d=(a[f]<<16)+(a[f+1]<<8)+a[f+2],e.push(g(d));return e.join("")}function i(a){for(var b,c=a.length,d=c%3,e="",f=[],g=16383,i=0,k=c-d;k>i;i+=g)f.push(h(a,i,i+g>k?k:i+g));return 1===d?(b=a[c-1],e+=j[b>>2],e+=j[b<<4&63],e+="=="):2===d&&(b=(a[c-2]<<8)+a[c-1],e+=j[b>>10],e+=j[b>>4&63],e+=j[b<<2&63],e+="="),f.push(e),f.join("")}c.byteLength=e,c.toByteArray=f,c.fromByteArray=i;for(var j=[],k=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=m.length;o>n;++n)j[n]=m[n],k[m.charCodeAt(n)]=n;k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63},{}],4:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:(n?-1:1)*(1/0);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],5:[function(a,b,c){var d={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==d.call(a)}},{}],6:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:7}],7:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],8:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],9:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],10:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments);
};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":9,_process:7,inherits:8}],11:[function(a,b,c){!function(d,e){"object"==typeof c&&"undefined"!=typeof b?e(c,a("d3-color")):"function"==typeof define&&define.amd?define(["exports","d3-color"],e):e(d.d3=d.d3||{},d.d3)}(this,function(a,b){"use strict";function c(a,b,c,d,e){var f=a*a,g=f*a;return((1-3*a+3*f-g)*b+(4-6*f+3*g)*c+(1+3*a+3*f-3*g)*d+g*e)/6}function d(a,b){return function(c){return a+c*b}}function e(a,b,c){return a=Math.pow(a,c),b=Math.pow(b,c)-a,c=1/c,function(d){return Math.pow(a+d*b,c)}}function f(a,b){var c=b-a;return c?d(a,c>180||-180>c?c-360*Math.round(c/360):c):B(isNaN(a)?b:a)}function g(a){return 1===(a=+a)?h:function(b,c){return c-b?e(b,c,a):B(isNaN(b)?c:b)}}function h(a,b){var c=b-a;return c?d(a,c):B(isNaN(a)?b:a)}function i(a){return function(c){var d,e,f=c.length,g=new Array(f),h=new Array(f),i=new Array(f);for(d=0;f>d;++d)e=b.rgb(c[d]),g[d]=e.r||0,h[d]=e.g||0,i[d]=e.b||0;return g=a(g),h=a(h),i=a(i),e.opacity=1,function(a){return e.r=g(a),e.g=h(a),e.b=i(a),e+""}}}function j(a){return function(){return a}}function k(a){return function(b){return a(b)+""}}function l(a){return"none"===a?P:(v||(v=document.createElement("DIV"),w=document.documentElement,x=document.defaultView),v.style.transform=a,a=x.getComputedStyle(w.appendChild(v),null).getPropertyValue("transform"),w.removeChild(v),a=a.slice(7,-1).split(","),Q(+a[0],+a[1],+a[2],+a[3],+a[4],+a[5]))}function m(a){return null==a?P:(y||(y=document.createElementNS("http://www.w3.org/2000/svg","g")),y.setAttribute("transform",a),(a=y.transform.baseVal.consolidate())?(a=a.matrix,Q(a.a,a.b,a.c,a.d,a.e,a.f)):P)}function n(a,b,c,d){function e(a){return a.length?a.pop()+" ":""}function f(a,d,e,f,g,h){if(a!==e||d!==f){var i=g.push("translate(",null,b,null,c);h.push({i:i-4,x:H(a,e)},{i:i-2,x:H(d,f)})}else(e||f)&&g.push("translate("+e+b+f+c)}function g(a,b,c,f){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),f.push({i:c.push(e(c)+"rotate(",null,d)-2,x:H(a,b)})):b&&c.push(e(c)+"rotate("+b+d)}function h(a,b,c,f){a!==b?f.push({i:c.push(e(c)+"skewX(",null,d)-2,x:H(a,b)}):b&&c.push(e(c)+"skewX("+b+d)}function i(a,b,c,d,f,g){if(a!==c||b!==d){var h=f.push(e(f)+"scale(",null,",",null,")");g.push({i:h-4,x:H(a,c)},{i:h-2,x:H(b,d)})}else(1!==c||1!==d)&&f.push(e(f)+"scale("+c+","+d+")")}return function(b,c){var d=[],e=[];return b=a(b),c=a(c),f(b.translateX,b.translateY,c.translateX,c.translateY,d,e),g(b.rotate,c.rotate,d,e),h(b.skewX,c.skewX,d,e),i(b.scaleX,b.scaleY,c.scaleX,c.scaleY,d,e),b=c=null,function(a){for(var b,c=-1,f=e.length;++c<f;)d[(b=e[c]).i]=b.x(a);return d.join("")}}}function o(a){return((a=Math.exp(a))+1/a)/2}function p(a){return((a=Math.exp(a))-1/a)/2}function q(a){return((a=Math.exp(2*a))-1)/(a+1)}function r(a){return function(c,d){var e=a((c=b.hsl(c)).h,(d=b.hsl(d)).h),f=h(c.s,d.s),g=h(c.l,d.l),i=h(c.opacity,d.opacity);return function(a){return c.h=e(a),c.s=f(a),c.l=g(a),c.opacity=i(a),c+""}}}function s(a,c){var d=h((a=b.lab(a)).l,(c=b.lab(c)).l),e=h(a.a,c.a),f=h(a.b,c.b),g=h(a.opacity,c.opacity);return function(b){return a.l=d(b),a.a=e(b),a.b=f(b),a.opacity=g(b),a+""}}function t(a){return function(c,d){var e=a((c=b.hcl(c)).h,(d=b.hcl(d)).h),f=h(c.c,d.c),g=h(c.l,d.l),i=h(c.opacity,d.opacity);return function(a){return c.h=e(a),c.c=f(a),c.l=g(a),c.opacity=i(a),c+""}}}function u(a){return function c(d){function e(c,e){var f=a((c=b.cubehelix(c)).h,(e=b.cubehelix(e)).h),g=h(c.s,e.s),i=h(c.l,e.l),j=h(c.opacity,e.opacity);return function(a){return c.h=f(a),c.s=g(a),c.l=i(Math.pow(a,d)),c.opacity=j(a),c+""}}return d=+d,e.gamma=c,e}(1)}var v,w,x,y,z=function(a){var b=a.length-1;return function(d){var e=0>=d?d=0:d>=1?(d=1,b-1):Math.floor(d*b),f=a[e],g=a[e+1],h=e>0?a[e-1]:2*f-g,i=b-1>e?a[e+2]:2*g-f;return c((d-e/b)*b,h,f,g,i)}},A=function(a){var b=a.length;return function(d){var e=Math.floor(((d%=1)<0?++d:d)*b),f=a[(e+b-1)%b],g=a[e%b],h=a[(e+1)%b],i=a[(e+2)%b];return c((d-e/b)*b,f,g,h,i)}},B=function(a){return function(){return a}},C=function da(a){function c(a,c){var e=d((a=b.rgb(a)).r,(c=b.rgb(c)).r),f=d(a.g,c.g),g=d(a.b,c.b),h=d(a.opacity,c.opacity);return function(b){return a.r=e(b),a.g=f(b),a.b=g(b),a.opacity=h(b),a+""}}var d=g(a);return c.gamma=da,c}(1),D=i(z),E=i(A),F=function(a,b){var c,d=b?b.length:0,e=a?Math.min(d,a.length):0,f=new Array(d),g=new Array(d);for(c=0;e>c;++c)f[c]=M(a[c],b[c]);for(;d>c;++c)g[c]=b[c];return function(a){for(c=0;e>c;++c)g[c]=f[c](a);return g}},G=function(a,b){var c=new Date;return a=+a,b-=a,function(d){return c.setTime(a+b*d),c}},H=function(a,b){return a=+a,b-=a,function(c){return a+b*c}},I=function(a,b){var c,d={},e={};(null===a||"object"!=typeof a)&&(a={}),(null===b||"object"!=typeof b)&&(b={});for(c in b)c in a?d[c]=M(a[c],b[c]):e[c]=b[c];return function(a){for(c in d)e[c]=d[c](a);return e}},J=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,K=new RegExp(J.source,"g"),L=function(a,b){var c,d,e,f=J.lastIndex=K.lastIndex=0,g=-1,h=[],i=[];for(a+="",b+="";(c=J.exec(a))&&(d=K.exec(b));)(e=d.index)>f&&(e=b.slice(f,e),h[g]?h[g]+=e:h[++g]=e),(c=c[0])===(d=d[0])?h[g]?h[g]+=d:h[++g]=d:(h[++g]=null,i.push({i:g,x:H(c,d)})),f=K.lastIndex;return f<b.length&&(e=b.slice(f),h[g]?h[g]+=e:h[++g]=e),h.length<2?i[0]?k(i[0].x):j(b):(b=i.length,function(a){for(var c,d=0;b>d;++d)h[(c=i[d]).i]=c.x(a);return h.join("")})},M=function(a,c){var d,e=typeof c;return null==c||"boolean"===e?B(c):("number"===e?H:"string"===e?(d=b.color(c))?(c=d,C):L:c instanceof b.color?C:c instanceof Date?G:Array.isArray(c)?F:isNaN(c)?I:H)(a,c)},N=function(a,b){return a=+a,b-=a,function(c){return Math.round(a+b*c)}},O=180/Math.PI,P={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},Q=function(a,b,c,d,e,f){var g,h,i;return(g=Math.sqrt(a*a+b*b))&&(a/=g,b/=g),(i=a*c+b*d)&&(c-=a*i,d-=b*i),(h=Math.sqrt(c*c+d*d))&&(c/=h,d/=h,i/=h),b*c>a*d&&(a=-a,b=-b,i=-i,g=-g),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*O,skewX:Math.atan(i)*O,scaleX:g,scaleY:h}},R=n(l,"px, ","px)","deg)"),S=n(m,", ",")",")"),T=Math.SQRT2,U=2,V=4,W=1e-12,X=function(a,b){var c,d,e=a[0],f=a[1],g=a[2],h=b[0],i=b[1],j=b[2],k=h-e,l=i-f,m=k*k+l*l;if(W>m)d=Math.log(j/g)/T,c=function(a){return[e+a*k,f+a*l,g*Math.exp(T*a*d)]};else{var n=Math.sqrt(m),r=(j*j-g*g+V*m)/(2*g*U*n),s=(j*j-g*g-V*m)/(2*j*U*n),t=Math.log(Math.sqrt(r*r+1)-r),u=Math.log(Math.sqrt(s*s+1)-s);d=(u-t)/T,c=function(a){var b=a*d,c=o(t),h=g/(U*n)*(c*q(T*b+t)-p(t));return[e+h*k,f+h*l,g*c/o(T*b+t)]}}return c.duration=1e3*d,c},Y=r(f),Z=r(h),$=t(f),_=t(h),aa=u(f),ba=u(h),ca=function(a,b){for(var c=new Array(b),d=0;b>d;++d)c[d]=a(d/(b-1));return c};a.interpolate=M,a.interpolateArray=F,a.interpolateBasis=z,a.interpolateBasisClosed=A,a.interpolateDate=G,a.interpolateNumber=H,a.interpolateObject=I,a.interpolateRound=N,a.interpolateString=L,a.interpolateTransformCss=R,a.interpolateTransformSvg=S,a.interpolateZoom=X,a.interpolateRgb=C,a.interpolateRgbBasis=D,a.interpolateRgbBasisClosed=E,a.interpolateHsl=Y,a.interpolateHslLong=Z,a.interpolateLab=s,a.interpolateHcl=$,a.interpolateHclLong=_,a.interpolateCubehelix=aa,a.interpolateCubehelixLong=ba,a.quantize=ca,Object.defineProperty(a,"__esModule",{value:!0})})},{"d3-color":12}],12:[function(a,b,c){!function(a,d){"object"==typeof c&&"undefined"!=typeof b?d(c):"function"==typeof define&&define.amd?define(["exports"],d):d(a.d3=a.d3||{})}(this,function(a){"use strict";function b(a,b){var c=Object.create(a.prototype);for(var d in b)c[d]=b[d];return c}function c(){}function d(a){var b;return a=(a+"").trim().toLowerCase(),(b=H.exec(a))?(b=parseInt(b[1],16),new i(b>>8&15|b>>4&240,b>>4&15|240&b,(15&b)<<4|15&b,1)):(b=I.exec(a))?e(parseInt(b[1],16)):(b=J.exec(a))?new i(b[1],b[2],b[3],1):(b=K.exec(a))?new i(255*b[1]/100,255*b[2]/100,255*b[3]/100,1):(b=L.exec(a))?f(b[1],b[2],b[3],b[4]):(b=M.exec(a))?f(255*b[1]/100,255*b[2]/100,255*b[3]/100,b[4]):(b=N.exec(a))?j(b[1],b[2]/100,b[3]/100,1):(b=O.exec(a))?j(b[1],b[2]/100,b[3]/100,b[4]):P.hasOwnProperty(a)?e(P[a]):"transparent"===a?new i(NaN,NaN,NaN,0):null}function e(a){return new i(a>>16&255,a>>8&255,255&a,1)}function f(a,b,c,d){return 0>=d&&(a=b=c=NaN),new i(a,b,c,d)}function g(a){return a instanceof c||(a=d(a)),a?(a=a.rgb(),new i(a.r,a.g,a.b,a.opacity)):new i}function h(a,b,c,d){return 1===arguments.length?g(a):new i(a,b,c,null==d?1:d)}function i(a,b,c,d){this.r=+a,this.g=+b,this.b=+c,this.opacity=+d}function j(a,b,c,d){return 0>=d?a=b=c=NaN:0>=c||c>=1?a=b=NaN:0>=b&&(a=NaN),new m(a,b,c,d)}function k(a){if(a instanceof m)return new m(a.h,a.s,a.l,a.opacity);if(a instanceof c||(a=d(a)),!a)return new m;if(a instanceof m)return a;a=a.rgb();var b=a.r/255,e=a.g/255,f=a.b/255,g=Math.min(b,e,f),h=Math.max(b,e,f),i=NaN,j=h-g,k=(h+g)/2;return j?(i=b===h?(e-f)/j+6*(f>e):e===h?(f-b)/j+2:(b-e)/j+4,j/=.5>k?h+g:2-h-g,i*=60):j=k>0&&1>k?0:i,new m(i,j,k,a.opacity)}function l(a,b,c,d){return 1===arguments.length?k(a):new m(a,b,c,null==d?1:d)}function m(a,b,c,d){this.h=+a,this.s=+b,this.l=+c,this.opacity=+d}function n(a,b,c){return 255*(60>a?b+(c-b)*a/60:180>a?c:240>a?b+(c-b)*(240-a)/60:b)}function o(a){if(a instanceof q)return new q(a.l,a.a,a.b,a.opacity);if(a instanceof x){var b=a.h*Q;return new q(a.l,Math.cos(b)*a.c,Math.sin(b)*a.c,a.opacity)}a instanceof i||(a=g(a));var c=u(a.r),d=u(a.g),e=u(a.b),f=r((.4124564*c+.3575761*d+.1804375*e)/T),h=r((.2126729*c+.7151522*d+.072175*e)/U),j=r((.0193339*c+.119192*d+.9503041*e)/V);return new q(116*h-16,500*(f-h),200*(h-j),a.opacity)}function p(a,b,c,d){return 1===arguments.length?o(a):new q(a,b,c,null==d?1:d)}function q(a,b,c,d){this.l=+a,this.a=+b,this.b=+c,this.opacity=+d}function r(a){return a>Z?Math.pow(a,1/3):a/Y+W}function s(a){return a>X?a*a*a:Y*(a-W)}function t(a){return 255*(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function u(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function v(a){if(a instanceof x)return new x(a.h,a.c,a.l,a.opacity);a instanceof q||(a=o(a));var b=Math.atan2(a.b,a.a)*R;return new x(0>b?b+360:b,Math.sqrt(a.a*a.a+a.b*a.b),a.l,a.opacity)}function w(a,b,c,d){return 1===arguments.length?v(a):new x(a,b,c,null==d?1:d)}function x(a,b,c,d){this.h=+a,this.c=+b,this.l=+c,this.opacity=+d}function y(a){if(a instanceof A)return new A(a.h,a.s,a.l,a.opacity);a instanceof i||(a=g(a));var b=a.r/255,c=a.g/255,d=a.b/255,e=(fa*d+da*b-ea*c)/(fa+da-ea),f=d-e,h=(ca*(c-e)-aa*f)/ba,j=Math.sqrt(h*h+f*f)/(ca*e*(1-e)),k=j?Math.atan2(h,f)*R-120:NaN;return new A(0>k?k+360:k,j,e,a.opacity)}function z(a,b,c,d){return 1===arguments.length?y(a):new A(a,b,c,null==d?1:d)}function A(a,b,c,d){this.h=+a,this.s=+b,this.l=+c,this.opacity=+d}var B=function(a,b,c){a.prototype=b.prototype=c,c.constructor=a},C=.7,D=1/C,E="\\s*([+-]?\\d+)\\s*",F="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",G="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",H=/^#([0-9a-f]{3})$/,I=/^#([0-9a-f]{6})$/,J=new RegExp("^rgb\\("+[E,E,E]+"\\)$"),K=new RegExp("^rgb\\("+[G,G,G]+"\\)$"),L=new RegExp("^rgba\\("+[E,E,E,F]+"\\)$"),M=new RegExp("^rgba\\("+[G,G,G,F]+"\\)$"),N=new RegExp("^hsl\\("+[F,G,G]+"\\)$"),O=new RegExp("^hsla\\("+[F,G,G,F]+"\\)$"),P={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};B(c,d,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),B(i,h,b(c,{brighter:function(a){return a=null==a?D:Math.pow(D,a),new i(this.r*a,this.g*a,this.b*a,this.opacity)},darker:function(a){return a=null==a?C:Math.pow(C,a),new i(this.r*a,this.g*a,this.b*a,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var a=this.opacity;return a=isNaN(a)?1:Math.max(0,Math.min(1,a)),(1===a?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===a?")":", "+a+")")}})),B(m,l,b(c,{brighter:function(a){return a=null==a?D:Math.pow(D,a),new m(this.h,this.s,this.l*a,this.opacity)},darker:function(a){return a=null==a?C:Math.pow(C,a),new m(this.h,this.s,this.l*a,this.opacity)},rgb:function(){var a=this.h%360+360*(this.h<0),b=isNaN(a)||isNaN(this.s)?0:this.s,c=this.l,d=c+(.5>c?c:1-c)*b,e=2*c-d;return new i(n(a>=240?a-240:a+120,e,d),n(a,e,d),n(120>a?a+240:a-120,e,d),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var Q=Math.PI/180,R=180/Math.PI,S=18,T=.95047,U=1,V=1.08883,W=4/29,X=6/29,Y=3*X*X,Z=X*X*X;B(q,p,b(c,{brighter:function(a){return new q(this.l+S*(null==a?1:a),this.a,this.b,this.opacity)},darker:function(a){return new q(this.l-S*(null==a?1:a),this.a,this.b,this.opacity)},rgb:function(){var a=(this.l+16)/116,b=isNaN(this.a)?a:a+this.a/500,c=isNaN(this.b)?a:a-this.b/200;return a=U*s(a),b=T*s(b),c=V*s(c),new i(t(3.2404542*b-1.5371385*a-.4985314*c),t(-.969266*b+1.8760108*a+.041556*c),t(.0556434*b-.2040259*a+1.0572252*c),this.opacity)}})),B(x,w,b(c,{brighter:function(a){return new x(this.h,this.c,this.l+S*(null==a?1:a),this.opacity)},darker:function(a){return new x(this.h,this.c,this.l-S*(null==a?1:a),this.opacity)},rgb:function(){return o(this).rgb()}}));var $=-.14861,_=1.78277,aa=-.29227,ba=-.90649,ca=1.97294,da=ca*ba,ea=ca*_,fa=_*aa-ba*$;B(A,z,b(c,{brighter:function(a){return a=null==a?D:Math.pow(D,a),new A(this.h,this.s,this.l*a,this.opacity)},darker:function(a){return a=null==a?C:Math.pow(C,a),new A(this.h,this.s,this.l*a,this.opacity)},rgb:function(){var a=isNaN(this.h)?0:(this.h+120)*Q,b=+this.l,c=isNaN(this.s)?0:this.s*b*(1-b),d=Math.cos(a),e=Math.sin(a);return new i(255*(b+c*($*d+_*e)),255*(b+c*(aa*d+ba*e)),255*(b+c*(ca*d)),this.opacity)}})),a.color=d,a.rgb=h,a.hsl=l,a.lab=p,a.hcl=w,a.cubehelix=z,Object.defineProperty(a,"__esModule",{value:!0})})},{}],13:[function(a,b,c){!function(){function a(a){return a&&(a.ownerDocument||a.document||a).documentElement}function c(a){return a&&(a.ownerDocument&&a.ownerDocument.defaultView||a.document&&a||a.defaultView)}function d(a,b){return b>a?-1:a>b?1:a>=b?0:NaN}function e(a){return null===a?NaN:+a}function f(a){return!isNaN(a)}function g(a){return{left:function(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;a(b[f],c)<0?d=f+1:e=f}return d},right:function(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;a(b[f],c)>0?e=f:d=f+1}return d}}}function h(a){return a.length}function i(a){for(var b=1;a*b%1;)b*=10;return b}function j(a,b){for(var c in b)Object.defineProperty(a.prototype,c,{value:b[c],enumerable:!1})}function k(){this._=Object.create(null)}function l(a){return(a+="")===vg||a[0]===wg?wg+a:a}function m(a){return(a+="")[0]===wg?a.slice(1):a}function n(a){return l(a)in this._}function o(a){return(a=l(a))in this._&&delete this._[a]}function p(){var a=[];for(var b in this._)a.push(m(b));return a}function q(){var a=0;for(var b in this._)++a;return a}function r(){for(var a in this._)return!1;return!0}function s(){this._=Object.create(null)}function t(a){return a}function u(a,b,c){return function(){var d=c.apply(b,arguments);return d===b?a:d}}function v(a,b){if(b in a)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(var c=0,d=xg.length;d>c;++c){var e=xg[c]+b;if(e in a)return e}}function w(){}function x(){}function y(a){function b(){for(var b,d=c,e=-1,f=d.length;++e<f;)(b=d[e].on)&&b.apply(this,arguments);return a}var c=[],d=new k;return b.on=function(b,e){var f,g=d.get(b);return arguments.length<2?g&&g.on:(g&&(g.on=null,c=c.slice(0,f=c.indexOf(g)).concat(c.slice(f+1)),d.remove(b)),e&&c.push(d.set(b,{on:e})),a)},b}function z(){ig.event.preventDefault()}function A(){for(var a,b=ig.event;a=b.sourceEvent;)b=a;return b}function B(a){for(var b=new x,c=0,d=arguments.length;++c<d;)b[arguments[c]]=y(b);return b.of=function(c,d){return function(e){try{var f=e.sourceEvent=ig.event;e.target=a,ig.event=e,b[e.type].apply(c,d)}finally{ig.event=f}}},b}function C(a){return zg(a,Dg),a}function D(a){return"function"==typeof a?a:function(){return Ag(a,this)}}function E(a){return"function"==typeof a?a:function(){return Bg(a,this)}}function F(a,b){function c(){this.removeAttribute(a)}function d(){this.removeAttributeNS(a.space,a.local)}function e(){this.setAttribute(a,b)}function f(){this.setAttributeNS(a.space,a.local,b)}function g(){var c=b.apply(this,arguments);null==c?this.removeAttribute(a):this.setAttribute(a,c)}function h(){var c=b.apply(this,arguments);null==c?this.removeAttributeNS(a.space,a.local):this.setAttributeNS(a.space,a.local,c)}return a=ig.ns.qualify(a),null==b?a.local?d:c:"function"==typeof b?a.local?h:g:a.local?f:e}function G(a){return a.trim().replace(/\s+/g," ")}function H(a){return new RegExp("(?:^|\\s+)"+ig.requote(a)+"(?:\\s+|$)","g")}function I(a){return(a+"").trim().split(/^|\s+/)}function J(a,b){function c(){for(var c=-1;++c<e;)a[c](this,b)}function d(){for(var c=-1,d=b.apply(this,arguments);++c<e;)a[c](this,d)}a=I(a).map(K);var e=a.length;return"function"==typeof b?d:c}function K(a){var b=H(a);return function(c,d){if(e=c.classList)return d?e.add(a):e.remove(a);var e=c.getAttribute("class")||"";d?(b.lastIndex=0,b.test(e)||c.setAttribute("class",G(e+" "+a))):c.setAttribute("class",G(e.replace(b," ")))}}function L(a,b,c){function d(){this.style.removeProperty(a)}function e(){this.style.setProperty(a,b,c)}function f(){var d=b.apply(this,arguments);null==d?this.style.removeProperty(a):this.style.setProperty(a,d,c)}return null==b?d:"function"==typeof b?f:e}function M(a,b){function c(){delete this[a]}function d(){this[a]=b}function e(){var c=b.apply(this,arguments);null==c?delete this[a]:this[a]=c}return null==b?c:"function"==typeof b?e:d}function N(a){function b(){var b=this.ownerDocument,c=this.namespaceURI;return c===Eg&&b.documentElement.namespaceURI===Eg?b.createElement(a):b.createElementNS(c,a)}function c(){return this.ownerDocument.createElementNS(a.space,a.local)}return"function"==typeof a?a:(a=ig.ns.qualify(a)).local?c:b}function O(){var a=this.parentNode;a&&a.removeChild(this)}function P(a){return{__data__:a}}function Q(a){return function(){return Cg(this,a)}}function R(a){return arguments.length||(a=d),function(b,c){return b&&c?a(b.__data__,c.__data__):!b-!c}}function S(a,b){for(var c=0,d=a.length;d>c;c++)for(var e,f=a[c],g=0,h=f.length;h>g;g++)(e=f[g])&&b(e,g,c);return a}function T(a){return zg(a,Gg),a}function U(a){var b,c;return function(d,e,f){var g,h=a[f].update,i=h.length;for(f!=c&&(c=f,b=0),e>=b&&(b=e+1);!(g=h[b])&&++b<i;);return g}}function V(a,b,c){function d(){var b=this[g];b&&(this.removeEventListener(a,b,b.$),delete this[g])}function e(){var e=i(b,kg(arguments));d.call(this),this.addEventListener(a,this[g]=e,e.$=c),e._=b}function f(){var b,c=new RegExp("^__on([^.]+)"+ig.requote(a)+"$");for(var d in this)if(b=d.match(c)){var e=this[d];this.removeEventListener(b[1],e,e.$),delete this[d]}}var g="__on"+a,h=a.indexOf("."),i=W;h>0&&(a=a.slice(0,h));var j=Hg.get(a);return j&&(a=j,i=X),h?b?e:d:b?w:f}function W(a,b){return function(c){var d=ig.event;ig.event=c,b[0]=this.__data__;try{a.apply(this,b)}finally{ig.event=d}}}function X(a,b){var c=W(a,b);return function(a){var b=this,d=a.relatedTarget;d&&(d===b||8&d.compareDocumentPosition(b))||c.call(b,a)}}function Y(b){var d=".dragsuppress-"+ ++Jg,e="click"+d,f=ig.select(c(b)).on("touchmove"+d,z).on("dragstart"+d,z).on("selectstart"+d,z);if(null==Ig&&(Ig="onselectstart"in b?!1:v(b.style,"userSelect")),Ig){var g=a(b).style,h=g[Ig];g[Ig]="none"}return function(a){if(f.on(d,null),Ig&&(g[Ig]=h),a){var b=function(){f.on(e,null)};f.on(e,function(){z(),b()},!0),setTimeout(b,0)}}}function Z(a,b){b.changedTouches&&(b=b.changedTouches[0]);var d=a.ownerSVGElement||a;if(d.createSVGPoint){var e=d.createSVGPoint();if(0>Kg){var f=c(a);if(f.scrollX||f.scrollY){d=ig.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var g=d[0][0].getScreenCTM();Kg=!(g.f||g.e),d.remove()}}return Kg?(e.x=b.pageX,e.y=b.pageY):(e.x=b.clientX,e.y=b.clientY),e=e.matrixTransform(a.getScreenCTM().inverse()),[e.x,e.y]}var h=a.getBoundingClientRect();return[b.clientX-h.left-a.clientLeft,b.clientY-h.top-a.clientTop]}function $(){return ig.event.changedTouches[0].identifier}function _(a){return a>0?1:0>a?-1:0}function aa(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function ba(a){return a>1?0:-1>a?Ng:Math.acos(a)}function ca(a){return a>1?Qg:-1>a?-Qg:Math.asin(a)}function da(a){return((a=Math.exp(a))-1/a)/2}function ea(a){return((a=Math.exp(a))+1/a)/2}function fa(a){return((a=Math.exp(2*a))-1)/(a+1)}function ga(a){return(a=Math.sin(a/2))*a}function ha(){}function ia(a,b,c){return this instanceof ia?(this.h=+a,this.s=+b,void(this.l=+c)):arguments.length<2?a instanceof ia?new ia(a.h,a.s,a.l):wa(""+a,xa,ia):new ia(a,b,c)}function ja(a,b,c){function d(a){return a>360?a-=360:0>a&&(a+=360),60>a?f+(g-f)*a/60:180>a?g:240>a?f+(g-f)*(240-a)/60:f}function e(a){return Math.round(255*d(a))}var f,g;return a=isNaN(a)?0:(a%=360)<0?a+360:a,b=isNaN(b)?0:0>b?0:b>1?1:b,c=0>c?0:c>1?1:c,g=.5>=c?c*(1+b):c+b-c*b,f=2*c-g,new sa(e(a+120),e(a),e(a-120))}function ka(a,b,c){return this instanceof ka?(this.h=+a,this.c=+b,void(this.l=+c)):arguments.length<2?a instanceof ka?new ka(a.h,a.c,a.l):a instanceof ma?oa(a.l,a.a,a.b):oa((a=ya((a=ig.rgb(a)).r,a.g,a.b)).l,a.a,a.b):new ka(a,b,c)}function la(a,b,c){return isNaN(a)&&(a=0),isNaN(b)&&(b=0),new ma(c,Math.cos(a*=Rg)*b,Math.sin(a)*b)}function ma(a,b,c){return this instanceof ma?(this.l=+a,this.a=+b,void(this.b=+c)):arguments.length<2?a instanceof ma?new ma(a.l,a.a,a.b):a instanceof ka?la(a.h,a.c,a.l):ya((a=sa(a)).r,a.g,a.b):new ma(a,b,c)}function na(a,b,c){var d=(a+16)/116,e=d+b/500,f=d-c/200;return e=pa(e)*ah,d=pa(d)*bh,f=pa(f)*ch,new sa(ra(3.2404542*e-1.5371385*d-.4985314*f),ra(-.969266*e+1.8760108*d+.041556*f),ra(.0556434*e-.2040259*d+1.0572252*f))}function oa(a,b,c){return a>0?new ka(Math.atan2(c,b)*Sg,Math.sqrt(b*b+c*c),a):new ka(NaN,NaN,a)}function pa(a){return a>.206893034?a*a*a:(a-4/29)/7.787037}function qa(a){return a>.008856?Math.pow(a,1/3):7.787037*a+4/29}function ra(a){return Math.round(255*(.00304>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055))}function sa(a,b,c){return this instanceof sa?(this.r=~~a,this.g=~~b,void(this.b=~~c)):arguments.length<2?a instanceof sa?new sa(a.r,a.g,a.b):wa(""+a,sa,ja):new sa(a,b,c)}function ta(a){return new sa(a>>16,a>>8&255,255&a)}function ua(a){return ta(a)+""}function va(a){return 16>a?"0"+Math.max(0,a).toString(16):Math.min(255,a).toString(16)}function wa(a,b,c){var d,e,f,g=0,h=0,i=0;if(d=/([a-z]+)\((.*)\)/.exec(a=a.toLowerCase()))switch(e=d[2].split(","),d[1]){case"hsl":return c(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100);case"rgb":return b(Aa(e[0]),Aa(e[1]),Aa(e[2]))}return(f=fh.get(a))?b(f.r,f.g,f.b):(null==a||"#"!==a.charAt(0)||isNaN(f=parseInt(a.slice(1),16))||(4===a.length?(g=(3840&f)>>4,g=g>>4|g,h=240&f,h=h>>4|h,i=15&f,i=i<<4|i):7===a.length&&(g=(16711680&f)>>16,h=(65280&f)>>8,i=255&f)),b(g,h,i))}function xa(a,b,c){var d,e,f=Math.min(a/=255,b/=255,c/=255),g=Math.max(a,b,c),h=g-f,i=(g+f)/2;return h?(e=.5>i?h/(g+f):h/(2-g-f),d=a==g?(b-c)/h+(c>b?6:0):b==g?(c-a)/h+2:(a-b)/h+4,d*=60):(d=NaN,e=i>0&&1>i?0:d),new ia(d,e,i)}function ya(a,b,c){a=za(a),b=za(b),c=za(c);var d=qa((.4124564*a+.3575761*b+.1804375*c)/ah),e=qa((.2126729*a+.7151522*b+.072175*c)/bh),f=qa((.0193339*a+.119192*b+.9503041*c)/ch);return ma(116*e-16,500*(d-e),200*(e-f))}function za(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Aa(a){var b=parseFloat(a);return"%"===a.charAt(a.length-1)?Math.round(2.55*b):b}function Ba(a){return"function"==typeof a?a:function(){return a}}function Ca(a){return function(b,c,d){return 2===arguments.length&&"function"==typeof c&&(d=c,c=null),Da(b,c,a,d)}}function Da(a,b,c,d){function e(){var a,b=i.status;if(!b&&Fa(i)||b>=200&&300>b||304===b){try{a=c.call(f,i)}catch(d){return void g.error.call(f,d)}g.load.call(f,a)}else g.error.call(f,i)}var f={},g=ig.dispatch("beforesend","progress","load","error"),h={},i=new XMLHttpRequest,j=null;return!this.XDomainRequest||"withCredentials"in i||!/^(http(s)?:)?\/\//.test(a)||(i=new XDomainRequest),"onload"in i?i.onload=i.onerror=e:i.onreadystatechange=function(){i.readyState>3&&e()},i.onprogress=function(a){var b=ig.event;ig.event=a;try{g.progress.call(f,i)}finally{ig.event=b}},f.header=function(a,b){return a=(a+"").toLowerCase(),arguments.length<2?h[a]:(null==b?delete h[a]:h[a]=b+"",f)},f.mimeType=function(a){return arguments.length?(b=null==a?null:a+"",f):b},f.responseType=function(a){return arguments.length?(j=a,f):j},f.response=function(a){return c=a,f},["get","post"].forEach(function(a){f[a]=function(){return f.send.apply(f,[a].concat(kg(arguments)))}}),f.send=function(c,d,e){if(2===arguments.length&&"function"==typeof d&&(e=d,d=null),i.open(c,a,!0),null==b||"accept"in h||(h.accept=b+",*/*"),i.setRequestHeader)for(var k in h)i.setRequestHeader(k,h[k]);return null!=b&&i.overrideMimeType&&i.overrideMimeType(b),null!=j&&(i.responseType=j),null!=e&&f.on("error",e).on("load",function(a){e(null,a)}),g.beforesend.call(f,i),i.send(null==d?null:d),f},f.abort=function(){return i.abort(),f},ig.rebind(f,g,"on"),null==d?f:f.get(Ea(d))}function Ea(a){return 1===a.length?function(b,c){a(null==b?c:null)}:a}function Fa(a){var b=a.responseType;return b&&"text"!==b?a.response:a.responseText}function Ga(a,b,c){var d=arguments.length;2>d&&(b=0),3>d&&(c=Date.now());var e=c+b,f={c:a,t:e,n:null};return hh?hh.n=f:gh=f,hh=f,ih||(jh=clearTimeout(jh),ih=1,kh(Ha)),f}function Ha(){var a=Ia(),b=Ja()-a;b>24?(isFinite(b)&&(clearTimeout(jh),jh=setTimeout(Ha,b)),ih=0):(ih=1,kh(Ha))}function Ia(){for(var a=Date.now(),b=gh;b;)a>=b.t&&b.c(a-b.t)&&(b.c=null),b=b.n;return a}function Ja(){for(var a,b=gh,c=1/0;b;)b.c?(b.t<c&&(c=b.t),b=(a=b).n):b=a?a.n=b.n:gh=b.n;return hh=a,c}function Ka(a,b){return b-(a?Math.ceil(Math.log(a)/Math.LN10):1)}function La(a,b){var c=Math.pow(10,3*ug(8-b));return{scale:b>8?function(a){return a/c}:function(a){return a*c},symbol:a}}function Ma(a){var b=a.decimal,c=a.thousands,d=a.grouping,e=a.currency,f=d&&c?function(a,b){for(var e=a.length,f=[],g=0,h=d[0],i=0;e>0&&h>0&&(i+h+1>b&&(h=Math.max(1,b-i)),f.push(a.substring(e-=h,e+h)),!((i+=h+1)>b));)h=d[g=(g+1)%d.length];return f.reverse().join(c)}:t;return function(a){var c=mh.exec(a),d=c[1]||" ",g=c[2]||">",h=c[3]||"-",i=c[4]||"",j=c[5],k=+c[6],l=c[7],m=c[8],n=c[9],o=1,p="",q="",r=!1,s=!0;switch(m&&(m=+m.substring(1)),(j||"0"===d&&"="===g)&&(j=d="0",g="="),n){case"n":l=!0,n="g";break;case"%":o=100,q="%",n="f";break;case"p":o=100,q="%",n="r";break;case"b":case"o":case"x":case"X":"#"===i&&(p="0"+n.toLowerCase());case"c":s=!1;case"d":r=!0,m=0;break;case"s":o=-1,n="r"}"$"===i&&(p=e[0],q=e[1]),"r"!=n||m||(n="g"),null!=m&&("g"==n?m=Math.max(1,Math.min(21,m)):("e"==n||"f"==n)&&(m=Math.max(0,Math.min(20,m)))),n=nh.get(n)||Na;var t=j&&l;return function(a){var c=q;if(r&&a%1)return"";var e=0>a||0===a&&0>1/a?(a=-a,"-"):"-"===h?"":h;if(0>o){var i=ig.formatPrefix(a,m);a=i.scale(a),c=i.symbol+q}else a*=o;a=n(a,m);var u,v,w=a.lastIndexOf(".");if(0>w){var x=s?a.lastIndexOf("e"):-1;0>x?(u=a,v=""):(u=a.substring(0,x),v=a.substring(x))}else u=a.substring(0,w),v=b+a.substring(w+1);!j&&l&&(u=f(u,1/0));var y=p.length+u.length+v.length+(t?0:e.length),z=k>y?new Array(y=k-y+1).join(d):"";return t&&(u=f(z+u,z.length?k-v.length:1/0)),e+=p,a=u+v,("<"===g?e+a+z:">"===g?z+e+a:"^"===g?z.substring(0,y>>=1)+e+a+z.substring(y):e+(t?a:z+a))+c}}}function Na(a){return a+""}function Oa(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Pa(a,b,c){function d(b){var c=a(b),d=f(c,1);return d-b>b-c?c:d}function e(c){return b(c=a(new ph(c-1)),1),c}function f(a,c){return b(a=new ph(+a),c),a}function g(a,d,f){var g=e(a),h=[];if(f>1)for(;d>g;)c(g)%f||h.push(new Date(+g)),b(g,1);else for(;d>g;)h.push(new Date(+g)),b(g,1);return h}function h(a,b,c){try{ph=Oa;var d=new Oa;return d._=a,g(d,b,c)}finally{ph=Date}}a.floor=a,a.round=d,a.ceil=e,a.offset=f,a.range=g;var i=a.utc=Qa(a);return i.floor=i,
i.round=Qa(d),i.ceil=Qa(e),i.offset=Qa(f),i.range=h,a}function Qa(a){return function(b,c){try{ph=Oa;var d=new Oa;return d._=b,a(d,c)._}finally{ph=Date}}}function Ra(a){function b(a){function b(b){for(var c,e,f,g=[],h=-1,i=0;++h<d;)37===a.charCodeAt(h)&&(g.push(a.slice(i,h)),null!=(e=rh[c=a.charAt(++h)])&&(c=a.charAt(++h)),(f=C[c])&&(c=f(b,null==e?"e"===c?" ":"0":e)),g.push(c),i=h+1);return g.push(a.slice(i,h)),g.join("")}var d=a.length;return b.parse=function(b){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},e=c(d,a,b,0);if(e!=b.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);var f=null!=d.Z&&ph!==Oa,g=new(f?Oa:ph);return"j"in d?g.setFullYear(d.y,0,d.j):"W"in d||"U"in d?("w"in d||(d.w="W"in d?1:0),g.setFullYear(d.y,0,1),g.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(g.getDay()+5)%7:d.w+7*d.U-(g.getDay()+6)%7)):g.setFullYear(d.y,d.m,d.d),g.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L),f?g._:g},b.toString=function(){return a},b}function c(a,b,c,d){for(var e,f,g,h=0,i=b.length,j=c.length;i>h;){if(d>=j)return-1;if(e=b.charCodeAt(h++),37===e){if(g=b.charAt(h++),f=D[g in rh?b.charAt(h++):g],!f||(d=f(a,c,d))<0)return-1}else if(e!=c.charCodeAt(d++))return-1}return d}function d(a,b,c){w.lastIndex=0;var d=w.exec(b.slice(c));return d?(a.w=x.get(d[0].toLowerCase()),c+d[0].length):-1}function e(a,b,c){u.lastIndex=0;var d=u.exec(b.slice(c));return d?(a.w=v.get(d[0].toLowerCase()),c+d[0].length):-1}function f(a,b,c){A.lastIndex=0;var d=A.exec(b.slice(c));return d?(a.m=B.get(d[0].toLowerCase()),c+d[0].length):-1}function g(a,b,c){y.lastIndex=0;var d=y.exec(b.slice(c));return d?(a.m=z.get(d[0].toLowerCase()),c+d[0].length):-1}function h(a,b,d){return c(a,C.c.toString(),b,d)}function i(a,b,d){return c(a,C.x.toString(),b,d)}function j(a,b,d){return c(a,C.X.toString(),b,d)}function k(a,b,c){var d=t.get(b.slice(c,c+=2).toLowerCase());return null==d?-1:(a.p=d,c)}var l=a.dateTime,m=a.date,n=a.time,o=a.periods,p=a.days,q=a.shortDays,r=a.months,s=a.shortMonths;b.utc=function(a){function c(a){try{ph=Oa;var b=new ph;return b._=a,d(b)}finally{ph=Date}}var d=b(a);return c.parse=function(a){try{ph=Oa;var b=d.parse(a);return b&&b._}finally{ph=Date}},c.toString=d.toString,c},b.multi=b.utc.multi=jb;var t=ig.map(),u=Ta(p),v=Ua(p),w=Ta(q),x=Ua(q),y=Ta(r),z=Ua(r),A=Ta(s),B=Ua(s);o.forEach(function(a,b){t.set(a.toLowerCase(),b)});var C={a:function(a){return q[a.getDay()]},A:function(a){return p[a.getDay()]},b:function(a){return s[a.getMonth()]},B:function(a){return r[a.getMonth()]},c:b(l),d:function(a,b){return Sa(a.getDate(),b,2)},e:function(a,b){return Sa(a.getDate(),b,2)},H:function(a,b){return Sa(a.getHours(),b,2)},I:function(a,b){return Sa(a.getHours()%12||12,b,2)},j:function(a,b){return Sa(1+oh.dayOfYear(a),b,3)},L:function(a,b){return Sa(a.getMilliseconds(),b,3)},m:function(a,b){return Sa(a.getMonth()+1,b,2)},M:function(a,b){return Sa(a.getMinutes(),b,2)},p:function(a){return o[+(a.getHours()>=12)]},S:function(a,b){return Sa(a.getSeconds(),b,2)},U:function(a,b){return Sa(oh.sundayOfYear(a),b,2)},w:function(a){return a.getDay()},W:function(a,b){return Sa(oh.mondayOfYear(a),b,2)},x:b(m),X:b(n),y:function(a,b){return Sa(a.getFullYear()%100,b,2)},Y:function(a,b){return Sa(a.getFullYear()%1e4,b,4)},Z:hb,"%":function(){return"%"}},D={a:d,A:e,b:f,B:g,c:h,d:bb,e:bb,H:db,I:db,j:cb,L:gb,m:ab,M:eb,p:k,S:fb,U:Wa,w:Va,W:Xa,x:i,X:j,y:Za,Y:Ya,Z:$a,"%":ib};return b}function Sa(a,b,c){var d=0>a?"-":"",e=(d?-a:a)+"",f=e.length;return d+(c>f?new Array(c-f+1).join(b)+e:e)}function Ta(a){return new RegExp("^(?:"+a.map(ig.requote).join("|")+")","i")}function Ua(a){for(var b=new k,c=-1,d=a.length;++c<d;)b.set(a[c].toLowerCase(),c);return b}function Va(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+1));return d?(a.w=+d[0],c+d[0].length):-1}function Wa(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c));return d?(a.U=+d[0],c+d[0].length):-1}function Xa(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c));return d?(a.W=+d[0],c+d[0].length):-1}function Ya(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+4));return d?(a.y=+d[0],c+d[0].length):-1}function Za(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+2));return d?(a.y=_a(+d[0]),c+d[0].length):-1}function $a(a,b,c){return/^[+-]\d{4}$/.test(b=b.slice(c,c+5))?(a.Z=-b,c+5):-1}function _a(a){return a+(a>68?1900:2e3)}function ab(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+2));return d?(a.m=d[0]-1,c+d[0].length):-1}function bb(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+2));return d?(a.d=+d[0],c+d[0].length):-1}function cb(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+3));return d?(a.j=+d[0],c+d[0].length):-1}function db(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+2));return d?(a.H=+d[0],c+d[0].length):-1}function eb(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+2));return d?(a.M=+d[0],c+d[0].length):-1}function fb(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+2));return d?(a.S=+d[0],c+d[0].length):-1}function gb(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+3));return d?(a.L=+d[0],c+d[0].length):-1}function hb(a){var b=a.getTimezoneOffset(),c=b>0?"-":"+",d=ug(b)/60|0,e=ug(b)%60;return c+Sa(d,"0",2)+Sa(e,"0",2)}function ib(a,b,c){th.lastIndex=0;var d=th.exec(b.slice(c,c+1));return d?c+d[0].length:-1}function jb(a){for(var b=a.length,c=-1;++c<b;)a[c][0]=this(a[c][0]);return function(b){for(var c=0,d=a[c];!d[1](b);)d=a[++c];return d[0](b)}}function kb(){}function lb(a,b,c){var d=c.s=a+b,e=d-a,f=d-e;c.t=a-f+(b-e)}function mb(a,b){a&&xh.hasOwnProperty(a.type)&&xh[a.type](a,b)}function nb(a,b,c){var d,e=-1,f=a.length-c;for(b.lineStart();++e<f;)d=a[e],b.point(d[0],d[1],d[2]);b.lineEnd()}function ob(a,b){var c=-1,d=a.length;for(b.polygonStart();++c<d;)nb(a[c],b,1);b.polygonEnd()}function pb(){function a(a,b){a*=Rg,b=b*Rg/2+Ng/4;var c=a-d,g=c>=0?1:-1,h=g*c,i=Math.cos(b),j=Math.sin(b),k=f*j,l=e*i+k*Math.cos(h),m=k*g*Math.sin(h);zh.add(Math.atan2(m,l)),d=a,e=i,f=j}var b,c,d,e,f;Ah.point=function(g,h){Ah.point=a,d=(b=g)*Rg,e=Math.cos(h=(c=h)*Rg/2+Ng/4),f=Math.sin(h)},Ah.lineEnd=function(){a(b,c)}}function qb(a){var b=a[0],c=a[1],d=Math.cos(c);return[d*Math.cos(b),d*Math.sin(b),Math.sin(c)]}function rb(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function sb(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function tb(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function ub(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function vb(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=b,a[1]/=b,a[2]/=b}function wb(a){return[Math.atan2(a[1],a[0]),ca(a[2])]}function xb(a,b){return ug(a[0]-b[0])<Lg&&ug(a[1]-b[1])<Lg}function yb(a,b){a*=Rg;var c=Math.cos(b*=Rg);zb(c*Math.cos(a),c*Math.sin(a),Math.sin(b))}function zb(a,b,c){++Bh,Dh+=(a-Dh)/Bh,Eh+=(b-Eh)/Bh,Fh+=(c-Fh)/Bh}function Ab(){function a(a,e){a*=Rg;var f=Math.cos(e*=Rg),g=f*Math.cos(a),h=f*Math.sin(a),i=Math.sin(e),j=Math.atan2(Math.sqrt((j=c*i-d*h)*j+(j=d*g-b*i)*j+(j=b*h-c*g)*j),b*g+c*h+d*i);Ch+=j,Gh+=j*(b+(b=g)),Hh+=j*(c+(c=h)),Ih+=j*(d+(d=i)),zb(b,c,d)}var b,c,d;Mh.point=function(e,f){e*=Rg;var g=Math.cos(f*=Rg);b=g*Math.cos(e),c=g*Math.sin(e),d=Math.sin(f),Mh.point=a,zb(b,c,d)}}function Bb(){Mh.point=yb}function Cb(){function a(a,b){a*=Rg;var c=Math.cos(b*=Rg),g=c*Math.cos(a),h=c*Math.sin(a),i=Math.sin(b),j=e*i-f*h,k=f*g-d*i,l=d*h-e*g,m=Math.sqrt(j*j+k*k+l*l),n=d*g+e*h+f*i,o=m&&-ba(n)/m,p=Math.atan2(m,n);Jh+=o*j,Kh+=o*k,Lh+=o*l,Ch+=p,Gh+=p*(d+(d=g)),Hh+=p*(e+(e=h)),Ih+=p*(f+(f=i)),zb(d,e,f)}var b,c,d,e,f;Mh.point=function(g,h){b=g,c=h,Mh.point=a,g*=Rg;var i=Math.cos(h*=Rg);d=i*Math.cos(g),e=i*Math.sin(g),f=Math.sin(h),zb(d,e,f)},Mh.lineEnd=function(){a(b,c),Mh.lineEnd=Bb,Mh.point=yb}}function Db(a,b){function c(c,d){return c=a(c,d),b(c[0],c[1])}return a.invert&&b.invert&&(c.invert=function(c,d){return c=b.invert(c,d),c&&a.invert(c[0],c[1])}),c}function Eb(){return!0}function Fb(a,b,c,d,e){var f=[],g=[];if(a.forEach(function(a){if(!((b=a.length-1)<=0)){var b,c=a[0],d=a[b];if(xb(c,d)){e.lineStart();for(var h=0;b>h;++h)e.point((c=a[h])[0],c[1]);return void e.lineEnd()}var i=new Hb(c,a,null,!0),j=new Hb(c,null,i,!1);i.o=j,f.push(i),g.push(j),i=new Hb(d,a,null,!1),j=new Hb(d,null,i,!0),i.o=j,f.push(i),g.push(j)}}),g.sort(b),Gb(f),Gb(g),f.length){for(var h=0,i=c,j=g.length;j>h;++h)g[h].e=i=!i;for(var k,l,m=f[0];;){for(var n=m,o=!0;n.v;)if((n=n.n)===m)return;k=n.z,e.lineStart();do{if(n.v=n.o.v=!0,n.e){if(o)for(var h=0,j=k.length;j>h;++h)e.point((l=k[h])[0],l[1]);else d(n.x,n.n.x,1,e);n=n.n}else{if(o){k=n.p.z;for(var h=k.length-1;h>=0;--h)e.point((l=k[h])[0],l[1])}else d(n.x,n.p.x,-1,e);n=n.p}n=n.o,k=n.z,o=!o}while(!n.v);e.lineEnd()}}}function Gb(a){if(b=a.length){for(var b,c,d=0,e=a[0];++d<b;)e.n=c=a[d],c.p=e,e=c;e.n=c=a[0],c.p=e}}function Hb(a,b,c,d){this.x=a,this.z=b,this.o=c,this.e=d,this.v=!1,this.n=this.p=null}function Ib(a,b,c,d){return function(e,f){function g(b,c){var d=e(b,c);a(b=d[0],c=d[1])&&f.point(b,c)}function h(a,b){var c=e(a,b);q.point(c[0],c[1])}function i(){s.point=h,q.lineStart()}function j(){s.point=g,q.lineEnd()}function k(a,b){p.push([a,b]);var c=e(a,b);u.point(c[0],c[1])}function l(){u.lineStart(),p=[]}function m(){k(p[0][0],p[0][1]),u.lineEnd();var a,b=u.clean(),c=t.buffer(),d=c.length;if(p.pop(),o.push(p),p=null,d)if(1&b){a=c[0];var e,d=a.length-1,g=-1;if(d>0){for(v||(f.polygonStart(),v=!0),f.lineStart();++g<d;)f.point((e=a[g])[0],e[1]);f.lineEnd()}}else d>1&&2&b&&c.push(c.pop().concat(c.shift())),n.push(c.filter(Jb))}var n,o,p,q=b(f),r=e.invert(d[0],d[1]),s={point:g,lineStart:i,lineEnd:j,polygonStart:function(){s.point=k,s.lineStart=l,s.lineEnd=m,n=[],o=[]},polygonEnd:function(){s.point=g,s.lineStart=i,s.lineEnd=j,n=ig.merge(n);var a=Pb(r,o);n.length?(v||(f.polygonStart(),v=!0),Fb(n,Lb,a,c,f)):a&&(v||(f.polygonStart(),v=!0),f.lineStart(),c(null,null,1,f),f.lineEnd()),v&&(f.polygonEnd(),v=!1),n=o=null},sphere:function(){f.polygonStart(),f.lineStart(),c(null,null,1,f),f.lineEnd(),f.polygonEnd()}},t=Kb(),u=b(t),v=!1;return s}}function Jb(a){return a.length>1}function Kb(){var a,b=[];return{lineStart:function(){b.push(a=[])},point:function(b,c){a.push([b,c])},lineEnd:w,buffer:function(){var c=b;return b=[],a=null,c},rejoin:function(){b.length>1&&b.push(b.pop().concat(b.shift()))}}}function Lb(a,b){return((a=a.x)[0]<0?a[1]-Qg-Lg:Qg-a[1])-((b=b.x)[0]<0?b[1]-Qg-Lg:Qg-b[1])}function Mb(a){var b,c=NaN,d=NaN,e=NaN;return{lineStart:function(){a.lineStart(),b=1},point:function(f,g){var h=f>0?Ng:-Ng,i=ug(f-c);ug(i-Ng)<Lg?(a.point(c,d=(d+g)/2>0?Qg:-Qg),a.point(e,d),a.lineEnd(),a.lineStart(),a.point(h,d),a.point(f,d),b=0):e!==h&&i>=Ng&&(ug(c-e)<Lg&&(c-=e*Lg),ug(f-h)<Lg&&(f-=h*Lg),d=Nb(c,d,f,g),a.point(e,d),a.lineEnd(),a.lineStart(),a.point(h,d),b=0),a.point(c=f,d=g),e=h},lineEnd:function(){a.lineEnd(),c=d=NaN},clean:function(){return 2-b}}}function Nb(a,b,c,d){var e,f,g=Math.sin(a-c);return ug(g)>Lg?Math.atan((Math.sin(b)*(f=Math.cos(d))*Math.sin(c)-Math.sin(d)*(e=Math.cos(b))*Math.sin(a))/(e*f*g)):(b+d)/2}function Ob(a,b,c,d){var e;if(null==a)e=c*Qg,d.point(-Ng,e),d.point(0,e),d.point(Ng,e),d.point(Ng,0),d.point(Ng,-e),d.point(0,-e),d.point(-Ng,-e),d.point(-Ng,0),d.point(-Ng,e);else if(ug(a[0]-b[0])>Lg){var f=a[0]<b[0]?Ng:-Ng;e=c*f/2,d.point(-f,e),d.point(0,e),d.point(f,e)}else d.point(b[0],b[1])}function Pb(a,b){var c=a[0],d=a[1],e=[Math.sin(c),-Math.cos(c),0],f=0,g=0;zh.reset();for(var h=0,i=b.length;i>h;++h){var j=b[h],k=j.length;if(k)for(var l=j[0],m=l[0],n=l[1]/2+Ng/4,o=Math.sin(n),p=Math.cos(n),q=1;;){q===k&&(q=0),a=j[q];var r=a[0],s=a[1]/2+Ng/4,t=Math.sin(s),u=Math.cos(s),v=r-m,w=v>=0?1:-1,x=w*v,y=x>Ng,z=o*t;if(zh.add(Math.atan2(z*w*Math.sin(x),p*u+z*Math.cos(x))),f+=y?v+w*Og:v,y^m>=c^r>=c){var A=sb(qb(l),qb(a));vb(A);var B=sb(e,A);vb(B);var C=(y^v>=0?-1:1)*ca(B[2]);(d>C||d===C&&(A[0]||A[1]))&&(g+=y^v>=0?1:-1)}if(!q++)break;m=r,o=t,p=u,l=a}}return(-Lg>f||Lg>f&&-Lg>zh)^1&g}function Qb(a){function b(a,b){return Math.cos(a)*Math.cos(b)>f}function c(a){var c,f,i,j,k;return{lineStart:function(){j=i=!1,k=1},point:function(l,m){var n,o=[l,m],p=b(l,m),q=g?p?0:e(l,m):p?e(l+(0>l?Ng:-Ng),m):0;if(!c&&(j=i=p)&&a.lineStart(),p!==i&&(n=d(c,o),(xb(c,n)||xb(o,n))&&(o[0]+=Lg,o[1]+=Lg,p=b(o[0],o[1]))),p!==i)k=0,p?(a.lineStart(),n=d(o,c),a.point(n[0],n[1])):(n=d(c,o),a.point(n[0],n[1]),a.lineEnd()),c=n;else if(h&&c&&g^p){var r;q&f||!(r=d(o,c,!0))||(k=0,g?(a.lineStart(),a.point(r[0][0],r[0][1]),a.point(r[1][0],r[1][1]),a.lineEnd()):(a.point(r[1][0],r[1][1]),a.lineEnd(),a.lineStart(),a.point(r[0][0],r[0][1])))}!p||c&&xb(c,o)||a.point(o[0],o[1]),c=o,i=p,f=q},lineEnd:function(){i&&a.lineEnd(),c=null},clean:function(){return k|(j&&i)<<1}}}function d(a,b,c){var d=qb(a),e=qb(b),g=[1,0,0],h=sb(d,e),i=rb(h,h),j=h[0],k=i-j*j;if(!k)return!c&&a;var l=f*i/k,m=-f*j/k,n=sb(g,h),o=ub(g,l),p=ub(h,m);tb(o,p);var q=n,r=rb(o,q),s=rb(q,q),t=r*r-s*(rb(o,o)-1);if(!(0>t)){var u=Math.sqrt(t),v=ub(q,(-r-u)/s);if(tb(v,o),v=wb(v),!c)return v;var w,x=a[0],y=b[0],z=a[1],A=b[1];x>y&&(w=x,x=y,y=w);var B=y-x,C=ug(B-Ng)<Lg,D=C||Lg>B;if(!C&&z>A&&(w=z,z=A,A=w),D?C?z+A>0^v[1]<(ug(v[0]-x)<Lg?z:A):z<=v[1]&&v[1]<=A:B>Ng^(x<=v[0]&&v[0]<=y)){var E=ub(q,(-r+u)/s);return tb(E,o),[v,wb(E)]}}}function e(b,c){var d=g?a:Ng-a,e=0;return-d>b?e|=1:b>d&&(e|=2),-d>c?e|=4:c>d&&(e|=8),e}var f=Math.cos(a),g=f>0,h=ug(f)>Lg,i=pc(a,6*Rg);return Ib(b,c,i,g?[0,-a]:[-Ng,a-Ng])}function Rb(a,b,c,d){return function(e){var f,g=e.a,h=e.b,i=g.x,j=g.y,k=h.x,l=h.y,m=0,n=1,o=k-i,p=l-j;if(f=a-i,o||!(f>0)){if(f/=o,0>o){if(m>f)return;n>f&&(n=f)}else if(o>0){if(f>n)return;f>m&&(m=f)}if(f=c-i,o||!(0>f)){if(f/=o,0>o){if(f>n)return;f>m&&(m=f)}else if(o>0){if(m>f)return;n>f&&(n=f)}if(f=b-j,p||!(f>0)){if(f/=p,0>p){if(m>f)return;n>f&&(n=f)}else if(p>0){if(f>n)return;f>m&&(m=f)}if(f=d-j,p||!(0>f)){if(f/=p,0>p){if(f>n)return;f>m&&(m=f)}else if(p>0){if(m>f)return;n>f&&(n=f)}return m>0&&(e.a={x:i+m*o,y:j+m*p}),1>n&&(e.b={x:i+n*o,y:j+n*p}),e}}}}}}function Sb(a,b,c,d){function e(d,e){return ug(d[0]-a)<Lg?e>0?0:3:ug(d[0]-c)<Lg?e>0?2:1:ug(d[1]-b)<Lg?e>0?1:0:e>0?3:2}function f(a,b){return g(a.x,b.x)}function g(a,b){var c=e(a,1),d=e(b,1);return c!==d?c-d:0===c?b[1]-a[1]:1===c?a[0]-b[0]:2===c?a[1]-b[1]:b[0]-a[0]}return function(h){function i(a){for(var b=0,c=q.length,d=a[1],e=0;c>e;++e)for(var f,g=1,h=q[e],i=h.length,j=h[0];i>g;++g)f=h[g],j[1]<=d?f[1]>d&&aa(j,f,a)>0&&++b:f[1]<=d&&aa(j,f,a)<0&&--b,j=f;return 0!==b}function j(f,h,i,j){var k=0,l=0;if(null==f||(k=e(f,i))!==(l=e(h,i))||g(f,h)<0^i>0){do j.point(0===k||3===k?a:c,k>1?d:b);while((k=(k+i+4)%4)!==l)}else j.point(h[0],h[1])}function k(e,f){return e>=a&&c>=e&&f>=b&&d>=f}function l(a,b){k(a,b)&&h.point(a,b)}function m(){D.point=o,q&&q.push(r=[]),y=!0,x=!1,v=w=NaN}function n(){p&&(o(s,t),u&&x&&B.rejoin(),p.push(B.buffer())),D.point=l,x&&h.lineEnd()}function o(a,b){a=Math.max(-Oh,Math.min(Oh,a)),b=Math.max(-Oh,Math.min(Oh,b));var c=k(a,b);if(q&&r.push([a,b]),y)s=a,t=b,u=c,y=!1,c&&(h.lineStart(),h.point(a,b));else if(c&&x)h.point(a,b);else{var d={a:{x:v,y:w},b:{x:a,y:b}};C(d)?(x||(h.lineStart(),h.point(d.a.x,d.a.y)),h.point(d.b.x,d.b.y),c||h.lineEnd(),z=!1):c&&(h.lineStart(),h.point(a,b),z=!1)}v=a,w=b,x=c}var p,q,r,s,t,u,v,w,x,y,z,A=h,B=Kb(),C=Rb(a,b,c,d),D={point:l,lineStart:m,lineEnd:n,polygonStart:function(){h=B,p=[],q=[],z=!0},polygonEnd:function(){h=A,p=ig.merge(p);var b=i([a,d]),c=z&&b,e=p.length;(c||e)&&(h.polygonStart(),c&&(h.lineStart(),j(null,null,1,h),h.lineEnd()),e&&Fb(p,f,b,j,h),h.polygonEnd()),p=q=r=null}};return D}}function Tb(a){var b=0,c=Ng/3,d=hc(a),e=d(b,c);return e.parallels=function(a){return arguments.length?d(b=a[0]*Ng/180,c=a[1]*Ng/180):[b/Ng*180,c/Ng*180]},e}function Ub(a,b){function c(a,b){var c=Math.sqrt(f-2*e*Math.sin(b))/e;return[c*Math.sin(a*=e),g-c*Math.cos(a)]}var d=Math.sin(a),e=(d+Math.sin(b))/2,f=1+d*(2*e-d),g=Math.sqrt(f)/e;return c.invert=function(a,b){var c=g-b;return[Math.atan2(a,c)/e,ca((f-(a*a+c*c)*e*e)/(2*e))]},c}function Vb(){function a(a,b){Qh+=e*a-d*b,d=a,e=b}var b,c,d,e;Vh.point=function(f,g){Vh.point=a,b=d=f,c=e=g},Vh.lineEnd=function(){a(b,c)}}function Wb(a,b){Rh>a&&(Rh=a),a>Th&&(Th=a),Sh>b&&(Sh=b),b>Uh&&(Uh=b)}function Xb(){function a(a,b){g.push("M",a,",",b,f)}function b(a,b){g.push("M",a,",",b),h.point=c}function c(a,b){g.push("L",a,",",b)}function d(){h.point=a}function e(){g.push("Z")}var f=Yb(4.5),g=[],h={point:a,lineStart:function(){h.point=b},lineEnd:d,polygonStart:function(){h.lineEnd=e},polygonEnd:function(){h.lineEnd=d,h.point=a},pointRadius:function(a){return f=Yb(a),h},result:function(){if(g.length){var a=g.join("");return g=[],a}}};return h}function Yb(a){return"m0,"+a+"a"+a+","+a+" 0 1,1 0,"+-2*a+"a"+a+","+a+" 0 1,1 0,"+2*a+"z"}function Zb(a,b){Dh+=a,Eh+=b,++Fh}function $b(){function a(a,d){var e=a-b,f=d-c,g=Math.sqrt(e*e+f*f);Gh+=g*(b+a)/2,Hh+=g*(c+d)/2,Ih+=g,Zb(b=a,c=d)}var b,c;Xh.point=function(d,e){Xh.point=a,Zb(b=d,c=e)}}function _b(){Xh.point=Zb}function ac(){function a(a,b){var c=a-d,f=b-e,g=Math.sqrt(c*c+f*f);Gh+=g*(d+a)/2,Hh+=g*(e+b)/2,Ih+=g,g=e*a-d*b,Jh+=g*(d+a),Kh+=g*(e+b),Lh+=3*g,Zb(d=a,e=b)}var b,c,d,e;Xh.point=function(f,g){Xh.point=a,Zb(b=d=f,c=e=g)},Xh.lineEnd=function(){a(b,c)}}function bc(a){function b(b,c){a.moveTo(b+g,c),a.arc(b,c,g,0,Og)}function c(b,c){a.moveTo(b,c),h.point=d}function d(b,c){a.lineTo(b,c)}function e(){h.point=b}function f(){a.closePath()}var g=4.5,h={point:b,lineStart:function(){h.point=c},lineEnd:e,polygonStart:function(){h.lineEnd=f},polygonEnd:function(){h.lineEnd=e,h.point=b},pointRadius:function(a){return g=a,h},result:w};return h}function cc(a){function b(a){return(h?d:c)(a)}function c(b){return fc(b,function(c,d){c=a(c,d),b.point(c[0],c[1])})}function d(b){function c(c,d){c=a(c,d),b.point(c[0],c[1])}function d(){t=NaN,y.point=f,b.lineStart()}function f(c,d){var f=qb([c,d]),g=a(c,d);e(t,u,s,v,w,x,t=g[0],u=g[1],s=c,v=f[0],w=f[1],x=f[2],h,b),b.point(t,u)}function g(){y.point=c,b.lineEnd()}function i(){d(),y.point=j,y.lineEnd=k}function j(a,b){f(l=a,m=b),n=t,o=u,p=v,q=w,r=x,y.point=f}function k(){e(t,u,s,v,w,x,n,o,l,p,q,r,h,b),y.lineEnd=g,g()}var l,m,n,o,p,q,r,s,t,u,v,w,x,y={point:c,lineStart:d,lineEnd:g,polygonStart:function(){b.polygonStart(),y.lineStart=i},polygonEnd:function(){b.polygonEnd(),y.lineStart=d}};return y}function e(b,c,d,h,i,j,k,l,m,n,o,p,q,r){var s=k-b,t=l-c,u=s*s+t*t;if(u>4*f&&q--){var v=h+n,w=i+o,x=j+p,y=Math.sqrt(v*v+w*w+x*x),z=Math.asin(x/=y),A=ug(ug(x)-1)<Lg||ug(d-m)<Lg?(d+m)/2:Math.atan2(w,v),B=a(A,z),C=B[0],D=B[1],E=C-b,F=D-c,G=t*E-s*F;(G*G/u>f||ug((s*E+t*F)/u-.5)>.3||g>h*n+i*o+j*p)&&(e(b,c,d,h,i,j,C,D,A,v/=y,w/=y,x,q,r),r.point(C,D),e(C,D,A,v,w,x,k,l,m,n,o,p,q,r))}}var f=.5,g=Math.cos(30*Rg),h=16;return b.precision=function(a){return arguments.length?(h=(f=a*a)>0&&16,b):Math.sqrt(f)},b}function dc(a){var b=cc(function(b,c){return a([b*Sg,c*Sg])});return function(a){return ic(b(a))}}function ec(a){this.stream=a}function fc(a,b){return{point:b,sphere:function(){a.sphere()},lineStart:function(){a.lineStart()},lineEnd:function(){a.lineEnd()},polygonStart:function(){a.polygonStart()},polygonEnd:function(){a.polygonEnd()}}}function gc(a){return hc(function(){return a})()}function hc(a){function b(a){return a=h(a[0]*Rg,a[1]*Rg),[a[0]*m+i,j-a[1]*m]}function c(a){return a=h.invert((a[0]-i)/m,(j-a[1])/m),a&&[a[0]*Sg,a[1]*Sg]}function d(){h=Db(g=lc(r,s,u),f);var a=f(p,q);return i=n-a[0]*m,j=o+a[1]*m,e()}function e(){return k&&(k.valid=!1,k=null),b}var f,g,h,i,j,k,l=cc(function(a,b){return a=f(a,b),[a[0]*m+i,j-a[1]*m]}),m=150,n=480,o=250,p=0,q=0,r=0,s=0,u=0,v=Nh,w=t,x=null,y=null;return b.stream=function(a){return k&&(k.valid=!1),k=ic(v(g,l(w(a)))),k.valid=!0,k},b.clipAngle=function(a){return arguments.length?(v=null==a?(x=a,Nh):Qb((x=+a)*Rg),e()):x},b.clipExtent=function(a){return arguments.length?(y=a,w=a?Sb(a[0][0],a[0][1],a[1][0],a[1][1]):t,e()):y},b.scale=function(a){return arguments.length?(m=+a,d()):m},b.translate=function(a){return arguments.length?(n=+a[0],o=+a[1],d()):[n,o]},b.center=function(a){return arguments.length?(p=a[0]%360*Rg,q=a[1]%360*Rg,d()):[p*Sg,q*Sg]},b.rotate=function(a){return arguments.length?(r=a[0]%360*Rg,s=a[1]%360*Rg,u=a.length>2?a[2]%360*Rg:0,d()):[r*Sg,s*Sg,u*Sg]},ig.rebind(b,l,"precision"),function(){return f=a.apply(this,arguments),b.invert=f.invert&&c,d()}}function ic(a){return fc(a,function(b,c){a.point(b*Rg,c*Rg)})}function jc(a,b){return[a,b]}function kc(a,b){return[a>Ng?a-Og:-Ng>a?a+Og:a,b]}function lc(a,b,c){return a?b||c?Db(nc(a),oc(b,c)):nc(a):b||c?oc(b,c):kc}function mc(a){return function(b,c){return b+=a,[b>Ng?b-Og:-Ng>b?b+Og:b,c]}}function nc(a){var b=mc(a);return b.invert=mc(-a),b}function oc(a,b){function c(a,b){var c=Math.cos(b),h=Math.cos(a)*c,i=Math.sin(a)*c,j=Math.sin(b),k=j*d+h*e;return[Math.atan2(i*f-k*g,h*d-j*e),ca(k*f+i*g)]}var d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b);return c.invert=function(a,b){var c=Math.cos(b),h=Math.cos(a)*c,i=Math.sin(a)*c,j=Math.sin(b),k=j*f-i*g;return[Math.atan2(i*f+j*g,h*d+k*e),ca(k*d-h*e)]},c}function pc(a,b){var c=Math.cos(a),d=Math.sin(a);return function(e,f,g,h){var i=g*b;null!=e?(e=qc(c,e),f=qc(c,f),(g>0?f>e:e>f)&&(e+=g*Og)):(e=a+g*Og,f=a-.5*i);for(var j,k=e;g>0?k>f:f>k;k-=i)h.point((j=wb([c,-d*Math.cos(k),-d*Math.sin(k)]))[0],j[1])}}function qc(a,b){var c=qb(b);c[0]-=a,vb(c);var d=ba(-c[1]);return((-c[2]<0?-d:d)+2*Math.PI-Lg)%(2*Math.PI)}function rc(a,b,c){var d=ig.range(a,b-Lg,c).concat(b);return function(a){return d.map(function(b){return[a,b]})}}function sc(a,b,c){var d=ig.range(a,b-Lg,c).concat(b);return function(a){return d.map(function(b){return[b,a]})}}function tc(a){return a.source}function uc(a){return a.target}function vc(a,b,c,d){var e=Math.cos(b),f=Math.sin(b),g=Math.cos(d),h=Math.sin(d),i=e*Math.cos(a),j=e*Math.sin(a),k=g*Math.cos(c),l=g*Math.sin(c),m=2*Math.asin(Math.sqrt(ga(d-b)+e*g*ga(c-a))),n=1/Math.sin(m),o=m?function(a){var b=Math.sin(a*=m)*n,c=Math.sin(m-a)*n,d=c*i+b*k,e=c*j+b*l,g=c*f+b*h;return[Math.atan2(e,d)*Sg,Math.atan2(g,Math.sqrt(d*d+e*e))*Sg]}:function(){return[a*Sg,b*Sg]};return o.distance=m,o}function wc(){function a(a,e){var f=Math.sin(e*=Rg),g=Math.cos(e),h=ug((a*=Rg)-b),i=Math.cos(h);Yh+=Math.atan2(Math.sqrt((h=g*Math.sin(h))*h+(h=d*f-c*g*i)*h),c*f+d*g*i),b=a,c=f,d=g}var b,c,d;Zh.point=function(e,f){b=e*Rg,c=Math.sin(f*=Rg),d=Math.cos(f),Zh.point=a},Zh.lineEnd=function(){Zh.point=Zh.lineEnd=w}}function xc(a,b){function c(b,c){var d=Math.cos(b),e=Math.cos(c),f=a(d*e);return[f*e*Math.sin(b),f*Math.sin(c)]}return c.invert=function(a,c){var d=Math.sqrt(a*a+c*c),e=b(d),f=Math.sin(e),g=Math.cos(e);return[Math.atan2(a*f,d*g),Math.asin(d&&c*f/d)]},c}function yc(a,b){function c(a,b){g>0?-Qg+Lg>b&&(b=-Qg+Lg):b>Qg-Lg&&(b=Qg-Lg);var c=g/Math.pow(e(b),f);return[c*Math.sin(f*a),g-c*Math.cos(f*a)]}var d=Math.cos(a),e=function(a){return Math.tan(Ng/4+a/2)},f=a===b?Math.sin(a):Math.log(d/Math.cos(b))/Math.log(e(b)/e(a)),g=d*Math.pow(e(a),f)/f;return f?(c.invert=function(a,b){var c=g-b,d=_(f)*Math.sqrt(a*a+c*c);return[Math.atan2(a,c)/f,2*Math.atan(Math.pow(g/d,1/f))-Qg]},c):Ac}function zc(a,b){function c(a,b){var c=f-b;return[c*Math.sin(e*a),f-c*Math.cos(e*a)]}var d=Math.cos(a),e=a===b?Math.sin(a):(d-Math.cos(b))/(b-a),f=d/e+a;return ug(e)<Lg?jc:(c.invert=function(a,b){var c=f-b;return[Math.atan2(a,c)/e,f-_(e)*Math.sqrt(a*a+c*c)]},c)}function Ac(a,b){return[a,Math.log(Math.tan(Ng/4+b/2))]}function Bc(a){var b,c=gc(a),d=c.scale,e=c.translate,f=c.clipExtent;return c.scale=function(){var a=d.apply(c,arguments);return a===c?b?c.clipExtent(null):c:a},c.translate=function(){var a=e.apply(c,arguments);return a===c?b?c.clipExtent(null):c:a},c.clipExtent=function(a){var g=f.apply(c,arguments);if(g===c){if(b=null==a){var h=Ng*d(),i=e();f([[i[0]-h,i[1]-h],[i[0]+h,i[1]+h]])}}else b&&(g=null);return g},c.clipExtent(null)}function Cc(a,b){return[Math.log(Math.tan(Ng/4+b/2)),-a]}function Dc(a){return a[0]}function Ec(a){return a[1]}function Fc(a){for(var b=a.length,c=[0,1],d=2,e=2;b>e;e++){for(;d>1&&aa(a[c[d-2]],a[c[d-1]],a[e])<=0;)--d;c[d++]=e}return c.slice(0,d)}function Gc(a,b){return a[0]-b[0]||a[1]-b[1]}function Hc(a,b,c){return(c[0]-b[0])*(a[1]-b[1])<(c[1]-b[1])*(a[0]-b[0])}function Ic(a,b,c,d){var e=a[0],f=c[0],g=b[0]-e,h=d[0]-f,i=a[1],j=c[1],k=b[1]-i,l=d[1]-j,m=(h*(i-j)-l*(e-f))/(l*g-h*k);return[e+m*g,i+m*k]}function Jc(a){var b=a[0],c=a[a.length-1];return!(b[0]-c[0]||b[1]-c[1])}function Kc(){dd(this),this.edge=this.site=this.circle=null}function Lc(a){var b=ji.pop()||new Kc;return b.site=a,b}function Mc(a){Wc(a),gi.remove(a),ji.push(a),dd(a)}function Nc(a){var b=a.circle,c=b.x,d=b.cy,e={x:c,y:d},f=a.P,g=a.N,h=[a];Mc(a);for(var i=f;i.circle&&ug(c-i.circle.x)<Lg&&ug(d-i.circle.cy)<Lg;)f=i.P,h.unshift(i),Mc(i),i=f;h.unshift(i),Wc(i);for(var j=g;j.circle&&ug(c-j.circle.x)<Lg&&ug(d-j.circle.cy)<Lg;)g=j.N,h.push(j),Mc(j),j=g;h.push(j),Wc(j);var k,l=h.length;for(k=1;l>k;++k)j=h[k],i=h[k-1],ad(j.edge,i.site,j.site,e);i=h[0],j=h[l-1],j.edge=$c(i.site,j.site,null,e),Vc(i),Vc(j)}function Oc(a){for(var b,c,d,e,f=a.x,g=a.y,h=gi._;h;)if(d=Pc(h,g)-f,d>Lg)h=h.L;else{if(e=f-Qc(h,g),!(e>Lg)){d>-Lg?(b=h.P,c=h):e>-Lg?(b=h,c=h.N):b=c=h;break}if(!h.R){b=h;break}h=h.R}var i=Lc(a);if(gi.insert(b,i),b||c){if(b===c)return Wc(b),c=Lc(b.site),gi.insert(i,c),i.edge=c.edge=$c(b.site,i.site),Vc(b),void Vc(c);if(!c)return void(i.edge=$c(b.site,i.site));Wc(b),Wc(c);var j=b.site,k=j.x,l=j.y,m=a.x-k,n=a.y-l,o=c.site,p=o.x-k,q=o.y-l,r=2*(m*q-n*p),s=m*m+n*n,t=p*p+q*q,u={x:(q*s-n*t)/r+k,y:(m*t-p*s)/r+l};ad(c.edge,j,o,u),i.edge=$c(j,a,null,u),c.edge=$c(a,o,null,u),Vc(b),Vc(c)}}function Pc(a,b){var c=a.site,d=c.x,e=c.y,f=e-b;if(!f)return d;var g=a.P;if(!g)return-(1/0);c=g.site;var h=c.x,i=c.y,j=i-b;if(!j)return h;var k=h-d,l=1/f-1/j,m=k/j;return l?(-m+Math.sqrt(m*m-2*l*(k*k/(-2*j)-i+j/2+e-f/2)))/l+d:(d+h)/2}function Qc(a,b){var c=a.N;if(c)return Pc(c,b);var d=a.site;return d.y===b?d.x:1/0}function Rc(a){this.site=a,this.edges=[]}function Sc(a){for(var b,c,d,e,f,g,h,i,j,k,l=a[0][0],m=a[1][0],n=a[0][1],o=a[1][1],p=fi,q=p.length;q--;)if(f=p[q],f&&f.prepare())for(h=f.edges,i=h.length,g=0;i>g;)k=h[g].end(),d=k.x,e=k.y,j=h[++g%i].start(),b=j.x,c=j.y,(ug(d-b)>Lg||ug(e-c)>Lg)&&(h.splice(g,0,new bd(_c(f.site,k,ug(d-l)<Lg&&o-e>Lg?{x:l,y:ug(b-l)<Lg?c:o}:ug(e-o)<Lg&&m-d>Lg?{x:ug(c-o)<Lg?b:m,y:o}:ug(d-m)<Lg&&e-n>Lg?{x:m,y:ug(b-m)<Lg?c:n}:ug(e-n)<Lg&&d-l>Lg?{x:ug(c-n)<Lg?b:l,y:n}:null),f.site,null)),++i)}function Tc(a,b){return b.angle-a.angle}function Uc(){dd(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vc(a){var b=a.P,c=a.N;if(b&&c){var d=b.site,e=a.site,f=c.site;if(d!==f){var g=e.x,h=e.y,i=d.x-g,j=d.y-h,k=f.x-g,l=f.y-h,m=2*(i*l-j*k);if(!(m>=-Mg)){var n=i*i+j*j,o=k*k+l*l,p=(l*n-j*o)/m,q=(i*o-k*n)/m,l=q+h,r=ki.pop()||new Uc;r.arc=a,r.site=e,r.x=p+g,r.y=l+Math.sqrt(p*p+q*q),r.cy=l,a.circle=r;for(var s=null,t=ii._;t;)if(r.y<t.y||r.y===t.y&&r.x<=t.x){if(!t.L){s=t.P;break}t=t.L}else{if(!t.R){s=t;break}t=t.R}ii.insert(s,r),s||(hi=r)}}}}function Wc(a){var b=a.circle;b&&(b.P||(hi=b.N),ii.remove(b),ki.push(b),dd(b),a.circle=null)}function Xc(a){for(var b,c=ei,d=Rb(a[0][0],a[0][1],a[1][0],a[1][1]),e=c.length;e--;)b=c[e],(!Yc(b,a)||!d(b)||ug(b.a.x-b.b.x)<Lg&&ug(b.a.y-b.b.y)<Lg)&&(b.a=b.b=null,c.splice(e,1))}function Yc(a,b){var c=a.b;if(c)return!0;var d,e,f=a.a,g=b[0][0],h=b[1][0],i=b[0][1],j=b[1][1],k=a.l,l=a.r,m=k.x,n=k.y,o=l.x,p=l.y,q=(m+o)/2,r=(n+p)/2;if(p===n){if(g>q||q>=h)return;if(m>o){if(f){if(f.y>=j)return}else f={x:q,y:i};c={x:q,y:j}}else{if(f){if(f.y<i)return}else f={x:q,y:j};c={x:q,y:i}}}else if(d=(m-o)/(p-n),e=r-d*q,-1>d||d>1)if(m>o){if(f){if(f.y>=j)return}else f={x:(i-e)/d,y:i};c={x:(j-e)/d,y:j}}else{if(f){if(f.y<i)return}else f={x:(j-e)/d,y:j};c={x:(i-e)/d,y:i}}else if(p>n){if(f){if(f.x>=h)return}else f={x:g,y:d*g+e};c={x:h,y:d*h+e}}else{if(f){if(f.x<g)return}else f={x:h,y:d*h+e};c={x:g,y:d*g+e}}return a.a=f,a.b=c,!0}function Zc(a,b){this.l=a,this.r=b,this.a=this.b=null}function $c(a,b,c,d){var e=new Zc(a,b);return ei.push(e),c&&ad(e,a,b,c),d&&ad(e,b,a,d),fi[a.i].edges.push(new bd(e,a,b)),fi[b.i].edges.push(new bd(e,b,a)),e}function _c(a,b,c){var d=new Zc(a,null);return d.a=b,d.b=c,ei.push(d),d}function ad(a,b,c,d){a.a||a.b?a.l===c?a.b=d:a.a=d:(a.a=d,a.l=b,a.r=c)}function bd(a,b,c){var d=a.a,e=a.b;this.edge=a,this.site=b,this.angle=c?Math.atan2(c.y-b.y,c.x-b.x):a.l===b?Math.atan2(e.x-d.x,d.y-e.y):Math.atan2(d.x-e.x,e.y-d.y)}function cd(){this._=null}function dd(a){a.U=a.C=a.L=a.R=a.P=a.N=null}function ed(a,b){var c=b,d=b.R,e=c.U;e?e.L===c?e.L=d:e.R=d:a._=d,d.U=e,c.U=d,c.R=d.L,c.R&&(c.R.U=c),d.L=c}function fd(a,b){var c=b,d=b.L,e=c.U;e?e.L===c?e.L=d:e.R=d:a._=d,d.U=e,c.U=d,c.L=d.R,c.L&&(c.L.U=c),d.R=c}function gd(a){for(;a.L;)a=a.L;return a}function hd(a,b){var c,d,e,f=a.sort(id).pop();for(ei=[],fi=new Array(a.length),gi=new cd,ii=new cd;;)if(e=hi,f&&(!e||f.y<e.y||f.y===e.y&&f.x<e.x))(f.x!==c||f.y!==d)&&(fi[f.i]=new Rc(f),Oc(f),c=f.x,d=f.y),f=a.pop();else{if(!e)break;Nc(e.arc)}b&&(Xc(b),Sc(b));var g={cells:fi,edges:ei};return gi=ii=ei=fi=null,g}function id(a,b){return b.y-a.y||b.x-a.x}function jd(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}function kd(a){return a.x}function ld(a){return a.y}function md(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function nd(a,b,c,d,e,f){if(!a(b,c,d,e,f)){var g=.5*(c+e),h=.5*(d+f),i=b.nodes;i[0]&&nd(a,i[0],c,d,g,h),i[1]&&nd(a,i[1],g,d,e,h),i[2]&&nd(a,i[2],c,h,g,f),i[3]&&nd(a,i[3],g,h,e,f)}}function od(a,b,c,d,e,f,g){var h,i=1/0;return function j(a,k,l,m,n){if(!(k>f||l>g||d>m||e>n)){if(o=a.point){var o,p=b-a.x,q=c-a.y,r=p*p+q*q;if(i>r){var s=Math.sqrt(i=r);d=b-s,e=c-s,f=b+s,g=c+s,h=o}}for(var t=a.nodes,u=.5*(k+m),v=.5*(l+n),w=b>=u,x=c>=v,y=x<<1|w,z=y+4;z>y;++y)if(a=t[3&y])switch(3&y){case 0:j(a,k,l,u,v);break;case 1:j(a,u,l,m,v);break;case 2:j(a,k,v,u,n);break;case 3:j(a,u,v,m,n)}}}(a,d,e,f,g),h}function pd(a,b){a=ig.rgb(a),b=ig.rgb(b);var c=a.r,d=a.g,e=a.b,f=b.r-c,g=b.g-d,h=b.b-e;return function(a){return"#"+va(Math.round(c+f*a))+va(Math.round(d+g*a))+va(Math.round(e+h*a))}}function qd(a,b){var c,d={},e={};for(c in a)c in b?d[c]=td(a[c],b[c]):e[c]=a[c];for(c in b)c in a||(e[c]=b[c]);return function(a){for(c in d)e[c]=d[c](a);return e}}function rd(a,b){return a=+a,b=+b,function(c){return a*(1-c)+b*c}}function sd(a,b){var c,d,e,f=mi.lastIndex=ni.lastIndex=0,g=-1,h=[],i=[];for(a+="",b+="";(c=mi.exec(a))&&(d=ni.exec(b));)(e=d.index)>f&&(e=b.slice(f,e),h[g]?h[g]+=e:h[++g]=e),(c=c[0])===(d=d[0])?h[g]?h[g]+=d:h[++g]=d:(h[++g]=null,i.push({i:g,x:rd(c,d)})),f=ni.lastIndex;return f<b.length&&(e=b.slice(f),h[g]?h[g]+=e:h[++g]=e),h.length<2?i[0]?(b=i[0].x,function(a){return b(a)+""}):function(){return b}:(b=i.length,function(a){for(var c,d=0;b>d;++d)h[(c=i[d]).i]=c.x(a);return h.join("")})}function td(a,b){for(var c,d=ig.interpolators.length;--d>=0&&!(c=ig.interpolators[d](a,b)););return c}function ud(a,b){var c,d=[],e=[],f=a.length,g=b.length,h=Math.min(a.length,b.length);for(c=0;h>c;++c)d.push(td(a[c],b[c]));for(;f>c;++c)e[c]=a[c];for(;g>c;++c)e[c]=b[c];return function(a){for(c=0;h>c;++c)e[c]=d[c](a);return e}}function vd(a){return function(b){return 0>=b?0:b>=1?1:a(b)}}function wd(a){return function(b){return 1-a(1-b)}}function xd(a){return function(b){return.5*(.5>b?a(2*b):2-a(2-2*b))}}function yd(a){return a*a}function zd(a){return a*a*a}function Ad(a){if(0>=a)return 0;if(a>=1)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)}function Bd(a){return function(b){return Math.pow(b,a)}}function Cd(a){return 1-Math.cos(a*Qg)}function Dd(a){return Math.pow(2,10*(a-1))}function Ed(a){return 1-Math.sqrt(1-a*a)}function Fd(a,b){var c;return arguments.length<2&&(b=.45),arguments.length?c=b/Og*Math.asin(1/a):(a=1,c=b/4),function(d){return 1+a*Math.pow(2,-10*d)*Math.sin((d-c)*Og/b)}}function Gd(a){return a||(a=1.70158),function(b){return b*b*((a+1)*b-a)}}function Hd(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}function Id(a,b){a=ig.hcl(a),b=ig.hcl(b);var c=a.h,d=a.c,e=a.l,f=b.h-c,g=b.c-d,h=b.l-e;return isNaN(g)&&(g=0,d=isNaN(d)?b.c:d),isNaN(f)?(f=0,c=isNaN(c)?b.h:c):f>180?f-=360:-180>f&&(f+=360),function(a){return la(c+f*a,d+g*a,e+h*a)+""}}function Jd(a,b){
a=ig.hsl(a),b=ig.hsl(b);var c=a.h,d=a.s,e=a.l,f=b.h-c,g=b.s-d,h=b.l-e;return isNaN(g)&&(g=0,d=isNaN(d)?b.s:d),isNaN(f)?(f=0,c=isNaN(c)?b.h:c):f>180?f-=360:-180>f&&(f+=360),function(a){return ja(c+f*a,d+g*a,e+h*a)+""}}function Kd(a,b){a=ig.lab(a),b=ig.lab(b);var c=a.l,d=a.a,e=a.b,f=b.l-c,g=b.a-d,h=b.b-e;return function(a){return na(c+f*a,d+g*a,e+h*a)+""}}function Ld(a,b){return b-=a,function(c){return Math.round(a+b*c)}}function Md(a){var b=[a.a,a.b],c=[a.c,a.d],d=Od(b),e=Nd(b,c),f=Od(Pd(c,b,-e))||0;b[0]*c[1]<c[0]*b[1]&&(b[0]*=-1,b[1]*=-1,d*=-1,e*=-1),this.rotate=(d?Math.atan2(b[1],b[0]):Math.atan2(-c[0],c[1]))*Sg,this.translate=[a.e,a.f],this.scale=[d,f],this.skew=f?Math.atan2(e,f)*Sg:0}function Nd(a,b){return a[0]*b[0]+a[1]*b[1]}function Od(a){var b=Math.sqrt(Nd(a,a));return b&&(a[0]/=b,a[1]/=b),b}function Pd(a,b,c){return a[0]+=c*b[0],a[1]+=c*b[1],a}function Qd(a){return a.length?a.pop()+",":""}function Rd(a,b,c,d){if(a[0]!==b[0]||a[1]!==b[1]){var e=c.push("translate(",null,",",null,")");d.push({i:e-4,x:rd(a[0],b[0])},{i:e-2,x:rd(a[1],b[1])})}else(b[0]||b[1])&&c.push("translate("+b+")")}function Sd(a,b,c,d){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),d.push({i:c.push(Qd(c)+"rotate(",null,")")-2,x:rd(a,b)})):b&&c.push(Qd(c)+"rotate("+b+")")}function Td(a,b,c,d){a!==b?d.push({i:c.push(Qd(c)+"skewX(",null,")")-2,x:rd(a,b)}):b&&c.push(Qd(c)+"skewX("+b+")")}function Ud(a,b,c,d){if(a[0]!==b[0]||a[1]!==b[1]){var e=c.push(Qd(c)+"scale(",null,",",null,")");d.push({i:e-4,x:rd(a[0],b[0])},{i:e-2,x:rd(a[1],b[1])})}else(1!==b[0]||1!==b[1])&&c.push(Qd(c)+"scale("+b+")")}function Vd(a,b){var c=[],d=[];return a=ig.transform(a),b=ig.transform(b),Rd(a.translate,b.translate,c,d),Sd(a.rotate,b.rotate,c,d),Td(a.skew,b.skew,c,d),Ud(a.scale,b.scale,c,d),a=b=null,function(a){for(var b,e=-1,f=d.length;++e<f;)c[(b=d[e]).i]=b.x(a);return c.join("")}}function Wd(a,b){return b=(b-=a=+a)||1/b,function(c){return(c-a)/b}}function Xd(a,b){return b=(b-=a=+a)||1/b,function(c){return Math.max(0,Math.min(1,(c-a)/b))}}function Yd(a){for(var b=a.source,c=a.target,d=$d(b,c),e=[b];b!==d;)b=b.parent,e.push(b);for(var f=e.length;c!==d;)e.splice(f,0,c),c=c.parent;return e}function Zd(a){for(var b=[],c=a.parent;null!=c;)b.push(a),a=c,c=c.parent;return b.push(a),b}function $d(a,b){if(a===b)return a;for(var c=Zd(a),d=Zd(b),e=c.pop(),f=d.pop(),g=null;e===f;)g=e,e=c.pop(),f=d.pop();return g}function _d(a){a.fixed|=2}function ae(a){a.fixed&=-7}function be(a){a.fixed|=4,a.px=a.x,a.py=a.y}function ce(a){a.fixed&=-5}function de(a,b,c){var d=0,e=0;if(a.charge=0,!a.leaf)for(var f,g=a.nodes,h=g.length,i=-1;++i<h;)f=g[i],null!=f&&(de(f,b,c),a.charge+=f.charge,d+=f.charge*f.cx,e+=f.charge*f.cy);if(a.point){a.leaf||(a.point.x+=Math.random()-.5,a.point.y+=Math.random()-.5);var j=b*c[a.point.index];a.charge+=a.pointCharge=j,d+=j*a.point.x,e+=j*a.point.y}a.cx=d/a.charge,a.cy=e/a.charge}function ee(a,b){return ig.rebind(a,b,"sort","children","value"),a.nodes=a,a.links=ke,a}function fe(a,b){for(var c=[a];null!=(a=c.pop());)if(b(a),(e=a.children)&&(d=e.length))for(var d,e;--d>=0;)c.push(e[d])}function ge(a,b){for(var c=[a],d=[];null!=(a=c.pop());)if(d.push(a),(f=a.children)&&(e=f.length))for(var e,f,g=-1;++g<e;)c.push(f[g]);for(;null!=(a=d.pop());)b(a)}function he(a){return a.children}function ie(a){return a.value}function je(a,b){return b.value-a.value}function ke(a){return ig.merge(a.map(function(a){return(a.children||[]).map(function(b){return{source:a,target:b}})}))}function le(a){return a.x}function me(a){return a.y}function ne(a,b,c){a.y0=b,a.y=c}function oe(a){return ig.range(a.length)}function pe(a){for(var b=-1,c=a[0].length,d=[];++b<c;)d[b]=0;return d}function qe(a){for(var b,c=1,d=0,e=a[0][1],f=a.length;f>c;++c)(b=a[c][1])>e&&(d=c,e=b);return d}function re(a){return a.reduce(se,0)}function se(a,b){return a+b[1]}function te(a,b){return ue(a,Math.ceil(Math.log(b.length)/Math.LN2+1))}function ue(a,b){for(var c=-1,d=+a[0],e=(a[1]-d)/b,f=[];++c<=b;)f[c]=e*c+d;return f}function ve(a){return[ig.min(a),ig.max(a)]}function we(a,b){return a.value-b.value}function xe(a,b){var c=a._pack_next;a._pack_next=b,b._pack_prev=a,b._pack_next=c,c._pack_prev=b}function ye(a,b){a._pack_next=b,b._pack_prev=a}function ze(a,b){var c=b.x-a.x,d=b.y-a.y,e=a.r+b.r;return.999*e*e>c*c+d*d}function Ae(a){function b(a){k=Math.min(a.x-a.r,k),l=Math.max(a.x+a.r,l),m=Math.min(a.y-a.r,m),n=Math.max(a.y+a.r,n)}if((c=a.children)&&(j=c.length)){var c,d,e,f,g,h,i,j,k=1/0,l=-(1/0),m=1/0,n=-(1/0);if(c.forEach(Be),d=c[0],d.x=-d.r,d.y=0,b(d),j>1&&(e=c[1],e.x=e.r,e.y=0,b(e),j>2))for(f=c[2],Ee(d,e,f),b(f),xe(d,f),d._pack_prev=f,xe(f,e),e=d._pack_next,g=3;j>g;g++){Ee(d,e,f=c[g]);var o=0,p=1,q=1;for(h=e._pack_next;h!==e;h=h._pack_next,p++)if(ze(h,f)){o=1;break}if(1==o)for(i=d._pack_prev;i!==h._pack_prev&&!ze(i,f);i=i._pack_prev,q++);o?(q>p||p==q&&e.r<d.r?ye(d,e=h):ye(d=i,e),g--):(xe(d,f),e=f,b(f))}var r=(k+l)/2,s=(m+n)/2,t=0;for(g=0;j>g;g++)f=c[g],f.x-=r,f.y-=s,t=Math.max(t,f.r+Math.sqrt(f.x*f.x+f.y*f.y));a.r=t,c.forEach(Ce)}}function Be(a){a._pack_next=a._pack_prev=a}function Ce(a){delete a._pack_next,delete a._pack_prev}function De(a,b,c,d){var e=a.children;if(a.x=b+=d*a.x,a.y=c+=d*a.y,a.r*=d,e)for(var f=-1,g=e.length;++f<g;)De(e[f],b,c,d)}function Ee(a,b,c){var d=a.r+c.r,e=b.x-a.x,f=b.y-a.y;if(d&&(e||f)){var g=b.r+c.r,h=e*e+f*f;g*=g,d*=d;var i=.5+(d-g)/(2*h),j=Math.sqrt(Math.max(0,2*g*(d+h)-(d-=h)*d-g*g))/(2*h);c.x=a.x+i*e+j*f,c.y=a.y+i*f-j*e}else c.x=a.x+d,c.y=a.y}function Fe(a,b){return a.parent==b.parent?1:2}function Ge(a){var b=a.children;return b.length?b[0]:a.t}function He(a){var b,c=a.children;return(b=c.length)?c[b-1]:a.t}function Ie(a,b,c){var d=c/(b.i-a.i);b.c-=d,b.s+=c,a.c+=d,b.z+=c,b.m+=c}function Je(a){for(var b,c=0,d=0,e=a.children,f=e.length;--f>=0;)b=e[f],b.z+=c,b.m+=c,c+=b.s+(d+=b.c)}function Ke(a,b,c){return a.a.parent===b.parent?a.a:c}function Le(a){return 1+ig.max(a,function(a){return a.y})}function Me(a){return a.reduce(function(a,b){return a+b.x},0)/a.length}function Ne(a){var b=a.children;return b&&b.length?Ne(b[0]):a}function Oe(a){var b,c=a.children;return c&&(b=c.length)?Oe(c[b-1]):a}function Pe(a){return{x:a.x,y:a.y,dx:a.dx,dy:a.dy}}function Qe(a,b){var c=a.x+b[3],d=a.y+b[0],e=a.dx-b[1]-b[3],f=a.dy-b[0]-b[2];return 0>e&&(c+=e/2,e=0),0>f&&(d+=f/2,f=0),{x:c,y:d,dx:e,dy:f}}function Re(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function Se(a){return a.rangeExtent?a.rangeExtent():Re(a.range())}function Te(a,b,c,d){var e=c(a[0],a[1]),f=d(b[0],b[1]);return function(a){return f(e(a))}}function Ue(a,b){var c,d=0,e=a.length-1,f=a[d],g=a[e];return f>g&&(c=d,d=e,e=c,c=f,f=g,g=c),a[d]=b.floor(f),a[e]=b.ceil(g),a}function Ve(a){return a?{floor:function(b){return Math.floor(b/a)*a},ceil:function(b){return Math.ceil(b/a)*a}}:yi}function We(a,b,c,d){var e=[],f=[],g=0,h=Math.min(a.length,b.length)-1;for(a[h]<a[0]&&(a=a.slice().reverse(),b=b.slice().reverse());++g<=h;)e.push(c(a[g-1],a[g])),f.push(d(b[g-1],b[g]));return function(b){var c=ig.bisect(a,b,1,h)-1;return f[c](e[c](b))}}function Xe(a,b,c,d){function e(){var e=Math.min(a.length,b.length)>2?We:Te,i=d?Xd:Wd;return g=e(a,b,i,c),h=e(b,a,i,td),f}function f(a){return g(a)}var g,h;return f.invert=function(a){return h(a)},f.domain=function(b){return arguments.length?(a=b.map(Number),e()):a},f.range=function(a){return arguments.length?(b=a,e()):b},f.rangeRound=function(a){return f.range(a).interpolate(Ld)},f.clamp=function(a){return arguments.length?(d=a,e()):d},f.interpolate=function(a){return arguments.length?(c=a,e()):c},f.ticks=function(b){return _e(a,b)},f.tickFormat=function(b,c){return af(a,b,c)},f.nice=function(b){return Ze(a,b),e()},f.copy=function(){return Xe(a,b,c,d)},e()}function Ye(a,b){return ig.rebind(a,b,"range","rangeRound","interpolate","clamp")}function Ze(a,b){return Ue(a,Ve($e(a,b)[2])),Ue(a,Ve($e(a,b)[2])),a}function $e(a,b){null==b&&(b=10);var c=Re(a),d=c[1]-c[0],e=Math.pow(10,Math.floor(Math.log(d/b)/Math.LN10)),f=b/d*e;return.15>=f?e*=10:.35>=f?e*=5:.75>=f&&(e*=2),c[0]=Math.ceil(c[0]/e)*e,c[1]=Math.floor(c[1]/e)*e+.5*e,c[2]=e,c}function _e(a,b){return ig.range.apply(ig,$e(a,b))}function af(a,b,c){var d=$e(a,b);if(c){var e=mh.exec(c);if(e.shift(),"s"===e[8]){var f=ig.formatPrefix(Math.max(ug(d[0]),ug(d[1])));return e[7]||(e[7]="."+bf(f.scale(d[2]))),e[8]="f",c=ig.format(e.join("")),function(a){return c(f.scale(a))+f.symbol}}e[7]||(e[7]="."+cf(e[8],d)),c=e.join("")}else c=",."+bf(d[2])+"f";return ig.format(c)}function bf(a){return-Math.floor(Math.log(a)/Math.LN10+.01)}function cf(a,b){var c=bf(b[2]);return a in zi?Math.abs(c-bf(Math.max(ug(b[0]),ug(b[1]))))+ +("e"!==a):c-2*("%"===a)}function df(a,b,c,d){function e(a){return(c?Math.log(0>a?0:a):-Math.log(a>0?0:-a))/Math.log(b)}function f(a){return c?Math.pow(b,a):-Math.pow(b,-a)}function g(b){return a(e(b))}return g.invert=function(b){return f(a.invert(b))},g.domain=function(b){return arguments.length?(c=b[0]>=0,a.domain((d=b.map(Number)).map(e)),g):d},g.base=function(c){return arguments.length?(b=+c,a.domain(d.map(e)),g):b},g.nice=function(){var b=Ue(d.map(e),c?Math:Bi);return a.domain(b),d=b.map(f),g},g.ticks=function(){var a=Re(d),g=[],h=a[0],i=a[1],j=Math.floor(e(h)),k=Math.ceil(e(i)),l=b%1?2:b;if(isFinite(k-j)){if(c){for(;k>j;j++)for(var m=1;l>m;m++)g.push(f(j)*m);g.push(f(j))}else for(g.push(f(j));j++<k;)for(var m=l-1;m>0;m--)g.push(f(j)*m);for(j=0;g[j]<h;j++);for(k=g.length;g[k-1]>i;k--);g=g.slice(j,k)}return g},g.tickFormat=function(a,c){if(!arguments.length)return Ai;arguments.length<2?c=Ai:"function"!=typeof c&&(c=ig.format(c));var d=Math.max(1,b*a/g.ticks().length);return function(a){var g=a/f(Math.round(e(a)));return b-.5>g*b&&(g*=b),d>=g?c(a):""}},g.copy=function(){return df(a.copy(),b,c,d)},Ye(g,a)}function ef(a,b,c){function d(b){return a(e(b))}var e=ff(b),f=ff(1/b);return d.invert=function(b){return f(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain((c=b.map(Number)).map(e)),d):c},d.ticks=function(a){return _e(c,a)},d.tickFormat=function(a,b){return af(c,a,b)},d.nice=function(a){return d.domain(Ze(c,a))},d.exponent=function(g){return arguments.length?(e=ff(b=g),f=ff(1/b),a.domain(c.map(e)),d):b},d.copy=function(){return ef(a.copy(),b,c)},Ye(d,a)}function ff(a){return function(b){return 0>b?-Math.pow(-b,a):Math.pow(b,a)}}function gf(a,b){function c(c){return f[((e.get(c)||("range"===b.t?e.set(c,a.push(c)):NaN))-1)%f.length]}function d(b,c){return ig.range(a.length).map(function(a){return b+c*a})}var e,f,g;return c.domain=function(d){if(!arguments.length)return a;a=[],e=new k;for(var f,g=-1,h=d.length;++g<h;)e.has(f=d[g])||e.set(f,a.push(f));return c[b.t].apply(c,b.a)},c.range=function(a){return arguments.length?(f=a,g=0,b={t:"range",a:arguments},c):f},c.rangePoints=function(e,h){arguments.length<2&&(h=0);var i=e[0],j=e[1],k=a.length<2?(i=(i+j)/2,0):(j-i)/(a.length-1+h);return f=d(i+k*h/2,k),g=0,b={t:"rangePoints",a:arguments},c},c.rangeRoundPoints=function(e,h){arguments.length<2&&(h=0);var i=e[0],j=e[1],k=a.length<2?(i=j=Math.round((i+j)/2),0):(j-i)/(a.length-1+h)|0;return f=d(i+Math.round(k*h/2+(j-i-(a.length-1+h)*k)/2),k),g=0,b={t:"rangeRoundPoints",a:arguments},c},c.rangeBands=function(e,h,i){arguments.length<2&&(h=0),arguments.length<3&&(i=h);var j=e[1]<e[0],k=e[j-0],l=e[1-j],m=(l-k)/(a.length-h+2*i);return f=d(k+m*i,m),j&&f.reverse(),g=m*(1-h),b={t:"rangeBands",a:arguments},c},c.rangeRoundBands=function(e,h,i){arguments.length<2&&(h=0),arguments.length<3&&(i=h);var j=e[1]<e[0],k=e[j-0],l=e[1-j],m=Math.floor((l-k)/(a.length-h+2*i));return f=d(k+Math.round((l-k-(a.length-h)*m)/2),m),j&&f.reverse(),g=Math.round(m*(1-h)),b={t:"rangeRoundBands",a:arguments},c},c.rangeBand=function(){return g},c.rangeExtent=function(){return Re(b.a[0])},c.copy=function(){return gf(a,b)},c.domain(a)}function hf(a,b){function c(){var c=0,d=b.length;for(h=[];++c<d;)h[c-1]=ig.quantile(a,c/d);return g}function g(a){return isNaN(a=+a)?void 0:b[ig.bisect(h,a)]}var h;return g.domain=function(b){return arguments.length?(a=b.map(e).filter(f).sort(d),c()):a},g.range=function(a){return arguments.length?(b=a,c()):b},g.quantiles=function(){return h},g.invertExtent=function(c){return c=b.indexOf(c),0>c?[NaN,NaN]:[c>0?h[c-1]:a[0],c<h.length?h[c]:a[a.length-1]]},g.copy=function(){return hf(a,b)},c()}function jf(a,b,c){function d(b){return c[Math.max(0,Math.min(g,Math.floor(f*(b-a))))]}function e(){return f=c.length/(b-a),g=c.length-1,d}var f,g;return d.domain=function(c){return arguments.length?(a=+c[0],b=+c[c.length-1],e()):[a,b]},d.range=function(a){return arguments.length?(c=a,e()):c},d.invertExtent=function(b){return b=c.indexOf(b),b=0>b?NaN:b/f+a,[b,b+1/f]},d.copy=function(){return jf(a,b,c)},e()}function kf(a,b){function c(c){return c>=c?b[ig.bisect(a,c)]:void 0}return c.domain=function(b){return arguments.length?(a=b,c):a},c.range=function(a){return arguments.length?(b=a,c):b},c.invertExtent=function(c){return c=b.indexOf(c),[a[c-1],a[c]]},c.copy=function(){return kf(a,b)},c}function lf(a){function b(a){return+a}return b.invert=b,b.domain=b.range=function(c){return arguments.length?(a=c.map(b),b):a},b.ticks=function(b){return _e(a,b)},b.tickFormat=function(b,c){return af(a,b,c)},b.copy=function(){return lf(a)},b}function mf(){return 0}function nf(a){return a.innerRadius}function of(a){return a.outerRadius}function pf(a){return a.startAngle}function qf(a){return a.endAngle}function rf(a){return a&&a.padAngle}function sf(a,b,c,d){return(a-c)*b-(b-d)*a>0?0:1}function tf(a,b,c,d,e){var f=a[0]-b[0],g=a[1]-b[1],h=(e?d:-d)/Math.sqrt(f*f+g*g),i=h*g,j=-h*f,k=a[0]+i,l=a[1]+j,m=b[0]+i,n=b[1]+j,o=(k+m)/2,p=(l+n)/2,q=m-k,r=n-l,s=q*q+r*r,t=c-d,u=k*n-m*l,v=(0>r?-1:1)*Math.sqrt(Math.max(0,t*t*s-u*u)),w=(u*r-q*v)/s,x=(-u*q-r*v)/s,y=(u*r+q*v)/s,z=(-u*q+r*v)/s,A=w-o,B=x-p,C=y-o,D=z-p;return A*A+B*B>C*C+D*D&&(w=y,x=z),[[w-i,x-j],[w*c/t,x*c/t]]}function uf(a){function b(b){function g(){j.push("M",f(a(k),h))}for(var i,j=[],k=[],l=-1,m=b.length,n=Ba(c),o=Ba(d);++l<m;)e.call(this,i=b[l],l)?k.push([+n.call(this,i,l),+o.call(this,i,l)]):k.length&&(g(),k=[]);return k.length&&g(),j.length?j.join(""):null}var c=Dc,d=Ec,e=Eb,f=vf,g=f.key,h=.7;return b.x=function(a){return arguments.length?(c=a,b):c},b.y=function(a){return arguments.length?(d=a,b):d},b.defined=function(a){return arguments.length?(e=a,b):e},b.interpolate=function(a){return arguments.length?(g="function"==typeof a?f=a:(f=Hi.get(a)||vf).key,b):g},b.tension=function(a){return arguments.length?(h=a,b):h},b}function vf(a){return a.length>1?a.join("L"):a+"Z"}function wf(a){return a.join("L")+"Z"}function xf(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("H",(d[0]+(d=a[b])[0])/2,"V",d[1]);return c>1&&e.push("H",d[0]),e.join("")}function yf(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("V",(d=a[b])[1],"H",d[0]);return e.join("")}function zf(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("H",(d=a[b])[0],"V",d[1]);return e.join("")}function Af(a,b){return a.length<4?vf(a):a[1]+Df(a.slice(1,-1),Ef(a,b))}function Bf(a,b){return a.length<3?wf(a):a[0]+Df((a.push(a[0]),a),Ef([a[a.length-2]].concat(a,[a[1]]),b))}function Cf(a,b){return a.length<3?vf(a):a[0]+Df(a,Ef(a,b))}function Df(a,b){if(b.length<1||a.length!=b.length&&a.length!=b.length+2)return vf(a);var c=a.length!=b.length,d="",e=a[0],f=a[1],g=b[0],h=g,i=1;if(c&&(d+="Q"+(f[0]-2*g[0]/3)+","+(f[1]-2*g[1]/3)+","+f[0]+","+f[1],e=a[1],i=2),b.length>1){h=b[1],f=a[i],i++,d+="C"+(e[0]+g[0])+","+(e[1]+g[1])+","+(f[0]-h[0])+","+(f[1]-h[1])+","+f[0]+","+f[1];for(var j=2;j<b.length;j++,i++)f=a[i],h=b[j],d+="S"+(f[0]-h[0])+","+(f[1]-h[1])+","+f[0]+","+f[1]}if(c){var k=a[i];d+="Q"+(f[0]+2*h[0]/3)+","+(f[1]+2*h[1]/3)+","+k[0]+","+k[1]}return d}function Ef(a,b){for(var c,d=[],e=(1-b)/2,f=a[0],g=a[1],h=1,i=a.length;++h<i;)c=f,f=g,g=a[h],d.push([e*(g[0]-c[0]),e*(g[1]-c[1])]);return d}function Ff(a){if(a.length<3)return vf(a);var b=1,c=a.length,d=a[0],e=d[0],f=d[1],g=[e,e,e,(d=a[1])[0]],h=[f,f,f,d[1]],i=[e,",",f,"L",Jf(Ki,g),",",Jf(Ki,h)];for(a.push(a[c-1]);++b<=c;)d=a[b],g.shift(),g.push(d[0]),h.shift(),h.push(d[1]),Kf(i,g,h);return a.pop(),i.push("L",d),i.join("")}function Gf(a){if(a.length<4)return vf(a);for(var b,c=[],d=-1,e=a.length,f=[0],g=[0];++d<3;)b=a[d],f.push(b[0]),g.push(b[1]);for(c.push(Jf(Ki,f)+","+Jf(Ki,g)),--d;++d<e;)b=a[d],f.shift(),f.push(b[0]),g.shift(),g.push(b[1]),Kf(c,f,g);return c.join("")}function Hf(a){for(var b,c,d=-1,e=a.length,f=e+4,g=[],h=[];++d<4;)c=a[d%e],g.push(c[0]),h.push(c[1]);for(b=[Jf(Ki,g),",",Jf(Ki,h)],--d;++d<f;)c=a[d%e],g.shift(),g.push(c[0]),h.shift(),h.push(c[1]),Kf(b,g,h);return b.join("")}function If(a,b){var c=a.length-1;if(c)for(var d,e,f=a[0][0],g=a[0][1],h=a[c][0]-f,i=a[c][1]-g,j=-1;++j<=c;)d=a[j],e=j/c,d[0]=b*d[0]+(1-b)*(f+e*h),d[1]=b*d[1]+(1-b)*(g+e*i);return Ff(a)}function Jf(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function Kf(a,b,c){a.push("C",Jf(Ii,b),",",Jf(Ii,c),",",Jf(Ji,b),",",Jf(Ji,c),",",Jf(Ki,b),",",Jf(Ki,c))}function Lf(a,b){return(b[1]-a[1])/(b[0]-a[0])}function Mf(a){for(var b=0,c=a.length-1,d=[],e=a[0],f=a[1],g=d[0]=Lf(e,f);++b<c;)d[b]=(g+(g=Lf(e=f,f=a[b+1])))/2;return d[b]=g,d}function Nf(a){for(var b,c,d,e,f=[],g=Mf(a),h=-1,i=a.length-1;++h<i;)b=Lf(a[h],a[h+1]),ug(b)<Lg?g[h]=g[h+1]=0:(c=g[h]/b,d=g[h+1]/b,e=c*c+d*d,e>9&&(e=3*b/Math.sqrt(e),g[h]=e*c,g[h+1]=e*d));for(h=-1;++h<=i;)e=(a[Math.min(i,h+1)][0]-a[Math.max(0,h-1)][0])/(6*(1+g[h]*g[h])),f.push([e||0,g[h]*e||0]);return f}function Of(a){return a.length<3?vf(a):a[0]+Df(a,Nf(a))}function Pf(a){for(var b,c,d,e=-1,f=a.length;++e<f;)b=a[e],c=b[0],d=b[1]-Qg,b[0]=c*Math.cos(d),b[1]=c*Math.sin(d);return a}function Qf(a){function b(b){function i(){p.push("M",h(a(r),l),k,j(a(q.reverse()),l),"Z")}for(var m,n,o,p=[],q=[],r=[],s=-1,t=b.length,u=Ba(c),v=Ba(e),w=c===d?function(){return n}:Ba(d),x=e===f?function(){return o}:Ba(f);++s<t;)g.call(this,m=b[s],s)?(q.push([n=+u.call(this,m,s),o=+v.call(this,m,s)]),r.push([+w.call(this,m,s),+x.call(this,m,s)])):q.length&&(i(),q=[],r=[]);return q.length&&i(),p.length?p.join(""):null}var c=Dc,d=Dc,e=0,f=Ec,g=Eb,h=vf,i=h.key,j=h,k="L",l=.7;return b.x=function(a){return arguments.length?(c=d=a,b):d},b.x0=function(a){return arguments.length?(c=a,b):c},b.x1=function(a){return arguments.length?(d=a,b):d},b.y=function(a){return arguments.length?(e=f=a,b):f},b.y0=function(a){return arguments.length?(e=a,b):e},b.y1=function(a){return arguments.length?(f=a,b):f},b.defined=function(a){return arguments.length?(g=a,b):g},b.interpolate=function(a){return arguments.length?(i="function"==typeof a?h=a:(h=Hi.get(a)||vf).key,j=h.reverse||h,k=h.closed?"M":"L",b):i},b.tension=function(a){return arguments.length?(l=a,b):l},b}function Rf(a){return a.radius}function Sf(a){return[a.x,a.y]}function Tf(a){return function(){var b=a.apply(this,arguments),c=b[0],d=b[1]-Qg;return[c*Math.cos(d),c*Math.sin(d)]}}function Uf(){return 64}function Vf(){return"circle"}function Wf(a){var b=Math.sqrt(a/Ng);return"M0,"+b+"A"+b+","+b+" 0 1,1 0,"+-b+"A"+b+","+b+" 0 1,1 0,"+b+"Z"}function Xf(a){return function(){var b,c,d;(b=this[a])&&(d=b[c=b.active])&&(d.timer.c=null,d.timer.t=NaN,--b.count?delete b[c]:delete this[a],b.active+=.5,d.event&&d.event.interrupt.call(this,this.__data__,d.index))}}function Yf(a,b,c){return zg(a,Ri),a.namespace=b,a.id=c,a}function Zf(a,b,c,d){var e=a.id,f=a.namespace;return S(a,"function"==typeof c?function(a,g,h){a[f][e].tween.set(b,d(c.call(a,a.__data__,g,h)))}:(c=d(c),function(a){a[f][e].tween.set(b,c)}))}function $f(a){return null==a&&(a=""),function(){this.textContent=a}}function _f(a){return null==a?"__transition__":"__transition_"+a+"__"}function ag(a,b,c,d,e){function f(a){var b=p.delay;return j.t=b+i,a>=b?g(a-b):void(j.c=g)}function g(c){var e=o.active,f=o[e];f&&(f.timer.c=null,f.timer.t=NaN,--o.count,delete o[e],f.event&&f.event.interrupt.call(a,a.__data__,f.index));for(var g in o)if(d>+g){var k=o[g];k.timer.c=null,k.timer.t=NaN,--o.count,delete o[g]}j.c=h,Ga(function(){return j.c&&h(c||1)&&(j.c=null,j.t=NaN),1},0,i),o.active=d,p.event&&p.event.start.call(a,a.__data__,b),n=[],p.tween.forEach(function(c,d){(d=d.call(a,a.__data__,b))&&n.push(d)}),m=p.ease,l=p.duration}function h(e){for(var f=e/l,g=m(f),h=n.length;h>0;)n[--h].call(a,g);return f>=1?(p.event&&p.event.end.call(a,a.__data__,b),--o.count?delete o[d]:delete a[c],1):void 0}var i,j,l,m,n,o=a[c]||(a[c]={active:0,count:0}),p=o[d];p||(i=e.time,j=Ga(f,0,i),p=o[d]={tween:new k,time:i,timer:j,delay:e.delay,duration:e.duration,ease:e.ease,index:b},e=null,++o.count)}function bg(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate("+(isFinite(d)?d:c(a))+",0)"})}function cg(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate(0,"+(isFinite(d)?d:c(a))+")"})}function dg(a){return a.toISOString()}function eg(a,b,c){function d(b){return a(b)}function e(a,c){var d=a[1]-a[0],e=d/c,f=ig.bisect($i,e);return f==$i.length?[b.year,$e(a.map(function(a){return a/31536e6}),c)[2]]:f?b[e/$i[f-1]<$i[f]/e?f-1:f]:[bj,$e(a,c)[2]]}return d.invert=function(b){return fg(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain(b),d):a.domain().map(fg)},d.nice=function(a,b){function c(c){return!isNaN(c)&&!a.range(c,fg(+c+1),b).length}var f=d.domain(),g=Re(f),h=null==a?e(g,10):"number"==typeof a&&e(g,a);return h&&(a=h[0],b=h[1]),d.domain(Ue(f,b>1?{floor:function(b){for(;c(b=a.floor(b));)b=fg(b-1);return b},ceil:function(b){for(;c(b=a.ceil(b));)b=fg(+b+1);return b}}:a))},d.ticks=function(a,b){var c=Re(d.domain()),f=null==a?e(c,10):"number"==typeof a?e(c,a):!a.range&&[{range:a},b];return f&&(a=f[0],b=f[1]),a.range(c[0],fg(+c[1]+1),1>b?1:b)},d.tickFormat=function(){return c},d.copy=function(){return eg(a.copy(),b,c)},Ye(d,a)}function fg(a){return new Date(a)}function gg(a){return JSON.parse(a.responseText)}function hg(a){var b=lg.createRange();return b.selectNode(lg.body),b.createContextualFragment(a.responseText)}var ig={version:"3.5.17"},jg=[].slice,kg=function(a){return jg.call(a)},lg=this.document;if(lg)try{kg(lg.documentElement.childNodes)[0].nodeType}catch(mg){kg=function(a){for(var b=a.length,c=new Array(b);b--;)c[b]=a[b];return c}}if(Date.now||(Date.now=function(){return+new Date}),lg)try{lg.createElement("DIV").style.setProperty("opacity",0,"")}catch(ng){var og=this.Element.prototype,pg=og.setAttribute,qg=og.setAttributeNS,rg=this.CSSStyleDeclaration.prototype,sg=rg.setProperty;og.setAttribute=function(a,b){pg.call(this,a,b+"")},og.setAttributeNS=function(a,b,c){qg.call(this,a,b,c+"")},rg.setProperty=function(a,b,c){sg.call(this,a,b+"",c)}}ig.ascending=d,ig.descending=function(a,b){return a>b?-1:b>a?1:b>=a?0:NaN},ig.min=function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f;)if(null!=(d=a[e])&&d>=d){c=d;break}for(;++e<f;)null!=(d=a[e])&&c>d&&(c=d)}else{for(;++e<f;)if(null!=(d=b.call(a,a[e],e))&&d>=d){c=d;break}for(;++e<f;)null!=(d=b.call(a,a[e],e))&&c>d&&(c=d)}return c},ig.max=function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f;)if(null!=(d=a[e])&&d>=d){c=d;break}for(;++e<f;)null!=(d=a[e])&&d>c&&(c=d)}else{for(;++e<f;)if(null!=(d=b.call(a,a[e],e))&&d>=d){c=d;break}for(;++e<f;)null!=(d=b.call(a,a[e],e))&&d>c&&(c=d)}return c},ig.extent=function(a,b){var c,d,e,f=-1,g=a.length;if(1===arguments.length){for(;++f<g;)if(null!=(d=a[f])&&d>=d){c=e=d;break}for(;++f<g;)null!=(d=a[f])&&(c>d&&(c=d),d>e&&(e=d))}else{for(;++f<g;)if(null!=(d=b.call(a,a[f],f))&&d>=d){c=e=d;break}for(;++f<g;)null!=(d=b.call(a,a[f],f))&&(c>d&&(c=d),d>e&&(e=d))}return[c,e]},ig.sum=function(a,b){var c,d=0,e=a.length,g=-1;if(1===arguments.length)for(;++g<e;)f(c=+a[g])&&(d+=c);else for(;++g<e;)f(c=+b.call(a,a[g],g))&&(d+=c);return d},ig.mean=function(a,b){var c,d=0,g=a.length,h=-1,i=g;if(1===arguments.length)for(;++h<g;)f(c=e(a[h]))?d+=c:--i;else for(;++h<g;)f(c=e(b.call(a,a[h],h)))?d+=c:--i;return i?d/i:void 0},ig.quantile=function(a,b){var c=(a.length-1)*b+1,d=Math.floor(c),e=+a[d-1],f=c-d;return f?e+f*(a[d]-e):e},ig.median=function(a,b){var c,g=[],h=a.length,i=-1;if(1===arguments.length)for(;++i<h;)f(c=e(a[i]))&&g.push(c);else for(;++i<h;)f(c=e(b.call(a,a[i],i)))&&g.push(c);return g.length?ig.quantile(g.sort(d),.5):void 0},ig.variance=function(a,b){var c,d,g=a.length,h=0,i=0,j=-1,k=0;if(1===arguments.length)for(;++j<g;)f(c=e(a[j]))&&(d=c-h,h+=d/++k,i+=d*(c-h));else for(;++j<g;)f(c=e(b.call(a,a[j],j)))&&(d=c-h,h+=d/++k,i+=d*(c-h));return k>1?i/(k-1):void 0},ig.deviation=function(){var a=ig.variance.apply(this,arguments);return a?Math.sqrt(a):a};var tg=g(d);ig.bisectLeft=tg.left,ig.bisect=ig.bisectRight=tg.right,ig.bisector=function(a){return g(1===a.length?function(b,c){return d(a(b),c)}:a)},ig.shuffle=function(a,b,c){(f=arguments.length)<3&&(c=a.length,2>f&&(b=0));for(var d,e,f=c-b;f;)e=Math.random()*f--|0,d=a[f+b],a[f+b]=a[e+b],a[e+b]=d;return a},ig.permute=function(a,b){for(var c=b.length,d=new Array(c);c--;)d[c]=a[b[c]];return d},ig.pairs=function(a){for(var b,c=0,d=a.length-1,e=a[0],f=new Array(0>d?0:d);d>c;)f[c]=[b=e,e=a[++c]];return f},ig.transpose=function(a){if(!(e=a.length))return[];for(var b=-1,c=ig.min(a,h),d=new Array(c);++b<c;)for(var e,f=-1,g=d[b]=new Array(e);++f<e;)g[f]=a[f][b];return d},ig.zip=function(){return ig.transpose(arguments)},ig.keys=function(a){var b=[];for(var c in a)b.push(c);return b},ig.values=function(a){var b=[];for(var c in a)b.push(a[c]);return b},ig.entries=function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},ig.merge=function(a){for(var b,c,d,e=a.length,f=-1,g=0;++f<e;)g+=a[f].length;for(c=new Array(g);--e>=0;)for(d=a[e],b=d.length;--b>=0;)c[--g]=d[b];return c};var ug=Math.abs;ig.range=function(a,b,c){if(arguments.length<3&&(c=1,arguments.length<2&&(b=a,a=0)),(b-a)/c===1/0)throw new Error("infinite range");var d,e=[],f=i(ug(c)),g=-1;if(a*=f,b*=f,c*=f,0>c)for(;(d=a+c*++g)>b;)e.push(d/f);else for(;(d=a+c*++g)<b;)e.push(d/f);return e},ig.map=function(a,b){var c=new k;if(a instanceof k)a.forEach(function(a,b){c.set(a,b)});else if(Array.isArray(a)){var d,e=-1,f=a.length;if(1===arguments.length)for(;++e<f;)c.set(e,a[e]);else for(;++e<f;)c.set(b.call(a,d=a[e],e),d)}else for(var g in a)c.set(g,a[g]);return c};var vg="__proto__",wg="\x00";j(k,{has:n,get:function(a){return this._[l(a)]},set:function(a,b){return this._[l(a)]=b},remove:o,keys:p,values:function(){var a=[];for(var b in this._)a.push(this._[b]);return a},entries:function(){var a=[];for(var b in this._)a.push({key:m(b),value:this._[b]});return a},size:q,empty:r,forEach:function(a){for(var b in this._)a.call(this,m(b),this._[b])}}),ig.nest=function(){function a(b,g,h){if(h>=f.length)return d?d.call(e,g):c?g.sort(c):g;for(var i,j,l,m,n=-1,o=g.length,p=f[h++],q=new k;++n<o;)(m=q.get(i=p(j=g[n])))?m.push(j):q.set(i,[j]);return b?(j=b(),l=function(c,d){j.set(c,a(b,d,h))}):(j={},l=function(c,d){j[c]=a(b,d,h)}),q.forEach(l),j}function b(a,c){if(c>=f.length)return a;var d=[],e=g[c++];return a.forEach(function(a,e){d.push({key:a,values:b(e,c)})}),e?d.sort(function(a,b){return e(a.key,b.key)}):d}var c,d,e={},f=[],g=[];return e.map=function(b,c){return a(c,b,0)},e.entries=function(c){return b(a(ig.map,c,0),0)},e.key=function(a){return f.push(a),e},e.sortKeys=function(a){return g[f.length-1]=a,e},e.sortValues=function(a){return c=a,e},e.rollup=function(a){return d=a,e},e},ig.set=function(a){var b=new s;if(a)for(var c=0,d=a.length;d>c;++c)b.add(a[c]);return b},j(s,{has:n,add:function(a){return this._[l(a+="")]=!0,a},remove:o,values:p,size:q,empty:r,forEach:function(a){for(var b in this._)a.call(this,m(b))}}),ig.behavior={},ig.rebind=function(a,b){for(var c,d=1,e=arguments.length;++d<e;)a[c=arguments[d]]=u(a,b,b[c]);return a};var xg=["webkit","ms","moz","Moz","o","O"];ig.dispatch=function(){for(var a=new x,b=-1,c=arguments.length;++b<c;)a[arguments[b]]=y(a);return a},x.prototype.on=function(a,b){var c=a.indexOf("."),d="";if(c>=0&&(d=a.slice(c+1),a=a.slice(0,c)),a)return arguments.length<2?this[a].on(d):this[a].on(d,b);if(2===arguments.length){if(null==b)for(a in this)this.hasOwnProperty(a)&&this[a].on(d,null);return this}},ig.event=null,ig.requote=function(a){return a.replace(yg,"\\$&")};var yg=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,zg={}.__proto__?function(a,b){a.__proto__=b}:function(a,b){for(var c in b)a[c]=b[c]},Ag=function(a,b){return b.querySelector(a)},Bg=function(a,b){return b.querySelectorAll(a)},Cg=function(a,b){var c=a.matches||a[v(a,"matchesSelector")];return(Cg=function(a,b){return c.call(a,b)})(a,b)};"function"==typeof Sizzle&&(Ag=function(a,b){return Sizzle(a,b)[0]||null},Bg=Sizzle,Cg=Sizzle.matchesSelector),ig.selection=function(){return ig.select(lg.documentElement)};var Dg=ig.selection.prototype=[];Dg.select=function(a){var b,c,d,e,f=[];a=D(a);for(var g=-1,h=this.length;++g<h;){f.push(b=[]),b.parentNode=(d=this[g]).parentNode;for(var i=-1,j=d.length;++i<j;)(e=d[i])?(b.push(c=a.call(e,e.__data__,i,g)),c&&"__data__"in e&&(c.__data__=e.__data__)):b.push(null)}return C(f)},Dg.selectAll=function(a){var b,c,d=[];a=E(a);for(var e=-1,f=this.length;++e<f;)for(var g=this[e],h=-1,i=g.length;++h<i;)(c=g[h])&&(d.push(b=kg(a.call(c,c.__data__,h,e))),b.parentNode=c);return C(d)};var Eg="http://www.w3.org/1999/xhtml",Fg={svg:"http://www.w3.org/2000/svg",xhtml:Eg,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ig.ns={prefix:Fg,qualify:function(a){var b=a.indexOf(":"),c=a;return b>=0&&"xmlns"!==(c=a.slice(0,b))&&(a=a.slice(b+1)),Fg.hasOwnProperty(c)?{space:Fg[c],local:a}:a}},Dg.attr=function(a,b){if(arguments.length<2){if("string"==typeof a){var c=this.node();return a=ig.ns.qualify(a),a.local?c.getAttributeNS(a.space,a.local):c.getAttribute(a)}for(b in a)this.each(F(b,a[b]));return this}return this.each(F(a,b))},Dg.classed=function(a,b){if(arguments.length<2){if("string"==typeof a){var c=this.node(),d=(a=I(a)).length,e=-1;if(b=c.classList){for(;++e<d;)if(!b.contains(a[e]))return!1}else for(b=c.getAttribute("class");++e<d;)if(!H(a[e]).test(b))return!1;return!0}for(b in a)this.each(J(b,a[b]));return this}return this.each(J(a,b))},Dg.style=function(a,b,d){var e=arguments.length;if(3>e){if("string"!=typeof a){2>e&&(b="");for(d in a)this.each(L(d,a[d],b));return this}if(2>e){var f=this.node();return c(f).getComputedStyle(f,null).getPropertyValue(a)}d=""}return this.each(L(a,b,d))},Dg.property=function(a,b){if(arguments.length<2){if("string"==typeof a)return this.node()[a];for(b in a)this.each(M(b,a[b]));return this}return this.each(M(a,b))},Dg.text=function(a){return arguments.length?this.each("function"==typeof a?function(){var b=a.apply(this,arguments);this.textContent=null==b?"":b}:null==a?function(){this.textContent=""}:function(){this.textContent=a}):this.node().textContent},Dg.html=function(a){return arguments.length?this.each("function"==typeof a?function(){var b=a.apply(this,arguments);this.innerHTML=null==b?"":b}:null==a?function(){this.innerHTML=""}:function(){this.innerHTML=a}):this.node().innerHTML},Dg.append=function(a){return a=N(a),this.select(function(){return this.appendChild(a.apply(this,arguments))})},Dg.insert=function(a,b){return a=N(a),b=D(b),this.select(function(){return this.insertBefore(a.apply(this,arguments),b.apply(this,arguments)||null)})},Dg.remove=function(){return this.each(O)},Dg.data=function(a,b){function c(a,c){var d,e,f,g=a.length,l=c.length,m=Math.min(g,l),n=new Array(l),o=new Array(l),p=new Array(g);if(b){var q,r=new k,s=new Array(g);for(d=-1;++d<g;)(e=a[d])&&(r.has(q=b.call(e,e.__data__,d))?p[d]=e:r.set(q,e),s[d]=q);for(d=-1;++d<l;)(e=r.get(q=b.call(c,f=c[d],d)))?e!==!0&&(n[d]=e,e.__data__=f):o[d]=P(f),r.set(q,!0);for(d=-1;++d<g;)d in s&&r.get(s[d])!==!0&&(p[d]=a[d])}else{for(d=-1;++d<m;)e=a[d],f=c[d],e?(e.__data__=f,n[d]=e):o[d]=P(f);for(;l>d;++d)o[d]=P(c[d]);for(;g>d;++d)p[d]=a[d]}o.update=n,o.parentNode=n.parentNode=p.parentNode=a.parentNode,h.push(o),i.push(n),j.push(p)}var d,e,f=-1,g=this.length;if(!arguments.length){for(a=new Array(g=(d=this[0]).length);++f<g;)(e=d[f])&&(a[f]=e.__data__);return a}var h=T([]),i=C([]),j=C([]);
if("function"==typeof a)for(;++f<g;)c(d=this[f],a.call(d,d.parentNode.__data__,f));else for(;++f<g;)c(d=this[f],a);return i.enter=function(){return h},i.exit=function(){return j},i},Dg.datum=function(a){return arguments.length?this.property("__data__",a):this.property("__data__")},Dg.filter=function(a){var b,c,d,e=[];"function"!=typeof a&&(a=Q(a));for(var f=0,g=this.length;g>f;f++){e.push(b=[]),b.parentNode=(c=this[f]).parentNode;for(var h=0,i=c.length;i>h;h++)(d=c[h])&&a.call(d,d.__data__,h,f)&&b.push(d)}return C(e)},Dg.order=function(){for(var a=-1,b=this.length;++a<b;)for(var c,d=this[a],e=d.length-1,f=d[e];--e>=0;)(c=d[e])&&(f&&f!==c.nextSibling&&f.parentNode.insertBefore(c,f),f=c);return this},Dg.sort=function(a){a=R.apply(this,arguments);for(var b=-1,c=this.length;++b<c;)this[b].sort(a);return this.order()},Dg.each=function(a){return S(this,function(b,c,d){a.call(b,b.__data__,c,d)})},Dg.call=function(a){var b=kg(arguments);return a.apply(b[0]=this,b),this},Dg.empty=function(){return!this.node()},Dg.node=function(){for(var a=0,b=this.length;b>a;a++)for(var c=this[a],d=0,e=c.length;e>d;d++){var f=c[d];if(f)return f}return null},Dg.size=function(){var a=0;return S(this,function(){++a}),a};var Gg=[];ig.selection.enter=T,ig.selection.enter.prototype=Gg,Gg.append=Dg.append,Gg.empty=Dg.empty,Gg.node=Dg.node,Gg.call=Dg.call,Gg.size=Dg.size,Gg.select=function(a){for(var b,c,d,e,f,g=[],h=-1,i=this.length;++h<i;){d=(e=this[h]).update,g.push(b=[]),b.parentNode=e.parentNode;for(var j=-1,k=e.length;++j<k;)(f=e[j])?(b.push(d[j]=c=a.call(e.parentNode,f.__data__,j,h)),c.__data__=f.__data__):b.push(null)}return C(g)},Gg.insert=function(a,b){return arguments.length<2&&(b=U(this)),Dg.insert.call(this,a,b)},ig.select=function(b){var c;return"string"==typeof b?(c=[Ag(b,lg)],c.parentNode=lg.documentElement):(c=[b],c.parentNode=a(b)),C([c])},ig.selectAll=function(a){var b;return"string"==typeof a?(b=kg(Bg(a,lg)),b.parentNode=lg.documentElement):(b=kg(a),b.parentNode=null),C([b])},Dg.on=function(a,b,c){var d=arguments.length;if(3>d){if("string"!=typeof a){2>d&&(b=!1);for(c in a)this.each(V(c,a[c],b));return this}if(2>d)return(d=this.node()["__on"+a])&&d._;c=!1}return this.each(V(a,b,c))};var Hg=ig.map({mouseenter:"mouseover",mouseleave:"mouseout"});lg&&Hg.forEach(function(a){"on"+a in lg&&Hg.remove(a)});var Ig,Jg=0;ig.mouse=function(a){return Z(a,A())};var Kg=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ig.touch=function(a,b,c){if(arguments.length<3&&(c=b,b=A().changedTouches),b)for(var d,e=0,f=b.length;f>e;++e)if((d=b[e]).identifier===c)return Z(a,d)},ig.behavior.drag=function(){function a(){this.on("mousedown.drag",f).on("touchstart.drag",g)}function b(a,b,c,f,g){return function(){function h(){var a,c,d=b(m,p);d&&(a=d[0]-t[0],c=d[1]-t[1],o|=a|c,t=d,n({type:"drag",x:d[0]+j[0],y:d[1]+j[1],dx:a,dy:c}))}function i(){b(m,p)&&(r.on(f+q,null).on(g+q,null),s(o),n({type:"dragend"}))}var j,k=this,l=ig.event.target.correspondingElement||ig.event.target,m=k.parentNode,n=d.of(k,arguments),o=0,p=a(),q=".drag"+(null==p?"":"-"+p),r=ig.select(c(l)).on(f+q,h).on(g+q,i),s=Y(l),t=b(m,p);e?(j=e.apply(k,arguments),j=[j.x-t[0],j.y-t[1]]):j=[0,0],n({type:"dragstart"})}}var d=B(a,"drag","dragstart","dragend"),e=null,f=b(w,ig.mouse,c,"mousemove","mouseup"),g=b($,ig.touch,t,"touchmove","touchend");return a.origin=function(b){return arguments.length?(e=b,a):e},ig.rebind(a,d,"on")},ig.touches=function(a,b){return arguments.length<2&&(b=A().touches),b?kg(b).map(function(b){var c=Z(a,b);return c.identifier=b.identifier,c}):[]};var Lg=1e-6,Mg=Lg*Lg,Ng=Math.PI,Og=2*Ng,Pg=Og-Lg,Qg=Ng/2,Rg=Ng/180,Sg=180/Ng,Tg=Math.SQRT2,Ug=2,Vg=4;ig.interpolateZoom=function(a,b){var c,d,e=a[0],f=a[1],g=a[2],h=b[0],i=b[1],j=b[2],k=h-e,l=i-f,m=k*k+l*l;if(Mg>m)d=Math.log(j/g)/Tg,c=function(a){return[e+a*k,f+a*l,g*Math.exp(Tg*a*d)]};else{var n=Math.sqrt(m),o=(j*j-g*g+Vg*m)/(2*g*Ug*n),p=(j*j-g*g-Vg*m)/(2*j*Ug*n),q=Math.log(Math.sqrt(o*o+1)-o),r=Math.log(Math.sqrt(p*p+1)-p);d=(r-q)/Tg,c=function(a){var b=a*d,c=ea(q),h=g/(Ug*n)*(c*fa(Tg*b+q)-da(q));return[e+h*k,f+h*l,g*c/ea(Tg*b+q)]}}return c.duration=1e3*d,c},ig.behavior.zoom=function(){function a(a){a.on(F,l).on(Xg+".zoom",n).on("dblclick.zoom",o).on(I,m)}function b(a){return[(a[0]-y.x)/y.k,(a[1]-y.y)/y.k]}function d(a){return[a[0]*y.k+y.x,a[1]*y.k+y.y]}function e(a){y.k=Math.max(C[0],Math.min(C[1],a))}function f(a,b){b=d(b),y.x+=a[0]-b[0],y.y+=a[1]-b[1]}function g(b,c,d,g){b.__chart__={x:y.x,y:y.y,k:y.k},e(Math.pow(2,g)),f(q=c,d),b=ig.select(b),D>0&&(b=b.transition().duration(D)),b.call(a.event)}function h(){v&&v.domain(u.range().map(function(a){return(a-y.x)/y.k}).map(u.invert)),x&&x.domain(w.range().map(function(a){return(a-y.y)/y.k}).map(w.invert))}function i(a){E++||a({type:"zoomstart"})}function j(a){h(),a({type:"zoom",scale:y.k,translate:[y.x,y.y]})}function k(a){--E||(a({type:"zoomend"}),q=null)}function l(){function a(){h=1,f(ig.mouse(e),m),j(g)}function d(){l.on(G,null).on(H,null),n(h),k(g)}var e=this,g=J.of(e,arguments),h=0,l=ig.select(c(e)).on(G,a).on(H,d),m=b(ig.mouse(e)),n=Y(e);Qi.call(e),i(g)}function m(){function a(){var a=ig.touches(o);return n=y.k,a.forEach(function(a){a.identifier in q&&(q[a.identifier]=b(a))}),a}function c(){var b=ig.event.target;ig.select(b).on(u,d).on(v,h),w.push(b);for(var c=ig.event.changedTouches,e=0,f=c.length;f>e;++e)q[c[e].identifier]=null;var i=a(),j=Date.now();if(1===i.length){if(500>j-t){var k=i[0];g(o,k,q[k.identifier],Math.floor(Math.log(y.k)/Math.LN2)+1),z()}t=j}else if(i.length>1){var k=i[0],l=i[1],m=k[0]-l[0],n=k[1]-l[1];r=m*m+n*n}}function d(){var a,b,c,d,g=ig.touches(o);Qi.call(o);for(var h=0,i=g.length;i>h;++h,d=null)if(c=g[h],d=q[c.identifier]){if(b)break;a=c,b=d}if(d){var k=(k=c[0]-a[0])*k+(k=c[1]-a[1])*k,l=r&&Math.sqrt(k/r);a=[(a[0]+c[0])/2,(a[1]+c[1])/2],b=[(b[0]+d[0])/2,(b[1]+d[1])/2],e(l*n)}t=null,f(a,b),j(p)}function h(){if(ig.event.touches.length){for(var b=ig.event.changedTouches,c=0,d=b.length;d>c;++c)delete q[b[c].identifier];for(var e in q)return void a()}ig.selectAll(w).on(s,null),x.on(F,l).on(I,m),A(),k(p)}var n,o=this,p=J.of(o,arguments),q={},r=0,s=".zoom-"+ig.event.changedTouches[0].identifier,u="touchmove"+s,v="touchend"+s,w=[],x=ig.select(o),A=Y(o);c(),i(p),x.on(F,null).on(I,c)}function n(){var a=J.of(this,arguments);s?clearTimeout(s):(Qi.call(this),p=b(q=r||ig.mouse(this)),i(a)),s=setTimeout(function(){s=null,k(a)},50),z(),e(Math.pow(2,.002*Wg())*y.k),f(q,p),j(a)}function o(){var a=ig.mouse(this),c=Math.log(y.k)/Math.LN2;g(this,a,b(a),ig.event.shiftKey?Math.ceil(c)-1:Math.floor(c)+1)}var p,q,r,s,t,u,v,w,x,y={x:0,y:0,k:1},A=[960,500],C=Yg,D=250,E=0,F="mousedown.zoom",G="mousemove.zoom",H="mouseup.zoom",I="touchstart.zoom",J=B(a,"zoomstart","zoom","zoomend");return Xg||(Xg="onwheel"in lg?(Wg=function(){return-ig.event.deltaY*(ig.event.deltaMode?120:1)},"wheel"):"onmousewheel"in lg?(Wg=function(){return ig.event.wheelDelta},"mousewheel"):(Wg=function(){return-ig.event.detail},"MozMousePixelScroll")),a.event=function(a){a.each(function(){var a=J.of(this,arguments),b=y;Oi?ig.select(this).transition().each("start.zoom",function(){y=this.__chart__||{x:0,y:0,k:1},i(a)}).tween("zoom:zoom",function(){var c=A[0],d=A[1],e=q?q[0]:c/2,f=q?q[1]:d/2,g=ig.interpolateZoom([(e-y.x)/y.k,(f-y.y)/y.k,c/y.k],[(e-b.x)/b.k,(f-b.y)/b.k,c/b.k]);return function(b){var d=g(b),h=c/d[2];this.__chart__=y={x:e-d[0]*h,y:f-d[1]*h,k:h},j(a)}}).each("interrupt.zoom",function(){k(a)}).each("end.zoom",function(){k(a)}):(this.__chart__=y,i(a),j(a),k(a))})},a.translate=function(b){return arguments.length?(y={x:+b[0],y:+b[1],k:y.k},h(),a):[y.x,y.y]},a.scale=function(b){return arguments.length?(y={x:y.x,y:y.y,k:null},e(+b),h(),a):y.k},a.scaleExtent=function(b){return arguments.length?(C=null==b?Yg:[+b[0],+b[1]],a):C},a.center=function(b){return arguments.length?(r=b&&[+b[0],+b[1]],a):r},a.size=function(b){return arguments.length?(A=b&&[+b[0],+b[1]],a):A},a.duration=function(b){return arguments.length?(D=+b,a):D},a.x=function(b){return arguments.length?(v=b,u=b.copy(),y={x:0,y:0,k:1},a):v},a.y=function(b){return arguments.length?(x=b,w=b.copy(),y={x:0,y:0,k:1},a):x},ig.rebind(a,J,"on")};var Wg,Xg,Yg=[0,1/0];ig.color=ha,ha.prototype.toString=function(){return this.rgb()+""},ig.hsl=ia;var Zg=ia.prototype=new ha;Zg.brighter=function(a){return a=Math.pow(.7,arguments.length?a:1),new ia(this.h,this.s,this.l/a)},Zg.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),new ia(this.h,this.s,a*this.l)},Zg.rgb=function(){return ja(this.h,this.s,this.l)},ig.hcl=ka;var $g=ka.prototype=new ha;$g.brighter=function(a){return new ka(this.h,this.c,Math.min(100,this.l+_g*(arguments.length?a:1)))},$g.darker=function(a){return new ka(this.h,this.c,Math.max(0,this.l-_g*(arguments.length?a:1)))},$g.rgb=function(){return la(this.h,this.c,this.l).rgb()},ig.lab=ma;var _g=18,ah=.95047,bh=1,ch=1.08883,dh=ma.prototype=new ha;dh.brighter=function(a){return new ma(Math.min(100,this.l+_g*(arguments.length?a:1)),this.a,this.b)},dh.darker=function(a){return new ma(Math.max(0,this.l-_g*(arguments.length?a:1)),this.a,this.b)},dh.rgb=function(){return na(this.l,this.a,this.b)},ig.rgb=sa;var eh=sa.prototype=new ha;eh.brighter=function(a){a=Math.pow(.7,arguments.length?a:1);var b=this.r,c=this.g,d=this.b,e=30;return b||c||d?(b&&e>b&&(b=e),c&&e>c&&(c=e),d&&e>d&&(d=e),new sa(Math.min(255,b/a),Math.min(255,c/a),Math.min(255,d/a))):new sa(e,e,e)},eh.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),new sa(a*this.r,a*this.g,a*this.b)},eh.hsl=function(){return xa(this.r,this.g,this.b)},eh.toString=function(){return"#"+va(this.r)+va(this.g)+va(this.b)};var fh=ig.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});fh.forEach(function(a,b){fh.set(a,ta(b))}),ig.functor=Ba,ig.xhr=Ca(t),ig.dsv=function(a,b){function c(a,c,f){arguments.length<3&&(f=c,c=null);var g=Da(a,b,null==c?d:e(c),f);return g.row=function(a){return arguments.length?g.response(null==(c=a)?d:e(a)):c},g}function d(a){return c.parse(a.responseText)}function e(a){return function(b){return c.parse(b.responseText,a)}}function f(b){return b.map(g).join(a)}function g(a){return h.test(a)?'"'+a.replace(/\"/g,'""')+'"':a}var h=new RegExp('["'+a+"\n]"),i=a.charCodeAt(0);return c.parse=function(a,b){var d;return c.parseRows(a,function(a,c){if(d)return d(a,c-1);var e=new Function("d","return {"+a.map(function(a,b){return JSON.stringify(a)+": d["+b+"]"}).join(",")+"}");d=b?function(a,c){return b(e(a),c)}:e})},c.parseRows=function(a,b){function c(){if(k>=j)return g;if(e)return e=!1,f;var b=k;if(34===a.charCodeAt(b)){for(var c=b;c++<j;)if(34===a.charCodeAt(c)){if(34!==a.charCodeAt(c+1))break;++c}k=c+2;var d=a.charCodeAt(c+1);return 13===d?(e=!0,10===a.charCodeAt(c+2)&&++k):10===d&&(e=!0),a.slice(b+1,c).replace(/""/g,'"')}for(;j>k;){var d=a.charCodeAt(k++),h=1;if(10===d)e=!0;else if(13===d)e=!0,10===a.charCodeAt(k)&&(++k,++h);else if(d!==i)continue;return a.slice(b,k-h)}return a.slice(b)}for(var d,e,f={},g={},h=[],j=a.length,k=0,l=0;(d=c())!==g;){for(var m=[];d!==f&&d!==g;)m.push(d),d=c();b&&null==(m=b(m,l++))||h.push(m)}return h},c.format=function(b){if(Array.isArray(b[0]))return c.formatRows(b);var d=new s,e=[];return b.forEach(function(a){for(var b in a)d.has(b)||e.push(d.add(b))}),[e.map(g).join(a)].concat(b.map(function(b){return e.map(function(a){return g(b[a])}).join(a)})).join("\n")},c.formatRows=function(a){return a.map(f).join("\n")},c},ig.csv=ig.dsv(",","text/csv"),ig.tsv=ig.dsv("	","text/tab-separated-values");var gh,hh,ih,jh,kh=this[v(this,"requestAnimationFrame")]||function(a){setTimeout(a,17)};ig.timer=function(){Ga.apply(this,arguments)},ig.timer.flush=function(){Ia(),Ja()},ig.round=function(a,b){return b?Math.round(a*(b=Math.pow(10,b)))/b:Math.round(a)};var lh=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(La);ig.formatPrefix=function(a,b){var c=0;return(a=+a)&&(0>a&&(a*=-1),b&&(a=ig.round(a,Ka(a,b))),c=1+Math.floor(1e-12+Math.log(a)/Math.LN10),c=Math.max(-24,Math.min(24,3*Math.floor((c-1)/3)))),lh[8+c/3]};var mh=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,nh=ig.map({b:function(a){return a.toString(2)},c:function(a){return String.fromCharCode(a)},o:function(a){return a.toString(8)},x:function(a){return a.toString(16)},X:function(a){return a.toString(16).toUpperCase()},g:function(a,b){return a.toPrecision(b)},e:function(a,b){return a.toExponential(b)},f:function(a,b){return a.toFixed(b)},r:function(a,b){return(a=ig.round(a,Ka(a,b))).toFixed(Math.max(0,Math.min(20,Ka(a*(1+1e-15),b))))}}),oh=ig.time={},ph=Date;Oa.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){qh.setUTCDate.apply(this._,arguments)},setDay:function(){qh.setUTCDay.apply(this._,arguments)},setFullYear:function(){qh.setUTCFullYear.apply(this._,arguments)},setHours:function(){qh.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){qh.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){qh.setUTCMinutes.apply(this._,arguments)},setMonth:function(){qh.setUTCMonth.apply(this._,arguments)},setSeconds:function(){qh.setUTCSeconds.apply(this._,arguments)},setTime:function(){qh.setTime.apply(this._,arguments)}};var qh=Date.prototype;oh.year=Pa(function(a){return a=oh.day(a),a.setMonth(0,1),a},function(a,b){a.setFullYear(a.getFullYear()+b)},function(a){return a.getFullYear()}),oh.years=oh.year.range,oh.years.utc=oh.year.utc.range,oh.day=Pa(function(a){var b=new ph(2e3,0);return b.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),b},function(a,b){a.setDate(a.getDate()+b)},function(a){return a.getDate()-1}),oh.days=oh.day.range,oh.days.utc=oh.day.utc.range,oh.dayOfYear=function(a){var b=oh.year(a);return Math.floor((a-b-6e4*(a.getTimezoneOffset()-b.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(a,b){b=7-b;var c=oh[a]=Pa(function(a){return(a=oh.day(a)).setDate(a.getDate()-(a.getDay()+b)%7),a},function(a,b){a.setDate(a.getDate()+7*Math.floor(b))},function(a){var c=oh.year(a).getDay();return Math.floor((oh.dayOfYear(a)+(c+b)%7)/7)-(c!==b)});oh[a+"s"]=c.range,oh[a+"s"].utc=c.utc.range,oh[a+"OfYear"]=function(a){var c=oh.year(a).getDay();return Math.floor((oh.dayOfYear(a)+(c+b)%7)/7)}}),oh.week=oh.sunday,oh.weeks=oh.sunday.range,oh.weeks.utc=oh.sunday.utc.range,oh.weekOfYear=oh.sundayOfYear;var rh={"-":"",_:" ",0:"0"},sh=/^\s*\d+/,th=/^%/;ig.locale=function(a){return{numberFormat:Ma(a),timeFormat:Ra(a)}};var uh=ig.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ig.format=uh.numberFormat,ig.geo={},kb.prototype={s:0,t:0,add:function(a){lb(a,this.t,vh),lb(vh.s,this.s,this),this.s?this.t+=vh.t:this.s=vh.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var vh=new kb;ig.geo.stream=function(a,b){a&&wh.hasOwnProperty(a.type)?wh[a.type](a,b):mb(a,b)};var wh={Feature:function(a,b){mb(a.geometry,b)},FeatureCollection:function(a,b){for(var c=a.features,d=-1,e=c.length;++d<e;)mb(c[d].geometry,b)}},xh={Sphere:function(a,b){b.sphere()},Point:function(a,b){a=a.coordinates,b.point(a[0],a[1],a[2])},MultiPoint:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)a=c[d],b.point(a[0],a[1],a[2])},LineString:function(a,b){nb(a.coordinates,b,0)},MultiLineString:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)nb(c[d],b,0)},Polygon:function(a,b){ob(a.coordinates,b)},MultiPolygon:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)ob(c[d],b)},GeometryCollection:function(a,b){for(var c=a.geometries,d=-1,e=c.length;++d<e;)mb(c[d],b)}};ig.geo.area=function(a){return yh=0,ig.geo.stream(a,Ah),yh};var yh,zh=new kb,Ah={sphere:function(){yh+=4*Ng},point:w,lineStart:w,lineEnd:w,polygonStart:function(){zh.reset(),Ah.lineStart=pb},polygonEnd:function(){var a=2*zh;yh+=0>a?4*Ng+a:a,Ah.lineStart=Ah.lineEnd=Ah.point=w}};ig.geo.bounds=function(){function a(a,b){t.push(u=[k=a,m=a]),l>b&&(l=b),b>n&&(n=b)}function b(b,c){var d=qb([b*Rg,c*Rg]);if(r){var e=sb(r,d),f=[e[1],-e[0],0],g=sb(f,e);vb(g),g=wb(g);var i=b-o,j=i>0?1:-1,p=g[0]*Sg*j,q=ug(i)>180;if(q^(p>j*o&&j*b>p)){var s=g[1]*Sg;s>n&&(n=s)}else if(p=(p+360)%360-180,q^(p>j*o&&j*b>p)){var s=-g[1]*Sg;l>s&&(l=s)}else l>c&&(l=c),c>n&&(n=c);q?o>b?h(k,b)>h(k,m)&&(m=b):h(b,m)>h(k,m)&&(k=b):m>=k?(k>b&&(k=b),b>m&&(m=b)):b>o?h(k,b)>h(k,m)&&(m=b):h(b,m)>h(k,m)&&(k=b)}else a(b,c);r=d,o=b}function c(){v.point=b}function d(){u[0]=k,u[1]=m,v.point=a,r=null}function e(a,c){if(r){var d=a-o;s+=ug(d)>180?d+(d>0?360:-360):d}else p=a,q=c;Ah.point(a,c),b(a,c)}function f(){Ah.lineStart()}function g(){e(p,q),Ah.lineEnd(),ug(s)>Lg&&(k=-(m=180)),u[0]=k,u[1]=m,r=null}function h(a,b){return(b-=a)<0?b+360:b}function i(a,b){return a[0]-b[0]}function j(a,b){return b[0]<=b[1]?b[0]<=a&&a<=b[1]:a<b[0]||b[1]<a}var k,l,m,n,o,p,q,r,s,t,u,v={point:a,lineStart:c,lineEnd:d,polygonStart:function(){v.point=e,v.lineStart=f,v.lineEnd=g,s=0,Ah.polygonStart()},polygonEnd:function(){Ah.polygonEnd(),v.point=a,v.lineStart=c,v.lineEnd=d,0>zh?(k=-(m=180),l=-(n=90)):s>Lg?n=90:-Lg>s&&(l=-90),u[0]=k,u[1]=m}};return function(a){n=m=-(k=l=1/0),t=[],ig.geo.stream(a,v);var b=t.length;if(b){t.sort(i);for(var c,d=1,e=t[0],f=[e];b>d;++d)c=t[d],j(c[0],e)||j(c[1],e)?(h(e[0],c[1])>h(e[0],e[1])&&(e[1]=c[1]),h(c[0],e[1])>h(e[0],e[1])&&(e[0]=c[0])):f.push(e=c);for(var g,c,o=-(1/0),b=f.length-1,d=0,e=f[b];b>=d;e=c,++d)c=f[d],(g=h(e[1],c[0]))>o&&(o=g,k=c[0],m=e[1])}return t=u=null,k===1/0||l===1/0?[[NaN,NaN],[NaN,NaN]]:[[k,l],[m,n]]}}(),ig.geo.centroid=function(a){Bh=Ch=Dh=Eh=Fh=Gh=Hh=Ih=Jh=Kh=Lh=0,ig.geo.stream(a,Mh);var b=Jh,c=Kh,d=Lh,e=b*b+c*c+d*d;return Mg>e&&(b=Gh,c=Hh,d=Ih,Lg>Ch&&(b=Dh,c=Eh,d=Fh),e=b*b+c*c+d*d,Mg>e)?[NaN,NaN]:[Math.atan2(c,b)*Sg,ca(d/Math.sqrt(e))*Sg]};var Bh,Ch,Dh,Eh,Fh,Gh,Hh,Ih,Jh,Kh,Lh,Mh={sphere:w,point:yb,lineStart:Ab,lineEnd:Bb,polygonStart:function(){Mh.lineStart=Cb},polygonEnd:function(){Mh.lineStart=Ab}},Nh=Ib(Eb,Mb,Ob,[-Ng,-Ng/2]),Oh=1e9;ig.geo.clipExtent=function(){var a,b,c,d,e,f,g={stream:function(a){return e&&(e.valid=!1),e=f(a),e.valid=!0,e},extent:function(h){return arguments.length?(f=Sb(a=+h[0][0],b=+h[0][1],c=+h[1][0],d=+h[1][1]),e&&(e.valid=!1,e=null),g):[[a,b],[c,d]]}};return g.extent([[0,0],[960,500]])},(ig.geo.conicEqualArea=function(){return Tb(Ub)}).raw=Ub,ig.geo.albers=function(){return ig.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ig.geo.albersUsa=function(){function a(a){var f=a[0],g=a[1];return b=null,c(f,g),b||(d(f,g),b)||e(f,g),b}var b,c,d,e,f=ig.geo.albers(),g=ig.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),h=ig.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),i={point:function(a,c){b=[a,c]}};return a.invert=function(a){var b=f.scale(),c=f.translate(),d=(a[0]-c[0])/b,e=(a[1]-c[1])/b;return(e>=.12&&.234>e&&d>=-.425&&-.214>d?g:e>=.166&&.234>e&&d>=-.214&&-.115>d?h:f).invert(a)},a.stream=function(a){var b=f.stream(a),c=g.stream(a),d=h.stream(a);return{point:function(a,e){b.point(a,e),c.point(a,e),d.point(a,e)},sphere:function(){b.sphere(),c.sphere(),d.sphere()},lineStart:function(){b.lineStart(),c.lineStart(),d.lineStart()},lineEnd:function(){b.lineEnd(),c.lineEnd(),d.lineEnd()},polygonStart:function(){b.polygonStart(),c.polygonStart(),d.polygonStart()},polygonEnd:function(){b.polygonEnd(),c.polygonEnd(),d.polygonEnd()}}},a.precision=function(b){return arguments.length?(f.precision(b),g.precision(b),h.precision(b),a):f.precision()},a.scale=function(b){return arguments.length?(f.scale(b),g.scale(.35*b),h.scale(b),a.translate(f.translate())):f.scale()},a.translate=function(b){if(!arguments.length)return f.translate();var j=f.scale(),k=+b[0],l=+b[1];return c=f.translate(b).clipExtent([[k-.455*j,l-.238*j],[k+.455*j,l+.238*j]]).stream(i).point,d=g.translate([k-.307*j,l+.201*j]).clipExtent([[k-.425*j+Lg,l+.12*j+Lg],[k-.214*j-Lg,l+.234*j-Lg]]).stream(i).point,e=h.translate([k-.205*j,l+.212*j]).clipExtent([[k-.214*j+Lg,l+.166*j+Lg],[k-.115*j-Lg,l+.234*j-Lg]]).stream(i).point,a},a.scale(1070)};var Ph,Qh,Rh,Sh,Th,Uh,Vh={point:w,lineStart:w,lineEnd:w,polygonStart:function(){Qh=0,Vh.lineStart=Vb},polygonEnd:function(){Vh.lineStart=Vh.lineEnd=Vh.point=w,Ph+=ug(Qh/2)}},Wh={point:Wb,lineStart:w,lineEnd:w,polygonStart:w,polygonEnd:w},Xh={point:Zb,lineStart:$b,lineEnd:_b,polygonStart:function(){Xh.lineStart=ac},polygonEnd:function(){Xh.point=Zb,Xh.lineStart=$b,Xh.lineEnd=_b}};ig.geo.path=function(){function a(a){return a&&("function"==typeof h&&f.pointRadius(+h.apply(this,arguments)),g&&g.valid||(g=e(f)),ig.geo.stream(a,g)),f.result()}function b(){return g=null,a}var c,d,e,f,g,h=4.5;return a.area=function(a){return Ph=0,ig.geo.stream(a,e(Vh)),Ph},a.centroid=function(a){return Dh=Eh=Fh=Gh=Hh=Ih=Jh=Kh=Lh=0,ig.geo.stream(a,e(Xh)),Lh?[Jh/Lh,Kh/Lh]:Ih?[Gh/Ih,Hh/Ih]:Fh?[Dh/Fh,Eh/Fh]:[NaN,NaN]},a.bounds=function(a){return Th=Uh=-(Rh=Sh=1/0),ig.geo.stream(a,e(Wh)),[[Rh,Sh],[Th,Uh]]},a.projection=function(a){return arguments.length?(e=(c=a)?a.stream||dc(a):t,b()):c},a.context=function(a){return arguments.length?(f=null==(d=a)?new Xb:new bc(a),"function"!=typeof h&&f.pointRadius(h),b()):d},a.pointRadius=function(b){return arguments.length?(h="function"==typeof b?b:(f.pointRadius(+b),+b),a):h},a.projection(ig.geo.albersUsa()).context(null)},ig.geo.transform=function(a){return{stream:function(b){var c=new ec(b);for(var d in a)c[d]=a[d];return c}}},ec.prototype={point:function(a,b){this.stream.point(a,b)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ig.geo.projection=gc,ig.geo.projectionMutator=hc,(ig.geo.equirectangular=function(){return gc(jc)}).raw=jc.invert=jc,ig.geo.rotation=function(a){function b(b){return b=a(b[0]*Rg,b[1]*Rg),b[0]*=Sg,b[1]*=Sg,b}return a=lc(a[0]%360*Rg,a[1]*Rg,a.length>2?a[2]*Rg:0),b.invert=function(b){return b=a.invert(b[0]*Rg,b[1]*Rg),b[0]*=Sg,b[1]*=Sg,b},b},kc.invert=jc,ig.geo.circle=function(){function a(){var a="function"==typeof d?d.apply(this,arguments):d,b=lc(-a[0]*Rg,-a[1]*Rg,0).invert,e=[];return c(null,null,1,{point:function(a,c){e.push(a=b(a,c)),a[0]*=Sg,a[1]*=Sg}}),{type:"Polygon",coordinates:[e]}}var b,c,d=[0,0],e=6;return a.origin=function(b){return arguments.length?(d=b,a):d},a.angle=function(d){return arguments.length?(c=pc((b=+d)*Rg,e*Rg),a):b},a.precision=function(d){return arguments.length?(c=pc(b*Rg,(e=+d)*Rg),a):e},a.angle(90)},ig.geo.distance=function(a,b){var c,d=(b[0]-a[0])*Rg,e=a[1]*Rg,f=b[1]*Rg,g=Math.sin(d),h=Math.cos(d),i=Math.sin(e),j=Math.cos(e),k=Math.sin(f),l=Math.cos(f);return Math.atan2(Math.sqrt((c=l*g)*c+(c=j*k-i*l*h)*c),i*k+j*l*h)},ig.geo.graticule=function(){function a(){return{type:"MultiLineString",coordinates:b()}}function b(){return ig.range(Math.ceil(f/q)*q,e,q).map(m).concat(ig.range(Math.ceil(j/r)*r,i,r).map(n)).concat(ig.range(Math.ceil(d/o)*o,c,o).filter(function(a){return ug(a%q)>Lg}).map(k)).concat(ig.range(Math.ceil(h/p)*p,g,p).filter(function(a){return ug(a%r)>Lg}).map(l))}var c,d,e,f,g,h,i,j,k,l,m,n,o=10,p=o,q=90,r=360,s=2.5;return a.lines=function(){return b().map(function(a){return{type:"LineString",coordinates:a}})},a.outline=function(){return{type:"Polygon",coordinates:[m(f).concat(n(i).slice(1),m(e).reverse().slice(1),n(j).reverse().slice(1))]}},a.extent=function(b){return arguments.length?a.majorExtent(b).minorExtent(b):a.minorExtent()},a.majorExtent=function(b){return arguments.length?(f=+b[0][0],e=+b[1][0],j=+b[0][1],i=+b[1][1],f>e&&(b=f,f=e,e=b),j>i&&(b=j,j=i,i=b),a.precision(s)):[[f,j],[e,i]]},a.minorExtent=function(b){return arguments.length?(d=+b[0][0],c=+b[1][0],h=+b[0][1],g=+b[1][1],d>c&&(b=d,d=c,c=b),h>g&&(b=h,h=g,g=b),a.precision(s)):[[d,h],[c,g]]},a.step=function(b){return arguments.length?a.majorStep(b).minorStep(b):a.minorStep()},a.majorStep=function(b){return arguments.length?(q=+b[0],r=+b[1],a):[q,r]},a.minorStep=function(b){return arguments.length?(o=+b[0],p=+b[1],a):[o,p]},a.precision=function(b){return arguments.length?(s=+b,k=rc(h,g,90),l=sc(d,c,s),m=rc(j,i,90),n=sc(f,e,s),a):s},a.majorExtent([[-180,-90+Lg],[180,90-Lg]]).minorExtent([[-180,-80-Lg],[180,80+Lg]])},ig.geo.greatArc=function(){function a(){return{type:"LineString",coordinates:[b||d.apply(this,arguments),c||e.apply(this,arguments)]}}var b,c,d=tc,e=uc;return a.distance=function(){return ig.geo.distance(b||d.apply(this,arguments),c||e.apply(this,arguments))},a.source=function(c){return arguments.length?(d=c,b="function"==typeof c?null:c,a):d},a.target=function(b){return arguments.length?(e=b,c="function"==typeof b?null:b,a):e},a.precision=function(){return arguments.length?a:0},a},ig.geo.interpolate=function(a,b){return vc(a[0]*Rg,a[1]*Rg,b[0]*Rg,b[1]*Rg)},ig.geo.length=function(a){return Yh=0,ig.geo.stream(a,Zh),Yh};var Yh,Zh={sphere:w,point:w,lineStart:wc,lineEnd:w,polygonStart:w,polygonEnd:w},$h=xc(function(a){return Math.sqrt(2/(1+a))},function(a){return 2*Math.asin(a/2)});(ig.geo.azimuthalEqualArea=function(){return gc($h)}).raw=$h;var _h=xc(function(a){var b=Math.acos(a);return b&&b/Math.sin(b)},t);(ig.geo.azimuthalEquidistant=function(){return gc(_h)}).raw=_h,(ig.geo.conicConformal=function(){return Tb(yc)}).raw=yc,(ig.geo.conicEquidistant=function(){return Tb(zc)}).raw=zc;var ai=xc(function(a){return 1/a},Math.atan);(ig.geo.gnomonic=function(){return gc(ai)}).raw=ai,Ac.invert=function(a,b){return[a,2*Math.atan(Math.exp(b))-Qg]},(ig.geo.mercator=function(){return Bc(Ac)}).raw=Ac;var bi=xc(function(){return 1},Math.asin);(ig.geo.orthographic=function(){return gc(bi)}).raw=bi;var ci=xc(function(a){return 1/(1+a)},function(a){return 2*Math.atan(a)});(ig.geo.stereographic=function(){return gc(ci)}).raw=ci,Cc.invert=function(a,b){return[-b,2*Math.atan(Math.exp(a))-Qg]},(ig.geo.transverseMercator=function(){var a=Bc(Cc),b=a.center,c=a.rotate;return a.center=function(a){return a?b([-a[1],a[0]]):(a=b(),[a[1],-a[0]])},a.rotate=function(a){return a?c([a[0],a[1],a.length>2?a[2]+90:90]):(a=c(),[a[0],a[1],a[2]-90])},c([0,0,90])}).raw=Cc,ig.geom={},ig.geom.hull=function(a){function b(a){if(a.length<3)return[];var b,e=Ba(c),f=Ba(d),g=a.length,h=[],i=[];for(b=0;g>b;b++)h.push([+e.call(this,a[b],b),+f.call(this,a[b],b),b]);for(h.sort(Gc),b=0;g>b;b++)i.push([h[b][0],-h[b][1]]);var j=Fc(h),k=Fc(i),l=k[0]===j[0],m=k[k.length-1]===j[j.length-1],n=[];for(b=j.length-1;b>=0;--b)n.push(a[h[j[b]][2]]);for(b=+l;b<k.length-m;++b)n.push(a[h[k[b]][2]]);return n}var c=Dc,d=Ec;return arguments.length?b(a):(b.x=function(a){return arguments.length?(c=a,b):c},b.y=function(a){return arguments.length?(d=a,b):d},b)},ig.geom.polygon=function(a){return zg(a,di),a};var di=ig.geom.polygon.prototype=[];di.area=function(){for(var a,b=-1,c=this.length,d=this[c-1],e=0;++b<c;)a=d,d=this[b],e+=a[1]*d[0]-a[0]*d[1];return.5*e},di.centroid=function(a){var b,c,d=-1,e=this.length,f=0,g=0,h=this[e-1];for(arguments.length||(a=-1/(6*this.area()));++d<e;)b=h,h=this[d],c=b[0]*h[1]-h[0]*b[1],f+=(b[0]+h[0])*c,g+=(b[1]+h[1])*c;return[f*a,g*a]},di.clip=function(a){for(var b,c,d,e,f,g,h=Jc(a),i=-1,j=this.length-Jc(this),k=this[j-1];++i<j;){for(b=a.slice(),a.length=0,e=this[i],f=b[(d=b.length-h)-1],c=-1;++c<d;)g=b[c],Hc(g,k,e)?(Hc(f,k,e)||a.push(Ic(f,g,k,e)),a.push(g)):Hc(f,k,e)&&a.push(Ic(f,g,k,e)),f=g;h&&a.push(a[0]),k=e}return a};var ei,fi,gi,hi,ii,ji=[],ki=[];Rc.prototype.prepare=function(){for(var a,b=this.edges,c=b.length;c--;)a=b[c].edge,a.b&&a.a||b.splice(c,1);return b.sort(Tc),b.length},bd.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},cd.prototype={insert:function(a,b){var c,d,e;if(a){if(b.P=a,b.N=a.N,a.N&&(a.N.P=b),a.N=b,a.R){for(a=a.R;a.L;)a=a.L;a.L=b}else a.R=b;c=a}else this._?(a=gd(this._),b.P=null,b.N=a,a.P=a.L=b,c=a):(b.P=b.N=null,this._=b,c=null);for(b.L=b.R=null,b.U=c,b.C=!0,a=b;c&&c.C;)d=c.U,c===d.L?(e=d.R,e&&e.C?(c.C=e.C=!1,d.C=!0,a=d):(a===c.R&&(ed(this,c),a=c,c=a.U),c.C=!1,d.C=!0,fd(this,d))):(e=d.L,e&&e.C?(c.C=e.C=!1,d.C=!0,a=d):(a===c.L&&(fd(this,c),a=c,c=a.U),c.C=!1,d.C=!0,ed(this,d))),c=a.U;this._.C=!1},remove:function(a){a.N&&(a.N.P=a.P),a.P&&(a.P.N=a.N),a.N=a.P=null;var b,c,d,e=a.U,f=a.L,g=a.R;if(c=f?g?gd(g):f:g,e?e.L===a?e.L=c:e.R=c:this._=c,f&&g?(d=c.C,c.C=a.C,c.L=f,f.U=c,c!==g?(e=c.U,c.U=a.U,a=c.R,e.L=a,c.R=g,g.U=c):(c.U=e,e=c,a=c.R)):(d=a.C,a=c),a&&(a.U=e),
!d){if(a&&a.C)return void(a.C=!1);do{if(a===this._)break;if(a===e.L){if(b=e.R,b.C&&(b.C=!1,e.C=!0,ed(this,e),b=e.R),b.L&&b.L.C||b.R&&b.R.C){b.R&&b.R.C||(b.L.C=!1,b.C=!0,fd(this,b),b=e.R),b.C=e.C,e.C=b.R.C=!1,ed(this,e),a=this._;break}}else if(b=e.L,b.C&&(b.C=!1,e.C=!0,fd(this,e),b=e.L),b.L&&b.L.C||b.R&&b.R.C){b.L&&b.L.C||(b.R.C=!1,b.C=!0,ed(this,b),b=e.L),b.C=e.C,e.C=b.L.C=!1,fd(this,e),a=this._;break}b.C=!0,a=e,e=e.U}while(!a.C);a&&(a.C=!1)}}},ig.geom.voronoi=function(a){function b(a){var b=new Array(a.length),d=h[0][0],e=h[0][1],f=h[1][0],g=h[1][1];return hd(c(a),h).cells.forEach(function(c,h){var i=c.edges,j=c.site,k=b[h]=i.length?i.map(function(a){var b=a.start();return[b.x,b.y]}):j.x>=d&&j.x<=f&&j.y>=e&&j.y<=g?[[d,g],[f,g],[f,e],[d,e]]:[];k.point=a[h]}),b}function c(a){return a.map(function(a,b){return{x:Math.round(f(a,b)/Lg)*Lg,y:Math.round(g(a,b)/Lg)*Lg,i:b}})}var d=Dc,e=Ec,f=d,g=e,h=li;return a?b(a):(b.links=function(a){return hd(c(a)).edges.filter(function(a){return a.l&&a.r}).map(function(b){return{source:a[b.l.i],target:a[b.r.i]}})},b.triangles=function(a){var b=[];return hd(c(a)).cells.forEach(function(c,d){for(var e,f,g=c.site,h=c.edges.sort(Tc),i=-1,j=h.length,k=h[j-1].edge,l=k.l===g?k.r:k.l;++i<j;)e=k,f=l,k=h[i].edge,l=k.l===g?k.r:k.l,d<f.i&&d<l.i&&jd(g,f,l)<0&&b.push([a[d],a[f.i],a[l.i]])}),b},b.x=function(a){return arguments.length?(f=Ba(d=a),b):d},b.y=function(a){return arguments.length?(g=Ba(e=a),b):e},b.clipExtent=function(a){return arguments.length?(h=null==a?li:a,b):h===li?null:h},b.size=function(a){return arguments.length?b.clipExtent(a&&[[0,0],a]):h===li?null:h&&h[1]},b)};var li=[[-1e6,-1e6],[1e6,1e6]];ig.geom.delaunay=function(a){return ig.geom.voronoi().triangles(a)},ig.geom.quadtree=function(a,b,c,d,e){function f(a){function f(a,b,c,d,e,f,g,h){if(!isNaN(c)&&!isNaN(d))if(a.leaf){var i=a.x,k=a.y;if(null!=i)if(ug(i-c)+ug(k-d)<.01)j(a,b,c,d,e,f,g,h);else{var l=a.point;a.x=a.y=a.point=null,j(a,l,i,k,e,f,g,h),j(a,b,c,d,e,f,g,h)}else a.x=c,a.y=d,a.point=b}else j(a,b,c,d,e,f,g,h)}function j(a,b,c,d,e,g,h,i){var j=.5*(e+h),k=.5*(g+i),l=c>=j,m=d>=k,n=m<<1|l;a.leaf=!1,a=a.nodes[n]||(a.nodes[n]=md()),l?e=j:h=j,m?g=k:i=k,f(a,b,c,d,e,g,h,i)}var k,l,m,n,o,p,q,r,s,t=Ba(h),u=Ba(i);if(null!=b)p=b,q=c,r=d,s=e;else if(r=s=-(p=q=1/0),l=[],m=[],o=a.length,g)for(n=0;o>n;++n)k=a[n],k.x<p&&(p=k.x),k.y<q&&(q=k.y),k.x>r&&(r=k.x),k.y>s&&(s=k.y),l.push(k.x),m.push(k.y);else for(n=0;o>n;++n){var v=+t(k=a[n],n),w=+u(k,n);p>v&&(p=v),q>w&&(q=w),v>r&&(r=v),w>s&&(s=w),l.push(v),m.push(w)}var x=r-p,y=s-q;x>y?s=q+x:r=p+y;var z=md();if(z.add=function(a){f(z,a,+t(a,++n),+u(a,n),p,q,r,s)},z.visit=function(a){nd(a,z,p,q,r,s)},z.find=function(a){return od(z,a[0],a[1],p,q,r,s)},n=-1,null==b){for(;++n<o;)f(z,a[n],l[n],m[n],p,q,r,s);--n}else a.forEach(z.add);return l=m=a=k=null,z}var g,h=Dc,i=Ec;return(g=arguments.length)?(h=kd,i=ld,3===g&&(e=c,d=b,c=b=0),f(a)):(f.x=function(a){return arguments.length?(h=a,f):h},f.y=function(a){return arguments.length?(i=a,f):i},f.extent=function(a){return arguments.length?(null==a?b=c=d=e=null:(b=+a[0][0],c=+a[0][1],d=+a[1][0],e=+a[1][1]),f):null==b?null:[[b,c],[d,e]]},f.size=function(a){return arguments.length?(null==a?b=c=d=e=null:(b=c=0,d=+a[0],e=+a[1]),f):null==b?null:[d-b,e-c]},f)},ig.interpolateRgb=pd,ig.interpolateObject=qd,ig.interpolateNumber=rd,ig.interpolateString=sd;var mi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ni=new RegExp(mi.source,"g");ig.interpolate=td,ig.interpolators=[function(a,b){var c=typeof b;return("string"===c?fh.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?pd:sd:b instanceof ha?pd:Array.isArray(b)?ud:"object"===c&&isNaN(b)?qd:rd)(a,b)}],ig.interpolateArray=ud;var oi=function(){return t},pi=ig.map({linear:oi,poly:Bd,quad:function(){return yd},cubic:function(){return zd},sin:function(){return Cd},exp:function(){return Dd},circle:function(){return Ed},elastic:Fd,back:Gd,bounce:function(){return Hd}}),qi=ig.map({"in":t,out:wd,"in-out":xd,"out-in":function(a){return xd(wd(a))}});ig.ease=function(a){var b=a.indexOf("-"),c=b>=0?a.slice(0,b):a,d=b>=0?a.slice(b+1):"in";return c=pi.get(c)||oi,d=qi.get(d)||t,vd(d(c.apply(null,jg.call(arguments,1))))},ig.interpolateHcl=Id,ig.interpolateHsl=Jd,ig.interpolateLab=Kd,ig.interpolateRound=Ld,ig.transform=function(a){var b=lg.createElementNS(ig.ns.prefix.svg,"g");return(ig.transform=function(a){if(null!=a){b.setAttribute("transform",a);var c=b.transform.baseVal.consolidate()}return new Md(c?c.matrix:ri)})(a)},Md.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ri={a:1,b:0,c:0,d:1,e:0,f:0};ig.interpolateTransform=Vd,ig.layout={},ig.layout.bundle=function(){return function(a){for(var b=[],c=-1,d=a.length;++c<d;)b.push(Yd(a[c]));return b}},ig.layout.chord=function(){function a(){var a,j,l,m,n,o={},p=[],q=ig.range(f),r=[];for(c=[],d=[],a=0,m=-1;++m<f;){for(j=0,n=-1;++n<f;)j+=e[m][n];p.push(j),r.push(ig.range(f)),a+=j}for(g&&q.sort(function(a,b){return g(p[a],p[b])}),h&&r.forEach(function(a,b){a.sort(function(a,c){return h(e[b][a],e[b][c])})}),a=(Og-k*f)/a,j=0,m=-1;++m<f;){for(l=j,n=-1;++n<f;){var s=q[m],t=r[s][n],u=e[s][t],v=j,w=j+=u*a;o[s+"-"+t]={index:s,subindex:t,startAngle:v,endAngle:w,value:u}}d[s]={index:s,startAngle:l,endAngle:j,value:p[s]},j+=k}for(m=-1;++m<f;)for(n=m-1;++n<f;){var x=o[m+"-"+n],y=o[n+"-"+m];(x.value||y.value)&&c.push(x.value<y.value?{source:y,target:x}:{source:x,target:y})}i&&b()}function b(){c.sort(function(a,b){return i((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}var c,d,e,f,g,h,i,j={},k=0;return j.matrix=function(a){return arguments.length?(f=(e=a)&&e.length,c=d=null,j):e},j.padding=function(a){return arguments.length?(k=a,c=d=null,j):k},j.sortGroups=function(a){return arguments.length?(g=a,c=d=null,j):g},j.sortSubgroups=function(a){return arguments.length?(h=a,c=null,j):h},j.sortChords=function(a){return arguments.length?(i=a,c&&b(),j):i},j.chords=function(){return c||a(),c},j.groups=function(){return d||a(),d},j},ig.layout.force=function(){function a(a){return function(b,c,d,e){if(b.point!==a){var f=b.cx-a.x,g=b.cy-a.y,h=e-c,i=f*f+g*g;if(i>h*h/r){if(p>i){var j=b.charge/i;a.px-=f*j,a.py-=g*j}return!0}if(b.point&&i&&p>i){var j=b.pointCharge/i;a.px-=f*j,a.py-=g*j}}return!b.charge}}function b(a){a.px=ig.event.x,a.py=ig.event.y,i.resume()}var c,d,e,f,g,h,i={},j=ig.dispatch("start","tick","end"),k=[1,1],l=.9,m=si,n=ti,o=-30,p=ui,q=.1,r=.64,s=[],u=[];return i.tick=function(){if((e*=.99)<.005)return c=null,j.end({type:"end",alpha:e=0}),!0;var b,d,i,m,n,p,r,t,v,w=s.length,x=u.length;for(d=0;x>d;++d)i=u[d],m=i.source,n=i.target,t=n.x-m.x,v=n.y-m.y,(p=t*t+v*v)&&(p=e*g[d]*((p=Math.sqrt(p))-f[d])/p,t*=p,v*=p,n.x-=t*(r=m.weight+n.weight?m.weight/(m.weight+n.weight):.5),n.y-=v*r,m.x+=t*(r=1-r),m.y+=v*r);if((r=e*q)&&(t=k[0]/2,v=k[1]/2,d=-1,r))for(;++d<w;)i=s[d],i.x+=(t-i.x)*r,i.y+=(v-i.y)*r;if(o)for(de(b=ig.geom.quadtree(s),e,h),d=-1;++d<w;)(i=s[d]).fixed||b.visit(a(i));for(d=-1;++d<w;)i=s[d],i.fixed?(i.x=i.px,i.y=i.py):(i.x-=(i.px-(i.px=i.x))*l,i.y-=(i.py-(i.py=i.y))*l);j.tick({type:"tick",alpha:e})},i.nodes=function(a){return arguments.length?(s=a,i):s},i.links=function(a){return arguments.length?(u=a,i):u},i.size=function(a){return arguments.length?(k=a,i):k},i.linkDistance=function(a){return arguments.length?(m="function"==typeof a?a:+a,i):m},i.distance=i.linkDistance,i.linkStrength=function(a){return arguments.length?(n="function"==typeof a?a:+a,i):n},i.friction=function(a){return arguments.length?(l=+a,i):l},i.charge=function(a){return arguments.length?(o="function"==typeof a?a:+a,i):o},i.chargeDistance=function(a){return arguments.length?(p=a*a,i):Math.sqrt(p)},i.gravity=function(a){return arguments.length?(q=+a,i):q},i.theta=function(a){return arguments.length?(r=a*a,i):Math.sqrt(r)},i.alpha=function(a){return arguments.length?(a=+a,e?a>0?e=a:(c.c=null,c.t=NaN,c=null,j.end({type:"end",alpha:e=0})):a>0&&(j.start({type:"start",alpha:e=a}),c=Ga(i.tick)),i):e},i.start=function(){function a(a,d){if(!c){for(c=new Array(e),i=0;e>i;++i)c[i]=[];for(i=0;j>i;++i){var f=u[i];c[f.source.index].push(f.target),c[f.target.index].push(f.source)}}for(var g,h=c[b],i=-1,k=h.length;++i<k;)if(!isNaN(g=h[i][a]))return g;return Math.random()*d}var b,c,d,e=s.length,j=u.length,l=k[0],p=k[1];for(b=0;e>b;++b)(d=s[b]).index=b,d.weight=0;for(b=0;j>b;++b)d=u[b],"number"==typeof d.source&&(d.source=s[d.source]),"number"==typeof d.target&&(d.target=s[d.target]),++d.source.weight,++d.target.weight;for(b=0;e>b;++b)d=s[b],isNaN(d.x)&&(d.x=a("x",l)),isNaN(d.y)&&(d.y=a("y",p)),isNaN(d.px)&&(d.px=d.x),isNaN(d.py)&&(d.py=d.y);if(f=[],"function"==typeof m)for(b=0;j>b;++b)f[b]=+m.call(this,u[b],b);else for(b=0;j>b;++b)f[b]=m;if(g=[],"function"==typeof n)for(b=0;j>b;++b)g[b]=+n.call(this,u[b],b);else for(b=0;j>b;++b)g[b]=n;if(h=[],"function"==typeof o)for(b=0;e>b;++b)h[b]=+o.call(this,s[b],b);else for(b=0;e>b;++b)h[b]=o;return i.resume()},i.resume=function(){return i.alpha(.1)},i.stop=function(){return i.alpha(0)},i.drag=function(){return d||(d=ig.behavior.drag().origin(t).on("dragstart.force",_d).on("drag.force",b).on("dragend.force",ae)),arguments.length?void this.on("mouseover.force",be).on("mouseout.force",ce).call(d):d},ig.rebind(i,j,"on")};var si=20,ti=1,ui=1/0;ig.layout.hierarchy=function(){function a(e){var f,g=[e],h=[];for(e.depth=0;null!=(f=g.pop());)if(h.push(f),(j=c.call(a,f,f.depth))&&(i=j.length)){for(var i,j,k;--i>=0;)g.push(k=j[i]),k.parent=f,k.depth=f.depth+1;d&&(f.value=0),f.children=j}else d&&(f.value=+d.call(a,f,f.depth)||0),delete f.children;return ge(e,function(a){var c,e;b&&(c=a.children)&&c.sort(b),d&&(e=a.parent)&&(e.value+=a.value)}),h}var b=je,c=he,d=ie;return a.sort=function(c){return arguments.length?(b=c,a):b},a.children=function(b){return arguments.length?(c=b,a):c},a.value=function(b){return arguments.length?(d=b,a):d},a.revalue=function(b){return d&&(fe(b,function(a){a.children&&(a.value=0)}),ge(b,function(b){var c;b.children||(b.value=+d.call(a,b,b.depth)||0),(c=b.parent)&&(c.value+=b.value)})),b},a},ig.layout.partition=function(){function a(b,c,d,e){var f=b.children;if(b.x=c,b.y=b.depth*e,b.dx=d,b.dy=e,f&&(g=f.length)){var g,h,i,j=-1;for(d=b.value?d/b.value:0;++j<g;)a(h=f[j],c,i=h.value*d,e),c+=i}}function b(a){var c=a.children,d=0;if(c&&(e=c.length))for(var e,f=-1;++f<e;)d=Math.max(d,b(c[f]));return 1+d}function c(c,f){var g=d.call(this,c,f);return a(g[0],0,e[0],e[1]/b(g[0])),g}var d=ig.layout.hierarchy(),e=[1,1];return c.size=function(a){return arguments.length?(e=a,c):e},ee(c,d)},ig.layout.pie=function(){function a(g){var h,i=g.length,j=g.map(function(c,d){return+b.call(a,c,d)}),k=+("function"==typeof d?d.apply(this,arguments):d),l=("function"==typeof e?e.apply(this,arguments):e)-k,m=Math.min(Math.abs(l)/i,+("function"==typeof f?f.apply(this,arguments):f)),n=m*(0>l?-1:1),o=ig.sum(j),p=o?(l-i*n)/o:0,q=ig.range(i),r=[];return null!=c&&q.sort(c===vi?function(a,b){return j[b]-j[a]}:function(a,b){return c(g[a],g[b])}),q.forEach(function(a){r[a]={data:g[a],value:h=j[a],startAngle:k,endAngle:k+=h*p+n,padAngle:m}}),r}var b=Number,c=vi,d=0,e=Og,f=0;return a.value=function(c){return arguments.length?(b=c,a):b},a.sort=function(b){return arguments.length?(c=b,a):c},a.startAngle=function(b){return arguments.length?(d=b,a):d},a.endAngle=function(b){return arguments.length?(e=b,a):e},a.padAngle=function(b){return arguments.length?(f=b,a):f},a};var vi={};ig.layout.stack=function(){function a(h,i){if(!(m=h.length))return h;var j=h.map(function(c,d){return b.call(a,c,d)}),k=j.map(function(b){return b.map(function(b,c){return[f.call(a,b,c),g.call(a,b,c)]})}),l=c.call(a,k,i);j=ig.permute(j,l),k=ig.permute(k,l);var m,n,o,p,q=d.call(a,k,i),r=j[0].length;for(o=0;r>o;++o)for(e.call(a,j[0][o],p=q[o],k[0][o][1]),n=1;m>n;++n)e.call(a,j[n][o],p+=k[n-1][o][1],k[n][o][1]);return h}var b=t,c=oe,d=pe,e=ne,f=le,g=me;return a.values=function(c){return arguments.length?(b=c,a):b},a.order=function(b){return arguments.length?(c="function"==typeof b?b:wi.get(b)||oe,a):c},a.offset=function(b){return arguments.length?(d="function"==typeof b?b:xi.get(b)||pe,a):d},a.x=function(b){return arguments.length?(f=b,a):f},a.y=function(b){return arguments.length?(g=b,a):g},a.out=function(b){return arguments.length?(e=b,a):e},a};var wi=ig.map({"inside-out":function(a){var b,c,d=a.length,e=a.map(qe),f=a.map(re),g=ig.range(d).sort(function(a,b){return e[a]-e[b]}),h=0,i=0,j=[],k=[];for(b=0;d>b;++b)c=g[b],i>h?(h+=f[c],j.push(c)):(i+=f[c],k.push(c));return k.reverse().concat(j)},reverse:function(a){return ig.range(a.length).reverse()},"default":oe}),xi=ig.map({silhouette:function(a){var b,c,d,e=a.length,f=a[0].length,g=[],h=0,i=[];for(c=0;f>c;++c){for(b=0,d=0;e>b;b++)d+=a[b][c][1];d>h&&(h=d),g.push(d)}for(c=0;f>c;++c)i[c]=(h-g[c])/2;return i},wiggle:function(a){var b,c,d,e,f,g,h,i,j,k=a.length,l=a[0],m=l.length,n=[];for(n[0]=i=j=0,c=1;m>c;++c){for(b=0,e=0;k>b;++b)e+=a[b][c][1];for(b=0,f=0,h=l[c][0]-l[c-1][0];k>b;++b){for(d=0,g=(a[b][c][1]-a[b][c-1][1])/(2*h);b>d;++d)g+=(a[d][c][1]-a[d][c-1][1])/h;f+=g*a[b][c][1]}n[c]=i-=e?f/e*h:0,j>i&&(j=i)}for(c=0;m>c;++c)n[c]-=j;return n},expand:function(a){var b,c,d,e=a.length,f=a[0].length,g=1/e,h=[];for(c=0;f>c;++c){for(b=0,d=0;e>b;b++)d+=a[b][c][1];if(d)for(b=0;e>b;b++)a[b][c][1]/=d;else for(b=0;e>b;b++)a[b][c][1]=g}for(c=0;f>c;++c)h[c]=0;return h},zero:pe});ig.layout.histogram=function(){function a(a,f){for(var g,h,i=[],j=a.map(c,this),k=d.call(this,j,f),l=e.call(this,k,j,f),f=-1,m=j.length,n=l.length-1,o=b?1:1/m;++f<n;)g=i[f]=[],g.dx=l[f+1]-(g.x=l[f]),g.y=0;if(n>0)for(f=-1;++f<m;)h=j[f],h>=k[0]&&h<=k[1]&&(g=i[ig.bisect(l,h,1,n)-1],g.y+=o,g.push(a[f]));return i}var b=!0,c=Number,d=ve,e=te;return a.value=function(b){return arguments.length?(c=b,a):c},a.range=function(b){return arguments.length?(d=Ba(b),a):d},a.bins=function(b){return arguments.length?(e="number"==typeof b?function(a){return ue(a,b)}:Ba(b),a):e},a.frequency=function(c){return arguments.length?(b=!!c,a):b},a},ig.layout.pack=function(){function a(a,f){var g=c.call(this,a,f),h=g[0],i=e[0],j=e[1],k=null==b?Math.sqrt:"function"==typeof b?b:function(){return b};if(h.x=h.y=0,ge(h,function(a){a.r=+k(a.value)}),ge(h,Ae),d){var l=d*(b?1:Math.max(2*h.r/i,2*h.r/j))/2;ge(h,function(a){a.r+=l}),ge(h,Ae),ge(h,function(a){a.r-=l})}return De(h,i/2,j/2,b?1:1/Math.max(2*h.r/i,2*h.r/j)),g}var b,c=ig.layout.hierarchy().sort(we),d=0,e=[1,1];return a.size=function(b){return arguments.length?(e=b,a):e},a.radius=function(c){return arguments.length?(b=null==c||"function"==typeof c?c:+c,a):b},a.padding=function(b){return arguments.length?(d=+b,a):d},ee(a,c)},ig.layout.tree=function(){function a(a,e){var k=g.call(this,a,e),l=k[0],m=b(l);if(ge(m,c),m.parent.m=-m.z,fe(m,d),j)fe(l,f);else{var n=l,o=l,p=l;fe(l,function(a){a.x<n.x&&(n=a),a.x>o.x&&(o=a),a.depth>p.depth&&(p=a)});var q=h(n,o)/2-n.x,r=i[0]/(o.x+h(o,n)/2+q),s=i[1]/(p.depth||1);fe(l,function(a){a.x=(a.x+q)*r,a.y=a.depth*s})}return k}function b(a){for(var b,c={A:null,children:[a]},d=[c];null!=(b=d.pop());)for(var e,f=b.children,g=0,h=f.length;h>g;++g)d.push((f[g]=e={_:f[g],parent:b,children:(e=f[g].children)&&e.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:g}).a=e);return c.children[0]}function c(a){var b=a.children,c=a.parent.children,d=a.i?c[a.i-1]:null;if(b.length){Je(a);var f=(b[0].z+b[b.length-1].z)/2;d?(a.z=d.z+h(a._,d._),a.m=a.z-f):a.z=f}else d&&(a.z=d.z+h(a._,d._));a.parent.A=e(a,d,a.parent.A||c[0])}function d(a){a._.x=a.z+a.parent.m,a.m+=a.parent.m}function e(a,b,c){if(b){for(var d,e=a,f=a,g=b,i=e.parent.children[0],j=e.m,k=f.m,l=g.m,m=i.m;g=He(g),e=Ge(e),g&&e;)i=Ge(i),f=He(f),f.a=a,d=g.z+l-e.z-j+h(g._,e._),d>0&&(Ie(Ke(g,a,c),a,d),j+=d,k+=d),l+=g.m,j+=e.m,m+=i.m,k+=f.m;g&&!He(f)&&(f.t=g,f.m+=l-k),e&&!Ge(i)&&(i.t=e,i.m+=j-m,c=a)}return c}function f(a){a.x*=i[0],a.y=a.depth*i[1]}var g=ig.layout.hierarchy().sort(null).value(null),h=Fe,i=[1,1],j=null;return a.separation=function(b){return arguments.length?(h=b,a):h},a.size=function(b){return arguments.length?(j=null==(i=b)?f:null,a):j?null:i},a.nodeSize=function(b){return arguments.length?(j=null==(i=b)?null:f,a):j?i:null},ee(a,g)},ig.layout.cluster=function(){function a(a,f){var g,h=b.call(this,a,f),i=h[0],j=0;ge(i,function(a){var b=a.children;b&&b.length?(a.x=Me(b),a.y=Le(b)):(a.x=g?j+=c(a,g):0,a.y=0,g=a)});var k=Ne(i),l=Oe(i),m=k.x-c(k,l)/2,n=l.x+c(l,k)/2;return ge(i,e?function(a){a.x=(a.x-i.x)*d[0],a.y=(i.y-a.y)*d[1]}:function(a){a.x=(a.x-m)/(n-m)*d[0],a.y=(1-(i.y?a.y/i.y:1))*d[1]}),h}var b=ig.layout.hierarchy().sort(null).value(null),c=Fe,d=[1,1],e=!1;return a.separation=function(b){return arguments.length?(c=b,a):c},a.size=function(b){return arguments.length?(e=null==(d=b),a):e?null:d},a.nodeSize=function(b){return arguments.length?(e=null!=(d=b),a):e?d:null},ee(a,b)},ig.layout.treemap=function(){function a(a,b){for(var c,d,e=-1,f=a.length;++e<f;)d=(c=a[e]).value*(0>b?0:b),c.area=isNaN(d)||0>=d?0:d}function b(c){var f=c.children;if(f&&f.length){var g,h,i,j=l(c),k=[],m=f.slice(),o=1/0,p="slice"===n?j.dx:"dice"===n?j.dy:"slice-dice"===n?1&c.depth?j.dy:j.dx:Math.min(j.dx,j.dy);for(a(m,j.dx*j.dy/c.value),k.area=0;(i=m.length)>0;)k.push(g=m[i-1]),k.area+=g.area,"squarify"!==n||(h=d(k,p))<=o?(m.pop(),o=h):(k.area-=k.pop().area,e(k,p,j,!1),p=Math.min(j.dx,j.dy),k.length=k.area=0,o=1/0);k.length&&(e(k,p,j,!0),k.length=k.area=0),f.forEach(b)}}function c(b){var d=b.children;if(d&&d.length){var f,g=l(b),h=d.slice(),i=[];for(a(h,g.dx*g.dy/b.value),i.area=0;f=h.pop();)i.push(f),i.area+=f.area,null!=f.z&&(e(i,f.z?g.dx:g.dy,g,!h.length),i.length=i.area=0);d.forEach(c)}}function d(a,b){for(var c,d=a.area,e=0,f=1/0,g=-1,h=a.length;++g<h;)(c=a[g].area)&&(f>c&&(f=c),c>e&&(e=c));return d*=d,b*=b,d?Math.max(b*e*o/d,d/(b*f*o)):1/0}function e(a,b,c,d){var e,f=-1,g=a.length,h=c.x,j=c.y,k=b?i(a.area/b):0;if(b==c.dx){for((d||k>c.dy)&&(k=c.dy);++f<g;)e=a[f],e.x=h,e.y=j,e.dy=k,h+=e.dx=Math.min(c.x+c.dx-h,k?i(e.area/k):0);e.z=!0,e.dx+=c.x+c.dx-h,c.y+=k,c.dy-=k}else{for((d||k>c.dx)&&(k=c.dx);++f<g;)e=a[f],e.x=h,e.y=j,e.dx=k,j+=e.dy=Math.min(c.y+c.dy-j,k?i(e.area/k):0);e.z=!1,e.dy+=c.y+c.dy-j,c.x+=k,c.dx-=k}}function f(d){var e=g||h(d),f=e[0];return f.x=f.y=0,f.value?(f.dx=j[0],f.dy=j[1]):f.dx=f.dy=0,g&&h.revalue(f),a([f],f.dx*f.dy/f.value),(g?c:b)(f),m&&(g=e),e}var g,h=ig.layout.hierarchy(),i=Math.round,j=[1,1],k=null,l=Pe,m=!1,n="squarify",o=.5*(1+Math.sqrt(5));return f.size=function(a){return arguments.length?(j=a,f):j},f.padding=function(a){function b(b){var c=a.call(f,b,b.depth);return null==c?Pe(b):Qe(b,"number"==typeof c?[c,c,c,c]:c)}function c(b){return Qe(b,a)}if(!arguments.length)return k;var d;return l=null==(k=a)?Pe:"function"==(d=typeof a)?b:"number"===d?(a=[a,a,a,a],c):c,f},f.round=function(a){return arguments.length?(i=a?Math.round:Number,f):i!=Number},f.sticky=function(a){return arguments.length?(m=a,g=null,f):m},f.ratio=function(a){return arguments.length?(o=a,f):o},f.mode=function(a){return arguments.length?(n=a+"",f):n},ee(f,h)},ig.random={normal:function(a,b){var c=arguments.length;return 2>c&&(b=1),1>c&&(a=0),function(){var c,d,e;do c=2*Math.random()-1,d=2*Math.random()-1,e=c*c+d*d;while(!e||e>1);return a+b*c*Math.sqrt(-2*Math.log(e)/e)}},logNormal:function(){var a=ig.random.normal.apply(ig,arguments);return function(){return Math.exp(a())}},bates:function(a){var b=ig.random.irwinHall(a);return function(){return b()/a}},irwinHall:function(a){return function(){for(var b=0,c=0;a>c;c++)b+=Math.random();return b}}},ig.scale={};var yi={floor:t,ceil:t};ig.scale.linear=function(){return Xe([0,1],[0,1],td,!1)};var zi={s:1,g:1,p:1,r:1,e:1};ig.scale.log=function(){return df(ig.scale.linear().domain([0,1]),10,!0,[1,10])};var Ai=ig.format(".0e"),Bi={floor:function(a){return-Math.ceil(-a)},ceil:function(a){return-Math.floor(-a)}};ig.scale.pow=function(){return ef(ig.scale.linear(),1,[0,1])},ig.scale.sqrt=function(){return ig.scale.pow().exponent(.5)},ig.scale.ordinal=function(){return gf([],{t:"range",a:[[]]})},ig.scale.category10=function(){return ig.scale.ordinal().range(Ci)},ig.scale.category20=function(){return ig.scale.ordinal().range(Di)},ig.scale.category20b=function(){return ig.scale.ordinal().range(Ei)},ig.scale.category20c=function(){return ig.scale.ordinal().range(Fi)};var Ci=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(ua),Di=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(ua),Ei=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(ua),Fi=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(ua);ig.scale.quantile=function(){return hf([],[])},ig.scale.quantize=function(){return jf(0,1,[0,1])},ig.scale.threshold=function(){return kf([.5],[0,1])},ig.scale.identity=function(){return lf([0,1])},ig.svg={},ig.svg.arc=function(){function a(){var a=Math.max(0,+c.apply(this,arguments)),j=Math.max(0,+d.apply(this,arguments)),k=g.apply(this,arguments)-Qg,l=h.apply(this,arguments)-Qg,m=Math.abs(l-k),n=k>l?0:1;if(a>j&&(o=j,j=a,a=o),m>=Pg)return b(j,n)+(a?b(a,1-n):"")+"Z";var o,p,q,r,s,t,u,v,w,x,y,z,A=0,B=0,C=[];if((r=(+i.apply(this,arguments)||0)/2)&&(q=f===Gi?Math.sqrt(a*a+j*j):+f.apply(this,arguments),n||(B*=-1),j&&(B=ca(q/j*Math.sin(r))),a&&(A=ca(q/a*Math.sin(r)))),j){s=j*Math.cos(k+B),t=j*Math.sin(k+B),u=j*Math.cos(l-B),v=j*Math.sin(l-B);var D=Math.abs(l-k-2*B)<=Ng?0:1;if(B&&sf(s,t,u,v)===n^D){var E=(k+l)/2;s=j*Math.cos(E),t=j*Math.sin(E),u=v=null}}else s=t=0;if(a){w=a*Math.cos(l-A),x=a*Math.sin(l-A),y=a*Math.cos(k+A),z=a*Math.sin(k+A);var F=Math.abs(k-l+2*A)<=Ng?0:1;if(A&&sf(w,x,y,z)===1-n^F){var G=(k+l)/2;w=a*Math.cos(G),x=a*Math.sin(G),y=z=null}}else w=x=0;if(m>Lg&&(o=Math.min(Math.abs(j-a)/2,+e.apply(this,arguments)))>.001){p=j>a^n?0:1;var H=o,I=o;if(Ng>m){var J=null==y?[w,x]:null==u?[s,t]:Ic([s,t],[y,z],[u,v],[w,x]),K=s-J[0],L=t-J[1],M=u-J[0],N=v-J[1],O=1/Math.sin(Math.acos((K*M+L*N)/(Math.sqrt(K*K+L*L)*Math.sqrt(M*M+N*N)))/2),P=Math.sqrt(J[0]*J[0]+J[1]*J[1]);I=Math.min(o,(a-P)/(O-1)),H=Math.min(o,(j-P)/(O+1))}if(null!=u){var Q=tf(null==y?[w,x]:[y,z],[s,t],j,H,n),R=tf([u,v],[w,x],j,H,n);o===H?C.push("M",Q[0],"A",H,",",H," 0 0,",p," ",Q[1],"A",j,",",j," 0 ",1-n^sf(Q[1][0],Q[1][1],R[1][0],R[1][1]),",",n," ",R[1],"A",H,",",H," 0 0,",p," ",R[0]):C.push("M",Q[0],"A",H,",",H," 0 1,",p," ",R[0])}else C.push("M",s,",",t);if(null!=y){var S=tf([s,t],[y,z],a,-I,n),T=tf([w,x],null==u?[s,t]:[u,v],a,-I,n);o===I?C.push("L",T[0],"A",I,",",I," 0 0,",p," ",T[1],"A",a,",",a," 0 ",n^sf(T[1][0],T[1][1],S[1][0],S[1][1]),",",1-n," ",S[1],"A",I,",",I," 0 0,",p," ",S[0]):C.push("L",T[0],"A",I,",",I," 0 0,",p," ",S[0])}else C.push("L",w,",",x)}else C.push("M",s,",",t),null!=u&&C.push("A",j,",",j," 0 ",D,",",n," ",u,",",v),C.push("L",w,",",x),null!=y&&C.push("A",a,",",a," 0 ",F,",",1-n," ",y,",",z);return C.push("Z"),C.join("")}function b(a,b){return"M0,"+a+"A"+a+","+a+" 0 1,"+b+" 0,"+-a+"A"+a+","+a+" 0 1,"+b+" 0,"+a}var c=nf,d=of,e=mf,f=Gi,g=pf,h=qf,i=rf;return a.innerRadius=function(b){return arguments.length?(c=Ba(b),a):c},a.outerRadius=function(b){return arguments.length?(d=Ba(b),a):d},a.cornerRadius=function(b){return arguments.length?(e=Ba(b),a):e},a.padRadius=function(b){return arguments.length?(f=b==Gi?Gi:Ba(b),a):f},a.startAngle=function(b){return arguments.length?(g=Ba(b),a):g},a.endAngle=function(b){return arguments.length?(h=Ba(b),a):h},a.padAngle=function(b){return arguments.length?(i=Ba(b),a):i},a.centroid=function(){var a=(+c.apply(this,arguments)+ +d.apply(this,arguments))/2,b=(+g.apply(this,arguments)+ +h.apply(this,arguments))/2-Qg;return[Math.cos(b)*a,Math.sin(b)*a]},a};var Gi="auto";ig.svg.line=function(){return uf(t)};var Hi=ig.map({linear:vf,"linear-closed":wf,step:xf,"step-before":yf,"step-after":zf,basis:Ff,"basis-open":Gf,"basis-closed":Hf,bundle:If,cardinal:Cf,"cardinal-open":Af,"cardinal-closed":Bf,monotone:Of});Hi.forEach(function(a,b){b.key=a,b.closed=/-closed$/.test(a)});var Ii=[0,2/3,1/3,0],Ji=[0,1/3,2/3,0],Ki=[0,1/6,2/3,1/6];ig.svg.line.radial=function(){var a=uf(Pf);return a.radius=a.x,delete a.x,a.angle=a.y,delete a.y,a},yf.reverse=zf,zf.reverse=yf,ig.svg.area=function(){return Qf(t)},ig.svg.area.radial=function(){var a=Qf(Pf);return a.radius=a.x,delete a.x,a.innerRadius=a.x0,delete a.x0,a.outerRadius=a.x1,delete a.x1,a.angle=a.y,delete a.y,a.startAngle=a.y0,delete a.y0,a.endAngle=a.y1,delete a.y1,a},ig.svg.chord=function(){function a(a,h){var i=b(this,f,a,h),j=b(this,g,a,h);return"M"+i.p0+d(i.r,i.p1,i.a1-i.a0)+(c(i,j)?e(i.r,i.p1,i.r,i.p0):e(i.r,i.p1,j.r,j.p0)+d(j.r,j.p1,j.a1-j.a0)+e(j.r,j.p1,i.r,i.p0))+"Z"}function b(a,b,c,d){var e=b.call(a,c,d),f=h.call(a,e,d),g=i.call(a,e,d)-Qg,k=j.call(a,e,d)-Qg;return{r:f,a0:g,a1:k,p0:[f*Math.cos(g),f*Math.sin(g)],p1:[f*Math.cos(k),f*Math.sin(k)]}}function c(a,b){return a.a0==b.a0&&a.a1==b.a1}function d(a,b,c){return"A"+a+","+a+" 0 "+ +(c>Ng)+",1 "+b}function e(a,b,c,d){return"Q 0,0 "+d}var f=tc,g=uc,h=Rf,i=pf,j=qf;return a.radius=function(b){return arguments.length?(h=Ba(b),a):h},a.source=function(b){return arguments.length?(f=Ba(b),a):f},a.target=function(b){return arguments.length?(g=Ba(b),a):g},a.startAngle=function(b){return arguments.length?(i=Ba(b),a):i},a.endAngle=function(b){return arguments.length?(j=Ba(b),a):j},a},ig.svg.diagonal=function(){function a(a,e){var f=b.call(this,a,e),g=c.call(this,a,e),h=(f.y+g.y)/2,i=[f,{x:f.x,y:h},{x:g.x,y:h},g];return i=i.map(d),"M"+i[0]+"C"+i[1]+" "+i[2]+" "+i[3]}var b=tc,c=uc,d=Sf;return a.source=function(c){return arguments.length?(b=Ba(c),a):b},a.target=function(b){return arguments.length?(c=Ba(b),a):c},a.projection=function(b){return arguments.length?(d=b,a):d},a},ig.svg.diagonal.radial=function(){var a=ig.svg.diagonal(),b=Sf,c=a.projection;return a.projection=function(a){return arguments.length?c(Tf(b=a)):b},a},ig.svg.symbol=function(){function a(a,d){return(Li.get(b.call(this,a,d))||Wf)(c.call(this,a,d))}var b=Vf,c=Uf;return a.type=function(c){return arguments.length?(b=Ba(c),a):b},a.size=function(b){return arguments.length?(c=Ba(b),a):c},a};var Li=ig.map({circle:Wf,cross:function(a){var b=Math.sqrt(a/5)/2;return"M"+-3*b+","+-b+"H"+-b+"V"+-3*b+"H"+b+"V"+-b+"H"+3*b+"V"+b+"H"+b+"V"+3*b+"H"+-b+"V"+b+"H"+-3*b+"Z"},diamond:function(a){var b=Math.sqrt(a/(2*Ni)),c=b*Ni;return"M0,"+-b+"L"+c+",0 0,"+b+" "+-c+",0Z"},square:function(a){var b=Math.sqrt(a)/2;return"M"+-b+","+-b+"L"+b+","+-b+" "+b+","+b+" "+-b+","+b+"Z"},"triangle-down":function(a){var b=Math.sqrt(a/Mi),c=b*Mi/2;return"M0,"+c+"L"+b+","+-c+" "+-b+","+-c+"Z"},"triangle-up":function(a){var b=Math.sqrt(a/Mi),c=b*Mi/2;return"M0,"+-c+"L"+b+","+c+" "+-b+","+c+"Z"}});ig.svg.symbolTypes=Li.keys();var Mi=Math.sqrt(3),Ni=Math.tan(30*Rg);Dg.transition=function(a){for(var b,c,d=Oi||++Si,e=_f(a),f=[],g=Pi||{time:Date.now(),ease:Ad,delay:0,duration:250},h=-1,i=this.length;++h<i;){f.push(b=[]);for(var j=this[h],k=-1,l=j.length;++k<l;)(c=j[k])&&ag(c,k,e,d,g),b.push(c)}return Yf(f,e,d)},Dg.interrupt=function(a){return this.each(null==a?Qi:Xf(_f(a)))};var Oi,Pi,Qi=Xf(_f()),Ri=[],Si=0;Ri.call=Dg.call,Ri.empty=Dg.empty,Ri.node=Dg.node,Ri.size=Dg.size,ig.transition=function(a,b){return a&&a.transition?Oi?a.transition(b):a:ig.selection().transition(a)},ig.transition.prototype=Ri,Ri.select=function(a){var b,c,d,e=this.id,f=this.namespace,g=[];a=D(a);for(var h=-1,i=this.length;++h<i;){g.push(b=[]);for(var j=this[h],k=-1,l=j.length;++k<l;)(d=j[k])&&(c=a.call(d,d.__data__,k,h))?("__data__"in d&&(c.__data__=d.__data__),ag(c,k,f,e,d[f][e]),b.push(c)):b.push(null)}return Yf(g,f,e)},Ri.selectAll=function(a){var b,c,d,e,f,g=this.id,h=this.namespace,i=[];a=E(a);for(var j=-1,k=this.length;++j<k;)for(var l=this[j],m=-1,n=l.length;++m<n;)if(d=l[m]){f=d[h][g],c=a.call(d,d.__data__,m,j),i.push(b=[]);for(var o=-1,p=c.length;++o<p;)(e=c[o])&&ag(e,o,h,g,f),b.push(e)}return Yf(i,h,g)},Ri.filter=function(a){var b,c,d,e=[];"function"!=typeof a&&(a=Q(a));for(var f=0,g=this.length;g>f;f++){e.push(b=[]);for(var c=this[f],h=0,i=c.length;i>h;h++)(d=c[h])&&a.call(d,d.__data__,h,f)&&b.push(d)}return Yf(e,this.namespace,this.id)},Ri.tween=function(a,b){var c=this.id,d=this.namespace;return arguments.length<2?this.node()[d][c].tween.get(a):S(this,null==b?function(b){b[d][c].tween.remove(a)}:function(e){e[d][c].tween.set(a,b)})},Ri.attr=function(a,b){function c(){this.removeAttribute(h)}function d(){this.removeAttributeNS(h.space,h.local)}function e(a){return null==a?c:(a+="",function(){var b,c=this.getAttribute(h);return c!==a&&(b=g(c,a),function(a){this.setAttribute(h,b(a))})})}function f(a){return null==a?d:(a+="",function(){var b,c=this.getAttributeNS(h.space,h.local);return c!==a&&(b=g(c,a),function(a){this.setAttributeNS(h.space,h.local,b(a))})})}if(arguments.length<2){for(b in a)this.attr(b,a[b]);return this}var g="transform"==a?Vd:td,h=ig.ns.qualify(a);return Zf(this,"attr."+a,b,h.local?f:e)},Ri.attrTween=function(a,b){function c(a,c){var d=b.call(this,a,c,this.getAttribute(e));return d&&function(a){this.setAttribute(e,d(a))}}function d(a,c){var d=b.call(this,a,c,this.getAttributeNS(e.space,e.local));return d&&function(a){this.setAttributeNS(e.space,e.local,d(a))}}var e=ig.ns.qualify(a);return this.tween("attr."+a,e.local?d:c)},Ri.style=function(a,b,d){function e(){this.style.removeProperty(a)}function f(b){return null==b?e:(b+="",function(){var e,f=c(this).getComputedStyle(this,null).getPropertyValue(a);return f!==b&&(e=td(f,b),function(b){this.style.setProperty(a,e(b),d)})})}var g=arguments.length;if(3>g){if("string"!=typeof a){2>g&&(b="");for(d in a)this.style(d,a[d],b);return this}d=""}return Zf(this,"style."+a,b,f)},Ri.styleTween=function(a,b,d){function e(e,f){var g=b.call(this,e,f,c(this).getComputedStyle(this,null).getPropertyValue(a));return g&&function(b){this.style.setProperty(a,g(b),d)}}return arguments.length<3&&(d=""),this.tween("style."+a,e)},Ri.text=function(a){return Zf(this,"text",a,$f)},Ri.remove=function(){var a=this.namespace;return this.each("end.transition",function(){var b;this[a].count<2&&(b=this.parentNode)&&b.removeChild(this)})},Ri.ease=function(a){var b=this.id,c=this.namespace;return arguments.length<1?this.node()[c][b].ease:("function"!=typeof a&&(a=ig.ease.apply(ig,arguments)),S(this,function(d){d[c][b].ease=a}))},Ri.delay=function(a){var b=this.id,c=this.namespace;return arguments.length<1?this.node()[c][b].delay:S(this,"function"==typeof a?function(d,e,f){d[c][b].delay=+a.call(d,d.__data__,e,f)}:(a=+a,function(d){d[c][b].delay=a}))},Ri.duration=function(a){var b=this.id,c=this.namespace;return arguments.length<1?this.node()[c][b].duration:S(this,"function"==typeof a?function(d,e,f){d[c][b].duration=Math.max(1,a.call(d,d.__data__,e,f))}:(a=Math.max(1,a),function(d){d[c][b].duration=a}))},Ri.each=function(a,b){var c=this.id,d=this.namespace;if(arguments.length<2){var e=Pi,f=Oi;try{Oi=c,S(this,function(b,e,f){Pi=b[d][c],a.call(b,b.__data__,e,f)})}finally{Pi=e,Oi=f}}else S(this,function(e){var f=e[d][c];(f.event||(f.event=ig.dispatch("start","end","interrupt"))).on(a,b)});return this},Ri.transition=function(){for(var a,b,c,d,e=this.id,f=++Si,g=this.namespace,h=[],i=0,j=this.length;j>i;i++){h.push(a=[]);for(var b=this[i],k=0,l=b.length;l>k;k++)(c=b[k])&&(d=c[g][e],ag(c,k,g,f,{time:d.time,ease:d.ease,delay:d.delay+d.duration,duration:d.duration})),a.push(c)}return Yf(h,g,f)},ig.svg.axis=function(){function a(a){a.each(function(){var a,j=ig.select(this),k=this.__chart__||c,l=this.__chart__=c.copy(),m=null==i?l.ticks?l.ticks.apply(l,h):l.domain():i,n=null==b?l.tickFormat?l.tickFormat.apply(l,h):t:b,o=j.selectAll(".tick").data(m,l),p=o.enter().insert("g",".domain").attr("class","tick").style("opacity",Lg),q=ig.transition(o.exit()).style("opacity",Lg).remove(),r=ig.transition(o.order()).style("opacity",1),s=Math.max(e,0)+g,u=Se(l),v=j.selectAll(".domain").data([0]),w=(v.enter().append("path").attr("class","domain"),
ig.transition(v));p.append("line"),p.append("text");var x,y,z,A,B=p.select("line"),C=r.select("line"),D=o.select("text").text(n),E=p.select("text"),F=r.select("text"),G="top"===d||"left"===d?-1:1;if("bottom"===d||"top"===d?(a=bg,x="x",z="y",y="x2",A="y2",D.attr("dy",0>G?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+u[0]+","+G*f+"V0H"+u[1]+"V"+G*f)):(a=cg,x="y",z="x",y="y2",A="x2",D.attr("dy",".32em").style("text-anchor",0>G?"end":"start"),w.attr("d","M"+G*f+","+u[0]+"H0V"+u[1]+"H"+G*f)),B.attr(A,G*e),E.attr(z,G*s),C.attr(y,0).attr(A,G*e),F.attr(x,0).attr(z,G*s),l.rangeBand){var H=l,I=H.rangeBand()/2;k=l=function(a){return H(a)+I}}else k.rangeBand?k=l:q.call(a,l,k);p.call(a,k,l),r.call(a,l,l)})}var b,c=ig.scale.linear(),d=Ti,e=6,f=6,g=3,h=[10],i=null;return a.scale=function(b){return arguments.length?(c=b,a):c},a.orient=function(b){return arguments.length?(d=b in Ui?b+"":Ti,a):d},a.ticks=function(){return arguments.length?(h=kg(arguments),a):h},a.tickValues=function(b){return arguments.length?(i=b,a):i},a.tickFormat=function(c){return arguments.length?(b=c,a):b},a.tickSize=function(b){var c=arguments.length;return c?(e=+b,f=+arguments[c-1],a):e},a.innerTickSize=function(b){return arguments.length?(e=+b,a):e},a.outerTickSize=function(b){return arguments.length?(f=+b,a):f},a.tickPadding=function(b){return arguments.length?(g=+b,a):g},a.tickSubdivide=function(){return arguments.length&&a},a};var Ti="bottom",Ui={top:1,right:1,bottom:1,left:1};ig.svg.brush=function(){function a(c){c.each(function(){var c=ig.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",f).on("touchstart.brush",f),g=c.selectAll(".background").data([0]);g.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),c.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var h=c.selectAll(".resize").data(p,t);h.exit().remove(),h.enter().append("g").attr("class",function(a){return"resize "+a}).style("cursor",function(a){return Vi[a]}).append("rect").attr("x",function(a){return/[ew]$/.test(a)?-3:null}).attr("y",function(a){return/^[ns]/.test(a)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),h.style("display",a.empty()?"none":null);var i,l=ig.transition(c),m=ig.transition(g);j&&(i=Se(j),m.attr("x",i[0]).attr("width",i[1]-i[0]),d(l)),k&&(i=Se(k),m.attr("y",i[0]).attr("height",i[1]-i[0]),e(l)),b(l)})}function b(a){a.selectAll(".resize").attr("transform",function(a){return"translate("+l[+/e$/.test(a)]+","+m[+/^s/.test(a)]+")"})}function d(a){a.select(".extent").attr("x",l[0]),a.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function e(a){a.select(".extent").attr("y",m[0]),a.selectAll(".extent,.e>rect,.w>rect").attr("height",m[1]-m[0])}function f(){function f(){32==ig.event.keyCode&&(D||(t=null,F[0]-=l[1],F[1]-=m[1],D=2),z())}function p(){32==ig.event.keyCode&&2==D&&(F[0]+=l[1],F[1]+=m[1],D=0,z())}function q(){var a=ig.mouse(v),c=!1;u&&(a[0]+=u[0],a[1]+=u[1]),D||(ig.event.altKey?(t||(t=[(l[0]+l[1])/2,(m[0]+m[1])/2]),F[0]=l[+(a[0]<t[0])],F[1]=m[+(a[1]<t[1])]):t=null),B&&r(a,j,0)&&(d(y),c=!0),C&&r(a,k,1)&&(e(y),c=!0),c&&(b(y),x({type:"brush",mode:D?"move":"resize"}))}function r(a,b,c){var d,e,f=Se(b),i=f[0],j=f[1],k=F[c],p=c?m:l,q=p[1]-p[0];return D&&(i-=k,j-=q+k),d=(c?o:n)?Math.max(i,Math.min(j,a[c])):a[c],D?e=(d+=k)+q:(t&&(k=Math.max(i,Math.min(j,2*t[c]-d))),d>k?(e=d,d=k):e=k),p[0]!=d||p[1]!=e?(c?h=null:g=null,p[0]=d,p[1]=e,!0):void 0}function s(){q(),y.style("pointer-events","all").selectAll(".resize").style("display",a.empty()?"none":null),ig.select("body").style("cursor",null),G.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),E(),x({type:"brushend"})}var t,u,v=this,w=ig.select(ig.event.target),x=i.of(v,arguments),y=ig.select(v),A=w.datum(),B=!/^(n|s)$/.test(A)&&j,C=!/^(e|w)$/.test(A)&&k,D=w.classed("extent"),E=Y(v),F=ig.mouse(v),G=ig.select(c(v)).on("keydown.brush",f).on("keyup.brush",p);if(ig.event.changedTouches?G.on("touchmove.brush",q).on("touchend.brush",s):G.on("mousemove.brush",q).on("mouseup.brush",s),y.interrupt().selectAll("*").interrupt(),D)F[0]=l[0]-F[0],F[1]=m[0]-F[1];else if(A){var H=+/w$/.test(A),I=+/^n/.test(A);u=[l[1-H]-F[0],m[1-I]-F[1]],F[0]=l[H],F[1]=m[I]}else ig.event.altKey&&(t=F.slice());y.style("pointer-events","none").selectAll(".resize").style("display",null),ig.select("body").style("cursor",w.style("cursor")),x({type:"brushstart"}),q()}var g,h,i=B(a,"brushstart","brush","brushend"),j=null,k=null,l=[0,0],m=[0,0],n=!0,o=!0,p=Wi[0];return a.event=function(a){a.each(function(){var a=i.of(this,arguments),b={x:l,y:m,i:g,j:h},c=this.__chart__||b;this.__chart__=b,Oi?ig.select(this).transition().each("start.brush",function(){g=c.i,h=c.j,l=c.x,m=c.y,a({type:"brushstart"})}).tween("brush:brush",function(){var c=ud(l,b.x),d=ud(m,b.y);return g=h=null,function(e){l=b.x=c(e),m=b.y=d(e),a({type:"brush",mode:"resize"})}}).each("end.brush",function(){g=b.i,h=b.j,a({type:"brush",mode:"resize"}),a({type:"brushend"})}):(a({type:"brushstart"}),a({type:"brush",mode:"resize"}),a({type:"brushend"}))})},a.x=function(b){return arguments.length?(j=b,p=Wi[!j<<1|!k],a):j},a.y=function(b){return arguments.length?(k=b,p=Wi[!j<<1|!k],a):k},a.clamp=function(b){return arguments.length?(j&&k?(n=!!b[0],o=!!b[1]):j?n=!!b:k&&(o=!!b),a):j&&k?[n,o]:j?n:k?o:null},a.extent=function(b){var c,d,e,f,i;return arguments.length?(j&&(c=b[0],d=b[1],k&&(c=c[0],d=d[0]),g=[c,d],j.invert&&(c=j(c),d=j(d)),c>d&&(i=c,c=d,d=i),(c!=l[0]||d!=l[1])&&(l=[c,d])),k&&(e=b[0],f=b[1],j&&(e=e[1],f=f[1]),h=[e,f],k.invert&&(e=k(e),f=k(f)),e>f&&(i=e,e=f,f=i),(e!=m[0]||f!=m[1])&&(m=[e,f])),a):(j&&(g?(c=g[0],d=g[1]):(c=l[0],d=l[1],j.invert&&(c=j.invert(c),d=j.invert(d)),c>d&&(i=c,c=d,d=i))),k&&(h?(e=h[0],f=h[1]):(e=m[0],f=m[1],k.invert&&(e=k.invert(e),f=k.invert(f)),e>f&&(i=e,e=f,f=i))),j&&k?[[c,e],[d,f]]:j?[c,d]:k&&[e,f])},a.clear=function(){return a.empty()||(l=[0,0],m=[0,0],g=h=null),a},a.empty=function(){return!!j&&l[0]==l[1]||!!k&&m[0]==m[1]},ig.rebind(a,i,"on")};var Vi={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Wi=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Xi=oh.format=uh.timeFormat,Yi=Xi.utc,Zi=Yi("%Y-%m-%dT%H:%M:%S.%LZ");Xi.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?dg:Zi,dg.parse=function(a){var b=new Date(a);return isNaN(b)?null:b},dg.toString=Zi.toString,oh.second=Pa(function(a){return new ph(1e3*Math.floor(a/1e3))},function(a,b){a.setTime(a.getTime()+1e3*Math.floor(b))},function(a){return a.getSeconds()}),oh.seconds=oh.second.range,oh.seconds.utc=oh.second.utc.range,oh.minute=Pa(function(a){return new ph(6e4*Math.floor(a/6e4))},function(a,b){a.setTime(a.getTime()+6e4*Math.floor(b))},function(a){return a.getMinutes()}),oh.minutes=oh.minute.range,oh.minutes.utc=oh.minute.utc.range,oh.hour=Pa(function(a){var b=a.getTimezoneOffset()/60;return new ph(36e5*(Math.floor(a/36e5-b)+b))},function(a,b){a.setTime(a.getTime()+36e5*Math.floor(b))},function(a){return a.getHours()}),oh.hours=oh.hour.range,oh.hours.utc=oh.hour.utc.range,oh.month=Pa(function(a){return a=oh.day(a),a.setDate(1),a},function(a,b){a.setMonth(a.getMonth()+b)},function(a){return a.getMonth()}),oh.months=oh.month.range,oh.months.utc=oh.month.utc.range;var $i=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],_i=[[oh.second,1],[oh.second,5],[oh.second,15],[oh.second,30],[oh.minute,1],[oh.minute,5],[oh.minute,15],[oh.minute,30],[oh.hour,1],[oh.hour,3],[oh.hour,6],[oh.hour,12],[oh.day,1],[oh.day,2],[oh.week,1],[oh.month,1],[oh.month,3],[oh.year,1]],aj=Xi.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",Eb]]),bj={range:function(a,b,c){return ig.range(Math.ceil(a/c)*c,+b,c).map(fg)},floor:t,ceil:t};_i.year=oh.year,oh.scale=function(){return eg(ig.scale.linear(),_i,aj)};var cj=_i.map(function(a){return[a[0].utc,a[1]]}),dj=Yi.multi([[".%L",function(a){return a.getUTCMilliseconds()}],[":%S",function(a){return a.getUTCSeconds()}],["%I:%M",function(a){return a.getUTCMinutes()}],["%I %p",function(a){return a.getUTCHours()}],["%a %d",function(a){return a.getUTCDay()&&1!=a.getUTCDate()}],["%b %d",function(a){return 1!=a.getUTCDate()}],["%B",function(a){return a.getUTCMonth()}],["%Y",Eb]]);cj.year=oh.year.utc,oh.scale.utc=function(){return eg(ig.scale.linear(),cj,dj)},ig.text=Ca(function(a){return a.responseText}),ig.json=function(a,b){return Da(a,"application/json",gg,b)},ig.html=function(a,b){return Da(a,"text/html",hg,b)},ig.xml=Ca(function(a){return a.responseXML}),"function"==typeof define&&define.amd?(this.d3=ig,define(ig)):"object"==typeof b&&b.exports?b.exports=ig:this.d3=ig}()},{}],14:[function(a,b,c){!function(a){function c(a,b){if(a=a?a:"",b=b||{},a instanceof c)return a;if(!(this instanceof c))return new c(a,b);var e=d(a);this._originalInput=a,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=Q(100*this._a)/100,this._format=b.format||e.format,this._gradientType=b.gradientType,this._r<1&&(this._r=Q(this._r)),this._g<1&&(this._g=Q(this._g)),this._b<1&&(this._b=Q(this._b)),this._ok=e.ok,this._tc_id=P++}function d(a){var b={r:0,g:0,b:0},c=1,d=null,f=null,h=null,j=!1,k=!1;return"string"==typeof a&&(a=L(a)),"object"==typeof a&&(K(a.r)&&K(a.g)&&K(a.b)?(b=e(a.r,a.g,a.b),j=!0,k="%"===String(a.r).substr(-1)?"prgb":"rgb"):K(a.h)&&K(a.s)&&K(a.v)?(d=H(a.s),f=H(a.v),b=i(a.h,d,f),j=!0,k="hsv"):K(a.h)&&K(a.s)&&K(a.l)&&(d=H(a.s),h=H(a.l),b=g(a.h,d,h),j=!0,k="hsl"),a.hasOwnProperty("a")&&(c=a.a)),c=A(c),{ok:j,format:a.format||k,r:R(255,S(b.r,0)),g:R(255,S(b.g,0)),b:R(255,S(b.b,0)),a:c}}function e(a,b,c){return{r:255*B(a,255),g:255*B(b,255),b:255*B(c,255)}}function f(a,b,c){a=B(a,255),b=B(b,255),c=B(c,255);var d,e,f=S(a,b,c),g=R(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}}function g(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(a=B(a,360),b=B(b,100),c=B(c,100),0===b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:255*e,g:255*f,b:255*g}}function h(a,b,c){a=B(a,255),b=B(b,255),c=B(c,255);var d,e,f=S(a,b,c),g=R(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function i(b,c,d){b=6*B(b,360),c=B(c,100),d=B(d,100);var e=a.floor(b),f=b-e,g=d*(1-c),h=d*(1-f*c),i=d*(1-(1-f)*c),j=e%6,k=[d,h,g,g,i,d][j],l=[i,d,d,h,g,g][j],m=[g,g,i,d,d,h][j];return{r:255*k,g:255*l,b:255*m}}function j(a,b,c,d){var e=[G(Q(a).toString(16)),G(Q(b).toString(16)),G(Q(c).toString(16))];return d&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function k(a,b,c,d,e){var f=[G(Q(a).toString(16)),G(Q(b).toString(16)),G(Q(c).toString(16)),G(I(d))];return e&&f[0].charAt(0)==f[0].charAt(1)&&f[1].charAt(0)==f[1].charAt(1)&&f[2].charAt(0)==f[2].charAt(1)&&f[3].charAt(0)==f[3].charAt(1)?f[0].charAt(0)+f[1].charAt(0)+f[2].charAt(0)+f[3].charAt(0):f.join("")}function l(a,b,c,d){var e=[G(I(d)),G(Q(a).toString(16)),G(Q(b).toString(16)),G(Q(c).toString(16))];return e.join("")}function m(a,b){b=0===b?0:b||10;var d=c(a).toHsl();return d.s-=b/100,d.s=C(d.s),c(d)}function n(a,b){b=0===b?0:b||10;var d=c(a).toHsl();return d.s+=b/100,d.s=C(d.s),c(d)}function o(a){return c(a).desaturate(100)}function p(a,b){b=0===b?0:b||10;var d=c(a).toHsl();return d.l+=b/100,d.l=C(d.l),c(d)}function q(a,b){b=0===b?0:b||10;var d=c(a).toRgb();return d.r=S(0,R(255,d.r-Q(255*-(b/100)))),d.g=S(0,R(255,d.g-Q(255*-(b/100)))),d.b=S(0,R(255,d.b-Q(255*-(b/100)))),c(d)}function r(a,b){b=0===b?0:b||10;var d=c(a).toHsl();return d.l-=b/100,d.l=C(d.l),c(d)}function s(a,b){var d=c(a).toHsl(),e=(d.h+b)%360;return d.h=0>e?360+e:e,c(d)}function t(a){var b=c(a).toHsl();return b.h=(b.h+180)%360,c(b)}function u(a){var b=c(a).toHsl(),d=b.h;return[c(a),c({h:(d+120)%360,s:b.s,l:b.l}),c({h:(d+240)%360,s:b.s,l:b.l})]}function v(a){var b=c(a).toHsl(),d=b.h;return[c(a),c({h:(d+90)%360,s:b.s,l:b.l}),c({h:(d+180)%360,s:b.s,l:b.l}),c({h:(d+270)%360,s:b.s,l:b.l})]}function w(a){var b=c(a).toHsl(),d=b.h;return[c(a),c({h:(d+72)%360,s:b.s,l:b.l}),c({h:(d+216)%360,s:b.s,l:b.l})]}function x(a,b,d){b=b||6,d=d||30;var e=c(a).toHsl(),f=360/d,g=[c(a)];for(e.h=(e.h-(f*b>>1)+720)%360;--b;)e.h=(e.h+f)%360,g.push(c(e));return g}function y(a,b){b=b||6;for(var d=c(a).toHsv(),e=d.h,f=d.s,g=d.v,h=[],i=1/b;b--;)h.push(c({h:e,s:f,v:g})),g=(g+i)%1;return h}function z(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}function A(a){return a=parseFloat(a),(isNaN(a)||0>a||a>1)&&(a=1),a}function B(b,c){E(b)&&(b="100%");var d=F(b);return b=R(c,S(0,parseFloat(b))),d&&(b=parseInt(b*c,10)/100),a.abs(b-c)<1e-6?1:b%c/parseFloat(c)}function C(a){return R(1,S(0,a))}function D(a){return parseInt(a,16)}function E(a){return"string"==typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)}function F(a){return"string"==typeof a&&-1!=a.indexOf("%")}function G(a){return 1==a.length?"0"+a:""+a}function H(a){return 1>=a&&(a=100*a+"%"),a}function I(b){return a.round(255*parseFloat(b)).toString(16)}function J(a){return D(a)/255}function K(a){return!!W.CSS_UNIT.exec(a)}function L(a){a=a.replace(N,"").replace(O,"").toLowerCase();var b=!1;if(U[a])a=U[a],b=!0;else if("transparent"==a)return{r:0,g:0,b:0,a:0,format:"name"};var c;return(c=W.rgb.exec(a))?{r:c[1],g:c[2],b:c[3]}:(c=W.rgba.exec(a))?{r:c[1],g:c[2],b:c[3],a:c[4]}:(c=W.hsl.exec(a))?{h:c[1],s:c[2],l:c[3]}:(c=W.hsla.exec(a))?{h:c[1],s:c[2],l:c[3],a:c[4]}:(c=W.hsv.exec(a))?{h:c[1],s:c[2],v:c[3]}:(c=W.hsva.exec(a))?{h:c[1],s:c[2],v:c[3],a:c[4]}:(c=W.hex8.exec(a))?{r:D(c[1]),g:D(c[2]),b:D(c[3]),a:J(c[4]),format:b?"name":"hex8"}:(c=W.hex6.exec(a))?{r:D(c[1]),g:D(c[2]),b:D(c[3]),format:b?"name":"hex"}:(c=W.hex4.exec(a))?{r:D(c[1]+""+c[1]),g:D(c[2]+""+c[2]),b:D(c[3]+""+c[3]),a:J(c[4]+""+c[4]),format:b?"name":"hex8"}:(c=W.hex3.exec(a))?{r:D(c[1]+""+c[1]),g:D(c[2]+""+c[2]),b:D(c[3]+""+c[3]),format:b?"name":"hex"}:!1}function M(a){var b,c;return a=a||{level:"AA",size:"small"},b=(a.level||"AA").toUpperCase(),c=(a.size||"small").toLowerCase(),"AA"!==b&&"AAA"!==b&&(b="AA"),"small"!==c&&"large"!==c&&(c="small"),{level:b,size:c}}var N=/^\s+/,O=/\s+$/,P=0,Q=a.round,R=a.min,S=a.max,T=a.random;c.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var a=this.toRgb();return(299*a.r+587*a.g+114*a.b)/1e3},getLuminance:function(){var b,c,d,e,f,g,h=this.toRgb();return b=h.r/255,c=h.g/255,d=h.b/255,e=.03928>=b?b/12.92:a.pow((b+.055)/1.055,2.4),f=.03928>=c?c/12.92:a.pow((c+.055)/1.055,2.4),g=.03928>=d?d/12.92:a.pow((d+.055)/1.055,2.4),.2126*e+.7152*f+.0722*g},setAlpha:function(a){return this._a=A(a),this._roundA=Q(100*this._a)/100,this},toHsv:function(){var a=h(this._r,this._g,this._b);return{h:360*a.h,s:a.s,v:a.v,a:this._a}},toHsvString:function(){var a=h(this._r,this._g,this._b),b=Q(360*a.h),c=Q(100*a.s),d=Q(100*a.v);return 1==this._a?"hsv("+b+", "+c+"%, "+d+"%)":"hsva("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHsl:function(){var a=f(this._r,this._g,this._b);return{h:360*a.h,s:a.s,l:a.l,a:this._a}},toHslString:function(){var a=f(this._r,this._g,this._b),b=Q(360*a.h),c=Q(100*a.s),d=Q(100*a.l);return 1==this._a?"hsl("+b+", "+c+"%, "+d+"%)":"hsla("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHex:function(a){return j(this._r,this._g,this._b,a)},toHexString:function(a){return"#"+this.toHex(a)},toHex8:function(a){return k(this._r,this._g,this._b,this._a,a)},toHex8String:function(a){return"#"+this.toHex8(a)},toRgb:function(){return{r:Q(this._r),g:Q(this._g),b:Q(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Q(this._r)+", "+Q(this._g)+", "+Q(this._b)+")":"rgba("+Q(this._r)+", "+Q(this._g)+", "+Q(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Q(100*B(this._r,255))+"%",g:Q(100*B(this._g,255))+"%",b:Q(100*B(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Q(100*B(this._r,255))+"%, "+Q(100*B(this._g,255))+"%, "+Q(100*B(this._b,255))+"%)":"rgba("+Q(100*B(this._r,255))+"%, "+Q(100*B(this._g,255))+"%, "+Q(100*B(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:V[j(this._r,this._g,this._b,!0)]||!1},toFilter:function(a){var b="#"+l(this._r,this._g,this._b,this._a),d=b,e=this._gradientType?"GradientType = 1, ":"";if(a){var f=c(a);d="#"+l(f._r,f._g,f._b,f._a)}return"progid:DXImageTransform.Microsoft.gradient("+e+"startColorstr="+b+",endColorstr="+d+")"},toString:function(a){var b=!!a;a=a||this._format;var c=!1,d=this._a<1&&this._a>=0,e=!b&&d&&("hex"===a||"hex6"===a||"hex3"===a||"hex4"===a||"hex8"===a||"name"===a);return e?"name"===a&&0===this._a?this.toName():this.toRgbString():("rgb"===a&&(c=this.toRgbString()),"prgb"===a&&(c=this.toPercentageRgbString()),("hex"===a||"hex6"===a)&&(c=this.toHexString()),"hex3"===a&&(c=this.toHexString(!0)),"hex4"===a&&(c=this.toHex8String(!0)),"hex8"===a&&(c=this.toHex8String()),"name"===a&&(c=this.toName()),"hsl"===a&&(c=this.toHslString()),"hsv"===a&&(c=this.toHsvString()),c||this.toHexString())},clone:function(){return c(this.toString())},_applyModification:function(a,b){var c=a.apply(null,[this].concat([].slice.call(b)));return this._r=c._r,this._g=c._g,this._b=c._b,this.setAlpha(c._a),this},lighten:function(){return this._applyModification(p,arguments)},brighten:function(){return this._applyModification(q,arguments)},darken:function(){return this._applyModification(r,arguments)},desaturate:function(){return this._applyModification(m,arguments)},saturate:function(){return this._applyModification(n,arguments)},greyscale:function(){return this._applyModification(o,arguments)},spin:function(){return this._applyModification(s,arguments)},_applyCombination:function(a,b){return a.apply(null,[this].concat([].slice.call(b)))},analogous:function(){return this._applyCombination(x,arguments)},complement:function(){return this._applyCombination(t,arguments)},monochromatic:function(){return this._applyCombination(y,arguments)},splitcomplement:function(){return this._applyCombination(w,arguments)},triad:function(){return this._applyCombination(u,arguments)},tetrad:function(){return this._applyCombination(v,arguments)}},c.fromRatio=function(a,b){if("object"==typeof a){var d={};for(var e in a)a.hasOwnProperty(e)&&("a"===e?d[e]=a[e]:d[e]=H(a[e]));a=d}return c(a,b)},c.equals=function(a,b){return a&&b?c(a).toRgbString()==c(b).toRgbString():!1},c.random=function(){return c.fromRatio({r:T(),g:T(),b:T()})},c.mix=function(a,b,d){d=0===d?0:d||50;var e=c(a).toRgb(),f=c(b).toRgb(),g=d/100,h={r:(f.r-e.r)*g+e.r,g:(f.g-e.g)*g+e.g,b:(f.b-e.b)*g+e.b,a:(f.a-e.a)*g+e.a};return c(h)},c.readability=function(b,d){var e=c(b),f=c(d);return(a.max(e.getLuminance(),f.getLuminance())+.05)/(a.min(e.getLuminance(),f.getLuminance())+.05)},c.isReadable=function(a,b,d){var e,f,g=c.readability(a,b);switch(f=!1,e=M(d),e.level+e.size){case"AAsmall":case"AAAlarge":f=g>=4.5;break;case"AAlarge":f=g>=3;break;case"AAAsmall":f=g>=7}return f},c.mostReadable=function(a,b,d){var e,f,g,h,i=null,j=0;d=d||{},f=d.includeFallbackColors,g=d.level,h=d.size;for(var k=0;k<b.length;k++)e=c.readability(a,b[k]),e>j&&(j=e,i=c(b[k]));return c.isReadable(a,i,{level:g,size:h})||!f?i:(d.includeFallbackColors=!1,c.mostReadable(a,["#fff","#000"],d))};var U=c.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},V=c.hexNames=z(U),W=function(){var a="[-\\+]?\\d+%?",b="[-\\+]?\\d*\\.\\d+%?",c="(?:"+b+")|(?:"+a+")",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?",e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?";return{CSS_UNIT:new RegExp(c),rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hsva:new RegExp("hsva"+e),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof b&&b.exports?b.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):window.tinycolor=c}(Math)},{}],15:[function(a,b,c){!function(a,d){"use strict";"object"==typeof c?b.exports=d():"function"==typeof define&&define.amd?define(d):a.IPv6=d(a)}(this,function(a){"use strict";function b(a){var b=a.toLowerCase(),c=b.split(":"),d=c.length,e=8;""===c[0]&&""===c[1]&&""===c[2]?(c.shift(),c.shift()):""===c[0]&&""===c[1]?c.shift():""===c[d-1]&&""===c[d-2]&&c.pop(),d=c.length,-1!==c[d-1].indexOf(".")&&(e=7);var f;for(f=0;d>f&&""!==c[f];f++);if(e>f){for(c.splice(f,1,"0000");c.length<e;)c.splice(f,0,"0000");d=c.length}for(var g,h=0;e>h;h++){g=c[h].split("");for(var i=0;3>i&&("0"===g[0]&&g.length>1);i++)g.splice(0,1);c[h]=g.join("")}var j=-1,k=0,l=0,m=-1,n=!1;for(h=0;e>h;h++)n?"0"===c[h]?l+=1:(n=!1,l>k&&(j=m,k=l)):"0"===c[h]&&(n=!0,m=h,l=1);l>k&&(j=m,k=l),k>1&&c.splice(j,k,""),d=c.length;var o="";for(""===c[0]&&(o=":"),h=0;d>h&&(o+=c[h],h!==d-1);h++)o+=":";return""===c[d-1]&&(o+=":"),o}function c(){return a.IPv6===this&&(a.IPv6=d),this}var d=a&&a.IPv6;return{best:b,noConflict:c}})},{}],16:[function(a,b,c){!function(a,d){"use strict";"object"==typeof c?b.exports=d():"function"==typeof define&&define.amd?define(d):a.SecondLevelDomains=d(a)}(this,function(a){"use strict";var b=a&&a.SecondLevelDomains,c={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ","do":" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ","in":" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",
vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(a){var b=a.lastIndexOf(".");if(0>=b||b>=a.length-1)return!1;var d=a.lastIndexOf(".",b-1);if(0>=d||d>=b-1)return!1;var e=c.list[a.slice(b+1)];return e?e.indexOf(" "+a.slice(d+1,b)+" ")>=0:!1},is:function(a){var b=a.lastIndexOf(".");if(0>=b||b>=a.length-1)return!1;var d=a.lastIndexOf(".",b-1);if(d>=0)return!1;var e=c.list[a.slice(b+1)];return e?e.indexOf(" "+a.slice(0,b)+" ")>=0:!1},get:function(a){var b=a.lastIndexOf(".");if(0>=b||b>=a.length-1)return null;var d=a.lastIndexOf(".",b-1);if(0>=d||d>=b-1)return null;var e=c.list[a.slice(b+1)];return e?e.indexOf(" "+a.slice(d+1,b)+" ")<0?null:a.slice(d+1):null},noConflict:function(){return a.SecondLevelDomains===this&&(a.SecondLevelDomains=b),this}};return c})},{}],17:[function(a,b,c){!function(d,e){"use strict";"object"==typeof c?b.exports=e(a("./punycode"),a("./IPv6"),a("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],e):d.URI=e(d.punycode,d.IPv6,d.SecondLevelDomains,d)}(this,function(a,b,c,d){"use strict";function e(a,b){var c=arguments.length>=1,d=arguments.length>=2;if(!(this instanceof e))return c?d?new e(a,b):new e(a):new e;if(void 0===a){if(c)throw new TypeError("undefined is not a valid argument for URI");a="undefined"!=typeof location?location.href+"":""}return this.href(a),void 0!==b?this.absoluteTo(b):this}function f(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function g(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function h(a){return"Array"===g(a)}function i(a,b){var c,d,e={};if("RegExp"===g(b))e=null;else if(h(b))for(c=0,d=b.length;d>c;c++)e[b[c]]=!0;else e[b]=!0;for(c=0,d=a.length;d>c;c++){var f=e&&void 0!==e[a[c]]||!e&&b.test(a[c]);f&&(a.splice(c,1),d--,c--)}return a}function j(a,b){var c,d;if(h(b)){for(c=0,d=b.length;d>c;c++)if(!j(a,b[c]))return!1;return!0}var e=g(b);for(c=0,d=a.length;d>c;c++)if("RegExp"===e){if("string"==typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function k(a,b){if(!h(a)||!h(b))return!1;if(a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,d=a.length;d>c;c++)if(a[c]!==b[c])return!1;return!0}function l(a){var b=/^\/+|\/+$/g;return a.replace(b,"")}function m(a){return escape(a)}function n(a){return encodeURIComponent(a).replace(/[!'()*]/g,m).replace(/\*/g,"%2A")}function o(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function p(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}}var q=d&&d.URI;e.version="1.17.1";var r=e.prototype,s=Object.prototype.hasOwnProperty;e._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:e.duplicateQueryParameters,escapeQuerySpace:e.escapeQuerySpace}},e.duplicateQueryParameters=!1,e.escapeQuerySpace=!0,e.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,e.idn_expression=/[^a-z0-9\.-]/i,e.punycode_expression=/(xn--)/i,e.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,e.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,e.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,e.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},e.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},e.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,e.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},e.getDomAttribute=function(a){if(!a||!a.nodeName)return void 0;var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:e.domAttributes[b]},e.encode=n,e.decode=decodeURIComponent,e.iso8859=function(){e.encode=escape,e.decode=unescape},e.unicode=function(){e.encode=n,e.decode=decodeURIComponent},e.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},e.encodeQuery=function(a,b){var c=e.encode(a+"");return void 0===b&&(b=e.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},e.decodeQuery=function(a,b){a+="",void 0===b&&(b=e.escapeQuerySpace);try{return e.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}};var t,u={encode:"encode",decode:"decode"},v=function(a,b){return function(c){try{return e[b](c+"").replace(e.characters[a][b].expression,function(c){return e.characters[a][b].map[c]})}catch(d){return c}}};for(t in u)e[t+"PathSegment"]=v("pathname",u[t]),e[t+"UrnPathSegment"]=v("urnpath",u[t]);var w=function(a,b,c){return function(d){var f;f=c?function(a){return e[b](e[c](a))}:e[b];for(var g=(d+"").split(a),h=0,i=g.length;i>h;h++)g[h]=f(g[h]);return g.join(a)}};e.decodePath=w("/","decodePathSegment"),e.decodeUrnPath=w(":","decodeUrnPathSegment"),e.recodePath=w("/","encodePathSegment","decode"),e.recodeUrnPath=w(":","encodeUrnPathSegment","decode"),e.encodeReserved=v("reserved","encode"),e.parse=function(a,b){var c;return b||(b={}),c=a.indexOf("#"),c>-1&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),c=a.indexOf("?"),c>-1&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=e.parseAuthority(a,b)):(c=a.indexOf(":"),c>-1&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(e.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=e.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0))),b.path=a,b},e.parseHost=function(a,b){a=a.replace(/\\/g,"/");var c,d,e=a.indexOf("/");if(-1===e&&(e=a.length),"["===a.charAt(0))c=a.indexOf("]"),b.hostname=a.substring(1,c)||null,b.port=a.substring(c+2,e)||null,"/"===b.port&&(b.port=null);else{var f=a.indexOf(":"),g=a.indexOf("/"),h=a.indexOf(":",f+1);-1!==h&&(-1===g||g>h)?(b.hostname=a.substring(0,e)||null,b.port=null):(d=a.substring(0,e).split(":"),b.hostname=d[0]||null,b.port=d[1]||null)}return b.hostname&&"/"!==a.substring(e).charAt(0)&&(e++,a="/"+a),a.substring(e)||"/"},e.parseAuthority=function(a,b){return a=e.parseUserinfo(a,b),e.parseHost(a,b)},e.parseUserinfo=function(a,b){var c,d=a.indexOf("/"),f=a.lastIndexOf("@",d>-1?d:a.length-1);return f>-1&&(-1===d||d>f)?(c=a.substring(0,f).split(":"),b.username=c[0]?e.decode(c[0]):null,c.shift(),b.password=c[0]?e.decode(c.join(":")):null,a=a.substring(f+1)):(b.username=null,b.password=null),a},e.parseQuery=function(a,b){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var c,d,f,g={},h=a.split("&"),i=h.length,j=0;i>j;j++)c=h[j].split("="),d=e.decodeQuery(c.shift(),b),f=c.length?e.decodeQuery(c.join("="),b):null,s.call(g,d)?(("string"==typeof g[d]||null===g[d])&&(g[d]=[g[d]]),g[d].push(f)):g[d]=f;return g},e.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//"),b+=e.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},e.buildHost=function(a){var b="";return a.hostname?(b+=e.ip6_expression.test(a.hostname)?"["+a.hostname+"]":a.hostname,a.port&&(b+=":"+a.port),b):""},e.buildAuthority=function(a){return e.buildUserinfo(a)+e.buildHost(a)},e.buildUserinfo=function(a){var b="";return a.username&&(b+=e.encode(a.username),a.password&&(b+=":"+e.encode(a.password)),b+="@"),b},e.buildQuery=function(a,b,c){var d,f,g,i,j="";for(f in a)if(s.call(a,f)&&f)if(h(a[f]))for(d={},g=0,i=a[f].length;i>g;g++)void 0!==a[f][g]&&void 0===d[a[f][g]+""]&&(j+="&"+e.buildQueryParameter(f,a[f][g],c),b!==!0&&(d[a[f][g]+""]=!0));else void 0!==a[f]&&(j+="&"+e.buildQueryParameter(f,a[f],c));return j.substring(1)},e.buildQueryParameter=function(a,b,c){return e.encodeQuery(a,c)+(null!==b?"="+e.encodeQuery(b,c):"")},e.addQuery=function(a,b,c){if("object"==typeof b)for(var d in b)s.call(b,d)&&e.addQuery(a,d,b[d]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===a[b])return void(a[b]=c);"string"==typeof a[b]&&(a[b]=[a[b]]),h(c)||(c=[c]),a[b]=(a[b]||[]).concat(c)}},e.removeQuery=function(a,b,c){var d,f,j;if(h(b))for(d=0,f=b.length;f>d;d++)a[b[d]]=void 0;else if("RegExp"===g(b))for(j in a)b.test(j)&&(a[j]=void 0);else if("object"==typeof b)for(j in b)s.call(b,j)&&e.removeQuery(a,j,b[j]);else{if("string"!=typeof b)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==c?"RegExp"===g(c)?!h(a[b])&&c.test(a[b])?a[b]=void 0:a[b]=i(a[b],c):a[b]!==String(c)||h(c)&&1!==c.length?h(a[b])&&(a[b]=i(a[b],c)):a[b]=void 0:a[b]=void 0}},e.hasQuery=function(a,b,c,d){switch(g(b)){case"String":break;case"RegExp":for(var f in a)if(s.call(a,f)&&b.test(f)&&(void 0===c||e.hasQuery(a,f,c)))return!0;return!1;case"Object":for(var i in b)if(s.call(b,i)&&!e.hasQuery(a,i,b[i]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(g(c)){case"Undefined":return b in a;case"Boolean":var l=Boolean(h(a[b])?a[b].length:a[b]);return c===l;case"Function":return!!c(a[b],b,a);case"Array":if(!h(a[b]))return!1;var m=d?j:k;return m(a[b],c);case"RegExp":return h(a[b])?d?j(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case"Number":c=String(c);case"String":return h(a[b])?d?j(a[b],c):!1:a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},e.commonPath=function(a,b){var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a.charAt(c)!==b.charAt(c)){c--;break}return 1>c?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":(("/"!==a.charAt(c)||"/"!==b.charAt(c))&&(c=a.substring(0,c).lastIndexOf("/")),a.substring(0,c+1))},e.withinString=function(a,b,c){c||(c={});var d=c.start||e.findUri.start,f=c.end||e.findUri.end,g=c.trim||e.findUri.trim,h=/[a-z0-9-]=["']?$/i;for(d.lastIndex=0;;){var i=d.exec(a);if(!i)break;var j=i.index;if(c.ignoreHtml){var k=a.slice(Math.max(j-3,0),j);if(k&&h.test(k))continue}var l=j+a.slice(j).search(f),m=a.slice(j,l).replace(g,"");if(!c.ignore||!c.ignore.test(m)){l=j+m.length;var n=b(m,j,l,a);a=a.slice(0,j)+n+a.slice(l),d.lastIndex=j+n.length}}return d.lastIndex=0,a},e.ensureValidHostname=function(b){if(b.match(e.invalid_hostname_characters)){if(!a)throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(a.toASCII(b).match(e.invalid_hostname_characters))throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-]')}},e.noConflict=function(a){if(a){var b={URI:this.noConflict()};return d.URITemplate&&"function"==typeof d.URITemplate.noConflict&&(b.URITemplate=d.URITemplate.noConflict()),d.IPv6&&"function"==typeof d.IPv6.noConflict&&(b.IPv6=d.IPv6.noConflict()),d.SecondLevelDomains&&"function"==typeof d.SecondLevelDomains.noConflict&&(b.SecondLevelDomains=d.SecondLevelDomains.noConflict()),b}return d.URI===this&&(d.URI=q),this},r.build=function(a){return a===!0?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=e.build(this._parts),this._deferred_build=!1),this},r.clone=function(){return new e(this)},r.valueOf=r.toString=function(){return this.build(!1)._string},r.protocol=o("protocol"),r.username=o("username"),r.password=o("password"),r.hostname=o("hostname"),r.port=o("port"),r.query=p("query","?"),r.fragment=p("fragment","#"),r.search=function(a,b){var c=this.query(a,b);return"string"==typeof c&&c.length?"?"+c:c},r.hash=function(a,b){var c=this.fragment(a,b);return"string"==typeof c&&c.length?"#"+c:c},r.pathname=function(a,b){if(void 0===a||a===!0){var c=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?e.decodeUrnPath:e.decodePath)(c):c}return this._parts.urn?this._parts.path=a?e.recodeUrnPath(a):"":this._parts.path=a?e.recodePath(a):"/",this.build(!b),this},r.path=r.pathname,r.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="",this._parts=e._parts();var d=a instanceof e,f="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName){var g=e.getDomAttribute(a);a=a[g]||"",f=!1}if(!d&&f&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a||a instanceof String)this._parts=e.parse(String(a),this._parts);else{if(!d&&!f)throw new TypeError("invalid input");var h=d?a._parts:a;for(c in h)s.call(this._parts,c)&&(this._parts[c]=h[c])}return this.build(!b),this},r.is=function(a){var b=!1,d=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,d=e.ip4_expression.test(this._parts.hostname),f=e.ip6_expression.test(this._parts.hostname),b=d||f,g=!b,h=g&&c&&c.has(this._parts.hostname),i=g&&e.idn_expression.test(this._parts.hostname),j=g&&e.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return g;case"sld":return h;case"ip":return b;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return f;case"idn":return i;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return j}return null};var x=r.protocol,y=r.port,z=r.hostname;r.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(e.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return x.call(this,a,b)},r.scheme=r.protocol,r.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return y.call(this,a,b)},r.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={},d=e.parseHost(a,c);if("/"!==d)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');a=c.hostname}return z.call(this,a,b)},r.origin=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){var c=this.protocol(),d=this.authority();return d?(c?c+"://":"")+this.authority():""}var f=e(a);return this.protocol(f.protocol()).authority(f.authority()).build(!b),this},r.host=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?e.buildHost(this._parts):"";var c=e.parseHost(a,this._parts);if("/"!==c)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},r.authority=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?e.buildAuthority(this._parts):"";var c=e.parseAuthority(a,this._parts);if("/"!==c)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},r.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var c=e.buildUserinfo(this._parts);return c.substring(0,c.length-1)}return"@"!==a[a.length-1]&&(a+="@"),e.parseUserinfo(a,this._parts),this.build(!b),this},r.resource=function(a,b){var c;return void 0===a?this.path()+this.search()+this.hash():(c=e.parse(a),this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this)},r.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}var d=this._parts.hostname.length-this.domain().length,g=this._parts.hostname.substring(0,d),h=new RegExp("^"+f(g));return a&&"."!==a.charAt(a.length-1)&&(a+="."),a&&e.ensureValidHostname(a),this._parts.hostname=this._parts.hostname.replace(h,a),this.build(!b),this},r.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);if(c&&c.length<2)return this._parts.hostname;var d=this._parts.hostname.length-this.tld(b).length-1;return d=this._parts.hostname.lastIndexOf(".",d-1)+1,this._parts.hostname.substring(d)||""}if(!a)throw new TypeError("cannot set domain empty");if(e.ensureValidHostname(a),!this._parts.hostname||this.is("IP"))this._parts.hostname=a;else{var g=new RegExp(f(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(g,a)}return this.build(!b),this},r.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.lastIndexOf("."),e=this._parts.hostname.substring(d+1);return b!==!0&&c&&c.list[e.toLowerCase()]?c.get(this._parts.hostname)||e:e}var g;if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!c||!c.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');g=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");g=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,a)}return this.build(!b),this},r.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,d=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?e.decodePath(d):d}var g=this._parts.path.length-this.filename().length,h=this._parts.path.substring(0,g),i=new RegExp("^"+f(h));return this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a),this.build(!b),this},r.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),d=this._parts.path.substring(c+1);return a?e.decodePathSegment(d):d}var g=!1;"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(g=!0);var h=new RegExp(f(this.filename())+"$");return a=e.recodePath(a),this._parts.path=this._parts.path.replace(h,a),g?this.normalizePath(b):this.build(!b),this},r.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c,d,g=this.filename(),h=g.lastIndexOf(".");return-1===h?"":(c=g.substring(h+1),d=/^[a-z0-9%]+$/i.test(c)?c:"",a?e.decodePathSegment(d):d)}"."===a.charAt(0)&&(a=a.substring(1));var i,j=this.suffix();if(j)i=a?new RegExp(f(j)+"$"):new RegExp(f("."+j)+"$");else{if(!a)return this;this._parts.path+="."+e.recodePath(a)}return i&&(a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a)),this.build(!b),this},r.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),f="/"===e.substring(0,1),g=e.split(d);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw new Error('Bad segment "'+a+'", must be 0-based integer');if(f&&g.shift(),0>a&&(a=Math.max(g.length+a,0)),void 0===b)return void 0===a?g:g[a];if(null===a||void 0===g[a])if(h(b)){g=[];for(var i=0,j=b.length;j>i;i++)(b[i].length||g.length&&g[g.length-1].length)&&(g.length&&!g[g.length-1].length&&g.pop(),g.push(l(b[i])))}else(b||"string"==typeof b)&&(b=l(b),""===g[g.length-1]?g[g.length-1]=b:g.push(b));else b?g[a]=l(b):g.splice(a,1);return f&&g.unshift(""),this.path(g.join(d),c)},r.segmentCoded=function(a,b,c){var d,f,g;if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(d=this.segment(a,b,c),h(d))for(f=0,g=d.length;g>f;f++)d[f]=e.decode(d[f]);else d=void 0!==d?e.decode(d):void 0;return d}if(h(b))for(f=0,g=b.length;g>f;f++)b[f]=e.encode(b[f]);else b="string"==typeof b||b instanceof String?e.encode(b):b;return this.segment(a,b,c)};var A=r.query;return r.query=function(a,b){if(a===!0)return e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var c=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace),d=a.call(this,c);return this._parts.query=e.buildQuery(d||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=e.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):A.call(this,a,b)},r.setQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)d[a]=void 0!==b?b:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var f in a)s.call(a,f)&&(d[f]=a[f])}return this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},r.addQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.addQuery(d,a,void 0===b?null:b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},r.removeQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.removeQuery(d,a,b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},r.hasQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.hasQuery(d,a,b,c)},r.setSearch=r.setQuery,r.addSearch=r.addQuery,r.removeSearch=r.removeQuery,r.hasSearch=r.hasQuery,r.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},r.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},r.normalizeHostname=function(c){return this._parts.hostname&&(this.is("IDN")&&a?this._parts.hostname=a.toASCII(this._parts.hostname):this.is("IPv6")&&b&&(this._parts.hostname=b.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!c)),this},r.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===e.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},r.normalizePath=function(a){var b=this._parts.path;if(!b)return this;if(this._parts.urn)return this._parts.path=e.recodeUrnPath(this._parts.path),this.build(!a),this;if("/"===this._parts.path)return this;b=e.recodePath(b);var c,d,f,g="";for("/"!==b.charAt(0)&&(c=!0,b="/"+b),("/.."===b.slice(-3)||"/."===b.slice(-2))&&(b+="/"),b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),c&&(g=b.substring(1).match(/^(\.\.\/)+/)||"",g&&(g=g[0]));;){if(d=b.search(/\/\.\.(\/|$)/),-1===d)break;0!==d?(f=b.substring(0,d).lastIndexOf("/"),-1===f&&(f=d),b=b.substring(0,f)+b.substring(d+3)):b=b.substring(3)}return c&&this.is("relative")&&(b=g+b.substring(1)),this._parts.path=b,this.build(!a),this},r.normalizePathname=r.normalizePath,r.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(e.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},r.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},r.normalizeSearch=r.normalizeQuery,r.normalizeHash=r.normalizeFragment,r.iso8859=function(){var a=e.encode,b=e.decode;e.encode=escape,e.decode=decodeURIComponent;try{this.normalize()}finally{e.encode=a,e.decode=b}return this},r.unicode=function(){var a=e.encode,b=e.decode;e.encode=n,e.decode=unescape;try{this.normalize()}finally{e.encode=a,e.decode=b}return this},r.readable=function(){var b=this.clone();b.username("").password("").normalize();var c="";if(b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&a?(c+=a.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path.charAt(0)&&(c+="/"),c+=b.path(!0),b._parts.query){for(var d="",f=0,g=b._parts.query.split("&"),h=g.length;h>f;f++){var i=(g[f]||"").split("=");d+="&"+e.decodeQuery(i[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==i[1]&&(d+="="+e.decodeQuery(i[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=e.decodeQuery(b.hash(),!0)},r.absoluteTo=function(a){var b,c,d,f=this.clone(),g=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a instanceof e||(a=new e(a)),f._parts.protocol||(f._parts.protocol=a._parts.protocol),this._parts.hostname)return f;for(c=0;d=g[c];c++)f._parts[d]=a._parts[d];return f._parts.path?".."===f._parts.path.substring(-2)&&(f._parts.path+="/"):(f._parts.path=a._parts.path,f._parts.query||(f._parts.query=a._parts.query)),"/"!==f.path().charAt(0)&&(b=a.directory(),b=b?b:0===a.path().indexOf("/")?"/":"",f._parts.path=(b?b+"/":"")+f._parts.path,f.normalizePath()),f.build(),f},r.relativeTo=function(a){var b,c,d,f,g,h=this.clone().normalize();if(h._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a=new e(a).normalize(),b=h._parts,c=a._parts,f=h.path(),g=a.path(),"/"!==f.charAt(0))throw new Error("URI is already relative");if("/"!==g.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(b.protocol===c.protocol&&(b.protocol=null),b.username!==c.username||b.password!==c.password)return h.build();if(null!==b.protocol||null!==b.username||null!==b.password)return h.build();if(b.hostname!==c.hostname||b.port!==c.port)return h.build();if(b.hostname=null,b.port=null,f===g)return b.path="",h.build();if(d=e.commonPath(f,g),!d)return h.build();var i=c.path.substring(d.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return b.path=i+b.path.substring(d.length)||"./",h.build()},r.equals=function(a){var b,c,d,f=this.clone(),g=new e(a),i={},j={},l={};if(f.normalize(),g.normalize(),f.toString()===g.toString())return!0;if(b=f.query(),c=g.query(),f.query(""),g.query(""),f.toString()!==g.toString())return!1;if(b.length!==c.length)return!1;i=e.parseQuery(b,this._parts.escapeQuerySpace),j=e.parseQuery(c,this._parts.escapeQuerySpace);for(d in i)if(s.call(i,d)){if(h(i[d])){if(!k(i[d],j[d]))return!1}else if(i[d]!==j[d])return!1;l[d]=!0}for(d in j)if(s.call(j,d)&&!l[d])return!1;return!0},r.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},r.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},e})},{"./IPv6":15,"./SecondLevelDomains":16,"./punycode":18}],18:[function(a,b,c){(function(a){!function(d){function e(a){throw new RangeError(H[a])}function f(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function g(a,b){var c=a.split("@"),d="";c.length>1&&(d=c[0]+"@",a=c[1]),a=a.replace(G,".");var e=a.split("."),g=f(e,b).join(".");return d+g}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function i(a){return f(a,function(a){var b="";return a>65535&&(a-=65536,b+=K(a>>>10&1023|55296),a=56320|1023&a),b+=K(a)}).join("")}function j(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:w}function k(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function l(a,b,c){var d=0;for(a=c?J(a/A):a>>1,a+=J(a/b);a>I*y>>1;d+=w)a=J(a/I);return J(d+(I+1)*a/(a+z))}function m(a){var b,c,d,f,g,h,k,m,n,o,p=[],q=a.length,r=0,s=C,t=B;for(c=a.lastIndexOf(D),0>c&&(c=0),d=0;c>d;++d)a.charCodeAt(d)>=128&&e("not-basic"),p.push(a.charCodeAt(d));for(f=c>0?c+1:0;q>f;){for(g=r,h=1,k=w;f>=q&&e("invalid-input"),m=j(a.charCodeAt(f++)),(m>=w||m>J((v-r)/h))&&e("overflow"),r+=m*h,n=t>=k?x:k>=t+y?y:k-t,!(n>m);k+=w)o=w-n,h>J(v/o)&&e("overflow"),h*=o;b=p.length+1,t=l(r-g,b,0==g),J(r/b)>v-s&&e("overflow"),s+=J(r/b),r%=b,p.splice(r++,0,s)}return i(p)}function n(a){var b,c,d,f,g,i,j,m,n,o,p,q,r,s,t,u=[];for(a=h(a),q=a.length,b=C,c=0,g=B,i=0;q>i;++i)p=a[i],128>p&&u.push(K(p));for(d=f=u.length,f&&u.push(D);q>d;){for(j=v,i=0;q>i;++i)p=a[i],p>=b&&j>p&&(j=p);for(r=d+1,j-b>J((v-c)/r)&&e("overflow"),c+=(j-b)*r,b=j,i=0;q>i;++i)if(p=a[i],b>p&&++c>v&&e("overflow"),p==b){for(m=c,n=w;o=g>=n?x:n>=g+y?y:n-g,!(o>m);n+=w)t=m-o,s=w-o,u.push(K(k(o+t%s,0))),m=J(t/s);u.push(K(k(m,0))),g=l(c,r,d==f),c=0,++d}++c,++b}return u.join("")}function o(a){return g(a,function(a){return E.test(a)?m(a.slice(4).toLowerCase()):a})}function p(a){return g(a,function(a){return F.test(a)?"xn--"+n(a):a})}var q="object"==typeof c&&c&&!c.nodeType&&c,r="object"==typeof b&&b&&!b.nodeType&&b,s="object"==typeof a&&a;(s.global===s||s.window===s||s.self===s)&&(d=s);var t,u,v=2147483647,w=36,x=1,y=26,z=38,A=700,B=72,C=128,D="-",E=/^xn--/,F=/[^\x20-\x7E]/,G=/[\x2E\u3002\uFF0E\uFF61]/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=w-x,J=Math.floor,K=String.fromCharCode;if(t={version:"1.3.2",ucs2:{decode:h,encode:i},decode:m,encode:n,toASCII:p,toUnicode:o},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){
return t});else if(q&&r)if(b.exports==q)r.exports=t;else for(u in t)t.hasOwnProperty(u)&&(q[u]=t[u]);else d.punycode=t}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(a,b,c){b.exports={name:"cartodb-deep-insights.js",version:"0.0.2",description:"CARTO Deep Insights JS library",repository:{type:"git",url:"git://github.com/CartoDB/deep-insights.js.git"},author:{name:"CARTO",email:"wadus@carto.com",url:"http://carto.com/"},contributors:[{name:"Javier Álvarez",email:"jmedina@cartodb.com"},{name:"Javier Arce",email:"javierarce@cartodb.com"},{name:"Javier Santana",email:"jsantana@cartodb.com"},{name:"Raul Ochoa",email:"rochoa@cartodb.com"},{name:"Nicklas Gummesson",email:"nicklas@cartodb.com"},{name:"Pablo Alonso",email:"pablo@cartodb.com"},{name:"Antonio Santiago Pérez",email:"asantiago@cartodb.com"}],license:"BSD-3-Clause",dependencies:{backbone:"1.2.3",cartocolor:"4.0.0","cartodb.js":"github:cartodb/cartodb.js#v4",d3:"3.5.17","d3-interpolate":"1.1.2",jquery:"2.1.4",moment:"2.10.6","perfect-scrollbar":"0.6.7",tinycolor2:"1.4.1",underscore:"1.8.3",urijs:"1.17.1"},devDependencies:{browserify:"13.0.0","browserify-resolutions":"1.1.0",cartoassets:"github:cartodb/CartoAssets#master",grunt:"0.4.5","grunt-aws":"^0.4.0","grunt-browserify":"5.0.0","grunt-contrib-clean":"0.7.0","grunt-contrib-concat":"0.5.1","grunt-contrib-connect":"0.11.2","grunt-contrib-copy":"0.8.2","grunt-contrib-cssmin":"0.14.0","grunt-contrib-imagemin":"1.0.0","grunt-contrib-jasmine":"0.9.2","grunt-contrib-uglify":"0.11.0","grunt-contrib-watch":"0.6.1","grunt-exorcise":"2.1.0","grunt-fastly":"~0.1.3","grunt-gh-pages":"1.0.0","grunt-sass":"1.1.0",jstify:"0.12.0","load-grunt-tasks":"3.3.0",semistandard:"7.0.4","source-map-support":"0.4.0","time-grunt":"1.2.2",watchify:"3.6.1"},browserify:{transform:["jstify"]},main:"src/index.js",semistandard:{globals:["alert","cartodb","cdb","jasmine","describe","xdescribe","beforeEach","afterEach","spyOn","it","xit","expect"],ignore:["/*.js","/dist","/examples","/grunt-tasks","/styleguide","/themes","/vendor"]},gitHead:"708203920d2f5adeca73838205852688a837bc22",readme:"Deep-Insights.js [![Build Status](http://travis-ci.org/CartoDB/deep-insights.js.png?branch=master)](http://travis-ci.org/CartoDB/deep-insights.js)\n====================\n\n## Intro\n\nDepth Insights.js allows to create powerful dashboards using CartoDB\n\n## Quickstart\n\nPlease, read the [quickstart](doc/quickstart.md) and the [API](doc/api.md)\n\n\n## Develop\n\n`npm install` and then `grunt dev` to build dev dist files\n\nAfter the last step [http://localhost:9002/](http://localhost:9002/) should open in a browser, where you can run tests, see styleguide and examples etc.\n\n## release\n\n1. be sure you have the right secrets.json\n1. Modify the package.json version\n1. execute `grunt release`\n",readmeFilename:"README.md",bugs:{url:"https://github.com/CartoDB/deep-insights.js/issues"},homepage:"https://github.com/CartoDB/deep-insights.js#readme",_id:"cartodb-deep-insights.js@0.0.2",_shasum:"2a0f7fc836bd595199a7f4c3bc2c068ba5ac47c4",_from:"git://github.com/cartodb/deep-insights.js.git#708203920d2f5adeca73838205852688a837bc22",_resolved:"git://github.com/cartodb/deep-insights.js.git#708203920d2f5adeca73838205852688a837bc22"}},{}],20:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./dashboard"),g=a("../dashboard-view"),h=a("../widgets/widgets-collection"),i=a("../widgets-service"),j=a("./url-helper"),k=function(a,b,c,f){var k=document.querySelector(a);if(!k)throw new Error("no element found with selector "+a);c=c||{},c.renderMenu=d.isBoolean(c.renderMenu)?c.renderMenu:!0,c.autoStyle=d.isBoolean(c.autoStyle)?c.autoStyle:!1;var l=new h,m=new e.core.Model({title:b.title,description:b.description,updatedAt:b.updated_at,userName:b.user.fullname,userProfileURL:b.user.profile_url,userAvatarURL:b.user.avatar_url,renderMenu:c.renderMenu,autoStyle:c.autoStyle,showLogo:c.cartodb_logo,initialPosition:{bounds:b.bounds}}),n=new g({el:k,widgets:l,model:m}),o=c.state||j.getStateFromCurrentURL();o&&!d.isEmpty(o.map)&&o.map.ne&&o.map.sw&&(b.bounds=[o.map.ne,o.map.sw]);var p=e.createVis(n.$("#map"),b,d.extend(c,{skipMapInstantiation:!0}));p.once("load",function(a){o&&!d.isEmpty(o.map)&&(d.isUndefined(o.map.ne)||d.isUndefined(o.map.sw)?d.isUndefined(o.map.center)||d.isUndefined(o.map.zoom)||a.map.setView(o.map.center,o.map.zoom):a.map.setBounds([o.map.ne,o.map.sw]));var g=o&&o.widgets||{},h=new i(l,a.dataviews),j={list:h.createListModel.bind(h),formula:h.createFormulaModel.bind(h),histogram:h.createHistogramModel.bind(h),"time-series":h.createTimeSeriesModel.bind(h),category:h.createCategoryModel.bind(h)};b.widgets.forEach(function(b){var f=d.extend({},b,b.options),h=j[b.type],i=g[b.id];if(d.isFunction(h)){var k;b.layer_id?k=a.map.layers.get(b.layer_id):Number.isInteger(b.layerIndex)&&(k=a.map.layers.at(b.layerIndex)),h(f,k,i,{autoStyleEnabled:c.autoStyle})}else e.log.error("No widget found for type "+b.type)}),n.render(),l.size()>0&&a.centerMapToOrigin(),a.instantiateMap({success:function(){f&&f(null,{dashboardView:n,widgets:h,vis:a})},error:function(){var b=new Error("Map instantiation failed");console.log(b),f&&f(b,{dashboardView:n,widgets:h,vis:a})}})})};b.exports=function(a,b,c,g){function h(b){k(a,b,c,function(a,b){var e=new f(b);e.onStateChanged(d.debounce(function(a,b){window.history.replaceState("Object","Title",b)},500),c.share_urls),g&&g(a,e)})}var i=arguments,j=i[i.length-1];d.isFunction(j)&&(g=j),"string"==typeof b?e.core.Loader.get(b,function(a){a?h(a,c):g&&g(new Error("error fetching viz.json file"))}):h(b,c)}},{"../dashboard-view":28,"../widgets-service":31,"../widgets/widgets-collection":109,"./dashboard":21,"./url-helper":22,"cartodb.js":"cartodb.js",underscore:"underscore"}],21:[function(a,b,c){function d(a){this._dashboard=a}var e=a("./url-helper"),f=a("underscore");d.prototype={getView:function(){return this._dashboard.dashboardView},getMap:function(){return this._dashboard.vis},getWidgets:function(){return this._dashboard.widgets.getList()},getDashboardURL:function(){return e.getURLFromState(this.getState())},getState:function(){var a={},b=this.getMapState();f.isEmpty(b)||(a.map=b);var c=this._dashboard.widgets._widgetsCollection.getStates();return f.isEmpty(c)||(a.widgets=c),a},getMapState:function(){var a=this._dashboard.vis.map.getViewBounds();return{ne:a[0],sw:a[1]}},setState:function(a){this._dashboard.widgets.setWidgetsState(a.widgets),this._dashboard.vis.mapvis.map.setBounds([a.map.ne,a.map.sw])},onStateChanged:function(a,b){this._dashboard.vis.once("dataviewsFetched",function(){this._dashboard.widgets._widgetsCollection.initialState(),this._dashboard.widgets._widgetsCollection.each(function(a){a.applyInitialState()},this),b===!0&&this._bindChange(a)},this)},_bindChange:function(a){this._dashboard.widgets._widgetsCollection.bind("change",function(){a(this.getState(),this.getDashboardURL())},this),this._dashboard.vis.map.bind("change",function(){a(this.getState(),this.getDashboardURL())},this)},_getAutoStyleOpt:function(a){var b=this._dashboard.dashboardView.model.get("autoStyle");return a=a||{},a.autoStyleEnabled=b||!1,a},getWidget:function(a){return this._dashboard.widgets.get(a)},createCategoryWidget:function(a,b){return this._dashboard.widgets.createCategoryModel(a,b,null,this._getAutoStyleOpt())},createHistogramWidget:function(a,b){return this._dashboard.widgets.createHistogramModel(a,b,null,this._getAutoStyleOpt())},createFormulaWidget:function(a,b){return this._dashboard.widgets.createFormulaModel(a,b,null,this._getAutoStyleOpt())},createTimeSeriesWidget:function(a,b){return this._dashboard.widgets.createTimeSeriesModel(a,b,null,this._getAutoStyleOpt())}},b.exports=d},{"./url-helper":22,underscore:"underscore"}],22:[function(a,b,c){var d=a("urijs"),e=a("underscore");b.exports={getURLFromState:function(a){var b=new d(this.getLocalURL());if(b.removeQuery("state"),!e.isEmpty(a)){var c=JSON.stringify(a);b.setQuery("state",c)}return b.toString()},getStateFromCurrentURL:function(){var a=this.getLocalURL();return this.getStateFromURL(a)},getStateFromURL:function(a){var b,c=new d(a),f={};return c.hasQuery("state")&&(b=c.query(!0).state,e.isEmpty(b)||(f=JSON.parse(decodeURIComponent(b)))),f},getLocalURL:e.constant(window.location.href)}},{underscore:"underscore",urijs:17}],23:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./widgets/widget-view-factory"),g=a("./widgets/time-series/content-view"),h=a("./widgets/time-series/torque-content-view");b.exports=e.core.View.extend({className:"CDB-Dashboard-belowMap",initialize:function(a){this._widgetViewFactory=new f([{match:function(a){if("time-series"===a.get("type")){var b=a.dataviewModel;return b&&"torque"===b.layer.get("type")}return!1},createContentView:function(a){return new h({model:a})},customizeWidgetAttrs:function(a){return a.className+=" CDB-Widget--timeSeries",a}},{type:"time-series",createContentView:function(a){return new g({model:a})},customizeWidgetAttrs:function(a){return a.className+=" CDB-Widget--timeSeries",a}}]),this._widgets=a.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("add reset remove",this._onWidgetsChange,this),this.add_related_model(this._widgets)},render:function(){return this.clearSubViews(),this.$el.empty(),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this},_maybeRenderWidgetView:function(a){var b=this._widgetViewFactory.createWidgetView(a);b&&(this.addView(b),this.$el.append(b.render().el))},_toggleVisiblity:function(){this.$el.toggle(!d.isEmpty(this._subviews))},_onWidgetsChange:function(){this._toggleVisiblity()}})},{"./widgets/time-series/content-view":84,"./widgets/time-series/torque-content-view":90,"./widgets/widget-view-factory":107,"cartodb.js":"cartodb.js",underscore:"underscore"}],24:[function(a,b,c){var d=a("cartodb.js"),e=a("./dashboard-menu-view.tpl"),f=a("moment"),g=d.core.View.extend({className:"CDB-Dashboard-menu",events:{"click .js-toggle-view":"_toogleView"},render:function(){var a=this.model.get("title");return a&&a.length>120&&(a=a.slice(0,110)+"... %23 map"),this.$el.html(e({showLogo:this.model.get("showLogo"),title:this.model.get("title"),description:this.model.get("description"),updatedAt:f(this.model.get("updatedAt")).fromNow(),userName:this.model.get("userName"),url:window.location.href,urlWithoutParams:window.location.protocol+"//"+window.location.host+window.location.pathname,inIframe:window.location!==window.parent.location,shortTitle:a,userAvatarURL:this.model.get("userAvatarURL"),userProfileURL:this.model.get("userProfileURL")})),this},_toogleView:function(){this.$el.toggleClass("is-active")}});b.exports=g},{"./dashboard-menu-view.tpl":25,"cartodb.js":"cartodb.js",moment:"moment"}],25:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Dashboard-menuContainer"> <div class="CDB-Dashboard-menuInner"> <div class="CDB-Dashboard-menuHeader"> ',showLogo===!0&&(__p+=' <div class="CDB-Dashboard-menuLogo"> <a href="http://carto.com" target="_blank"> <svg width="62px" height="24px" viewBox="35 63 62 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g class="CDB-EmbedLogo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(35.000000, 63.000000)"> <path d="M3.94693333,15.9877346 C5.63066667,15.9877346 6.60373333,15.2552013 7.32533333,14.260268 L5.72906667,13.1232013 C5.26986667,13.6808013 4.79973333,14.0525346 4.0016,14.0525346 C2.93013333,14.0525346 2.17573333,13.1560013 2.17573333,12.0080013 L2.17573333,11.9861346 C2.17573333,10.8709346 2.93013333,9.95253464 4.0016,9.95253464 C4.73413333,9.95253464 5.23706667,10.3133346 5.6744,10.849068 L7.27066667,9.6136013 C6.5928,8.68426797 5.58693333,8.02826797 4.02346667,8.02826797 C1.7056,8.02826797 0,9.7776013 0,12.0080013 L0,12.029868 C0,14.3149346 1.76026667,15.9877346 3.94693333,15.9877346 L3.94693333,15.9877346 Z M10.93653,15.834668 L13.1559967,15.834668 L13.7026634,14.457068 L16.6655967,14.457068 L17.2122634,15.834668 L19.4863967,15.834668 L16.2282634,8.12666797 L14.18373,8.12666797 L10.93653,15.834668 Z M14.3258634,12.8061346 L15.1895967,10.6413346 L16.0423967,12.8061346 L14.3258634,12.8061346 Z M23.61653,15.834668 L25.7375966,15.834668 L25.7375966,13.5168013 L26.6778633,13.5168013 L28.2194633,15.834668 L30.6575966,15.834668 L28.83173,13.1669346 C29.78293,12.7624013 30.40613,11.9861346 30.40613,10.8053346 L30.40613,10.783468 C30.40613,10.029068 30.17653,9.4496013 29.7282633,9.00133464 C29.2143966,8.48746797 28.40533,8.18133464 27.2354633,8.18133464 L23.61653,8.18133464 L23.61653,15.834668 Z M25.7375966,11.8549346 L25.7375966,10.0072013 L27.1370633,10.0072013 C27.8367966,10.0072013 28.2850633,10.3133346 28.2850633,10.9256013 L28.2850633,10.947468 C28.2850633,11.505068 27.8586633,11.8549346 27.1479966,11.8549346 L25.7375966,11.8549346 Z M36.7338633,15.834668 L38.8549299,15.834668 L38.8549299,10.0400013 L41.1509299,10.0400013 L41.1509299,8.18133464 L34.4487966,8.18133464 L34.4487966,10.0400013 L36.7338633,10.0400013 L36.7338633,15.834668 Z" class="CDB-EmbedLogo-text" fill="#FFFFFF"></path> <g class="CDB-EmbedLogo-imago" transform="translate(37.000000, 0.000000)"> <circle class="CDB-EmbedLogo-halo" fill="rgba(255, 255, 255, 0.20)" cx="12.3333333" cy="12" r="12"></circle> <path d="M12.3333333,16.5 C14.8186147,16.5 16.8333333,14.4852814 16.8333333,12 C16.8333333,9.51471863 14.8186147,7.5 12.3333333,7.5 C9.84805196,7.5 7.83333333,9.51471863 7.83333333,12 C7.83333333,14.4852814 9.84805196,16.5 12.3333333,16.5 L12.3333333,16.5 Z" class="CDB-EmbedLogo-point" fill="#FFFFFF"></path> </g> </g> </svg> </a> </div> '),__p+=' <ul class="CDB-Dashboard-menuActions"> <li class="CDB-Dashboard-menuActionsItem"> <a href="https://twitter.com/share?url='+(null==(__t=urlWithoutParams)?"":_.escape(__t))+"&text="+(null==(__t=shortTitle)?"":_.escape(__t))+'" target="_blank" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-twitter CDB-Size-large"></i> </a> </li> <li class="CDB-Dashboard-menuActionsItem"> <a href="http://www.facebook.com/sharer.php?u='+(null==(__t=urlWithoutParams)?"":_.escape(__t))+"&text="+(null==(__t=shortTitle)?"":_.escape(__t))+'" target="_blank" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-facebook CDB-Size-medium"></i> </a> </li> ',inIframe&&(__p+=' <li class="CDB-Dashboard-menuActionsItem"> <a href="'+(null==(__t=url)?"":_.escape(__t))+'" target="_blank" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-anchor CDB-Size-medium"></i> </a> </li> '),__p+=' </ul> <div class="CDB-Dashboard-menuInfo"> <button class="js-toggle-view"> <i class="CDB-Text CDB-Size-medium CDB-IconFont CDB-IconFont-rArrowLight Size-large"></i> </button> </div> <div class="CDB-Dashboard-menuTexts CDB-Dashboard-hideMobile"> <div class="CDB-Dashboard-menuTextInner js-content"> <button class="js-toggle-view u-actionTextColor CDB-Dashboard-menuTextActions"> <svg width="10px" height="7px" viewBox="12 13 10 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <path d="M12,13.5 C12,13.2238576 12.1908338,13 12.4169561,13 L21.5830439,13 C21.8133224,13 22,13.2319336 22,13.5 C22,13.7761424 21.8091662,14 21.5830439,14 L12.4169561,14 C12.1866776,14 12,13.7680664 12,13.5 L12,13.5 L12,13.5 Z M12,16.5 C12,16.2238576 12.1908338,16 12.4169561,16 L21.5830439,16 C21.8133224,16 22,16.2319336 22,16.5 C22,16.7761424 21.8091662,17 21.5830439,17 L12.4169561,17 C12.1866776,17 12,16.7680664 12,16.5 L12,16.5 L12,16.5 Z M12,19.5 C12,19.2238576 12.1908338,19 12.4169561,19 L21.5830439,19 C21.8133224,19 22,19.2319336 22,19.5 C22,19.7761424 21.8091662,20 21.5830439,20 L12.4169561,20 C12.1866776,20 12,19.7680664 12,19.5 L12,19.5 L12,19.5 Z" id="Combined-Shape" stroke="none" fill="#1785fB" fill-rule="evenodd"></path> </svg> </button> <div> <p class="CDB-Dashboard-menuTime CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+(null==(__t=updatedAt)?"":_.escape(__t))+'</p> <h1 class="CDB-Dashboard-menuTitle CDB-Dashboard-menuTitle--mobile CDB-Text CDB-Size-huge u-ellipsis js-title" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h1> <h2 class="CDB-Dashboard-menuDescription CDB-Text CDB-Size-large is-light u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+'</h2> </div> </div> </div> </div> <div class="CDB-Dashboard-menuFooter"> <ul> <li class="CDB-Dashboard-menuFooterItem"> <div class="CDB-Dashboard-menuMedia CDB-Dashboard-menuAvatar"> <img src="'+(null==(__t=userAvatarURL)?"":_.escape(__t))+'" alt="avatar" class="inline-block"> </div> <p class="CDB-Text CDB-Size-medium CDB-Dashboard-menuFooterTxt">Map by <a href="'+(null==(__t=userProfileURL)?"":_.escape(__t))+'" target="_blank">'+(null==(__t=userName)?"":_.escape(__t))+'</a></p> </li> </ul> </div> </div> <div class="CDB-Dashboard-bg js-toggle-view"></div> <div class="CDB-Dashboard-menuHeaderMobile"> <div class="u-flex u-alignStart CDB-Dashboard-menuHeaderMobileInner"> <button class="js-toggle-view u-actionTextColor CDB-Dashboard-menuHeaderMobileActions"> <i class="CDB-Text CDB-Size-medium CDB-IconFont CDB-IconFont-rArrowLight Size-large"></i> </button> <div class="CDB-Dashboard-menuHeaderMobileText"> ',showLogo===!0&&(__p+=' <div class="CDB-Dashboard-menuLogo"> <a href="http://carto.com" target="_blank"> <svg width="62px" height="24px" viewBox="35 63 62 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g class="CDB-EmbedLogo" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(35.000000, 63.000000)"> <path d="M3.94693333,15.9877346 C5.63066667,15.9877346 6.60373333,15.2552013 7.32533333,14.260268 L5.72906667,13.1232013 C5.26986667,13.6808013 4.79973333,14.0525346 4.0016,14.0525346 C2.93013333,14.0525346 2.17573333,13.1560013 2.17573333,12.0080013 L2.17573333,11.9861346 C2.17573333,10.8709346 2.93013333,9.95253464 4.0016,9.95253464 C4.73413333,9.95253464 5.23706667,10.3133346 5.6744,10.849068 L7.27066667,9.6136013 C6.5928,8.68426797 5.58693333,8.02826797 4.02346667,8.02826797 C1.7056,8.02826797 0,9.7776013 0,12.0080013 L0,12.029868 C0,14.3149346 1.76026667,15.9877346 3.94693333,15.9877346 L3.94693333,15.9877346 Z M10.93653,15.834668 L13.1559967,15.834668 L13.7026634,14.457068 L16.6655967,14.457068 L17.2122634,15.834668 L19.4863967,15.834668 L16.2282634,8.12666797 L14.18373,8.12666797 L10.93653,15.834668 Z M14.3258634,12.8061346 L15.1895967,10.6413346 L16.0423967,12.8061346 L14.3258634,12.8061346 Z M23.61653,15.834668 L25.7375966,15.834668 L25.7375966,13.5168013 L26.6778633,13.5168013 L28.2194633,15.834668 L30.6575966,15.834668 L28.83173,13.1669346 C29.78293,12.7624013 30.40613,11.9861346 30.40613,10.8053346 L30.40613,10.783468 C30.40613,10.029068 30.17653,9.4496013 29.7282633,9.00133464 C29.2143966,8.48746797 28.40533,8.18133464 27.2354633,8.18133464 L23.61653,8.18133464 L23.61653,15.834668 Z M25.7375966,11.8549346 L25.7375966,10.0072013 L27.1370633,10.0072013 C27.8367966,10.0072013 28.2850633,10.3133346 28.2850633,10.9256013 L28.2850633,10.947468 C28.2850633,11.505068 27.8586633,11.8549346 27.1479966,11.8549346 L25.7375966,11.8549346 Z M36.7338633,15.834668 L38.8549299,15.834668 L38.8549299,10.0400013 L41.1509299,10.0400013 L41.1509299,8.18133464 L34.4487966,8.18133464 L34.4487966,10.0400013 L36.7338633,10.0400013 L36.7338633,15.834668 Z" class="CDB-EmbedLogo-text" fill="#FFFFFF"></path> <g class="CDB-EmbedLogo-imago" transform="translate(37.000000, 0.000000)"> <circle class="CDB-EmbedLogo-halo" fill="rgba(255, 255, 255, 0.20)" cx="12.3333333" cy="12" r="12"></circle> <path d="M12.3333333,16.5 C14.8186147,16.5 16.8333333,14.4852814 16.8333333,12 C16.8333333,9.51471863 14.8186147,7.5 12.3333333,7.5 C9.84805196,7.5 7.83333333,9.51471863 7.83333333,12 C7.83333333,14.4852814 9.84805196,16.5 12.3333333,16.5 L12.3333333,16.5 Z" class="CDB-EmbedLogo-point" fill="#FFFFFF"></path> </g> </g> </svg> </a> </div> '),__p+=' <p class="CDB-Dashboard-menuTime CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+(null==(__t=updatedAt)?"":_.escape(__t))+'</p> <h1 class="CDB-Text CDB-Size-large u-ellipsis js-title u-bSpace--xl u-ellipsis">'+(null==(__t=title)?"":_.escape(__t))+'</h1> <h2 class="CDB-Text CDB-Size-medium u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+"</h2> </div> </div> </div> </div>";return __p}},{underscore:"underscore"}],26:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("perfect-scrollbar"),g=a("cartodb.js"),h=a("./widgets/category/content-view"),i=a("./widgets/formula/content-view"),j=a("./widgets/histogram/content-view"),k=a("./widgets/list/content-view"),l=a("./widgets/widget-view-factory"),m=a("./dashboard-sidebar.tpl"),n=window.matchMedia,o=window.MutationObserver;b.exports=g.core.View.extend({className:"CDB-Widget-canvas",initialize:function(a){this._widgetViewFactory=new l([{type:"formula",createContentView:function(a){return new i({model:a})}},{type:"list",createContentView:function(a){return new k({model:a})}},{type:"histogram",createContentView:function(a){return new j({model:a})}},{type:"category",createContentView:function(a){return new h({model:a})}}]),this._widgets=a.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("orderChanged",this.render,this),this._widgets.bind("change:collapsed",this._onWidgetUpdate,this),this._widgets.bind("add remove reset",this._onUpdate,this),this.add_related_model(this._widgets),this._resizeHandler=this._onResize.bind(this)},render:function(){return this._cleanScroll(),this._observer&&this._observer.disconnect(),this.clearSubViews(),this.$el.html(m()),this.$el.toggleClass("CDB-Widget-canvas--withMenu",this.model.get("renderMenu")),this._widgets.each(this._maybeRenderWidgetView,this),this.$el.toggle(!d.isEmpty(this._subviews)),this._renderScroll(),this._renderShadows(),this._bindScroll(),this._initResize(),this._observe(),this},_initResize:function(){var a=["(max-width: 1600px)","(max-width: 1280px)","(max-width: 759px)"];a.forEach(function(a){var b=n(a);b.addListener(this._resizeHandler)},this)},_observe:function(){if(null!=o){var a=this.el,b=this._updateScrollCss.bind(this);this._observer=new o(b),b();var c={childList:!0,subtree:!0};this._observer.observe(a,c)}},_updateScrollCss:function(){this._onWidgetUpdate();var a=this._container();if(a){var b=a.clientWidth,c=a.clientHeight,d=a.scrollWidth,e=a.scrollHeight,f=d>b,g=e>c;this._$container().toggleClass("hasXScroll",f),this._$container().toggleClass("hasYScroll",g)}},_$container:function(){return e(this._container())},_container:function(){return this.el.querySelector(".js-container")},_maybeRenderWidgetView:function(a){var b=this._widgetViewFactory.createWidgetView(a);b&&(this.addView(b),this._$container().append(b.render().el))},_bindScroll:function(){this._$container().on("ps-y-reach-start",d.bind(this._onScrollTop,this)).on("ps-y-reach-end",d.bind(this._onScrollBottom,this)).on("ps-scroll-y",d.bind(this._onScroll,this))},_renderScroll:function(){f.initialize(this._container(),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_onWidgetUpdate:function(){f.update(this._container())},_renderShadows:function(){this.$shadowTop=e("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--top"),this.$shadowBottom=e("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--bottom"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom)},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){var a=this._$container(),b=a.scrollTop(),c=a.get(0).scrollHeight,d=a.outerHeight(),e=c-d;this.$shadowTop.toggleClass("is-visible",b>0),this.$shadowBottom.toggleClass("is-visible",e>b)},_updateScroll:function(){this._$container().scrollLeft=0,this._$container().scrollTop=0,f.update(this._container())},_onResize:function(a){this._updateScroll(),this._onScroll(),this._updateScrollCss()},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_cleanScroll:function(){e(window).off("resize",this._resizeHandler),this._container()&&(this._$container().off("ps-scroll-y"),f.destroy(this._container()))},_onUpdate:function(){this.$el.toggle(d.size(this._subviews)>0)},clean:function(){this._cleanScroll(),this._observer&&this._observer.disconnect(),g.core.View.prototype.clean.call(this)}})},{"./dashboard-sidebar.tpl":27,"./widgets/category/content-view":41,"./widgets/formula/content-view":66,"./widgets/histogram/content-view":70,"./widgets/list/content-view":77,"./widgets/widget-view-factory":107,"cartodb.js":"cartodb.js",jquery:"jquery","perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],27:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-canvasInner js-container"></div>';return __p}},{underscore:"underscore"}],28:[function(a,b,c){var d=a("cartodb.js"),e=a("./dashboard.tpl"),f=a("./dashboard-below-map-view"),g=a("./dashboard-menu-view"),h=a("./dashboard-sidebar-view");b.exports=d.core.View.extend({className:"CDB-Dashboard-canvas",initialize:function(a){this._widgets=a.widgets,this._infoView=a.infoView,this.el.classList.add(this.className),this.$el.html(e())},render:function(){this.clearSubViews();var a,b=this.model.get("renderMenu");return b&&(a=new g({model:this.model}),this.addView(a),this.$el.append(a.render().el)),a=new f({widgets:this._widgets}),this.addView(a),this.$(".js-map-wrapper").toggleClass("CDB-Dashboard-mapWrapper--withMenu",b).append(a.render().el),a=new h({widgets:this._widgets,model:this.model}),this.addView(a),this.$el.append(a.render().el),this},getInitialMapState:function(){return{bounds:this.model.get("initialPosition").bounds}}})},{"./dashboard-below-map-view":23,"./dashboard-menu-view":24,"./dashboard-sidebar-view":26,"./dashboard.tpl":29,"cartodb.js":"cartodb.js"}],29:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Dashboard-mapWrapper js-map-wrapper"> <div class="CDB-Map-canvas"> <div class="CDB-Map" id="map"></div> </div> </div>';return __p}},{underscore:"underscore"}],30:[function(a,b,c){var d=a("underscore"),e=a("d3"),f={};f.formatNumber=function(a,b){if(!d.isNumber(a)||0===a)return a;var c=e.format(".2s"),f=0,g=Math.abs(a);if(a>1e3)return a=c(a)+(b?" "+b:"");g>100?f=0:g>10?f=1:g>1?f=2:g>0&&(f=Math.max(Math.ceil(Math.abs(Math.log(g)/Math.log(10)))+2,3)),a=a.toFixed(f);var h=a.match(/(\.0+)$/);return h&&(a=a.replace(h[0],"")),a},f.formatDate=function(a){return e.time.format("%Y-%m-%d")(a)},f.formatValue=function(a){return d.isNumber(a)?f.formatNumber(a):d.isDate(a)?f.formatDate(a):a},b.exports=f},{d3:13,underscore:"underscore"}],31:[function(a,b,c){function d(a,b){e.each(b,function(b){if(void 0===a[b])throw new Error(b+" is required")})}var e=a("underscore"),f=a("./widgets/widget-model"),g=a("./widgets/category/category-widget-model"),h=a("./widgets/histogram/histogram-widget-model"),i=a("./widgets/time-series/time-series-widget-model"),j=function(a,b){this._widgetsCollection=a,this._dataviews=b};j.prototype.get=function(a){return this._widgetsCollection.get(a)},j.prototype.getList=function(){return this._widgetsCollection.models},j.prototype.createCategoryModel=function(a,b,c,f){d(a,["title"]),a=e.extend(a,c,{hasInitialState:this._widgetsCollection.hasInitialState()});var h=this._dataviews.createCategoryModel(b,a),i=["id","title","order","collapsed","prefix","suffix","show_stats","style","hasInitialState"],j=e.pick(a,i);j.attrsNames=i;var k=new g(j,{dataviewModel:h},f);return k.setInitialState(c),this._widgetsCollection.add(k),k},j.prototype.createHistogramModel=function(a,b,c,f){d(a,["title"]);var g=e.extend(a,c,{hasInitialState:this._widgetsCollection.hasInitialState()}),i=this._dataviews.createHistogramModel(b,g),j=["id","title","order","collapsed","bins","show_stats","normalized","style","hasInitialState"],k=e.pick(a,j);k.type="histogram",k.attrsNames=j;var l=new h(k,{dataviewModel:i},f);return l.setInitialState(c),this._widgetsCollection.add(l),l},j.prototype.createFormulaModel=function(a,b,c){d(a,["title"]),a=e.extend(a,c,{hasInitialState:this._widgetsCollection.hasInitialState()});var g=this._dataviews.createFormulaModel(b,a),h=["id","title","order","collapsed","prefix","suffix","show_stats","description","hasInitialState"],i=e.pick(a,h);i.type="formula",i.attrsNames=h;var j=new f(i,{dataviewModel:g});return j.setInitialState(c),this._widgetsCollection.add(j),j},j.prototype.createListModel=function(a,b){d(a,["title","columns_title"]);var c=this._dataviews.createListModel(b,a),g=["id","title","order","columns_title","show_stats"],h=e.pick(a,g);h.type="list",h.attrsNames=g;var i=new f(h,{dataviewModel:c});return this._widgetsCollection.add(i),i},j.prototype.createTimeSeriesModel=function(a,b,c,d){a.column_type=a.column_type||"date";var f=this._dataviews.createHistogramModel(b,a),g=["id","style"],h=e.pick(a,g);h.type="time-series",h.attrsNames=g;var j=new i(h,{dataviewModel:f},d);return j.setInitialState(c),this._widgetsCollection.add(j),j},j.prototype.setWidgetsState=function(a){this._widgetsCollection.setStates(a)},b.exports=j},{"./widgets/category/category-widget-model":39,"./widgets/histogram/histogram-widget-model":74,"./widgets/time-series/time-series-widget-model":89,"./widgets/widget-model":105,underscore:"underscore"}],32:[function(a,b,c){var d=a("underscore"),e=a("d3"),f=a("cartodb.js");b.exports=f.core.View.extend({animateFromValues:function(a,b,c,f,g){var h=this.$(c),i=g||{},j=i.formatter||e.format("0,000"),k=i.templateData||{},l=i.debounceWait||500,m=b%1===0,n=function(a){a=m?Math.round(a):a;var b=d.isNaN(a)||void 0===a?i.defaultValue||0:j(a),c=d.extend({value:b},k);h.text(f(c))};if(0===i.animationSpeed)return void n(b);n(a);var o=d.debounce(function(){h.prop("counter",a).stop().animate({counter:b},{duration:i.animationSpeed||500,easing:i.easingMethod||"swing",step:n})},l);o()},animateFromCurrentValue:function(a,b,c,f){var g=this.$(b),h=f||{},i=h.debounceWait||500,j=a,k=+this.$(b).text(),l=h.formatter||e.format("0,000"),m=h.templateData||{},n=j%1===0,o=function(b){b=n?Math.round(b):b,a=d.isNaN(b)||void 0===b?h.defaultValue||0:l(b);var e=d.extend({value:a},m);g.text(c(e))};if(0===h.animationSpeed)return void o(j);o(k);var p=d.debounce(function(){g.prop("counter",k).stop().animate({counter:j},{duration:h.animationSpeed||500,easing:h.easingMethod||"swing",step:o})},i);p()},animateValue:function(a,b,c,f,g){var h=this.$(c),i=g||{},j=i.debounceWait||500,k=a.get(b),l=a.previous(b)||0,m=i.formatter||e.format("0,000"),n=i.templateData||{},o=k%1===0,p=function(a){a=o?Math.round(a):a;var b=d.isNaN(a)||void 0===a?i.defaultValue||0:m(a),c=d.extend({value:b},n);h.text(f(c))};if(0===i.animationSpeed)return void p(k);p(l);var q=d.debounce(function(){h.prop("counter",l).stop().animate({counter:k},{duration:i.animationSpeed||500,easing:i.easingMethod||"swing",step:p})},j);q()}})},{"cartodb.js":"cartodb.js",d3:13,underscore:"underscore"}],33:[function(a,b,c){var d=a("cartodb.js"),e=a("./category-colors"),f=d.core.Model.extend({initialize:function(a,b){this.options=b||{},this.styles=b&&b.auto_style,this.dataviewModel=a,this.colors=new e(this.styles),this.layer=this.dataviewModel.layer,this.STYLE_TEMPLATE="DARK"===this.options.basemap?f.STYLE_TEMPLATE_DARK:f.STYLE_TEMPLATE_LIGHT},_getLayerHeader:function(a){return"#layer [mapnik-geometry-type="+f.MAPNIK_MAPPING[a]+"]{"},getPreservedWidth:function(){
var a,b=this.layer.get&&(this.layer.get("cartocss")||this.layer.get("meta").cartocss);if(b&&(a=b.match(/marker-width:.*?;\s/g))){if(a.length>1){var c=b.match(/\[.*?[><=].*?].*?{\s*?marker\-width\:\s*?\d.*?;\s*?}/g).join("\n");return{ramp:c,fixed:a[0].trim().replace("marker-width:","").replace(";","")}}a=a[0].trim().replace("marker-width:","").replace(";","")}return a}});f.STYLE_TEMPLATE_LIGHT={polygon:["{{layername}}","  polygon-fill: {{defaultColor}};","  polygon-opacity: 0.9;  ","  polygon-gamma: 0.5;    ","  line-color: #fff;","  line-width: 0.25;","  line-opacity: 0.25;","  line-comp-op: hard-light;","  {{ramp}}","}"].join("\n"),marker:["{{layername}}","  marker-width: {{markerWidth}};","  marker-fill-opacity: 0.9;  ","  marker-fill: {{defaultColor}};  ","  marker-line-color: #fff;","  marker-allow-overlap: true;","  marker-line-width: 1;","  marker-line-opacity: 0.8;","  {{ramp}}","  {{wramp}}","}"].join("\n"),line:["{{layername}}","  line-color: {{defaultColor}};","  line-width: 0.3;","  line-opacity: 0.3;","  {{ramp}}","}"].join("\n")},f.STYLE_TEMPLATE_DARK={polygon:["{{layername}}","  polygon-fill: {{defaultColor}};","  polygon-opacity: 0.9;  ","  polygon-gamma: 0.5;    ","  line-color: #fff;","  line-width: 0.25;","  line-opacity: 0.25;","  line-comp-op: hard-light;","  {{ramp}}","}"].join("\n"),marker:["{{layername}}","  marker-width: {{markerWidth}};","  marker-fill-opacity: 0.9;  ","  marker-fill: {{defaultColor}};  ","  marker-line-color: #000;","  marker-allow-overlap: true;","  marker-line-width: 1;","  marker-line-opacity: 0.5;","  {{ramp}}","  {{wramp}}","}"].join("\n"),line:["{{layername}}","  line-color: {{defaultColor}};","  line-width: 0.3;","  line-opacity: 0.3;","  {{ramp}}","}"].join("\n")},f.MAPNIK_MAPPING={polygon:3,marker:1,line:2},b.exports=f},{"./category-colors":34,"cartodb.js":"cartodb.js"}],34:[function(a,b,c){function d(a){var b=a&&a.definition&&a.definition.color&&a.definition.color.range;return b||g}function e(a){this.updateColors(a)}var f=a("underscore"),g=["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74"];e.prototype.updateColors=function(a){var b=d(a);this.colors={},f.each(b,function(a){this.colors[a]=null},this)},e.prototype.updateData=function(a){f.each(this.colors,function(b,c){f.contains(a,b)?a=f.without(a,b):this.colors[c]=null},this),f.each(a,function(a){var b=this.getNextAvailableColor();b&&(this.colors[b]=a)},this)},e.prototype.getNextAvailableColor=function(){for(var a in this.colors)if(null===this.colors[a])return a;return null},e.prototype.getColorByCategory=function(a){for(var b in this.colors)if(this.colors[b]===a)return b;return"#A5AA99"},e.prototype.getCategoryByColor=function(a){return this.colors[a]},b.exports=e},{underscore:"underscore"}],35:[function(a,b,c){var d=a("./auto-styler"),e=a("./style-utils"),f=a("underscore");b.exports=d.extend({getStyle:function(){var a=this.layer.get("initialStyle");if(a)return["marker-fill","polygon-fill","line-color"].forEach(function(b){a=e.changeStyle(a,b,this._generateCategoryRamp(b))}.bind(this)),e.replaceWrongSpaceChar(a)},getRange:function(){return f.map(this.dataviewModel.get("data"),function(a){return this.colors.getColorByCategory(a.name)},this)},getDef:function(){var a=this.dataviewModel,b=a.get("data"),c=this.getRange(),d={};return["marker-fill","polygon-fill","line-color"].forEach(function(e){var g={},h=e.substring(0,e.indexOf("-"));g={color:{domain:f.pluck(b,"name"),range:c,attribute:a.get("column")}},d["marker"===h?"point":h]=g}),d},_generateCategoryRamp:function(a){var b=this.dataviewModel,c=b.get("data"),d=b.get("column");return a+": "+this._getCategoryRamp(c,d)},_getCategoryRamp:function(a,b){for(var c="ramp(["+b+"], ",d="",e="",f=0;f<a.length;f++){var g=a[f],h="'",i=f!==a.length-1?"', ":"'";d+=h+this.colors.getColorByCategory(g.name)+i,g.agg?"'"===i&&(e=e.substring(0,e.length-2)):e+=h+g.name.replace(/'/g,"\\'")+i}return c+"("+d+"), ("+e+"));"}})},{"./auto-styler":33,"./style-utils":38,underscore:"underscore"}],36:[function(a,b,c){var d={category:a("./category"),histogram:a("./histogram")};b.exports={get:function(a,b){var c=d[a.get("type")];if(c)return new c(a,b);throw new Error("dataview type not supported")}}},{"./category":35,"./histogram":37}],37:[function(a,b,c){var d=a("./auto-styler"),e=a("./style-utils"),f=a("cartocolor"),g=a("underscore"),h=d.extend({getStyle:function(){var a=this.layer.get("initialStyle");if(a)return["marker-fill","polygon-fill","line-color"].forEach(function(b){a=e.changeStyle(a,b,this.getColorLine(b,this.getCustomStyle()))}.bind(this)),e.replaceWrongSpaceChar(a)},getCustomStyle:function(){return this.styles&&this.styles.definition&&this.styles.definition.color},updateColors:function(a){this.styles=a.auto_style},getColorLine:function(a,b){var c=b||{};if(!b){var d=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data"));c=h.SCALES_MAP[a][d]}var e="ramp(["+this.dataviewModel.get("column")+"], ",f=b?"('"+c.range.join("', '")+"'), ":"cartocolor("+c.palette+", "+this.dataviewModel.get("bins")+"), ",g=c.quantification+");";return a+": "+e+f+g},getDef:function(a){var b={},c=this.dataviewModel.getDistributionType(this.dataviewModel.getUnfilteredDataModel().get("data")),d=this.dataviewModel.get("bins"),i=this.dataviewModel.get("column"),j=this.styles,k=this.styles&&this.styles.custom||!1;return["marker-fill","polygon-fill","line-color"].forEach(function(l){if(a.search(e.getAttrRegex(l,!1))>=0){var m=h.SCALES_MAP[l][c],n=l.substring(0,l.indexOf("-")),o={};o=k===!0?g.extend(o,j.definition):{color:{range:f[m.palette][d]||f[m.palette][Object.keys(f[m.palette]).length],quantification:m.quantification,attribute:i}},b["marker"===n?"point":n]=o}}),b}});h.SCALES_MAP={"polygon-fill":{F:{palette:"PinkYl",quantification:"quantiles"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"line-color":{F:{palette:"PinkYl",quantification:"quantiles"},L:{palette:"Emrld",quantification:"headtails"},J:{palette:"Emrld",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"Sunset",quantification:"jenks"},U:{palette:"Sunset",quantification:"jenks"}},"marker-fill":{F:{palette:"RedOr",quantification:"quantiles"},L:{palette:"BluYl",quantification:"headtails"},J:{palette:"BluYl",quantification:"headtails"},A:{palette:"Geyser",quantification:"quantiles"},C:{palette:"SunsetDark",quantification:"jenks"},U:{palette:"SunsetDark",quantification:"jenks"}}},b.exports=h},{"./auto-styler":33,"./style-utils":38,cartocolor:"cartocolor",underscore:"underscore"}],38:[function(a,b,c){function d(a,b){return new RegExp("\\s"+a+":.*?(;|\n)",b?"g":"")}function e(a){return a.replace(/[^;}{]*{((\s|\n)*?)}/g,"")}function f(a,b,c){var e=a.search(d(b,!1))>=0;return e?a.replace("{","{ "+c):a}function g(a,b){return a.replace(d(b,!0),"")}function h(a,b,c){return a.replace(c,b)}function i(a,b){return"#layer ['mapnik::geometry_type'="+m[b]+"] {  } "+a}function j(a){return a.replace(new RegExp(String.fromCharCode(160),"g")," ")}function k(a,b,c){var d="##"+b+"##;";return h(e(g(f(i(a,b),b,d),b)),c,d)}var l=a("underscore"),m={"marker-fill":1,"line-color":2,"polygon-fill":3};b.exports={changeStyle:l.memoize(k,function(a,b,c){return a+b+c}),getAttrRegex:d,replaceWrongSpaceChar:j}},{underscore:"underscore"}],39:[function(a,b,c){var d=a("underscore"),e=a("../widget-model"),f=a("./locked-categories-collection");b.exports=e.extend({defaults:d.extend({type:"category",search:!1,locked:!1},e.prototype.defaults),defaultState:d.extend({acceptedCategories:[],locked:!1,autoStyle:!1},e.prototype.defaultState),initialize:function(){e.prototype.initialize.apply(this,arguments),this.lockedCategories=new f,this.listenTo(this.dataviewModel,"change:allCategoryNames",this._onDataviewAllCategoryNamesChange),this.on("change:locked",this._onLockedChange,this),this.on("change:collapsed",this._onCollapsedChange,this),this.isAutoStyleEnabled()&&this.on("change:style",this._updateColors,this),this.dataviewModel.filter.on("change",function(){this.set("acceptedCategories",this._acceptedCategories().pluck("name"))},this),this.dataviewModel.once("change:allCategoryNames",function(){this.get("autoStyle")&&this.autoStyle()},this)},setupSearch:function(){this.dataviewModel.setupSearch(),this.lockedCategories.addItems(this._acceptedCategories().toJSON()),this.toggleSearch()},toggleSearch:function(){this.set("search",!this.get("search"))},enableSearch:function(){this.set("search",!0)},disableSearch:function(){this.set("search",!1)},isSearchEnabled:function(){return this.get("search")},cleanSearch:function(){this.dataviewModel.cleanSearch(),this.lockedCategories.reset([])},autoStyle:function(){this.autoStyler.colors.updateData(this.dataviewModel.get("allCategoryNames")),e.prototype.autoStyle.call(this)},_updateColors:function(a,b){this.autoStyler.colors.updateColors(b.auto_style),this.autoStyler.colors.updateData(d.pluck(this.dataviewModel.get("data"),"name")),this.isAutoStyle()&&this.reapplyAutoStyle()},isLocked:function(){return this.get("locked")},canBeLocked:function(){return this.isLocked()||this._acceptedCategories().size()>0},canApplyLocked:function(){return this._acceptedCategories().size()!==this.lockedCategories.size()?!0:this._acceptedCategories().any(function(a){return!this.lockedCategories.isItemLocked(a.get("name"))},this)},applyLocked:function(){var a=this.lockedCategories.getItemsName();if(!a.length)return this.unlockCategories(),!1;this.set("locked",!0);var b=this.dataviewModel.filter;b.cleanFilter(!1),b.accept(a),b.applyFilter(),this.cleanSearch()},lockCategories:function(){this.set("locked",!0),this.dataviewModel.fetch()},unlockCategories:function(){this.set("locked",!1),this.dataviewModel.filter.acceptAll()},_onDataviewAllCategoryNamesChange:function(a,b){this.isAutoStyleEnabled()&&(this.isAutoStyle()||this.autoStyler.colors.updateData(b))},_onLockedChange:function(a,b){b?this.dataviewModel.enableFilter():this.dataviewModel.disableFilter()},_acceptedCategories:function(){return this.dataviewModel.filter.acceptedCategories},_onCollapsedChange:function(a,b){this.dataviewModel.set("enabled",!b)}})},{"../widget-model":105,"./locked-categories-collection":51,underscore:"underscore"}],40:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header js-header"></div> <div class="CDB-Widget-content CDB-Widget-content--noSidesMargin"> <div class="CDB-Widget-listWrapper js-content"></div> </div> <div class="CDB-Widget-footer js-footer"></div>';return __p}},{underscore:"underscore"}],41:[function(a,b,c){var d=a("cartodb.js"),e=a("./title/search-title-view"),f=a("./options/options-view"),g=a("./list/items-view"),h=a("./stats/stats-view"),i=a("./paginator/paginator-view"),j=a("./list/search-items-view"),k=a("./paginator/search-paginator-view"),l=a("./content-template.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-body",_ITEMS_PER_PAGE:6,initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(l()),this._initViews(),this},_initBinds:function(){this.model.get("hasInitialState")===!0?this._onInitialState():this.model.bind("change:hasInitialState",this._onInitialState,this),this.model.bind("change:collapsed",function(a,b){this.$el.toggleClass("is-collapsed",!!b)},this)},_onInitialState:function(){this.render(),this.model.get("autoStyle")===!0&&this.model.autoStyle()},_initViews:function(){var a=new e({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(a.render().el),this.addView(a);var b=new h({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(b.render().el),this.addView(b);var c=new f({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-content").html(c.render().el),this.addView(c);var d=new g({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE});this.$(".js-content").append(d.render().el),this.addView(d);var l=new i({$target:d.$el,widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE});this.$(".js-footer").append(l.render().el),this.addView(l);var m=new j({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0});this.$(".js-content").append(m.render().el),this.addView(m);var n=new k({$target:m.$el,widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0});this.$(".js-footer").append(n.render().el),this.addView(n)}})},{"./content-template.tpl":40,"./list/items-view":48,"./list/search-items-view":50,"./options/options-view":53,"./paginator/paginator-view":55,"./paginator/search-paginator-view":57,"./stats/stats-view":60,"./title/search-title-view":62,"cartodb.js":"cartodb.js"}],42:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton js-button '+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"> <div class="CDB-Widget-contentSpaced"> <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+(null==(__t=value)?"":_.escape(__t))+'">'+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=formattedValue)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+'</p> </div> <div class="CDB-Widget-progressBar"> <div class="CDB-Widget-progressState '+(null==(__t=isAggregated?"CDB-Widget-progressState--pattern":"")?"":_.escape(__t))+" "+(null==(__t=isAccepted?"is-accepted":"")?"":_.escape(__t))+'" style="width: '+(null==(__t=percentage)?"":_.escape(__t))+"%; background-color: "+(null==(__t=color)?"":_.escape(__t))+'"></div> </div> </button>';return __p}},{underscore:"underscore"}],43:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-listItemInner '+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"> <div class="CDB-Widget-contentSpaced"> <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+(null==(__t=value)?"":_.escape(__t))+'">'+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=formattedValue)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+'</p> </div> <div class="CDB-Widget-progressBar"> <div class="CDB-Widget-progressState CDB-Widget-progressState--pattern '+(null==(__t=isAggregated?"CDB-Widget-progressState--inactive":"")?"":_.escape(__t))+'" style="width: '+(null==(__t=percentage)?"":_.escape(__t))+"%; background-color: "+(null==(__t=color)?"":_.escape(__t))+'"></div> </div> </div>';return __p}},{underscore:"underscore"}],44:[function(a,b,c){var d=a("cartodb.js"),e=a("../../../../formatter"),f=a("underscore"),g=a("./item-clickable-template.tpl"),h=a("./item-unclickable-template.tpl");b.exports=d.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(a){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var a=this.model.get("name"),b=this.model.get("value"),c=this.model.get("agg")||this.widgetModel.isLocked()?h:g,d=this.dataviewModel.filter.getAcceptedCategoryNames(),i=f.contains(d,a);return this.$el.html(c({isAggregated:this.model.get("agg"),name:a,value:b,formattedValue:e.formatNumber(b),percentage:b/this.dataviewModel.get("max")*100,color:this.widgetModel.getColor(a),isDisabled:this.model.get("selected")?"":"is-disabled",isAccepted:i,prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change",this.render,this),this.widgetModel.bind("change:search change:prefix change:suffix change:autoStyle",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},{"../../../../formatter":30,"./item-clickable-template.tpl":42,"./item-unclickable-template.tpl":43,"cartodb.js":"cartodb.js",underscore:"underscore"}],45:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listItemInner--fullSpace CDB-Widget-listButton js-button '+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"> <span class="CDB-Widget-checkbox '+(null==(__t=isDisabled?"":"is-checked")?"":_.escape(__t))+'"></span> <div class="u-lSpace u-ellipsis"> <div class="CDB-Widget-contentSpaced"> <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+(null==(__t=value)?"":_.escape(__t))+'">'+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=formattedValue)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+'</p> </div> <div class="CDB-Widget-progressBar"> <div class="CDB-Widget-progressState is-accepted" style="width: '+(null==(__t=percentage)?"":_.escape(__t))+'%"></div> </div> </div> </button>';return __p}},{underscore:"underscore"}],46:[function(a,b,c){var d=a("cartodb.js"),e=a("../../../../formatter"),f=a("./search-item-clickable-template.tpl");b.exports=d.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(a){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var a=this.model.get("value");return this.$el.html(f({name:this.model.get("name"),value:a,formattedValue:e.formatNumber(a),percentage:a/this.dataviewModel.get("max")*100,isDisabled:!this.model.get("selected"),prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change:selected",this.render,this),this.widgetModel.bind("change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.model.set("selected",!this.model.get("selected"))}})},{"../../../../formatter":30,"./search-item-clickable-template.tpl":45,"cartodb.js":"cartodb.js"}],47:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>';return __p}},{underscore:"underscore"}],48:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js"),g=a("./item/item-view"),h=a("./items-placeholder-template.tpl");b.exports=f.core.View.extend({options:{paginator:!1,itemsPerPage:6},className:"CDB-Widget-list CDB-Widget-list--wrapped js-list",tagName:"ul",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this.dataviewModel.get("sync_on_bbox_change")||this.$el.addClass("CDB-Widget-list--nodynamic"),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var a=this.dataviewModel.getData(),b=e.isEmpty(a)||0===e.size(a);return b?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){this.widgetModel.bind("change:search",this.toggle,this),this.widgetModel.bind("change:autoStyle",this.render,this),this.widgetModel.bind("change:style",this.render,this),this.add_related_model(this.widgetModel),this.dataviewModel.bind("change:data",this.render,this),this.dataviewModel.bind("change:sync_on_bbox_change",this.blockFiltering,this),this.add_related_model(this.dataviewModel)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--withBorders").removeClass("CDB-Widget-list--wrapped"),this.$el.append(h())},_renderList:function(){this.$el.removeClass("CDB-Widget-list--withBorders"),this.$el[this.options.paginator?"addClass":"removeClass"]("CDB-Widget-list--wrapped");var a,b=this.dataviewModel.getData();b.each(function(b,c){c%this.options.itemsPerPage===0&&(a=d("<div>").addClass("CDB-Widget-listGroup"),this.$el.append(a)),this._addItem(b,a)},this)},_addItem:function(a,b){var c=new g({model:a,widgetModel:this.widgetModel,dataviewModel:this.dataviewModel});c.bind("itemClicked",this._setFilters,this),this.addView(c),b.append(c.render().el)},_setFilters:function(a){if(!this.dataviewModel.get("sync_on_bbox_change"))return this;var b=a.get("selected"),c=this.dataviewModel.filter,d=a.get("name");if(b)if(0===c.rejectedCategories.size()&&0===c.acceptedCategories.size()){var e=this.dataviewModel.getData();e.each(function(a){var b=a.get("name");b!==d&&a.set("selected",!1)}),c.accept(a.get("name"))}else a.set("selected",!1),c.reject(d);else a.set("selected",!0),c.accept(d);this.widgetModel.set("acceptedCategories",this.widgetModel._acceptedCategories().pluck("name"))},blockFiltering:function(a){a.changed.sync_on_bbox_change?this.$el.removeClass("CDB-Widget-list--nodynamic"):(this.$el.addClass("CDB-Widget-list--nodynamic"),this.dataviewModel.filter.acceptAll())},removeSelections:function(){this.dataviewModel.filter.acceptAll()},toggle:function(){this[this.widgetModel.isSearchEnabled()?"hide":"show"]()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},{"./item/item-view":44,"./items-placeholder-template.tpl":47,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],49:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="CDB-Widget-listItem"> <h4 class="CDB-Text CDB-Size-large">No results</h4> <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Your search "'+(null==(__t=q)?"":_.escape(__t))+'" didn\'t match<br>with any value.</p> <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Try searching again.</p> </li>';return __p}},{underscore:"underscore"}],50:[function(a,b,c){var d=a("jquery"),e=a("./items-view"),f=a("./item/search-item-view"),g=a("./search-items-no-results-template.tpl");b.exports=e.extend({className:"CDB-Widget-list is-hidden CDB-Widget-list--wrapped js-list",render:function(){this.clearSubViews(),this.$el.empty();var a=this._searchResultsCollection,b=a.isEmpty()||0===a.size();return b?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){e.prototype._initBinds.apply(this,arguments),this._searchResultsCollection=this.dataviewModel.getSearchResult(),this._searchResultsCollection.on("change:selected",this._onSelectedItemChange,this),this._searchResultsCollection.on("reset",this.render,this),this.add_related_model(this._searchResultsCollection)},_renderList:function(){this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--noresults"),this.$el.addClass("CDB-Widget-list--wrapped");var a,b=this._searchResultsCollection;b.each(function(b,c){c%this.options.itemsPerPage===0&&(a=d("<div>").addClass("CDB-Widget-listGroup"),this.$el.append(a)),this._addItem(b,a)},this)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--noresults").removeClass("CDB-Widget-list--wrapped"),this.$el.html(g({q:this.dataviewModel.getSearchQuery()}))},_addItem:function(a,b){var c=new f({model:a,widgetModel:this.widgetModel,dataviewModel:this.dataviewModel});this.addView(c),b.append(c.render().el)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"show":"hide"]()},_onSelectedItemChange:function(a,b){this.widgetModel.lockedCategories[b?"addItem":"removeItem"](a)}})},{"./item/search-item-view":46,"./items-view":48,"./search-items-no-results-template.tpl":49,jquery:"jquery"}],51:[function(a,b,c){var d=a("underscore"),e=a("backbone");b.exports=e.Collection.extend({addItem:function(a){this.isItemLocked(a.get("name"))||this.add(a)},addItems:function(a){d.each(a,function(a){this.isItemLocked(a.name)||this.add(a)},this)},resetItems:function(a){this.reset(a)},removeItem:function(a){var b=this.isItemLocked(a.get("name"));b&&this.remove(b)},removeItems:function(){this.reset([])},isItemLocked:function(a){return this.find(function(b){return b.get("name")===a})},getItemsName:function(){return this.pluck("name")}})},{backbone:"backbone",underscore:"underscore"}],52:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isSearchEnabled?__p+=' <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-lockCategories">'+(null==(__t=totalLocked)?"":_.escape(__t))+" selected</p> ":(__p+=' <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-textInfo"> ',isLocked?__p+=" "+(null==(__t=totalCats)?"":_.escape(__t))+' blocked <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-unlock">unlock</button> ':(__p+=" ",noneSelected?__p+=" None selected ":(__p+=" "+(null==(__t=allSelected?"All selected":acceptedCats+" selected")?"":_.escape(__t))+" ",canBeLocked&&(__p+=' <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-lock">lock</button> '),__p+=" "),__p+=" "),__p+=" </p> ",canSelectAll&&(__p+=' <div class="CDB-Widget-filterButtons"> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link CDB-Widget-filterButton js-all">all</button> </div> '),__p+=" "),__p+="";return __p}},{underscore:"underscore"}],53:[function(a,b,c){var d=a("cartodb.js"),e=a("./options-template.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-filter CDB-Widget-contentSpaced CDB-Widget-contentSpaced--sideMargins",events:{"click .js-all":"_onSelectAll","click .js-lock":"_lockCategories","click .js-unlock":"_unlockCategories"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var a=this.dataviewModel.filter.acceptedCategories.size(),b=this.dataviewModel.filter.rejectedCategories.size(),c=this.dataviewModel.filter.areAllRejected(),d=this.dataviewModel.getData().size(),f=this.widgetModel.isLocked();return this.$el.html(e({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:f,canBeLocked:this.widgetModel.canBeLocked(),allSelected:0===b&&0===a&&!c,canSelectAll:!f&&(b>0||a>0||c),noneSelected:c||!d&&!a,acceptedCats:a,totalLocked:this.widgetModel.lockedCategories.size(),totalCats:d})),this},_initBinds:function(){this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel);var a=this.dataviewModel.filter;a.acceptedCategories.bind("add remove reset",this.render,this),a.rejectedCategories.bind("add remove reset",this.render,this),this.add_related_model(a.rejectedCategories),this.add_related_model(a.acceptedCategories)},_lockCategories:function(){this.widgetModel.lockCategories()},_unlockCategories:function(){this.widgetModel.unlockCategories()},_onSelectAll:function(){this.dataviewModel.filter.acceptAll()}})},{"./options-template.tpl":52,"cartodb.js":"cartodb.js"}],54:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+='<div class="CDB-Widget-contentFlex"> <button class="u-rSpace--m CDB-Text is-semibold u-upperCase CDB-Size-small js-searchToggle"> <div class="CDB-Shape u-iBlock"> <span class="CDB-Shape-magnify is-small is-blue"></span> </div> <span class="u-iBlock u-actionTextColor"> search in '+(null==(__t=categoriesCount)?"":_.escape(__t))+" categor"+(null==(__t=1===categoriesCount?"y":"ies")?"":_.escape(__t))+" </span> </button> </div> ",showPaginator){__p+=' <div class="CDB-Widget-navDots js-dots"> ';for(var i=0,l=pages;l>i;i++)__p+='<button class="CDB-Shape-dot CDB-Widget-dot--navigation js-page ',currentPage===i&&(__p+="is-selected"),__p+='" data-page="'+(null==(__t=i)?"":_.escape(__t))+'"></button>';__p+=" </div> "}__p+=""}return __p}},{underscore:"underscore"}],55:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js"),g=a("./paginator-template.tpl"),h=5;b.exports=f.core.View.extend({options:{itemsPerPage:6,template:g,paginator:!1},className:"CDB-Widget-nav CDB-Widget-contentSpaced",events:{"click .js-searchToggle":"_onSearchClicked","click .js-page":"_onDotClick"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._$target=this.options.$target,this.model=new f.core.Model({page:0}),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var a=this.dataviewModel.getCount();if(a>h){var b=Math.ceil(this.dataviewModel.getSize()/this.options.itemsPerPage),c=this.options.template;this.$el.html(c({showPaginator:this.options.paginator,currentPage:this.model.get("page"),categoriesCount:a,pages:b}))}else this.model.set("page",0);return this._scrollToPage(),this},_initBinds:function(){d(window).bind("resize."+this.cid,e.bind(this._scrollToPage,this)),this.model.bind("change:page",this.render,this),this.dataviewModel.bind("change:categoriesCount",this.render,this),this.dataviewModel.bind("change:data change:searchData",function(){this._setPage(),this.render()},this),this.widgetModel.bind("change:search",this.toggle,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_setPage:function(){var a=this.dataviewModel.getSize(),b=Math.ceil(a/this._ITEMS_PER_PAGE);this.model.get("page")>b-1&&this.model.set({page:0},{silent:!0})},_onSearchClicked:function(){this.widgetModel.setupSearch()},_scrollToPage:function(){var a=this.model.get("page"),b=this._$target.find(".CDB-Widget-listGroup:eq(0)").outerWidth();this._$target.css("margin-left",-(a*b))},_onDotClick:function(a){var b=d(a.target).data("page");this.model.set("page",b)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"hide":"show"]()},hide:function(){this.$el.addClass("is-hidden")},show:function(){this.$el.removeClass("is-hidden")},clean:function(){d(window).unbind("resize."+this.cid),f.core.View.prototype.clean.call(this)}})},{"./paginator-template.tpl":54,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],56:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+='<div class="CDB-Widget-contentFlex"> <button class="CDB-Text is-semibold u-upperCase CDB-Size-small u-rSpace--m js-searchToggle u-actionTextColor">cancel</button> </div> ',showPaginator){__p+=' <div class="CDB-Widget-navDots js-dots u-tSpace--m"> ';for(var i=0,l=pages;l>i;i++)__p+='<button class="CDB-Shape-dot CDB-Widget-dot--navigation js-page ',currentPage===i&&(__p+="is-selected"),__p+='" data-page="'+(null==(__t=i)?"":_.escape(__t))+'"></button>';__p+=" </div> "}__p+=""}return __p}},{underscore:"underscore"}],57:[function(a,b,c){var d=a("./paginator-view"),e=a("./search-paginator-template.tpl");b.exports=d.extend({className:"CDB-Widget-nav is-hidden CDB-Widget-contentSpaced",
render:function(){this.clearSubViews(),this.$el.empty();var a=Math.ceil(this.dataviewModel.getSearchCount()/this.options.itemsPerPage);return this.$el.html(e({showPaginator:a>1,currentPage:this.model.get("page"),pages:a})),this._scrollToPage(),this},_setPage:function(){var a=this.dataviewModel.getSearchCount(),b=Math.ceil(a/this._ITEMS_PER_PAGE);this.model.get("page")>b-1&&this.model.set({page:0},{silent:!0})},toggle:function(){this[this.widgetModel.isSearchEnabled()?"show":"hide"]()},_onSearchClicked:function(){this.widgetModel.cleanSearch(),this.widgetModel.toggleSearch()}})},{"./paginator-view":55,"./search-paginator-template.tpl":56}],58:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+=""+(null==(__t=value)?"":_.escape(__t));return __p}},{underscore:"underscore"}],59:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isSearchEnabled?(__p+=" ",__p+=isSearchApplied?' <dt class="CDB-Widget-infoCount">'+(null==(__t=resultsCount)?"":_.escape(__t))+'</dt><dd class="CDB-Widget-infoDescription">found</dd> ':" &nbsp; ",__p+="  "):__p+=' <dt class="CDB-Widget-infoCount">'+(null==(__t=nullsPer)?"":_.escape(__t))+'%</dt><dd class="CDB-Widget-infoDescription"> null rows</dd> <dt class="CDB-Widget-infoCount"><span class="js-cats">'+(null==(__t=catsPer)?"":_.escape(__t))+'</span>%</dt><dd class="CDB-Widget-infoDescription">of total</dd> ',__p+="";return __p}},{underscore:"underscore"}],60:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("../../../formatter"),g=a("./stats-template.tpl"),h=a("./cats-template.tpl"),i=a("../../animate-values");b.exports=e.core.View.extend({className:"CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace",tagName:"dl",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){this.$el.html(g({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:this.widgetModel.isLocked(),isOtherAvailable:this.dataviewModel.isOtherAvailable(),resultsCount:this.dataviewModel.getSearchCount(),totalCats:this._getCategoriesSize(),nullsPer:this._getNullPercentage(),catsPer:this._getCurrentCategoriesPercentage()}));var a=new i({el:this.$el});return a.animateFromValues(this._getPreviousCategoriesPercentage(),this._getCurrentCategoriesPercentage(),".js-cats",h,{defaultValue:"-",animationSpeed:700,formatter:f.formatValue}),this._checkVisibility(),this},_initBinds:function(){this.dataviewModel.bind("change:data change:totalCount",this.render,this),this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.bind("change:show_stats",this._checkVisibility,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_getNullPercentage:function(){var a=this.dataviewModel.get("nulls"),b=this.dataviewModel.get("totalCount")||0;return a?(a/b*100).toFixed(2):0},_getPreviousCategoriesPercentage:function(){var a=this.dataviewModel.previous("totalCount")||0,b=this.dataviewModel.getPreviousData();return this._getCategoriesPercentage(b,a)},_getCurrentCategoriesPercentage:function(){var a=this.dataviewModel.get("totalCount")||0,b=this.dataviewModel.getData().toJSON();return this._getCategoriesPercentage(b,a)},_getCategoriesPercentage:function(a,b){if(!b)return 0;var c=a.reduce(function(a,b){return b.agg?a:a+parseFloat(b.value)},0);return c?(c/b*100).toFixed(2):0},_getCategoriesSize:function(){return d.pluck(this.dataviewModel.getData().reject(function(a){return a.get("agg")}),"name").length},_checkVisibility:function(){this.$el.toggle(!!this.widgetModel.get("show_stats"))}})},{"../../../formatter":30,"../../animate-values":32,"./cats-template.tpl":58,"./stats-template.tpl":59,"cartodb.js":"cartodb.js",underscore:"underscore"}],61:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isSearchEnabled?(__p+=' <form class="CDB-Widget-search js-form"> <div class="CDB-Shape CDB-Widget-searchLens u-iBlock u-rSpace js-searchIcon"> <span class="CDB-Shape-magnify is-small is-blue"></span> </div> <input type="text" class="CDB-Text CDB-Size-large CDB-Widget-textInput CDB-Widget-searchTextInput js-textInput" value="'+(null==(__t=q)?"":_.escape(__t))+'" placeholder="Search by '+(null==(__t=columnName)?"":_.escape(__t))+'"> ',canShowApply&&(__p+=' <button type="button" class="CDB-Text is-semibold u-upperCase CDB-Size-small CDB-Widget-searchApply js-applyLocked u-actionTextColor">apply</button> '),__p+=" </form> "):(__p+=' <div class="CDB-Widget-title CDB-Widget-contentSpaced js-title"> <h3 class="CDB-Text CDB-Size-large u-ellipsis js-titleText" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h3> <div class="CDB-Widget-options CDB-Widget-contentSpaced"> ',isAutoStyleEnabled&&(__p+=' <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-colors '+(null==(__t=isAutoStyle?"is-selected":"")?"":_.escape(__t))+" "+(null==(__t=isAutoStyle?"js-cancelAutoStyle":"js-autoStyle")?"":_.escape(__t))+' " data-tooltip=" '+(null==(__t=isAutoStyle?"Remove auto style":"Auto style")?"":_.escape(__t))+' "> <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i> </button> '),__p+=' <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace"> <div class="CDB-Shape-threePoints is-blue is-small"> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> </div> </button> </div> </div> '),__p+="";return __p}},{underscore:"underscore"}],62:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cartodb.js"),g=a("../../dropdown/widget-dropdown-view"),h=a("../../widget-tooltip-view"),i=a("./search-title-template.tpl");b.exports=f.core.View.extend({events:{"keyup .js-textInput":"_onKeyupInput","submit .js-form":"_onSubmitForm","click .js-applyLocked":"_applyLocked","click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(){this.model=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(i({isCollapsed:this.model.get("collapsed"),isAutoStyleEnabled:this.model.isAutoStyleEnabled(),isAutoStyle:this.model.isAutoStyle(),title:this.model.get("title"),columnName:this.dataviewModel.get("column"),q:this.dataviewModel.getSearchQuery(),isLocked:this.model.isLocked(),canBeLocked:this.model.canBeLocked(),isSearchEnabled:this.model.isSearchEnabled(),canShowApply:this.model.canApplyLocked()})),this._initViews(),this},_initBinds:function(){this.model.bind("change:search",this._onSearchToggled,this),this.model.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.model.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.model.lockedCategories),this.dataviewModel.filter.bind("change",this.render,this),this.add_related_model(this.dataviewModel.filter)},_initViews:function(){var a=new g({model:this.model,target:".js-actions",container:this.$el});this.addView(a);var b=new h({target:this.$(".js-colors")});e("body").append(b.render().el),this.addView(b)},_onSearchToggled:function(){var a=this.model.isSearchEnabled();this[a?"_bindESC":"_unbindESC"](),this.render(),a&&this._focusOnInput()},_onSubmitForm:function(a){a&&a.preventDefault();var b=this.$(".js-textInput").val();this.dataviewModel.getSearchQuery()!==b&&(this.dataviewModel.setSearchQuery(b),this.dataviewModel.isSearchValid()&&this.dataviewModel.applySearch())},_focusOnInput:function(){var a=this;setTimeout(function(){a.$(".js-textInput").focus()},0)},_onKeyupInput:d.debounce(function(a){var b=this.$(".js-textInput").val();13!==a.keyCode&&27!==a.keyCode&&""!==b&&this._onSubmitForm()},250),_bindESC:function(){e(document).bind("keyup."+this.cid,d.bind(this._onKeyUp,this))},_unbindESC:function(){e(document).unbind("keyup."+this.cid)},_onKeyUp:function(a){return 27===a.keyCode?(this._cancelSearch(),!1):void 0},_applyLocked:function(){this.model.toggleSearch(),this.model.applyLocked()},_autoStyle:function(){this.model.autoStyle()},_cancelAutoStyle:function(){this.model.cancelAutoStyle()},_cancelSearch:function(){this.model.cleanSearch(),this.model.disableSearch()},clean:function(){this._unbindESC(),f.core.View.prototype.clean.call(this)}})},{"../../dropdown/widget-dropdown-view":64,"../../widget-tooltip-view":106,"./search-title-template.tpl":61,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],63:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<ul class="CDB-Dropdown-list CDB-Text CDB-Size-medium"> <li class="CDB-Dropdown-item"> <button class="CDB-Dropdown-link js-toggleCollapsed"> Toggle widget <div class="CDB-Dropdown-toggle"> ',__p+=collapsed?' <input class="CDB-Toggle js-inputCollapsed" checked="checked" type="checkbox" name="collapsed"> ':' <input class="CDB-Toggle js-inputCollapsed" type="checkbox" name="collapsed"> ',__p+=' <span class="u-iBlock CDB-ToggleFace"></span> </div> </button> </li> ',flags.normalizeHistogram&&(__p+=' <li class="CDB-Dropdown-item"> <button class="CDB-Dropdown-link js-toggleNormalized"> Show totals <div class="CDB-Dropdown-toggle"> ',__p+=normalized?' <input class="CDB-Toggle u-iBlock js-inputNormalized" type="checkbox" name="normalized"> ':' <input class="CDB-Toggle u-iBlock js-inputNormalized" checked="checked" type="checkbox" name="normalized"> ',__p+=' <span class="u-iBlock CDB-ToggleFace"></span> </div> </button> </li> '),__p+=" ",show_options&&(__p+=' <li class="CDB-Dropdown-item"> <button type="button" class="CDB-Dropdown-link u-ellipsis u-actionTextColor js-editWidget" title="Edit">Edit</button> </li> <li class="CDB-Dropdown-item"> <button type="button" class="CDB-Dropdown-link u-ellipsis u-errorTextColor js-removeWidget" title="Delete...">Delete...</button> </li> '),__p+=" </ul>";return __p}},{underscore:"underscore"}],64:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js"),g=a("./template.tpl");b.exports=f.core.View.extend({_WIDGET_BOTTOM_PADDING:20,className:"CDB-Dropdown",events:{"click .js-toggleNormalized":"_toggleNormalized","click .js-toggleCollapsed":"_toggleCollapsed","click .js-removeWidget":"_removeWidget","click .js-editWidget":"_editWidget"},initialize:function(a){if(!a.target)throw new Error("target is not defined");this._target=this.options.target,this._$container=this.options.container,this._initBinds()},render:function(){return this.$el.html(g(e.defaults({},this.model.attributes,{flags:this.options.flags||{}},{normalized:!1,collapsed:!1,show_options:!1}))),this},_initBinds:function(){this.add_related_model(this.model),this.model.bind("change:widget_dropdown_open",this._onChangeOpen,this),this._$container.delegate(this._target,"click",e.bind(this._toggleClick,this))},_removeWidget:function(){this.model.trigger("removeWidget",this.model)},_editWidget:function(){this.model.trigger("editWidget",this.model)},_bindGlobalClick:function(){d(document).bind("click."+this.cid,e.bind(this._onGlobalClick,this))},_unbindGlobalClick:function(){d(document).unbind("click."+this.cid)},_bindESC:function(){d(document).bind("keyup."+this.cid,e.bind(this._onKeyUp,this))},_unbindESC:function(){d(document).unbind("keyup."+this.cid)},_onGlobalClick:function(a){var b=this._$container.find(this._target);b.get(0)!==d(a.target).closest(b).get(0)&&this.model.set("widget_dropdown_open",!1)},_onKeyUp:function(a){return 27===a.keyCode?(this.model.set("widget_dropdown_open",!1),!1):void 0},_onChangeOpen:function(){this.model.get("widget_dropdown_open")?this._open():this._close()},_toggleCollapsed:function(){var a=!this.model.get("collapsed");this.model.set("collapsed",a)},_toggleNormalized:function(){var a=!this.model.get("normalized");this.model.set("normalized",a)},_open:function(){this._bindESC(),this._bindGlobalClick(),this.render(),this._$container.append(this.$el),this.$el.show(),this._adjustVerticalPosition()},_adjustVerticalPosition:function(){var a=d("body").height(),b=this.$el.offset().top+this.$el.height();this.$el.toggleClass("has-top-position",b+this._WIDGET_BOTTOM_PADDING>a)},_close:function(){this._unbindESC(),this._unbindGlobalClick(),this.$el.hide()},_toggleClick:function(){this.model.set("widget_dropdown_open",!this.model.get("widget_dropdown_open"))},clean:function(){this.model.set("widget_dropdown_open",!1),this._unbindESC(),this._unbindGlobalClick(),this._$container.undelegate(this._target,"click"),f.core.View.prototype.clean.call(this)}})},{"./template.tpl":63,"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],65:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+=""+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=value)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t));return __p}},{underscore:"underscore"}],66:[function(a,b,c){var d=a("underscore"),e=a("d3"),f=a("cartodb.js"),g=a("../../formatter"),h=a("./template.tpl"),i=a("../dropdown/widget-dropdown-view"),j=a("./animation-template.tpl"),k=a("../animate-values.js");b.exports=f.core.View.extend({className:"CDB-Widget-body",initialize:function(){this._dataviewModel=this.model.dataviewModel,this.model.get("hasInitialState")===!0?this._initBinds():this.model.once("change:hasInitialState",this._onInitialState,this)},_onInitialState:function(){this._initBinds(),this.render()},render:function(){this.clearSubViews();var a=this._dataviewModel.get("data"),b=function(a){var b=e.format("0,000");return d.isNumber(a)?b(a.toFixed(2)):0},c=!d.isUndefined(this._dataviewModel.get("nulls"))&&g.formatNumber(this._dataviewModel.get("nulls"))||"-",f=this.model.get("collapsed"),i=this.model.get("prefix"),l=this.model.get("suffix");this.$el.html(h({title:this.model.get("title"),showStats:this.model.get("show_stats"),operation:this._dataviewModel.get("operation"),value:a,formatedValue:b(a),description:this.model.get("description"),nulls:c,prefix:i,suffix:l,isCollapsed:f}));var m=new k({el:this.$el});return m.animateValue(this._dataviewModel,"data",".js-value",j,{animationSpeed:700,formatter:b,templateData:{prefix:i,suffix:l}}),this.$el.toggleClass("is-collapsed",!!f),this._initViews(),this},_initBinds:function(){this.model.bind("change:title change:description change:collapsed change:prefix change:suffix",this.render,this),this._dataviewModel.bind("change:data",this.render,this),this.add_related_model(this._dataviewModel)},_initViews:function(){var a=new i({model:this.model,target:".js-actions",container:this.$(".js-header")});this.addView(a)}})},{"../../formatter":30,"../animate-values.js":32,"../dropdown/widget-dropdown-view":64,"./animation-template.tpl":65,"./template.tpl":67,"cartodb.js":"cartodb.js",d3:13,underscore:"underscore"}],67:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header js-header"> <div class="CDB-Widget-title CDB-Widget-contentSpaced"> <h3 class="CDB-Text CDB-Size-large u-ellipsis '+(null==(__t=isCollapsed?"js-value is-collapsed":"js-title")?"":_.escape(__t))+'">',__p+=isCollapsed?""+(null==(__t=formatedValue)?"":_.escape(__t)):" "+(null==(__t=title)?"":_.escape(__t)),__p+='</h3> <div class="CDB-Widget-options"> <button class="CDB-Shape CDB-Widget-actions js-actions"> <div class="CDB-Shape-threePoints is-blue is-small"> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> </div> </button> </div> </div> ',showStats&&(__p+=' <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace"> <dt class="CDB-Widget-infoCount">'+(null==(__t=nulls)?"":_.escape(__t))+'</dt><dd class="CDB-Widget-infoDescription">null rows</dd> </dl> '),__p+=' </div> <div class="CDB-Widget-content CDB-Widget-content--formula"> ',_.isNumber(value)?(__p+=' <h4 class="CDB-Text CDB-Size-huge '+(null==(__t=isCollapsed?"":"js-value")?"":_.escape(__t))+'" title="'+(null==(__t=value)?"":_.escape(__t))+'"> '+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=value)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+" </h4> ",description&&(__p+=' <p class="CDB-Text CDB-Size-small u-tSpace js-description">'+(null==(__t=description)?"":_.escape(__t))+"</p> "),__p+=" "):__p+=' <div class="CDB-Widget-listItem--fake"></div> ',__p+=" </div>";return __p}},{underscore:"underscore"}],68:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+=""+(null==(__t=value)?"":_.escape(__t))+" "+(null==(__t=suffix)?"":_.escape(__t));return __p}},{underscore:"underscore"}],69:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("d3"),g=a("d3-interpolate"),h=a("cartodb.js"),i=a("tinycolor2"),j=a("../../formatter"),k="#1181FB",l="rgba(0, 0, 0, 0.06)";b.exports=h.core.View.extend({options:{showOnWidthChange:!0,chartBarColor:"#F2CC8F",labelsMargin:16,hasAxisTip:!1,minimumBarHeight:2,animationSpeed:750,handleWidth:6,handleHeight:23,handleRadius:3,divisionWidth:80,animationBarDelay:function(a,b){return Math.random()*(100+10*b)},transitionType:"elastic"},initialize:function(){if(this._originalData=this.options.originalData,!e.isNumber(this.options.height))throw new Error("height is required");e.bindAll(this,"_selectBars","_adjustBrushHandles","_onBrushMove","_onBrushStart","_onMouseMove","_onMouseOut"),this._onWindowResize=e.debounce(this._resizeToParentElement.bind(this),50),d(window).bind("resize",this._onWindowResize),this.setElement(d('<svg class=""></svg>')[0]),this._widgetModel=this.options.widgetModel,this.canvas=f.select(this.el).attr("width",0).attr("height",this.options.height),this.canvas.append("g").attr("class","CDB-WidgetCanvas"),this._setupModel(),this._setupBindings(),this._setupDimensions(),this._setupD3Bindings(),this._setupFillColor(),this.hide()},render:function(){return this._generateChart(),this._generateChartContent(),this},replaceData:function(a){this.model.set({data:a})},toggleLabels:function(a){this.model.set("showLabels",a)},chartWidth:function(){var a=this.model.get("margin");return Math.max(0,this.model.get("width")-a.left-a.right)},chartHeight:function(){var a=this.model.get("margin"),b=this.model.get("showLabels")?this.options.labelsMargin:0;return this.model.get("height")-a.top-a.bottom-b},_resizeToParentElement:function(){if(this.$el.parent()){var a=this.isHidden();this.hide();var b=this.$el.parent().width()||0;a?this.hide():this.show(),this.model.set("width",b)}},_onChangeLeftAxisTip:function(){this._updateAxisTip("left")},_onChangeRightAxisTip:function(){this._updateAxisTip("right")},_updateAxisTip:function(a){var b=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+a),c=this.chart.select(".CDB-Chart-axisTip.CDB-Chart-axisTip-"+a),d=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+a),e=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+a);b.data([this.model.get(a+"_axis_tip")]).text(function(a){return j.formatNumber(a)});var f=b.node().getBBox().width;d.attr("width",f+4);var g=/translate\((\d*)/.exec(e.attr("transform")),h=+g[0]+3;0>h-f/2?(c.attr("transform","translate(0, 52)"),b.attr("dx",-h),d.attr("x",-h)):h+f/2+2>=this.chartWidth()?(c.attr("transform","translate(0, 52)"),b.attr("dx",this.chartWidth()-(h+f-2)),d.attr("x",this.chartWidth()-(h+f))):(c.attr("transform","translate(-"+f/2+", 52)"),d.attr("x",0),b.attr("dx",2))},_onChangeData:function(){this.model.previous("data").length!==this.model.get("data").length?this.reset():this.refresh(),this._setupFillColor(),this._refreshBarsColor()},_onChangeRange:function(){var a=this.model.get("lo_index"),b=this.model.get("hi_index");0===a&&0===b||null===a&&null===b||(this.selectRange(a,b),this._adjustBrushHandles(),this._selectBars(),this.trigger("on_brush_end",a,b))},_onChangeWidth:function(){var a=this.model.get("width");this.$el.width(a),this.chart.attr("width",a),this.options.showOnWidthChange&&a>0&&this.show(),this.reset();var b=this.model.get("lo_index"),c=this.model.get("hi_index");this.selectRange(b,c)},_onChangeNormalized:function(){this.model.set("show_shadow_bars",!this.model.get("normalized")),this._generateShadowBars(),this.updateYScale(),this.refresh()},_onChangeHeight:function(){var a=this.model.get("height");this.$el.height(a),this.chart.attr("height",a),this.leftHandle.attr("height",a),this.rightHandle.attr("height",a),this.updateYScale(),this.reset()},_onChangShowLabels:function(){this._axis.style("opacity",this.model.get("showLabels")?1:0)},_onChangePos:function(){var a=this.model.get("pos"),b=this.model.get("margin"),c=+a.x,d=+a.y;this.chart.transition().duration(150).attr("transform","translate("+(b.left+c)+", "+(b.top+d)+")")},_onBrushStart:function(){this.chart.classed("is-selectable",!0),this._axis.classed("is-disabled",!0)},_onChangeDragging:function(){this.chart.classed("is-dragging",this.model.get("dragging")),this._updateAxisTipOpacity("right"),this._updateAxisTipOpacity("left")},_showAxisTip:function(a){var b=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+a),c=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+a);b&&b.transition().duration(200).attr("opacity",1),c&&c.transition().duration(200).attr("opacity",1)},_hideAxisTip:function(a){var b=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+a),c=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+a);b&&b.transition().duration(200).attr("opacity",0),c&&c.transition().duration(200).attr("opacity",0)},_updateAxisTipOpacity:function(a){this.model.get("dragging")&&this._showAxisTip(a)},_onBrushMove:function(){this.model.set({dragging:!0}),this._selectBars(),this._setupFillColor(),this._refreshBarsColor(),this._adjustBrushHandles()},_onMouseOut:function(){var a=this.chart.selectAll(".CDB-Chart-bar");a.classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),this.trigger("hover",{value:null})},_onMouseMove:function(){var a=f.event.offsetX,b=Math.floor(a/this.barWidth),c=this.model.get("data");if(void 0!==c[b]&&null!==c[b]){var d=c[b].freq,e={},g=this.chart.select(".CDB-Chart-bar:nth-child("+(b+1)+")");if(g&&g.node()&&!g.classed("is-selected")){var h=b*this.barWidth+this.barWidth/2,i=this.yScale(d),k=this.chartHeight()-this.yScale(d);if(k<this.options.minimumBarHeight&&k>0&&(i=this.chartHeight()-this.options.minimumBarHeight),!this._isDragging()&&d>0){var l=j.formatNumber(d);e={top:i,left:h,data:l}}else e=null}else e=null;this.trigger("hover",e),this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this)),g&&g.node()&&(g.attr("fill",function(a,d){return this._getHoverFillColor(c[b],b)}.bind(this)),g.classed("is-highlighted",!0))}},reset:function(){this._removeChartContent(),this._setupDimensions(),this._calcBarWidth(),this._generateChartContent(),this._generateShadowBars()},refresh:function(){this._setupDimensions(),this._removeAxis(),this._generateAxis(),this._updateChart(),this._refreshBarsColor(),this.chart.select(".CDB-Chart-handles").moveToFront(),this.chart.select(".Brush").moveToFront()},resetIndexes:function(){this.model.set({lo_index:null,hi_index:null})},removeShadowBars:function(){this.model.set("show_shadow_bars",!1)},_removeShadowBars:function(){this.chart.selectAll(".CDB-Chart-shadowBars").remove()},_removeBars:function(){this.chart.selectAll(".CDB-Chart-bars").remove()},_removeBrush:function(){this.chart.selectAll(".Brush").remove(),this.chart.classed("is-selectable",!1),this._axis.classed("is-disabled",!1)},_removeLines:function(){this.chart.select(".CDB-Chart-lines").remove(),this.chart.select(".CDB-Chart-line--bottom").remove()},_removeChartContent:function(){this._removeBrush(),this._removeHandles(),this._removeBars(),this._removeAxis(),this._removeLines()},_generateChartContent:function(){this._generateAxis(),this._generateLines(),this._generateBars(),this._generateHandles(),this._setupBrush(),this._generateBottomLine()},_generateLines:function(){this._generateHorizontalLines(),"time"!==this.options.type&&this._generateVerticalLines()},_generateVerticalLines:function(){var a=this.chart.select(".CDB-Chart-lines");a.append("g").selectAll(".CDB-Chart-line").data(this.verticalRange.slice(1,this.verticalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("y1",0).attr("x1",function(a){return a}).attr("y2",this.chartHeight()).attr("x2",function(a){return a})},_generateHorizontalLines:function(){var a=this.chart.append("g").attr("class","CDB-Chart-lines");a.append("g").attr("class","y").selectAll(".CDB-Chart-line").data(this.horizontalRange.slice(0,this.horizontalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("x1",0).attr("y1",function(a){return a}).attr("x2",this.chartWidth()).attr("y2",function(a){return a})},_generateBottomLine:function(){this.chart.append("line").attr("class","CDB-Chart-line CDB-Chart-line--bottom").attr("x1",0).attr("y1",this.chartHeight()-1).attr("x2",this.chartWidth()-1).attr("y2",this.chartHeight()-1)},_setupD3Bindings:function(){f.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},f.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}},_setupModel:function(){this.model=new h.core.Model({bounded:!1,showLabels:!0,data:this.options.data,height:this.options.height,display:!0,show_shadow_bars:this.options.displayShadowBars,margin:e.clone(this.options.margin),width:0,pos:{x:0,y:0},normalized:this.options.normalized})},_setupBindings:function(){this.model.bind("change:data",this._onChangeData,this),this.model.bind("change:display",this._onChangeDisplay,this),this.model.bind("change:dragging",this._onChangeDragging,this),this.model.bind("change:height",this._onChangeHeight,this),this.model.bind("change:left_axis_tip",this._onChangeLeftAxisTip,this),this.model.bind("change:lo_index change:hi_index",this._onChangeRange,this),this.model.bind("change:pos",this._onChangePos,this),this.model.bind("change:right_axis_tip",this._onChangeRightAxisTip,this),this.model.bind("change:showLabels",this._onChangShowLabels,this),this.model.bind("change:show_shadow_bars",this._onChangeShowShadowBars,this),this.model.bind("change:width",this._onChangeWidth,this),this.model.bind("change:normalized",this._onChangeNormalized,this),this._widgetModel&&(this._widgetModel.bind("change:autoStyle",this._refreshBarsColor,this),this._widgetModel.bind("change:style",function(){this._setupFillColor(),this._refreshBarsColor()},this),this.add_related_model(this._widgetModel)),this._originalData&&(this._originalData.on("change:data",function(){this._removeShadowBars(),this._generateShadowBars()},this),this.add_related_model(this._originalData))},_setupDimensions:function(){this._setupScales(),this._setupRanges(),this._onWindowResize()},_getXScale:function(){return f.scale.linear().domain([0,100]).range([0,this.chartWidth()])},_getYScale:function(){var a=this._originalData&&this._originalData.getData()||this.model.get("data");return this.model.get("normalized")&&(a=this.model.get("data")),f.scale.linear().domain([0,f.max(a,function(a){return e.isEmpty(a)?0:a.freq})]).range([this.chartHeight(),0])},updateXScale:function(){this.xScale=this._getXScale()},updateYScale:function(){this.yScale=this._getYScale()},resetYScale:function(){this.yScale=this._originalYScale},_getDataForScales:function(){return!this.model.get("bounded")&&this._originalData?this._originalData.getData():this.model.get("data")},_setupScales:function(){var a=this._getDataForScales();this.updateXScale(),(!this._originalYScale||this.model.get("normalized"))&&(this._originalYScale=this.yScale=this._getYScale()),a&&a.length&&("time"===this.options.type?this.xAxisScale=f.time.scale().domain([1e3*a[0].start,1e3*a[a.length-1].end]).range([0,this.chartWidth()]):this.xAxisScale=f.scale.linear().range([a[0].start,a[a.length-1].end]).domain([0,this.chartWidth()]))},_setupRanges:function(){var a=Math.round(this.chartWidth()/this.options.divisionWidth);this.verticalRange=f.range(0,this.chartWidth()+this.chartWidth()/a,this.chartWidth()/a),this.horizontalRange=f.range(0,this.chartHeight()+this.chartHeight()/2,this.chartHeight()/2)},_calcBarWidth:function(){this.barWidth=this.chartWidth()/this.model.get("data").length},_generateChart:function(){var a=this.model.get("margin");this.chart=f.select(this.el).selectAll(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart").attr("transform","translate("+a.left+", "+a.top+")"),this.chart.classed(this.options.className||"",!0)},_onChangeShowShadowBars:function(){this.model.get("show_shadow_bars")?this._generateShadowBars():this._removeShadowBars()},_onChangeDisplay:function(){this.model.get("display")?this._show():this._hide()},hide:function(){this.model.set("display",!1)},show:function(){this.model.set("display",!0)},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},isHidden:function(){return!this.model.get("display")},_selectBars:function(){this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":function(a,b){return this._isBarChartWithinFilter(b)}.bind(this),"is-filtered":function(a,b){return!this._isBarChartWithinFilter(b)}.bind(this)})},_isBarChartWithinFilter:function(a){var b=this.brush.extent(),c=b[0],d=b[1],e=Math.floor(a*this.barWidth),f=Math.floor(e+this.barWidth),g=Math.floor(this.xScale(c)),h=Math.floor(this.xScale(d));return e>g&&h>e||f>g&&h>f||g>=e&&f>=h},_isDragging:function(){return this.model.get("dragging")},_move:function(a){this.model.set({pos:a})},expand:function(a){this.canvas.attr("height",this.model.get("height")+a),this._move({x:0,y:a})},contract:function(a){this.canvas.attr("height",a),this._move({x:0,y:0})},resizeHeight:function(a){this.model.set("height",a)},setNormalized:function(a){return this.model.set("normalized",!!a),this},removeSelection:function(){this.resetIndexes(),this.chart.selectAll(".CDB-Chart-bar").classed({"is-selected":!1,"is-filtered":!1}),this._refreshBarsColor(),this._removeBrush(),this._setupBrush()},selectRange:function(a,b){if(a||b){var c=this._getBarPosition(a),d=this._getBarPosition(b);this.model.set({lo_index:a,hi_index:b}),this._selectRange(c,d)}},_selectRange:function(a,b){this.chart.select(".Brush").transition().duration(this.brush.empty()?0:150).call(this.brush.extent([a,b])).call(this.brush.event)},_getLoBarIndex:function(){var a=this.brush.extent();return Math.round(this.xScale(a[0])/this.barWidth)},_getHiBarIndex:function(){var a=this.brush.extent();return Math.round(this.xScale(a[1])/this.barWidth)},_getBarIndex:function(){var a=f.event.sourceEvent.layerX;return Math.floor(a/this.barWidth)},_getBarPosition:function(a){var b=this.model.get("data");return a*(100/b.length)},_setupBrush:function(){function a(){var a,d,e=b.model.get("data");if(b.model.set({dragging:!1}),c.empty())b.chart.selectAll(".CDB-Chart-bar").classed("is-selected",!1),f.select(this).call(c.extent([0,0]));else{var g=b._getLoBarIndex(),h=b._getHiBarIndex();if(a=b._getBarPosition(g),d=b._getBarPosition(h),!f.event.sourceEvent)return;g===h&&(h>=e.length?a=b._getBarPosition(g-1):d=b._getBarPosition(h+1)),b.model.set({lo_index:g,hi_index:h})}if(f.event.sourceEvent&&void 0===a&&void 0===d){var i=b._getBarIndex();a=b._getBarPosition(i),d=b._getBarPosition(i+1),b.model.set({lo_index:i,hi_index:i+1})}b._setupFillColor(),b._refreshBarsColor()}var b=this,c=this.brush=f.svg.brush().x(this.xScale);
this.brush.on("brushstart",this._onBrushStart).on("brush",this._onBrushMove).on("brushend",a),this.chart.append("g").attr("class","Brush").call(this.brush).selectAll("rect").attr("y",0).attr("height",this.chartHeight()).on("mouseout",this._onMouseOut).on("mousemove",this._onMouseMove)},_adjustBrushHandles:function(){var a=this.brush.extent(),b=a[0],c=a[1],d=this.xScale(b)-this.options.handleWidth/2,e=this.xScale(c)-this.options.handleWidth/2;this.chart.select(".CDB-Chart-handle-left").attr("transform","translate("+d+", 0)"),this.chart.select(".CDB-Chart-handle-right").attr("transform","translate("+e+", 0)"),this.options.hasAxisTip&&this.model.set({left_axis_tip:this.xAxisScale(d+3),right_axis_tip:this.xAxisScale(e+3)})},_generateAxisTip:function(a){var b=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+a),c=b.selectAll("g").data([""]).enter().append("g").attr("class","CDB-Chart-axisTip CDB-Chart-axisTip-"+a).attr("transform",function(a,b){return"translate(0,52)"});this.rectLabel=c.append("rect").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTip-"+a).attr("height",12).attr("width",10),this.textLabel=c.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-axisTipText CDB-Chart-axisTip-"+a).attr("dy","11").attr("dx","0").text(function(a){return a})},_generateHandle:function(a){var b={width:this.options.handleWidth,height:this.options.handleHeight,radius:this.options.handleRadius},c=this.chartHeight()/2-this.options.handleHeight/2,d=this.chart.select(".CDB-Chart-handles").append("g").attr("class","CDB-Chart-handle CDB-Chart-handle-"+a);if(this.options.hasAxisTip&&this._generateAxisTip(a),d.append("line").attr("class","CDB-Chart-handleLine").attr("x1",3).attr("y1",-4).attr("x2",3).attr("y2",this.chartHeight()+4),this.options.hasHandles){d.append("rect").attr("class","CDB-Chart-handleRect").attr("transform","translate(0, "+c+")").attr("width",b.width).attr("height",b.height).attr("rx",b.radius).attr("ry",b.radius);for(var e=21,f=0;3>f;f++)d.append("line").attr("class","CDB-Chart-handleGrip").attr("x1",2).attr("y1",e+3*f).attr("x2",4).attr("y2",e+3*f)}return d},_generateHandles:function(){this.chart.append("g").attr("class","CDB-Chart-handles"),this.leftHandle=this._generateHandle("left"),this.rightHandle=this._generateHandle("right")},_generateHandleLine:function(){return this.chart.select(".CDB-Chart-handles").append("line").attr("class","CDB-Chart-handleLine").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this.chartHeight())},_removeHandles:function(){this.chart.select(".CDB-Chart-handles").remove()},_removeAxis:function(){this.canvas.select(".CDB-Chart-axis").remove()},_generateAdjustAnchorMethod:function(a){return function(b,c){return 0===c?"start":c===a.length-1?"end":"middle"}},_generateAxis:function(){this._axis="time"===this.options.type?this._generateTimeAxis():this._generateNumericAxis(),this._onChangShowLabels()},_generateNumericAxis:function(){var a=this,b=this._generateAdjustAnchorMethod(this.verticalRange),c=this.chart.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small");return c.append("g").selectAll(".Label").data(this.verticalRange).enter().append("text").attr("x",function(a){return a}).attr("y",function(b){return a.chartHeight()+15}).attr("text-anchor",b).text(function(b){return a.xAxisScale?j.formatNumber(a.xAxisScale(b)):void 0}),c},_generateTimeAxis:function(){var a=this._generateAdjustAnchorMethod(this.xAxisScale.ticks()),b=f.svg.axis().orient("bottom").tickPadding(5).innerTickSize(-this.chartHeight()).scale(this.xAxisScale).orient("bottom"),c=this.canvas.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small").attr("transform","translate(0,"+(this.chartHeight()+5)+")").call(b);return c.selectAll("text").style("text-anchor",a),c.moveToBack(),c},_getMinValueFromBinIndex:function(a){var b=this.model.get("data");return null!=b[a].min?b[a].min:b[a].start},_getMaxValueFromBinIndex:function(a){var b=this.model.get("data");return null!=b[a].max?b[a].max:b[a].end},_calculateDataDomain:function(){var a,b,c,d,f=e.clone(this.model.get("data"));if(this._hasFilterApplied()){var g=this._getLoBarIndex(),h=this._getHiBarIndex()-1,i=f.slice(g,h);if(e.isNaN(g)||e.isNaN(h))return[0,0];if(c=this._getMinValueFromBinIndex(g),d=this._getMaxValueFromBinIndex(h),f[g]&&0===f[g].freq&&(a=e.find(i,function(a){return 0!==a.freq},this)),f[h]&&0===f[h].freq){var j=i.reverse();b=e.find(j,function(a){return 0!==a.freq},this)}}else c=this._getMinValueFromBinIndex(0),d=this._getMaxValueFromBinIndex(f.length-1),a=e.find(f,function(a){return 0!==a.freq}),b=e.find(f.reverse(),function(a){return 0!==a.freq});return c=a?null!=a.min?a.min:a.start:c,d=b?null!=b.max?b.max:b.end:d,[c,d]},_removeFillGradients:function(){var a=f.select(this.el).select("defs");a.remove()},_generateFillGradients:function(){if(!this._widgetModel||!this._widgetModel.isAutoStyleEnabled())return!1;var a=this._widgetModel.getAutoStyle();if(e.isEmpty(a))return!1;var b=this,c=a.definition[Object.keys(a.definition)[0]],d=c&&c.color.range,h=this.model.get("data"),i=g.interpolateRgbBasis(d),j=this._calculateDataDomain(),k=f.scale.linear().domain(j).range([0,1]),l=f.select(this.el).append("defs"),m=4,n=l.selectAll("linearGradient").data(h).enter().append("linearGradient").attr("id",function(a,c){return this.__scale__=f.scale.linear().range([b._getMinValueFromBinIndex(c),b._getMaxValueFromBinIndex(c)]).domain([0,1]),"bar-"+b.cid+"-"+c}).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");n.selectAll("stop").data(f.range(m+1)).enter().append("stop").attr("offset",function(a,b){var c=this.__offset__=Math.floor(b/m*100);return c+"%"}).attr("stop-color",function(a,b){var c=this.parentNode.__scale__,d=k(c(this.__offset__/100));return i(d)})},_setupFillColor:function(){this._removeFillGradients(),this._generateFillGradients()},_getFillColor:function(a,b){return this._widgetModel?this._widgetModel.isAutoStyle()?this._hasFilterApplied()&&!this._isBarChartWithinFilter(b)?l:"url(#bar-"+this.cid+"-"+b+")":this._hasFilterApplied()?this._isBarChartWithinFilter(b)?k:l:this._widgetModel.getWidgetColor()||this.options.chartBarColor:this.options.chartBarColor},_getHoverFillColor:function(a,b){var c=this._getFillColor(a,b);return this._widgetModel&&this._widgetModel.isAutoStyle()?c:i(c).darken(20).toString()},_updateChart:function(){var a=this,b=this.model.get("data"),c=this.chart.selectAll(".CDB-Chart-bar").data(b);c.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(this)).attr("transform",function(b,c){return"translate("+c*a.barWidth+", 0 )"}).attr("y",a.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),c.transition().duration(200).attr("height",function(b){if(e.isEmpty(b))return 0;var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0&&(c=a.options.minimumBarHeight),c}).attr("y",function(b){if(e.isEmpty(b))return a.chartHeight();var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0?a.chartHeight()-a.options.minimumBarHeight:a.yScale(b.freq)}),c.exit().transition().duration(200).attr("height",function(a){return 0}).attr("y",function(b){return a.chartHeight()})},_refreshBarsColor:function(){this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1).attr("fill",this._getFillColor.bind(this))},_generateBars:function(){var a=this,b=this.model.get("data");this._calcBarWidth();var c=this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-bars").selectAll(".CDB-Chart-bar").data(b);c.enter().append("rect").attr("class","CDB-Chart-bar").attr("fill",this._getFillColor.bind(a)).attr("transform",function(b,c){return"translate("+c*a.barWidth+", 0 )"}).attr("y",a.chartHeight()).attr("height",0).attr("width",Math.max(.5,this.barWidth-1)),c.transition().ease(this.options.transitionType).duration(this.options.animationSpeed).delay(this.options.animationBarDelay).transition().attr("height",function(b){if(e.isEmpty(b))return 0;var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0&&(c=a.options.minimumBarHeight),c}).attr("y",function(b){if(e.isEmpty(b))return a.chartHeight();var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0?a.chartHeight()-a.options.minimumBarHeight:a.yScale(b.freq)})},showShadowBars:function(){this.options.displayShadowBars&&this.model.set("show_shadow_bars",!0)},_generateShadowBars:function(){var a=this._originalData&&this._originalData.getData()||this.model.get("data");if(!a||!a.length||!this.model.get("show_shadow_bars")||this.model.get("normalized"))return void this._removeShadowBars();this._removeShadowBars();var b=this,c=f.scale.linear().domain([0,f.max(a,function(a){return e.isEmpty(a)?0:a.freq})]).range([this.chartHeight(),0]),d=this.chartWidth()/a.length;this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-shadowBars").selectAll(".CDB-Chart-shadowBar").data(a).enter().append("rect").attr("class","CDB-Chart-shadowBar").attr("transform",function(a,b){return"translate("+b*d+", 0 )"}).attr("y",function(a){if(e.isEmpty(a))return b.chartHeight();var d=b.chartHeight()-c(a.freq);return d<b.options.minimumBarHeight&&d>0?b.chartHeight()-b.options.minimumBarHeight:c(a.freq)}).attr("width",Math.max(.5,d-1)).attr("height",function(a){if(e.isEmpty(a))return 0;var d=b.chartHeight()-c(a.freq);return d<b.options.minimumBarHeight&&d>0&&(d=b.options.minimumBarHeight),d}),this.chart.selectAll(".CDB-Chart-shadowBars").moveToBack(),this.chart.selectAll(".CDB-Chart-lines").moveToBack()},_hasFilterApplied:function(){return null!=this.model.get("lo_index")&&null!=this.model.get("hi_index")},unsetBounds:function(){this.model.set("bounded",!1),this.updateYScale(),this.contract(this.options.height),this.resetIndexes(),this.removeSelection(),this._setupFillColor()},setBounds:function(){this.model.set("bounded",!0),this.updateYScale(),this.expand(4),this.removeShadowBars()},clean:function(){d(window).unbind("resize",this._onWindowResize),h.core.View.prototype.clean.call(this)}})},{"../../formatter":30,"cartodb.js":"cartodb.js",d3:13,"d3-interpolate":11,jquery:"jquery",tinycolor2:14,underscore:"underscore"}],70:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("../../formatter"),g=a("./histogram-title-view"),h=a("./chart"),i=a("./placeholder.tpl"),j=a("./content.tpl"),k=a("../dropdown/widget-dropdown-view"),l=a("../animate-values.js"),m=a("./animation-template.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-body",defaults:{chartHeight:72},events:{"click .js-clear":"_resetWidget","click .js-zoom":"_zoom"},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this.filter=this._dataviewModel.filter,this.lockedByUser=!1,this._numberOfFilters=0,this._initStateApplied=!1;var a=this._initBinds.bind(this);this._originalData.once("change:data",function(){this._dataviewModel.fetch({complete:a})},this)},_initViews:function(){this._initTitleView();var a=new k({model:this.model,target:".js-actions",container:this.$(".js-header"),flags:{normalizeHistogram:!0}});this.addView(a),this._renderMiniChart(),this._renderMainChart(),this._renderAllValues()},_initTitleView:function(){var a=new g({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-title").append(a.render().el),this.addView(a)},_initBinds:function(){this.model.bind("change:normalized",function(){var a=this.model.get("normalized");this.histogramChartView.setNormalized(a),this.miniHistogramChartView.setNormalized(a)},this),this.model.bind("change:collapsed",this.render,this),this.model.get("hasInitialState")===!0?this._setInitialState():this.model.bind("change:hasInitialState",this._setInitialState,this)},_setInitialState:function(){var a=this._dataviewModel.getData();0===a.length?this._dataviewModel.once("change:data",this._onInitialState,this):this._onInitialState()},_onInitialState:function(){this.add_related_model(this._dataviewModel),this.render(),this.model.get("autoStyle")===!0&&this.model.autoStyle(),this._hasRange()&&(this._numberOfFilters=1),this._isZoomed()&&(this._numberOfFilters=2),0!==this._numberOfFilters?this._setInitialRange():this._completeInitialState()},_setupRange:function(a,b,c,e){var f,g,h=0,i=a.length;d.isNumber(b)&&(f=d.findWhere(a,{start:b}),h=f?f.bin:0),d.isNumber(c)&&(g=d.findWhere(a,{end:c}),i=g?g.bin+1:a.length),(h&&0!==h||i&&i!==a.length)&&(this.filter.setRange(a[h].start,a[i-1].end),this._onChangeFilterEnabled(),this.histogramChartView.selectRange(h,i)),e&&e(h,i)},_setInitialRange:function(){var a=this._dataviewModel.getData(),b=this.model.get("min"),c=this.model.get("max"),d=void 0!==b||void 0!==c;this._setupRange(a,b,c,function(a,b){this.model.set({filter_enabled:d,lo_index:a,hi_index:b}),this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._isZoomed()?(this._onChangeZoomEnabled(),this._onZoomIn()):this._updateStats()}.bind(this))},_completeInitialState:function(){this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this._initStateApplied=!0,this._updateStats()},_isZoomed:function(){return this.model.get("zoomed")},_hasRange:function(){var a=this.model.get("min"),b=this.model.get("max");return null!=a||null!=b},_onHistogramDataChanged:function(){this._dataviewModel.changed.url&&this._isZoomed()||(this.lockedByUser?this.lockedByUser=!1:(this._isZoomed()?this._filteredData=this._dataviewModel.getData():(this.histogramChartView.showShadowBars(),this.miniHistogramChartView.replaceData(this._dataviewModel.getData())),this.histogramChartView.replaceData(this._dataviewModel.getData())),this.unsettingRange&&this._unsetRange(),this._updateStats())},render:function(){this.clearSubViews(),this._unbinds();var a=this._dataviewModel.getData(),b=this._originalData.getData(),c=!d.size(a)&&!d.size(b);return this.$el.html(j({title:this.model.get("title"),showStats:this.model.get("show_stats"),itemsCount:c?"-":a.length,isCollapsed:!!this.model.get("collapsed")})),c?(this._addPlaceholder(),this._initTitleView()):(this._setupBindings(),this._initViews()),this},_unsetRange:function(){this.unsettingRange=!1,this.histogramChartView.replaceData(this._dataviewModel.getData()),this.model.set({lo_index:null,hi_index:null}),this._isZoomed()||this.histogramChartView.showShadowBars()},_addPlaceholder:function(){this.$(".js-content").append(i())},_renderMainChart:function(){this.histogramChartView=new h({margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,hasAxisTip:!0,chartBarColor:this.model.getColor()||"#9DE0AD",width:this.canvasWidth,height:this.defaults.chartHeight,data:this._dataviewModel.getData(),originalData:this._originalData,displayShadowBars:!this.model.get("normalized"),normalized:this.model.get("normalized"),widgetModel:this.model}),this.$(".js-content").append(this.histogramChartView.el),this.addView(this.histogramChartView),this.histogramChartView.bind("on_brush_end",this._onBrushEnd,this),this.histogramChartView.bind("hover",this._onValueHover,this),this.histogramChartView.render().show(),this._updateStats()},_renderMiniChart:function(){this.miniHistogramChartView=new h({className:"CDB-Chart--mini",margin:{top:0,right:4,bottom:4,left:4},height:40,showOnWidthChange:!1,data:this._dataviewModel.getData(),normalized:this.model.get("normalized"),chartBarColor:this.model.getColor()||"#9DE0AD",originalData:this._originalData,widgetModel:this.model}),this.addView(this.miniHistogramChartView),this.$(".js-content").append(this.miniHistogramChartView.el),this.miniHistogramChartView.bind("on_brush_end",this._onMiniRangeUpdated,this),this.miniHistogramChartView.render()},_setupBindings:function(){this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.model.bind("change:zoomed",this._onChangeZoomed,this),this.model.bind("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.bind("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.bind("change:total",this._onChangeTotal,this),this.model.bind("change:nulls",this._onChangeNulls,this),this.model.bind("change:max",this._onChangeMax,this),this.model.bind("change:min",this._onChangeMin,this),this.model.bind("change:avg",this._onChangeAvg,this)},_unbinds:function(){this._dataviewModel.off("change:bins",this._onChangeBins,this),this.model.off("change:zoomed",this._onChangeZoomed,this),this.model.off("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.off("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.off("change:total",this._onChangeTotal,this),this.model.off("change:nulls",this._onChangeNulls,this),this.model.off("change:max",this._onChangeMax,this),this.model.off("change:min",this._onChangeMin,this),this.model.off("change:avg",this._onChangeAvg,this)},_clearTooltip:function(){this.$(".js-tooltip").stop().hide()},_onValueHover:function(a){var b=this.$(".js-tooltip");if(a&&a.data){var c=this.defaults.chartHeight+3-a.top;b.css({bottom:c,left:a.left}),b.text(a.data),b.css({left:a.left-b.width()/2}),b.fadeIn(70)}else this._clearTooltip()},_onMiniRangeUpdated:function(a,b){this.lockedByUser=!1,this._clearTooltip(),this.histogramChartView.removeSelection();var c=this._originalData.getData();this.model.set({lo_index:a,hi_index:b,zlo_index:null,zhi_index:null}),this._applyBrushFilter(c,a,b)},_onBrushEnd:function(a,b){this._isZoomed()?this._onBrushEndFiltered(a,b):this._onBrushEndUnfiltered(a,b)},_onBrushEndFiltered:function(a,b){var c=this._filteredData;c&&c.length&&(this.model.get("zlo_index")!==a||this.model.get("zhi_index")!==b)&&(this._numberOfFilters=2,this.lockedByUser=!0,this.model.set({filter_enabled:!0,zlo_index:a,zhi_index:b}),this._applyBrushFilter(c,a,b))},_onBrushEndUnfiltered:function(a,b){var c=this._dataviewModel.getData();c&&c.length&&(this.model.get("lo_index")!==a||this.model.get("hi_index")!==b)&&(this._numberOfFilters=1,this.model.set({filter_enabled:!0,zoom_enabled:!0,lo_index:a,hi_index:b}),this._applyBrushFilter(c,a,b))},_applyBrushFilter:function(a,b,c){b!==c&&b>=0&&b<a.length&&c-1>=0&&c-1<a.length?(this.filter.setRange(a[b].start,a[c-1].end),this._updateStats()):console.error("Error accessing array bounds",b,c,a)},_onChangeFilterEnabled:function(){this.$(".js-filter").toggleClass("is-hidden",!this.model.get("filter_enabled"))},_onChangeBins:function(a,b){this._originalData.setBins(b),this.model.set({zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null})},_onChangeZoomEnabled:function(){this.$(".js-zoom").toggleClass("is-hidden",!this.model.get("zoom_enabled"))},_renderAllValues:function(){this._changeHeaderValue(".js-nulls","nulls",""),this._changeHeaderValue(".js-val","total","SELECTED"),this._changeHeaderValue(".js-max","max",""),this._changeHeaderValue(".js-min","min",""),this._changeHeaderValue(".js-avg","avg","")},_changeHeaderValue:function(a,b,c){if(null==this.model.get(b))return void this.$(a).text("0 "+c);this._addTitleForValue(a,b,c);var d=new l({el:this.$el});d.animateValue(this.model,b,a,m,{formatter:f.formatNumber,templateData:{suffix:" "+c}})},_onChangeNulls:function(){this._changeHeaderValue(".js-nulls","nulls","")},_onChangeTotal:function(){this._changeHeaderValue(".js-val","total","SELECTED")},_onChangeMax:function(){this._changeHeaderValue(".js-max","max","")},_onChangeMin:function(){this._changeHeaderValue(".js-min","min","")},_onChangeAvg:function(){this._changeHeaderValue(".js-avg","avg","")},_addTitleForValue:function(a,b,c){this.$(a).attr("title",this._formatNumberWithCommas(this.model.get(b).toFixed(2))+" "+c)},_formatNumberWithCommas:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_calculateBars:function(a){var b,c,e,f,g,h;return this._isZoomed()&&2===this._numberOfFilters?(b=this.model.get("zmin"),c=this.model.get("zmax"),e=this.model.get("zlo_index"),f=this.model.get("zhi_index")):1===this._numberOfFilters&&(b=this.model.get("min"),c=this.model.get("max"),e=this.model.get("lo_index"),f=this.model.get("hi_index")),a.length>0?(d.isNumber(b)||d.isNumber(e)?d.isNumber(b)&&!d.isNumber(e)&&(g=d.findWhere(a,{start:b}),e=g&&g.bin||0):e=0,d.isNumber(c)||d.isNumber(f)?d.isNumber(c)&&!d.isNumber(f)&&(h=d.findWhere(a,{end:c}),f=h&&h.bin+1||a.length):f=a.length):(e=0,f=a.length),{loBarIndex:e,hiBarIndex:f}},_updateStats:function(){if(this._initStateApplied){var a;if(a=!this._isZoomed()||this._isZoomed()&&2===this._numberOfFilters?this.histogramChartView.model.get("data"):this.miniHistogramChartView.model.get("data"),null!=a){var b,c,e,f,g,h=this._dataviewModel.get("nulls"),i=this._calculateBars(a),j=i.loBarIndex,k=i.hiBarIndex;a&&a.length&&(b=this._calcSum(a,j,k),c=this._calcAvg(a,j,k),j>=0&&j<a.length&&(e=a[j].start),k>=0&&k-1<a.length&&(f=a[Math.max(0,k-1)].end),this._isZoomed()&&2===this._numberOfFilters?g={zmin:e,zmax:f,zlo_index:j,zhi_index:k}:this._isZoomed()||1!==this._numberOfFilters||(g={min:e,max:f,lo_index:j,hi_index:k}),g=d.extend({total:b,nulls:h,avg:c},g),this.model.set(g))}}},_calcAvg:function(a,b,c){var e=a.slice(b,c),f=this._calcSum(a,b,c,f);if(!f)return 0;var g=d.reduce(e,function(a,b){return b.avg&&b.freq?b.avg*b.freq+a:a},0);return g/f},_calcSum:function(a,b,c){return d.reduce(a.slice(b,c),function(a,b){return b.freq+a},0)},_onChangeZoomed:function(){this.model.get("zoomed")?this._onZoomIn():this._resetWidget()},_showMiniRange:function(){var a=this.model.get("lo_index"),b=this.model.get("hi_index");this.miniHistogramChartView.selectRange(a,b),this.miniHistogramChartView.show()},_zoom:function(){this.model.set({zoomed:!0,zoom_enabled:!1}),this.histogramChartView.removeSelection()},_onZoomIn:function(){this.lockedByUser=!1,this._showMiniRange(),this.histogramChartView.setBounds(),this._dataviewModel.enableFilter(),this._dataviewModel.fetch()},_resetWidget:function(){this._numberOfFilters=0,this.model.set({zoomed:!1,zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null,min:null,max:null,zlo_index:null,zhi_index:null,zmin:null,zmax:null}),this.filter.unsetRange(),this._dataviewModel.disableFilter(),this.histogramChartView.unsetBounds(),this.miniHistogramChartView.hide(),this._clearTooltip(),this._updateStats()}})},{"../../formatter":30,"../animate-values.js":32,"../dropdown/widget-dropdown-view":64,"./animation-template.tpl":68,"./chart":69,"./content.tpl":71,"./histogram-title-view":73,"./placeholder.tpl":75,"cartodb.js":"cartodb.js",underscore:"underscore"}],71:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header js-header"> <div class="js-title"></div> ',showStats&&!isCollapsed&&(__p+=' <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace"> <dt class="CDB-Widget-infoCount js-nulls">0</dt><dd class="CDB-Widget-infoDescription">NULL ROWS</dd> <dt class="CDB-Widget-infoCount js-min">0</dt><dd class="CDB-Widget-infoDescription">MIN</dd> <dt class="CDB-Widget-infoCount js-avg">0</dt><dd class="CDB-Widget-infoDescription">AVG</dd> <dt class="CDB-Widget-infoCount js-max">0</dt><dd class="CDB-Widget-infoDescription">MAX</dd> </dl> '),__p+=" </div> ",isCollapsed||(__p+=' <div class="CDB-Widget-content CDB-Widget-content--histogram js-content"> <div class="CDB-Widget-tooltip CDB-Widget-tooltip--light CDB-Text CDB-Size-small js-tooltip"></div> <div class="CDB-Widget-filter CDB-Widget-contentSpaced"> <p class="CDB-Text CDB-Size-small is-semibold u-upperCase js-val">…</p> <div class="CDB-Widget-filterButtons js-filter is-hidden"> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-zoom">zoom</button> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">clear</button> </div> </div> </div> '),__p+="";return __p}},{underscore:"underscore"}],72:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-title CDB-Widget-contentSpaced"> <h3 class="CDB-Text CDB-Size-large u-ellipsis" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h3> <div class="CDB-Widget-options CDB-Widget-contentSpaced"> ',isAutoStyleEnabled&&(__p+=' <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-sizes '+(null==(__t=isAutoStyle?"is-selected":"")?"":_.escape(__t))+" "+(null==(__t=isAutoStyle?"js-cancelAutoStyle":"js-autoStyle")?"":_.escape(__t))+' " data-tooltip="'+(null==(__t=isAutoStyle?"Remove auto style":"Auto style")?"":_.escape(__t))+'"> <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i> </button> '),__p+=' <button class="CDB-Shape CDB-Widget-actions js-actions u-lSpace"> <div class="CDB-Shape-threePoints is-blue is-small"> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> </div> </button> </div> </div>';return __p}},{underscore:"underscore"}],73:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("../widget-tooltip-view"),g=a("./histogram-title-template.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-title CDB-Widget-contentSpaced",events:{"click .js-autoStyle":"_autoStyle","click .js-cancelAutoStyle":"_cancelAutoStyle"},initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g({title:this.widgetModel.get("title"),isAutoStyleEnabled:this.widgetModel.isAutoStyleEnabled(),isAutoStyle:this.widgetModel.get("autoStyle"),isCollapsed:this.widgetModel.get("collapsed")})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:title change:collapsed change:autoStyle change:style",this.render,this),this.add_related_model(this.dataviewModel)},_initViews:function(){var a=new f({target:this.$(".js-sizes")});d("body").append(a.render().el),this.addView(a)},_autoStyle:function(){this.widgetModel.autoStyle()},_cancelAutoStyle:function(){this.widgetModel.cancelAutoStyle()}})},{"../widget-tooltip-view":106,"./histogram-title-template.tpl":72,"cartodb.js":"cartodb.js",jquery:"jquery"}],74:[function(a,b,c){var d=a("../widget-model"),e=a("underscore");b.exports=d.extend({defaults:{normalized:!0},defaultState:e.extend({autoStyle:!1,normalized:!1},d.prototype.defaultState),initialize:function(a,b){d.prototype.initialize.apply(this,arguments),this.on("change:collapsed",this._onCollapsedChange,this),this.on("change:style",this._updateAutoStyle,this),this.dataviewModel.once("change",function(){this.get("autoStyle")&&this.autoStyle()},this)},_onCollapsedChange:function(a,b){this.dataviewModel.set("enabled",!b)},_updateAutoStyle:function(a,b){this.autoStyler&&this.autoStyler.updateColors(b),this.isAutoStyle()&&this.reapplyAutoStyle()},getState:function(){var a=d.prototype.getState.call(this),b=this.dataviewModel.get("start"),c=this.dataviewModel.get("end"),f=this.get("min"),g=this.get("max"),h=function(a,d){return e.isNumber(a)&&e.isNumber(d)&&a!==d&&Math.abs(a-d)>.01*Math.abs(b-c)?!0:!1};return h(b,f)?a.min=f:delete a.min,h(c,g)?a.max=g:delete a.max,this.get("zoomed")===!0&&(a.zoomed=!0),a}})},{"../widget-model":105,underscore:"underscore"}],75:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<ul class="CDB-Widget-chart CDB-Widget-chart--fake"> ';for(var i=0;15>i;i++)__p+=' <li class="CDB-Widget-chartItem CDB-Widget-chartItem--'+(null==(__t=_.sample(["small","medium","big"],1)[0])?"":_.escape(__t))+' CDB-Widget-chartItem--fake"></li> ';__p+=" </ul>"}return __p}},{underscore:"underscore"}],76:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header"> <div class="CDB-Widget-title CDB-Widget-contentSpaced"> <h3 class="CDB-Widget-textBig" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h3> </div> <dl class="CDB-Widget-info CDB-Widget-textSmaller CDB-Widget-textSmaller--upper u-tSpace"> <dt>'+(null==(__t=itemsCount)?"":_.escape(__t))+'</dt><dd class="CDB-Widget-info">rows</dd> </dl> </div> <div class="CDB-Widget-content CDB-Widget-content--noSidesMargin"> <div class="CDB-Widget-listWrapper js-content"></div> </div> <div class="CDB-Widget-footer js-footer"></div>';return __p}},{underscore:"underscore"}],77:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("../../formatter"),g=a("./items-view"),h=a("./paginator-view"),i=a("./edges-view"),j=a("./content-template.tpl"),k=a("./placeholder-template.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-body",options:{showScroll:!1},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){this.clearSubViews();var a=this._dataviewModel.getData(),b=d.isEmpty(a)||0===d.size(a);return this.$el.html(j({title:this.model.get("title"),itemsCount:b?"-":f.formatValue(a.length)})),b?this.$(".js-content").append(k()):this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:title",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.add_related_model(this._dataviewModel)},_initViews:function(){this._list=new g({model:this.model,dataviewModel:this._dataviewModel}),this.$(".js-content").html(this._list.render().el),this.addView(this._list);var a=this._list.$el.get(0).scrollHeight-this._list.$el.outerHeight()>0;(a||this.options.showScroll)&&(this._pagination=new h({$target:this._list.$el}),this.$(".js-footer").append(this._pagination.render().el),this.addView(this._pagination),this._edges=new i({$target:this._list.$el}),this.$(".js-content").append(this._edges.render().el),this.addView(this._edges))}})},{"../../formatter":30,"./content-template.tpl":76,"./edges-view":78,"./items-view":81,"./paginator-view":82,"./placeholder-template.tpl":83,"cartodb.js":"cartodb.js",underscore:"underscore"}],78:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js");b.exports=e.core.View.extend({_TEMPLATE:' <div class="CDB-Widget-listEdge CDB-Widget-listEdge--top"><div class="CDB-Widget-listEdgeShadow js-topShadow"></div><div class="CDB-Widget-listEdgeBorder"></div></div><div class="CDB-Widget-listEdge CDB-Widget-listEdge--bottom"><div class="CDB-Widget-listEdgeShadow js-bottomShadow"></div><div class="CDB-Widget-listEdgeBorder"></div></div>',initialize:function(){this._$target=this.options.$target,this._initBinds()},render:function(){this.clearSubViews();var a=d.template(this._TEMPLATE);return this.$el.html(a()),this._checkScroll(),this},_initBinds:function(){var a=this;this._$target.bind("scroll",function(){a._checkScroll()})},_unbindScroll:function(){this._$target.unbind("scroll")},_checkScroll:function(){var a=this._$target.scrollTop(),b=this._$target.get(0).scrollHeight-this._$target.outerHeight();this.$(".js-topShadow").toggle(0!==a),this.$(".js-bottomShadow").toggle(a!==b)},clean:function(){this._unbindScroll(),e.core.View.prototype.clean.call(this)}})},{"cartodb.js":"cartodb.js",underscore:"underscore"}],79:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+="",__p+=isClickable?' <button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton CDB-Widget-listButton--withBorder js-button"> ':' <div class="CDB-Widget-listItemInner CDB-Widget-listItemInner--withBorders"> ',__p+=' <div class="CDB-Widget-contentSpaced CDB-Widget-contentSpaced--topAligned CDB-Widget-contentSpaced--start"> <em class="CDB-Shape-dot CDB-Widget-listDot"></em> ',itemsCount>0){if(__p+=' <div class="CDB-Widget-contentFull"> <p class="CDB-Widget-textSmall CDB-Widget-textSmall--upper CDB-Widget-textSmall--bold" title="'+(null==(__t=items[0][1])?"":_.escape(__t))+'">'+(null==(__t=items[0][1])?"":_.escape(__t))+"</p> ",
itemsCount>2){__p+=' <dl class="CDB-Widget-inlineList"> ';for(var i=1,l=itemsCount;l>i;i++)__p+=' <div class="CDB-Widget-inlineListItem CDB-Widget-textSmaller CDB-Widget-textSmaller--noEllip"> <dd class="CDB-Widget-textSmaller--bold CDB-Widget-textSmaller--dark u-rSpace" title="'+(null==(__t=items[i][1])?"":_.escape(__t))+'">'+(null==(__t=items[i][1])?"":_.escape(__t))+'</dd> <dt title="'+(null==(__t=items[i][0])?"":_.escape(__t))+'">'+(null==(__t=items[i][0])?"":_.escape(__t))+"</dt> </div> ";__p+=" </dl> "}else 2===itemsCount&&(__p+=' <dl class="CDB-Widget-textSmaller CDB-Widget-textSmaller--noEllip u-tSpace"> <dd class="CDB-Widget-textSmaller--bold CDB-Widget-textSmaller--dark u-rSpace" title="'+(null==(__t=items[1][1])?"":_.escape(__t))+'">'+(null==(__t=items[1][1])?"":_.escape(__t))+'</dd> <dt title="'+(null==(__t=items[1][0])?"":_.escape(__t))+'">'+(null==(__t=items[1][0])?"":_.escape(__t))+"</dt> </dl> ");__p+=" </div> "}__p+=" </div> ",__p+=isClickable?" </div></button> ":"  ",__p+=""}return __p}},{underscore:"underscore"}],80:[function(a,b,c){var d=a("underscore"),e=a("../../formatter"),f=a("cartodb.js"),g=a("./item-template.tpl");b.exports=f.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(){this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel},render:function(){var a=this.model.toJSON(),b=this._hasInteractivity(a),c=this._sanitizeData(a);return this.$el.html(g({items:c,isClickable:b,itemsCount:d.size(c)})),this[b?"delegateEvents":"undelegateEvents"](),this},_sanitizeData:function(a){var b=this._hasInteractivity(a);a=d.omit(a,function(a,b,c){return"cartodb_id"===b});var c=this._widgetModel.get("columns_title");b&&!d.isEmpty(c)&&(c=d.rest(c,1));var f=[],g=0;return d.each(a,function(a,b){var d=c&&c[g]||b;f.push([d,e.formatValue(a)]),++g}),f},_hasInteractivity:function(a){return!d.isEmpty(d.filter(a,function(a,b){return"cartodb_id"===b}))},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},{"../../formatter":30,"./item-template.tpl":79,"cartodb.js":"cartodb.js",underscore:"underscore"}],81:[function(a,b,c){var d=a("cartodb.js"),e=a("./item-view");b.exports=d.core.View.extend({className:"CDB-Widget-list js-list",tagName:"ul",events:{scroll:"_checkScroll"},initialize:function(a){this._dataviewModel=a.dataviewModel},render:function(){return this.clearSubViews(),this._renderList(),this},_renderList:function(){this._dataviewModel.getData().each(this._addItem,this)},_addItem:function(a){var b=new e({model:a,widgetModel:this.model,dataviewModel:this._dataviewModel});b.bind("itemClicked",function(){this.trigger("itemClicked",a,this)},this),this.addView(b),this.$el.append(b.render().el)}})},{"./item-view":80,"cartodb.js":"cartodb.js"}],82:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js");b.exports=f.core.View.extend({className:"CDB-Widget-nav CDB-Widget-contentSpaced",_TEMPLATE:' <span></span><div class="CDB-Widget-navArrows CDB-Widget-contentSpaced"><button class="CDB-Shape-arrow CDB-Shape-arrow--up js-up"></button><button class="CDB-Shape-arrow CDB-Shape-arrow--down js-down"></button></div>',events:{"click .js-up":"_scrollUp","click .js-down":"_scrollDown"},initialize:function(){if(!this.options.$target)throw new Error("target should be defined in order to be able to paginate");this._$target=this.options.$target,this._scrollHeight=this._$target.get(0).scrollHeight-this._$target.outerHeight(),this._initBinds()},render:function(){var a=e.template(this._TEMPLATE);return this.$el.html(a()),this._checkScroll(),this},_initBinds:function(){var a=this;this._$target.bind("scroll",function(){a._checkScroll()})},_unbindScroll:function(){this._$target.unbind("scroll")},_checkScroll:function(){var a=this._$target.scrollTop();this.$(".js-up").toggleClass("is-disabled",0===a),this.$(".js-down").toggleClass("is-disabled",a>=this._scrollHeight)},_getEdgeVisibleItems:function(){var a=this._$target.outerHeight(),b=null,c=null,e=this._$target.children(".CDB-Widget-listItem");return e.each(function(f,g){var h=d(this).position().top,i=d(this).outerHeight();h>-1&&null===b?b=this:h+i>a&&null===c&&(c=e[f-1])}),[b,c]},_scrollDown:function(){var a=this._getEdgeVisibleItems()[1],b=this._$target.scrollTop(),c=d(a).next();if(c.length){var e=c.position().top,f=c.outerHeight(),g=e+f-this._$target.outerHeight()+b;g>0&&this._$target.scrollTop(g)}},_scrollUp:function(){var a=this._getEdgeVisibleItems()[0],b=this._$target.scrollTop(),c=d(a).prev();if(c.length){var e=c.position().top,f=b+e;this._$target.scrollTop(f)}},clean:function(){this._unbindScroll(),f.core.View.prototype.clean.call(this)}})},{"cartodb.js":"cartodb.js",jquery:"jquery",underscore:"underscore"}],83:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<ul class="CDB-Widget-list CDB-Widget-list--withBorders"> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> </ul>';return __p}},{underscore:"underscore"}],84:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./placeholder.tpl"),g=a("./histogram-view");b.exports=e.core.View.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this.model.dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._isDataEmpty()?this.$el.append(f({hasTorqueLayer:!1})):(this._createHistogramView(),this._updateRange()),this},_createHistogramView:function(){this._histogramView&&this._histogramView.remove(),this._histogramView=new g({timeseriesModel:this.model,model:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:this._dataviewModel.layer}),this._appendView(this._histogramView)},_updateRange:function(){var a=this._calculateBars(),b=a.loBarIndex,c=a.hiBarIndex;(0!==b||c!==this._dataviewModel.get("bins"))&&this._histogramView.selectRange(b,c)},_setRange:function(a,b){var c=this._dataviewModel.getData(),d=this._dataviewModel.filter;c&&c.length&&a&&b&&d.setRange(c[a].start,c[b-1].end)},_calculateBars:function(){var a,b,c=this._dataviewModel.getData(),e=this.model.get("min"),f=this.model.get("max"),g=this.model.get("lo_index"),h=this.model.get("hi_index");return c.length>0?(d.isNumber(e)||d.isNumber(g)?d.isNumber(e)&&!d.isNumber(g)&&(a=d.findWhere(c,{start:e}),g=a&&a.bin||0):g=0,d.isNumber(f)||d.isNumber(h)?d.isNumber(f)&&!d.isNumber(h)&&(b=d.findWhere(c,{end:f}),h=b&&b.bin+1||c.length):h=c.length):(g=0,h=c.length),{loBarIndex:g,hiBarIndex:h}},_initBinds:function(){this._originalData.once("change:data",this._onOriginalDataChange,this),this._dataviewModel.once("error",function(){console.log("the tiler does not support non-torque layers just yet…")}),this._dataviewModel.once("change:data",this.render,this),this.add_related_model(this._dataviewModel),this.add_related_model(this._originalData)},_appendView:function(a){this.addView(a),this.$el.append(a.render().el)},_isDataEmpty:function(){var a=this._dataviewModel.getData();return d.isEmpty(a)||0===d.size(a)},_onOriginalDataChange:function(){this._dataviewModel.fetch()}})},{"./histogram-view":85,"./placeholder.tpl":86,"cartodb.js":"cartodb.js",underscore:"underscore"}],85:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("../histogram/chart"),g=a("./time-series-header-view");b.exports=e.core.View.extend({className:"CDB-Widget-content CDB-Widget-content--timeSeries",defaults:{mobileThreshold:960,histogramChartHeight:72,histogramChartMobileHeight:24},initialize:function(){this._timeseriesModel=this.options.timeseriesModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this.model.getUnfilteredDataModel(),this.model.bind("change:data",this._onChangeData,this)},render:function(){return this.clearSubViews(),this._createHeaderView(),this._createHistogramView(),this},_createHeaderView:function(){var a=new g({dataviewModel:this.model,rangeFilter:this._rangeFilter});a.bind("resetFilter",this._onResetFilter,this),this.addView(a),this.$el.append(a.render().el)},selectRange:function(a,b){this._chartView.selectRange(a,b)},_createHistogramView:function(){this._chartView=new f({type:"time",chartBarColor:this._timeseriesModel.getWidgetColor()||"#F2CC8F",animationSpeed:100,margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,animationBarDelay:function(a,b){return 3*b},height:this.defaults.histogramChartHeight,data:this.model.getData(),originalData:this._originalData,displayShadowBars:!0,widgetModel:this._timeseriesModel}),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this._chartView.bind("on_brush_end",this._onBrushEnd,this),this._chartView.model.bind("change:width",this._onChangeChartWidth,this),this.add_related_model(this._chartView.model)},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this.model.getData()),this._chartView.updateXScale(),this._chartView.updateYScale())},_onResetFilter:function(){this._rangeFilter.unsetRange(),this._chartView.removeSelection(),this._timeseriesModel.set({lo_index:null,hi_index:null})},_onBrushEnd:function(a,b){var c=this.model.getData();this._rangeFilter.setRange(c[a].start,c[b-1].end),this._timeseriesModel.set({lo_index:a,hi_index:b})},_onChangeChartWidth:function(){var a=d(window).width()<this.defaults.mobileThreshold;this._chartView.toggleLabels(!a);var b=a?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",b)}})},{"../histogram/chart":69,"./time-series-header-view":87,"cartodb.js":"cartodb.js",jquery:"jquery"}],86:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="CDB-Widget-header CDB-Widget-header--timeSeries"> ',hasTorqueLayer&&(__p+=' <div class="CDB-Widget-timeSeriesFakeControl"></div> <div class="CDB-Widget-timeSeriesTimeInfo CDB-Widget-timeSeriesTimeInfo--fake"></div> '),__p+=' </div> <div class="CDB-Widget-content CDB-Widget-content--timeSeries"> <div class="CDB-Widget-timeSeriesFakeChart ',hasTorqueLayer&&(__p+="CDB-Widget-timeSeriesFakeChart--torque"),__p+='"> ';for(var i=0;50>i;i++)__p+=' <div class="CDB-Widget-timeSeriesFakeChartItem" style="height: '+(null==(__t=Math.floor(100*Math.random()))?"":_.escape(__t))+'%"></div> ';__p+=" </div> </div>"}return __p}},{underscore:"underscore"}],87:[function(a,b,c){var d=a("cartodb.js"),e=a("./time-series-header.tpl"),f=a("d3"),g={number:f.format(",.0f"),time:f.time.format("%H:%M"),date:f.time.format("%x")};b.exports=d.core.View.extend({className:"CDB-Widget-header--timeSeries js-header CDB-Widget-contentSpaced",events:{"click .js-clear":"_onClick"},options:{showClearButton:!0},initialize:function(a){if(!a.dataviewModel)throw new Error("dataviewModel is required");if(!a.rangeFilter)throw new Error("rangeFilter is required");this._dataviewModel=a.dataviewModel,this._rangeFilter=a.rangeFilter,this._layer=this._dataviewModel.layer,this._setupScales(),this._initBinds()},render:function(){var a,b,c=this._getColumnType(),d=this._scale,f=this._rangeFilter;if(f.isEmpty())this.$el.empty();else{if("date"===c){var h=new Date(d.invert(f.get("min"))),i=new Date(d.invert(f.get("max")));a=g.time(h)+" "+g.date(h),b=g.time(i)+" "+g.date(i)}else a=g.number(d(f.get("min"))),b=g.number(d(f.get("max")));this.$el.html(e({start:a,end:b,showClearButton:this.options.showClearButton}))}return this},_initBinds:function(){this._rangeFilter.bind("change",this.render,this),this.add_related_model(this._rangeFilter)},_getColumnType:function(){return this._layer.get("column_type")||this._dataviewModel.get("column_type")},_setupScales:function(){var a=this._dataviewModel.get("data"),b=this._getColumnType();"date"===b?this._scale=f.time.scale().domain([1e3*a[0].start,1e3*a[a.length-1].end]).nice().range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]):this._scale=f.scale.linear().domain([a[0].start,a[a.length-1].end]).nice().range([this._dataviewModel.get("start"),this._dataviewModel.get("end")])},_onClick:function(){this.trigger("resetFilter",this)}})},{"./time-series-header.tpl":88,"cartodb.js":"cartodb.js",d3:13}],88:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div> <p class="CDB-Text CDB-Size-large u-iBlock">Selected from</p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock">'+(null==(__t=start)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-large u-iBlock">to</p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock">'+(null==(__t=end)?"":_.escape(__t))+"</p> </div> ",showClearButton&&(__p+=' <div> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">Clear selection</button> </div> '),__p+="";return __p}},{underscore:"underscore"}],89:[function(a,b,c){var d=a("../widget-model"),e=a("underscore");b.exports=d.extend({getState:function(){var a,b,c=d.prototype.getState.call(this),f=this.dataviewModel.get("start"),g=this.dataviewModel.get("end"),h=this.dataviewModel.get("data"),i=this.get("lo_index"),j=this.get("hi_index"),k=function(a,b){return e.isNumber(a)&&e.isNumber(b)&&a!==b&&Math.abs(a-b)>.01*Math.abs(f-g)?!0:!1};return e.isNumber(i)&&e.isNumber(j)?(a=h[i].start,b=h[j-1].end):(a=f,b=g),k(f,a)&&(c.min=a),k(g,b)&&(c.max=b),c}})},{"../widget-model":105,underscore:"underscore"}],90:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./torque-template.tpl"),g=a("./placeholder.tpl"),h=a("./torque-histogram-view"),i=a("./torque-header-view");b.exports=e.core.View.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){if(this.clearSubViews(),this._isDataEmpty())this.$el.html(g({hasTorqueLayer:!0}));else{this.$el.html(f());var a=this._dataviewModel.layer;this._appendView(new i({el:this.$(".js-header"),dataviewModel:this._dataviewModel,torqueLayerModel:a}));var b=new h({dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:a});this._appendView(b),this.$el.append(b.el)}return this},_initBinds:function(){this._originalData.once("change:data",this._onOriginalDataChange,this),this.add_related_model(this._originalData),this._dataviewModel.once("change:data",this.render,this),this.add_related_model(this._dataviewModel)},_appendView:function(a){this.addView(a),a.render()},_isDataEmpty:function(){var a=this._dataviewModel.getData();return d.isEmpty(a)||0===d.size(a)},_onOriginalDataChange:function(){this._dataviewModel.fetch()}})},{"./placeholder.tpl":86,"./torque-header-view":93,"./torque-histogram-view":94,"./torque-template.tpl":98,"cartodb.js":"cartodb.js",underscore:"underscore"}],91:[function(a,b,c){var d=a("cartodb.js"),e=a("./torque-controls.tpl");b.exports=d.core.View.extend({tagName:"button",className:"CDB-Widget-controlButton",events:{click:"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._torqueLayerModel.bind("change:isRunning",this.render,this),this.add_related_model(this._torqueLayerModel)},render:function(){return this.$el.html(e({iconClass:"CDB-Widget-controlButtonIcon CDB-Widget-controlButtonIcon--"+(this._torqueLayerModel.get("isRunning")?"pause":"play")})),this},_onClick:function(){this._torqueLayerModel.get("isRunning")?this._torqueLayerModel.pause():this._torqueLayerModel.play()}})},{"./torque-controls.tpl":92,"cartodb.js":"cartodb.js"}],92:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-controlButtonContent"> <i class="'+(null==(__t=iconClass)?"":_.escape(__t))+'"></i> </div>';return __p}},{underscore:"underscore"}],93:[function(a,b,c){var d=a("cartodb.js"),e=a("./torque-controls-view"),f=a("./torque-time-info-view"),g=a("./time-series-header-view"),h=a("./torque-reset-render-range-view");b.exports=d.core.View.extend({initialize:function(){this._dataviewModel=this.options.dataviewModel,this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this._dataviewModel.filter,this._rangeFilter.bind("change",this.render,this),this.add_related_model(this._rangeFilter)},render:function(){return this.clearSubViews(),this._rangeFilter.isEmpty()?(this.el.classList.remove("CDB-Widget-contentSpaced"),this._appendView(new e({torqueLayerModel:this._torqueLayerModel})),this._appendView(new f({dataviewModel:this._dataviewModel,torqueLayerModel:this._torqueLayerModel}))):(this.el.classList.add("CDB-Widget-contentSpaced"),this._appendView(new g({dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,events:{},showClearButton:!1})),this._appendView(new h({torqueLayerModel:this._torqueLayerModel}))),this},_appendView:function(a){this.addView(a),this.$el.append(a.el),a.render()}})},{"./time-series-header-view":87,"./torque-controls-view":91,"./torque-reset-render-range-view":96,"./torque-time-info-view":99,"cartodb.js":"cartodb.js"}],94:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("../histogram/chart"),g=a("./torque-time-slider-view");b.exports=e.core.View.extend({className:"CDB-Widget-content CDB-Widget-content--timeSeries",defaults:{mobileThreshold:960,histogramChartHeight:72,histogramChartMobileHeight:24},initialize:function(){if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.rangeFilter)throw new Error("rangeFilter is required");this._dataviewModel=this.options.dataviewModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._torqueLayerModel=this.options.torqueLayerModel,this._initBinds()},render:function(){return this.clearSubViews(),this._createHistogramView(),this},_initBinds:function(){this._torqueLayerModel.bind("change:renderRange",this._onRenderRangeChanged,this),this._torqueLayerModel.bind("change:steps change:start change:end",this._reSelectRange,this),this.add_related_model(this._torqueLayerModel),this._dataviewModel.bind("change:data",this._onChangeData,this),this.add_related_model(this._dataviewModel)},_createHistogramView:function(){var a="date"===this._torqueLayerModel.get("column_type")?"time":"number",b=this._parent.model;this._chartView=new f({type:a,animationSpeed:100,animationBarDelay:function(a,b){return 3*b},chartBarColor:b.getWidgetColor()||"#F2CC8F",margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,height:this.defaults.histogramChartHeight,data:this._dataviewModel.getData(),originalData:this._originalData,widgetModel:b,displayShadowBars:!0}),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this._chartView.bind("on_brush_end",this._onBrushEnd,this),this._chartView.model.bind("change:width",this._onChangeChartWidth,this),this.add_related_model(this._chartView.model);var c=new g({dataviewModel:this._dataviewModel,chartView:this._chartView,torqueLayerModel:this._torqueLayerModel});this.addView(c),c.render()},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this._dataviewModel.getData()),this._chartView.updateXScale(),this._chartView.updateYScale(),this._reSelectRange())},_onRenderRangeChanged:function(a,b){void 0===b.start&&void 0===b.end&&(this._chartView.removeSelection(),this._rangeFilter.unsetRange())},_onBrushEnd:function(a,b){var c=this._dataviewModel.getData();this._rangeFilter.setRange(c[a].start,c[b-1].end),this._reSelectRange()},timeToStep:function(a){var b=this._torqueLayerModel.get("steps"),c=this._torqueLayerModel.get("start"),d=this._torqueLayerModel.get("end"),e=b*(1e3*a-c)/(d-c);return e},_reSelectRange:function(){if(!this._rangeFilter.isEmpty()){var a=this.timeToStep(this._rangeFilter.get("min")),b=this.timeToStep(this._rangeFilter.get("max")),c=this._torqueLayerModel.get("steps");this._torqueLayerModel.renderRange(this._clampRangeVal(0,c,a),this._clampRangeVal(0,c,b))}},_clampRangeVal:function(a,b,c){return Math.max(a,Math.min(b,c))},_onChangeChartWidth:function(){var a=d(window).width()<this.defaults.mobileThreshold;this._chartView.toggleLabels(!a);var b=a?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",b)}})},{"../histogram/chart":69,"./torque-time-slider-view":101,"cartodb.js":"cartodb.js",jquery:"jquery"}],95:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="CDB-Text CDB-Size-large u-iBlock"> '+(null==(__t=number)?"":_.escape(__t))+" </p>";return __p}},{underscore:"underscore"}],96:[function(a,b,c){var d=a("cartodb.js"),e=a("./torque-reset-render-range.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-filterButtons",events:{"click .js-clear":"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel},render:function(){return this.$el.html(e()),this},_onClick:function(){this._torqueLayerModel.resetRenderRange()}})},{"./torque-reset-render-range.tpl":97,"cartodb.js":"cartodb.js"}],97:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">Clear selection</button>';return __p}},{underscore:"underscore"}],98:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header CDB-Widget-header--timeSeries js-header"></div>';return __p}},{underscore:"underscore"}],99:[function(a,b,c){var d=a("d3"),e=a("cartodb.js"),f=a("./torque-time-info.tpl"),g=a("./torque-number-info.tpl"),h={number:d.format(",.0f"),time:d.time.format("%H:%M"),date:d.time.format("%x")};b.exports=e.core.View.extend({className:"CDB-Widget-timeSeriesTimeInfo",initialize:function(a){if(!a.torqueLayerModel)throw new Error("torqueLayerModel is required");if(!a.dataviewModel)throw new Error("dataviewModel is required");this._torqueLayerModel=this.options.torqueLayerModel,this._dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var a=this._dataviewModel.get("data"),b=this._torqueLayerModel.get("time"),c=this._torqueLayerModel.get("step"),e=this._torqueLayerModel.get("column_type"),i="number"===e?g:f,j=d.scale.linear().domain([0,a.length]).nice().range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]),k="";return"number"===e?k=i({number:h.number(j(c))}):"date"!==e||isNaN(b&&b.getTime())||(k=i({time:h.time(b),date:h.date(b)})),this.$el.html(k),this},_initBinds:function(){this._torqueLayerModel.bind("change:step",this.render,this),this.add_related_model(this._torqueLayerModel)}})},{"./torque-number-info.tpl":95,"./torque-time-info.tpl":100,"cartodb.js":"cartodb.js",d3:13}],100:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="CDB-Text CDB-Size-large u-iBlock"> '+(null==(__t=time)?"":_.escape(__t))+' </p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock"> '+(null==(__t=date)?"":_.escape(__t))+" </p>";return __p}},{underscore:"underscore"}],101:[function(a,b,c){var d=a("d3"),e=a("cartodb.js");b.exports=e.core.View.extend({defaults:{width:4,height:8},initialize:function(){if(!this.options.chartView)throw new Error("chartView is required");if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");this.model=new e.core.Model,this._dataviewModel=this.options.dataviewModel,this._chartView=this.options.chartView,this._torqueLayerModel=this.options.torqueLayerModel,this._initBinds(),this._updateXScale()},render:function(){if(!this.timeSlider){var a=d.behavior.drag().on("dragstart",this._onDragStart.bind(this)).on("drag",this._onDrag.bind(this)).on("dragend",this._onDragEnd.bind(this)),b=this._chartView.canvas.append("rect");this.timeSlider=b.attr("class","CDB-TimeSlider").attr("width",this.defaults.width).attr("height",this._calcHeight()).attr("rx",3).attr("ry",3).data([{x:0,y:0}]).attr("transform",this._translateXY).call(a)}return this.setElement(b.node()),this},_initBinds:function(){this._torqueLayerModel.bind("change:start change:end",this._updateChartandTimeslider,this),this._torqueLayerModel.bind("change:step",this._onChangeStep,this),this._torqueLayerModel.bind("change:steps",this._updateChartandTimeslider,this),this.add_related_model(this._torqueLayerModel),this._chartView.model.bind("change:width",this._updateChartandTimeslider,this),this._chartView.model.bind("change:height",this._onChangeChartHeight,this),this.add_related_model(this._chartView.model),this._dataviewModel.on("change:bins",this._updateChartandTimeslider,this),this.add_related_model(this._dataviewModel),this._dataviewModel.filter.on("change:min change:max",this._onFilterMinMaxChange,this),this.add_related_model(this._dataviewModel.filter)},clean:function(){this.timeSlider&&this.timeSlider.remove(),e.core.View.prototype.clean.call(this)},_onDragStart:function(){var a=this._torqueLayerModel.get("isRunning");a&&this._torqueLayerModel.pause(),this.model.set({isDragging:!0,wasRunning:a})},_onDrag:function(a,b){var c=a.x+d.event.dx;if(this._isWithinRange(c)){a.x=c,this.timeSlider.attr("transform",this._translateXY);var e=Math.round(this._xScale.invert(a.x));this._torqueLayerModel.setStep(e)}},_onDragEnd:function(){this.model.set("isDragging",!1),this.model.get("wasRunning")&&this._torqueLayerModel.play()},_translateXY:function(a){return"translate("+[a.x,a.y]+")"},_isWithinRange:function(a){return a>=0&&a<=this._width()},_onChangeStep:function(){if(this.timeSlider&&!this.model.get("isDragging")){var a=this.timeSlider.data(),b=this._xScale(this._torqueLayerModel.get("step"));isNaN(b)||(a[0].x=b,this.timeSlider.data(a).transition().ease("linear").attr("transform",this._translateXY))}},_onFilterMinMaxChange:function(a,b){this.$el.toggle(!b)},_onChangeChartHeight:function(){this.timeSlider.attr("height",this._calcHeight())},_updateChartandTimeslider:function(){this._updateXScale(),this._onChangeStep()},_calcHeight:function(){return this._chartView.chartHeight()+this.defaults.height},_updateXScale:function(){var a=1e3*(this._dataviewModel.get("end")-this._dataviewModel.get("start")),b=(this._torqueLayerModel.get("start")-1e3*this._dataviewModel.get("start"))/a,c=(this._torqueLayerModel.get("end")-1e3*this._dataviewModel.get("start"))/a;this._xScale=d.scale.linear().domain([0,this._torqueLayerModel.get("steps")]).range([b*this._width(),c*this._width()])},_width:function(){return this._chartView.model.get("width")}})},{"cartodb.js":"cartodb.js",d3:13}],102:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<button class="CDB-Widget-button CDB-Widget-errorButton js-refresh"> <span class="CDB-Widget-textSmall CDB-Widget-textSmall--bold">REFRESH</span> </button>';return __p}},{underscore:"underscore"}],103:[function(a,b,c){var d=a("cartodb.js"),e=a("./widget-error-template.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-error is-hidden",events:{"click .js-refresh":"_onRefreshClick"},initialize:function(){this._initBinds()},render:function(){return this.$el.html(e()),this},_initBinds:function(){this.model.bind("error",function(a,b){(!b||b&&"abort"!==b.statusText)&&this.show()},this),this.model.bind("loading loaded",this.hide,this)},_onRefreshClick:function(){this.model.refresh()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},{"./widget-error-template.tpl":102,"cartodb.js":"cartodb.js"}],104:[function(a,b,c){var d=a("cartodb.js");b.exports=d.core.View.extend({className:"CDB-Loader",initialize:function(){this._initBinds()},_initBinds:function(){this.model.bind("loading",this.show,this),this.model.bind("error",function(a,b){(!b||b&&"abort"!==b.statusText)&&this.hide()},this),this.model.bind("loaded",this.hide,this)},show:function(){this.$el.addClass("is-visible"),clearTimeout(this._timeout)},hide:function(){var a=this;this._timeout=setTimeout(function(){a.$el.removeClass("is-visible")},500)}})},{"cartodb.js":"cartodb.js"}],105:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./auto-style/factory");b.exports=e.core.Model.extend({defaults:{attrsNames:[],show_stats:!1},defaultState:{collapsed:!1},initialize:function(a,b,c){c=c||{},this.dataviewModel=b.dataviewModel,this.defaults.autoStyleEnabled=c.autoStyleEnabled,this.activeAutoStyler(),this.bind("change:style",this.activeAutoStyler,this)},activeAutoStyler:function(){this.isAutoStyleEnabled()&&!this.autoStyler&&(this.autoStyler=f.get(this.dataviewModel,this.get("style")))},update:function(a){var b=d.pick(a,this.get("attrsNames"));return this.set(b),this.dataviewModel.update(a),this._triggerChangesInAutoStyle(),!(!this.changedAttributes()&&!this.dataviewModel.changedAttributes())},_triggerChangesInAutoStyle:function(){var a=this.changed&&this.changed.style&&this.changed.style.auto_style&&this.changed.style.auto_style.definition,b=this.previousAttributes(),c=b.style&&b.style.auto_style&&b.style.auto_style.definition;d.isEqual(a,c)||this.trigger("customAutoStyle",this)},remove:function(){this.dataviewModel.remove(),this.trigger("destroy",this),this.stopListening()},isAutoStyleEnabled:function(){if(!this.defaults.autoStyleEnabled)return!1;var a=this.get("style");return"category"===this.get("type")||"histogram"===this.get("type")?a&&a.auto_style?a&&a.auto_style&&a.auto_style.allowed:!0:!1},getWidgetColor:function(){var a=this.get("style");return a&&a.widget_style&&a.widget_style.definition&&a.widget_style.definition.color&&a.widget_style.definition.color.fixed},getColor:function(a){return this.isAutoStyleEnabled()&&this.isAutoStyle()&&"category"===this.get("type")?this.autoStyler.colors.getColorByCategory(a):this.getWidgetColor()},isAutoStyle:function(){return this.get("autoStyle")},autoStyle:function(){if(this.isAutoStyleEnabled()){var a=this.dataviewModel.layer,b=a.get("cartocss");!b&&a.get("meta")&&(b=a.get("meta").cartocss),a.set("initialStyle",b);var c=this.autoStyler.getStyle();a.set("cartocss",c),this.set("autoStyle",!0)}},reapplyAutoStyle:function(){var a=this.autoStyler.getStyle();this.dataviewModel.layer.set("cartocss",a),this.set("autoStyle",!0)},cancelAutoStyle:function(a){a||this.dataviewModel.layer.restoreCartoCSS(),this.set("autoStyle",!1)},getAutoStyle:function(){var a=this.get("style"),b=this.dataviewModel.layer,c=b.get("cartocss")||b.get("meta")&&b.get("meta").cartocss;if(a&&a.auto_style&&a.auto_style.definition){var e=d.extend(a.auto_style,{cartocss:c});return d.extend({},e,{definition:this.autoStyler.getDef(c)})}return{definition:this.autoStyler.getDef(c),cartocss:c}},setInitialState:function(a){this.initialState=a||{}},applyInitialState:function(){var a=d.extend(this.initialState,{hasInitialState:!0});this.setState(a)},setState:function(a){this.set(a)},getState:function(){var a={};for(var b in this.defaultState){var c=this.get(b),e=this.defaultState[b];"undefined"==typeof e||"undefined"==typeof c||d.isEqual(c,e)||(a[b]=c)}return a}})},{"./auto-style/factory":36,"cartodb.js":"cartodb.js",underscore:"underscore"}],106:[function(a,b,c){var d=a("cartodb.js"),e=a("underscore");b.exports=d.core.View.extend({className:"CDB-Widget-tooltip CDB-Widget-tooltip--light CDB-Text CDB-Size-small",options:{attribute:"data-tooltip",offsetX:10,offsetY:-28
},initialize:function(a){if(!a.target)throw new Error("target is not defined");this._$target=this.options.target,this._initBinds()},render:function(){var a=this._$target.attr(this.options.attribute);return this.$el.html(a),this},_initBinds:function(){this._$target.hover(e.bind(this.show,this),e.bind(this.hide,this))},_setPosition:function(){var a=this._$target.offset(),b=this.$el.outerWidth();this.$el.css({top:a.top+this.options.offsetY,left:a.left-b/2+this.options.offsetX})},show:function(){this.render(),this._setPosition(),d.core.View.prototype.show.call(this)},clean:function(){this._$target.off("mouseenter mouseleave"),d.core.View.prototype.clean.call(this)}})},{"cartodb.js":"cartodb.js",underscore:"underscore"}],107:[function(a,b,c){var d=a("underscore"),e=a("./widget-view"),f=function(a){this.defs=[],d.each(a,function(a){this.addType(a)},this)};f.prototype.DEFAULT_CLASS_NAMES="CDB-Widget CDB-Widget--light",f.prototype.addType=function(a){if(!a.match){if(!a.type)throw new Error("def.type or def.match must be provided for createContentView to work");a.match=function(a){return a.get("type")===this.type}}if(!d.isFunction(a.createContentView))throw new Error("def.createContentView must be a function");this.defs.push(a)},f.prototype.createWidgetView=function(a){var b=d.find(this.defs,function(b){return b.match(a)});if(b){var c={className:this.DEFAULT_CLASS_NAMES,model:a,contentView:b.createContentView(a)};return new e(d.isFunction(b.customizeWidgetAttrs)?b.customizeWidgetAttrs(c):c)}},b.exports=f},{"./widget-view":108,underscore:"underscore"}],108:[function(a,b,c){var d=a("cartodb.js"),e=a("./widget-loader-view"),f=a("./widget-error-view");b.exports=d.core.View.extend({className:"CDB-Widget CDB-Widget--light",options:{columns_title:[]},initialize:function(){this.listenTo(this.model,"destroy",this.clean)},render:function(){var a=this.model.dataviewModel;return a&&(this._appendView(new e({model:a})),this._appendView(new f({model:a}))),this._appendView(this.options.contentView),this},_appendView:function(a){this.$el.append(a.render().el),this.addView(a)}})},{"./widget-error-view":103,"./widget-loader-view":104,"cartodb.js":"cartodb.js"}],109:[function(a,b,c){var d=a("underscore"),e=a("backbone");b.exports=e.Collection.extend({comparator:"order",initialize:function(){this._allDataviewsFetched=!1,this._initBinds()},_initBinds:function(){this.bind("change:order",d.debounce(this._onChangeOrder.bind(this),10),this),this.bind("change:autoStyle",function(a,b){b&&this.each(function(b){b.dataviewModel&&b!==a&&b.dataviewModel.layer.get("layer_name")===a.dataviewModel.layer.get("layer_name")&&b.get("autoStyle")&&b.set("autoStyle",!1)})},this)},_onChangeOrder:function(){this.sort(),this.trigger("orderChanged",this)},getStates:function(){var a={};return this.each(function(b){var c=b.getState();d.isEmpty(c)||(a[b.get("id")]=c)}),a},setStates:function(a){for(var b in a){var c=this.at(b);c.setState(a[b])}},hasInitialState:function(){return this._allDataviewsFetched},initialState:function(){this._allDataviewsFetched=!0}})},{backbone:"backbone",underscore:"underscore"}],110:[function(a,b,c){!function(d,e){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],e):"function"==typeof a&&"object"==typeof c?b.exports=e(a("underscore"),a("backbone")):d.Backbone.Poller=e(d._,d.Backbone)}(this,function(a,b){"use strict";function c(b){return a.find(k,function(a){return a.model===b})}function d(c,d){this.model=c,this.cid=a.uniqueId("poller"),this.set(d),this.model instanceof b.Model&&this.listenTo(this.model,"destroy",this.destroy)}function e(b){if(h(b)){var c=a.extend({},b.options,{success:function(a,c){b.trigger("success",a,c),g(b)},error:function(a,c){b.options.continueOnError?(b.trigger("error",a,c),g(b)):(b.stop({silent:!0}),b.trigger("error",a,c))}});b.trigger("fetch",b.model),b.xhr=b.model.fetch(c)}}function f(b){if(a.isNumber(b.options.delay))return b.options.delay;var c=b.options.delay[0],d=b.options.delay[1],e=b.options.delay[2]||2;m[b.cid]?a.isFunction(e)?m[b.cid]=e(m[b.cid]):m[b.cid]*=e:m[b.cid]=1;var f=Math.round(c*m[b.cid]);return d&&d>0&&(f=Math.min(f,d)),f}function g(b,c){h(b)&&(b.timeoutId=a.delay(e,c||f(b),b))}function h(a){return a.options.active?a.options.condition(a.model)!==!0?(a.stop({silent:!0}),a.trigger("complete",a.model),!1):!0:!1}var i={delay:1e3,condition:function(){return!0}},j=["start","stop","fetch","success","error","complete"],k=[],l={get:function(a,b){var e=c(a);return e?e.set(b):(e=new d(a,b),k.push(e)),b&&b.autostart===!0&&e.start({silent:!0}),e},size:function(){return k.length},reset:function(){for(;k.length;)k[0].destroy()}};a.extend(d.prototype,b.Events,{set:function(b){return this.options=a.extend({},i,b||{}),this.options.flush&&this.off(),a.each(j,function(b){var c=this.options[b];a.isFunction(c)&&(this.off(b,c,this),this.on(b,c,this))},this),this.stop({silent:!0})},start:function(b){return this.active()||(b&&b.silent||this.trigger("start",this.model),this.options.active=!0,this.options.delayed?g(this,a.isNumber(this.options.delayed)&&this.options.delayed):e(this)),this},stop:function(a){return a&&a.silent||this.trigger("stop",this.model),this.options.active=!1,this.xhr&&this.xhr.abort&&this.xhr.abort(),this.xhr=null,clearTimeout(this.timeoutId),this.timeoutId=null,this},active:function(){return this.options.active===!0},destroy:function(){var b=a.indexOf(k,this);b>-1&&(this.stop().stopListening().off(),k.splice(b,1))}});var m={};return l.getDelay=f,l.prototype=d.prototype,l})},{backbone:"backbone",underscore:"underscore"}],111:[function(a,b,c){!function(a){function b(a){return a}function c(a,b){for(var c=0,d=b.length,e=new Array(d);d>c;++c)e[c]=a[b[c]];return e}function d(a){function b(b,c,d,e){for(;e>d;){var f=d+e>>>1;a(b[f])<c?d=f+1:e=f}return d}function c(b,c,d,e){for(;e>d;){var f=d+e>>>1;c<a(b[f])?e=f:d=f+1}return d}return c.right=c,c.left=b,c}function e(a){function b(a,b,c){for(var e=c-b,f=(e>>>1)+1;--f>0;)d(a,f,e,b);return a}function c(a,b,c){for(var e,f=c-b;--f>0;)e=a[b],a[b]=a[b+f],a[b+f]=e,d(a,1,f,b);return a}function d(b,c,d,e){for(var f,g=b[--e+c],h=a(g);(f=c<<1)<=d&&(d>f&&a(b[e+f])>a(b[e+f+1])&&f++,!(h<=a(b[e+f])));)b[e+c]=b[e+f],c=f;b[e+c]=g}return b.sort=c,b}function f(a){function b(b,d,e,f){var g,h,i,j,k=new Array(f=Math.min(e-d,f));for(h=0;f>h;++h)k[h]=b[d++];if(c(k,0,f),e>d){g=a(k[0]);do(i=a(j=b[d])>g)&&(k[0]=j,g=a(c(k,0,f)[0]));while(++d<e)}return k}var c=e(a);return b}function g(a){function b(b,c,d){for(var e=c+1;d>e;++e){for(var f=e,g=b[e],h=a(g);f>c&&a(b[f-1])>h;--f)b[f]=b[f-1];b[f]=g}return b}return b}function h(a){function b(a,b,e){return(D>e-b?d:c)(a,b,e)}function c(c,d,e){var f,g=(e-d)/6|0,h=d+g,i=e-1-g,j=d+e-1>>1,k=j-g,l=j+g,m=c[h],n=a(m),o=c[k],p=a(o),q=c[j],r=a(q),s=c[l],t=a(s),u=c[i],v=a(u);n>p&&(f=m,m=o,o=f,f=n,n=p,p=f),t>v&&(f=s,s=u,u=f,f=t,t=v,v=f),n>r&&(f=m,m=q,q=f,f=n,n=r,r=f),p>r&&(f=o,o=q,q=f,f=p,p=r,r=f),n>t&&(f=m,m=s,s=f,f=n,n=t,t=f),r>t&&(f=q,q=s,s=f,f=r,r=t,t=f),p>v&&(f=o,o=u,u=f,f=p,p=v,v=f),p>r&&(f=o,o=q,q=f,f=p,p=r,r=f),t>v&&(f=s,s=u,u=f,f=t,t=v,v=f);var w=o,x=p,y=s,z=t;c[h]=m,c[k]=c[d],c[j]=q,c[l]=c[e-1],c[i]=u;var A=d+1,B=e-2,C=z>=x&&x>=z;if(C)for(var D=A;B>=D;++D){var E=c[D],F=a(E);if(x>F)D!==A&&(c[D]=c[A],c[A]=E),++A;else if(F>x)for(;;){var G=a(c[B]);{if(!(G>x)){if(x>G){c[D]=c[A],c[A++]=c[B],c[B--]=E;break}c[D]=c[B],c[B--]=E;break}B--}}}else for(var D=A;B>=D;D++){var E=c[D],F=a(E);if(x>F)D!==A&&(c[D]=c[A],c[A]=E),++A;else if(F>z)for(;;){var G=a(c[B]);{if(!(G>z)){x>G?(c[D]=c[A],c[A++]=c[B],c[B--]=E):(c[D]=c[B],c[B--]=E);break}if(B--,D>B)break}}}if(c[d]=c[A-1],c[A-1]=w,c[e-1]=c[B+1],c[B+1]=y,b(c,d,A-1),b(c,B+2,e),C)return c;if(h>A&&B>i){for(var H,G;(H=a(c[A]))<=x&&H>=x;)++A;for(;(G=a(c[B]))<=z&&G>=z;)--B;for(var D=A;B>=D;D++){var E=c[D],F=a(E);if(x>=F&&F>=x)D!==A&&(c[D]=c[A],c[A]=E),A++;else if(z>=F&&F>=z)for(;;){var G=a(c[B]);{if(!(z>=G&&G>=z)){x>G?(c[D]=c[A],c[A++]=c[B],c[B--]=E):(c[D]=c[B],c[B--]=E);break}if(B--,D>B)break}}}}return b(c,A,B+1)}var d=g(a);return b}function i(a){for(var b=new Array(a),c=-1;++c<a;)b[c]=0;return b}function j(a,b){for(var c=a.length;b>c;)a[c++]=0;return a}function k(a,b){if(b>32)throw new Error("invalid array width!");return a}function l(a,b){return function(c){var d=c.length;return[a.left(c,b,0,d),a.right(c,b,0,d)]}}function m(a,b){var c=b[0],d=b[1];return function(b){var e=b.length;return[a.left(b,c,0,e),a.left(b,d,0,e)]}}function n(a){return[0,a.length]}function o(){return null}function p(){return 0}function q(a){return a+1}function r(a){return a-1}function s(a){return function(b,c){return b+ +a(c)}}function t(a){return function(b,c){return b-a(c)}}function u(){function a(a){var b=z,c=a.length;return c&&(u=u.concat(a),C=H(C,z+=c),F.forEach(function(d){d(a,b,c)})),k}function d(){for(var a=v(z,z),b=[],c=0,d=0;z>c;++c)C[c]?a[c]=d++:b.push(c);D.forEach(function(a){a(0,[],b)}),G.forEach(function(b){b(a)});for(var e,c=0,d=0;z>c;++c)(e=C[c])&&(c!==d&&(C[d]=e,u[d]=u[c]),++d);for(u.length=d;z>d;)C[--z]=0}function g(a){function d(b,d,e){U=b.map(a),V=$(w(e),0,e),U=c(U,V);var f,g=_(U),h=g[0],i=g[1];if(W)for(f=0;e>f;++f)W(U[f],f)||(C[V[f]+d]|=Y);else{for(f=0;h>f;++f)C[V[f]+d]|=Y;for(f=i;e>f;++f)C[V[f]+d]|=Y}if(!d)return S=U,T=V,ca=h,void(da=i);var j=S,k=T,l=0,m=0;for(S=new Array(z),T=v(z,z),f=0;d>l&&e>m;++f)j[l]<U[m]?(S[f]=j[l],T[f]=k[l++]):(S[f]=U[m],T[f]=V[m++]+d);for(;d>l;++l,++f)S[f]=j[l],T[f]=k[l];for(;e>m;++m,++f)S[f]=U[m],T[f]=V[m]+d;g=_(S),ca=g[0],da=g[1]}function g(a,b,c){aa.forEach(function(a){a(U,V,b,c)}),U=V=null}function i(a){for(var b,c=0,d=0;z>c;++c)C[b=T[c]]&&(c!==d&&(S[d]=S[c]),T[d]=a[b],++d);for(S.length=d;z>d;)T[d++]=0;var e=_(S);ca=e[0],da=e[1]}function j(a){var b=a[0],c=a[1];if(W)return W=null,M(function(a,d){return d>=b&&c>d}),ca=b,da=c,X;var d,e,f,g=[],h=[];if(ca>b)for(d=b,e=Math.min(ca,c);e>d;++d)C[f=T[d]]^=Y,g.push(f);else if(b>ca)for(d=ca,e=Math.min(b,da);e>d;++d)C[f=T[d]]^=Y,h.push(f);if(c>da)for(d=Math.max(b,da),e=c;e>d;++d)C[f=T[d]]^=Y,g.push(f);else if(da>c)for(d=Math.max(ca,c),e=da;e>d;++d)C[f=T[d]]^=Y,h.push(f);return ca=b,da=c,D.forEach(function(a){a(Y,g,h)}),X}function k(a){return null==a?K():Array.isArray(a)?J(a):"function"==typeof a?L(a):E(a)}function E(a){return j((_=l(y,a))(S))}function J(a){return j((_=m(y,a))(S))}function K(){return j((_=n)(S))}function L(a){return _=n,M(W=a),ca=0,da=z,X}function M(a){var b,c,d,e=[],f=[];for(b=0;z>b;++b)!(C[c=T[b]]&Y)^!!(d=a(S[b],b))&&(d?(C[c]&=Z,e.push(c)):(C[c]|=Y,f.push(c)));D.forEach(function(a){a(Y,e,f)})}function N(a){for(var b,c=[],d=da;--d>=ca&&a>0;)C[b=T[d]]||(c.push(u[b]),--a);return c}function O(a){for(var b,c=[],d=ca;da>d&&a>0;)C[b=T[d]]||(c.push(u[b]),--a),d++;return c}function P(a){function c(b,c,d,e){function f(){++U===R&&(s=I(s,Q<<=1),K=I(K,Q),R=x(Q))}var k,l,m,n,p,q,r=J,s=v(U,R),t=N,w=P,y=U,A=0,B=0;for(X&&(t=w=o),J=new Array(U),U=0,K=y>1?H(K,z):v(z,R),y&&(m=(l=r[0]).key);e>B&&!((n=a(b[B]))>=n);)++B;for(;e>B;){for(l&&n>=m?(p=l,q=m,s[A]=U,(l=r[++A])&&(m=l.key)):(p={key:n,value:w()},q=n),J[U]=p;!(n>q||(K[k=c[B]+d]=U,C[k]&Z||(p.value=t(p.value,u[k])),++B>=e));)n=a(b[B]);f()}for(;y>A;)J[s[A]=U]=r[A++],f();if(U>A)for(A=0;d>A;++A)K[A]=s[K[A]];k=D.indexOf(V),U>1?(V=g,W=i):(!U&&$&&(U=1,J=[{key:null,value:w()}]),1===U?(V=h,W=j):(V=o,W=o),K=null),D[k]=V}function d(){if(U>1){for(var a=U,b=J,c=v(a,a),d=0,e=0;z>d;++d)C[d]&&(c[K[e]=K[d]]=1,++e);for(J=[],U=0,d=0;a>d;++d)c[d]&&(c[d]=U++,J.push(b[d]));if(U>1)for(var d=0;e>d;++d)K[d]=c[K[d]];else K=null;D[D.indexOf(V)]=U>1?(W=i,V=g):1===U?(W=j,V=h):W=V=o}else if(1===U){if($)return;for(var d=0;z>d;++d)if(C[d])return;J=[],U=0,D[D.indexOf(V)]=V=W=o}}function g(a,b,c){if(a!==Y&&!X){var d,e,f,g;for(d=0,f=b.length;f>d;++d)C[e=b[d]]&Z||(g=J[K[e]],g.value=N(g.value,u[e]));for(d=0,f=c.length;f>d;++d)(C[e=c[d]]&Z)===a&&(g=J[K[e]],g.value=O(g.value,u[e]))}}function h(a,b,c){if(a!==Y&&!X){var d,e,f,g=J[0];for(d=0,f=b.length;f>d;++d)C[e=b[d]]&Z||(g.value=N(g.value,u[e]));for(d=0,f=c.length;f>d;++d)(C[e=c[d]]&Z)===a&&(g.value=O(g.value,u[e]))}}function i(){var a,b;for(a=0;U>a;++a)J[a].value=P();for(a=0;z>a;++a)C[a]&Z||(b=J[K[a]],b.value=N(b.value,u[a]))}function j(){var a,b=J[0];for(b.value=P(),a=0;z>a;++a)C[a]&Z||(b.value=N(b.value,u[a]))}function k(){return X&&(W(),X=!1),J}function l(a){var b=L(k(),0,J.length,a);return M.sort(b,0,b.length)}function m(a,b,c){return N=a,O=b,P=c,X=!0,F}function n(){return m(q,r,p)}function w(a){return m(s(a),t(a),p)}function y(a){function b(b){return a(b.value)}return L=f(b),M=e(b),F}function A(){return y(b)}function B(){return U}function E(){var a=D.indexOf(V);return a>=0&&D.splice(a,1),a=aa.indexOf(c),a>=0&&aa.splice(a,1),a=G.indexOf(d),a>=0&&G.splice(a,1),F}var F={top:l,all:k,reduce:m,reduceCount:n,reduceSum:w,order:y,orderNatural:A,size:B,dispose:E,remove:E};ba.push(F);var J,K,L,M,N,O,P,Q=8,R=x(Q),U=0,V=o,W=o,X=!0,$=a===o;return arguments.length<1&&(a=b),D.push(V),aa.push(c),G.push(d),c(S,T,0,z),n().orderNatural()}function Q(){var a=P(o),b=a.all;return delete a.all,delete a.top,delete a.order,delete a.orderNatural,delete a.size,a.value=function(){return b()[0].value},a}function R(){ba.forEach(function(a){a.dispose()});var a=F.indexOf(d);return a>=0&&F.splice(a,1),a=F.indexOf(g),a>=0&&F.splice(a,1),a=G.indexOf(i),a>=0&&G.splice(a,1),A&=Z,K()}var S,T,U,V,W,X={filter:k,filterExact:E,filterRange:J,filterFunction:L,filterAll:K,top:N,bottom:O,group:P,groupAll:Q,dispose:R,remove:R},Y=~A&-~A,Z=~Y,$=h(function(a){return U[a]}),_=n,aa=[],ba=[],ca=0,da=0;return F.unshift(d),F.push(g),G.push(i),A|=Y,(B>=32?!Y:A&-(1<<B))&&(C=I(C,B<<=1)),d(u,0,z),g(u,0,z),X}function i(){function a(a,b){var c;if(!n)for(c=b;z>c;++c)C[c]||(i=j(i,u[c]))}function b(a,b,c){var d,e,f;if(!n){for(d=0,f=b.length;f>d;++d)C[e=b[d]]||(i=j(i,u[e]));for(d=0,f=c.length;f>d;++d)C[e=c[d]]===a&&(i=k(i,u[e]))}}function c(){var a;for(i=l(),a=0;z>a;++a)C[a]||(i=j(i,u[a]))}function d(a,b,c){return j=a,k=b,l=c,n=!0,m}function e(){return d(q,r,p)}function f(a){return d(s(a),t(a),p)}function g(){return n&&(c(),n=!1),i}function h(){var c=D.indexOf(b);return c>=0&&D.splice(c),c=F.indexOf(a),c>=0&&F.splice(c),m}var i,j,k,l,m={reduce:d,reduceCount:e,reduceSum:f,value:g,dispose:h,remove:h},n=!0;return D.push(b),F.push(a),a(u,0,z),e()}function j(){return z}var k={add:a,remove:d,dimension:g,groupAll:i,size:j},u=[],z=0,A=0,B=8,C=E(0),D=[],F=[],G=[];return arguments.length?a(arguments[0]):k}function v(a,b){return(257>b?E:65537>b?F:G)(a)}function w(a){for(var b=v(a,a),c=-1;++c<a;)b[c]=c;return b}function x(a){return 8===a?256:16===a?65536:4294967296}u.version="1.3.12",u.permute=c;var y=u.bisect=d(b);y.by=d;var z=u.heap=e(b);z.by=e;var A=u.heapselect=f(b);A.by=f;var B=u.insertionsort=g(b);B.by=g;var C=u.quicksort=h(b);C.by=h;var D=32,E=i,F=i,G=i,H=j,I=k;"undefined"!=typeof Uint8Array&&(E=function(a){return new Uint8Array(a)},F=function(a){return new Uint16Array(a)},G=function(a){return new Uint32Array(a)},H=function(a,b){if(a.length>=b)return a;var c=new a.constructor(b);return c.set(a),c},I=function(a,b){var c;switch(b){case 16:c=F(a.length);break;case 32:c=G(a.length);break;default:throw new Error("invalid array width!")}return c.set(a),c}),a.crossfilter=u}("undefined"!=typeof c&&c||this)},{}],112:[function(a,b,c){b.exports=a("./crossfilter").crossfilter},{"./crossfilter":111}],113:[function(a,b,c){!function(){var a={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],
5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}};"function"==typeof define&&define.amd?define(a):"object"==typeof b&&b.exports?b.exports=a:this.colorbrewer=a}()},{}],114:[function(a,b,c){b.exports=a("./colorbrewer.js")},{"./colorbrewer.js":113}],115:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":116}],116:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:117}],117:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],118:[function(a,b,c){(function(c,d){(function(){"use strict";function e(a){return"function"==typeof a||"object"==typeof a&&null!==a}function f(a){return"function"==typeof a}function g(a){T=a}function h(a){X=a}function i(){return function(){c.nextTick(n)}}function j(){return function(){S(n)}}function k(){var a=0,b=new $(n),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function l(){var a=new MessageChannel;return a.port1.onmessage=n,function(){a.port2.postMessage(0)}}function m(){return function(){setTimeout(n,1)}}function n(){for(var a=0;W>a;a+=2){var b=ba[a],c=ba[a+1];b(c),ba[a]=void 0,ba[a+1]=void 0}W=0}function o(){try{var b=a,c=b("vertx");return S=c.runOnLoop||c.runOnContext,j()}catch(d){return m()}}function p(a,b){var c=this,d=c._state;if(d===fa&&!a||d===ga&&!b)return this;var e=new this.constructor(r),f=c._result;if(d){var g=arguments[d-1];X(function(){H(d,e,g,f)})}else D(c,e,a,b);return e}function q(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(r);return z(c,a),c}function r(){}function s(){return new TypeError("You cannot resolve a promise with itself")}function t(){return new TypeError("A promises callback cannot return that same promise.")}function u(a){try{return a.then}catch(b){return ha.error=b,ha}}function v(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function w(a,b,c){X(function(a){var d=!1,e=v(c,b,function(c){d||(d=!0,b!==c?z(a,c):B(a,c))},function(b){d||(d=!0,C(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,C(a,e))},a)}function x(a,b){b._state===fa?B(a,b._result):b._state===ga?C(a,b._result):D(b,void 0,function(b){z(a,b)},function(b){C(a,b)})}function y(a,b,c){b.constructor===a.constructor&&c===ca&&constructor.resolve===da?x(a,b):c===ha?C(a,ha.error):void 0===c?B(a,b):f(c)?w(a,b,c):B(a,b)}function z(a,b){a===b?C(a,s()):e(b)?y(a,b,u(b)):B(a,b)}function A(a){a._onerror&&a._onerror(a._result),E(a)}function B(a,b){a._state===ea&&(a._result=b,a._state=fa,0!==a._subscribers.length&&X(E,a))}function C(a,b){a._state===ea&&(a._state=ga,a._result=b,X(A,a))}function D(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+fa]=c,e[f+ga]=d,0===f&&a._state&&X(E,a)}function E(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?H(c,d,e,f):e(f);a._subscribers.length=0}}function F(){this.error=null}function G(a,b){try{return a(b)}catch(c){return ia.error=c,ia}}function H(a,b,c,d){var e,g,h,i,j=f(c);if(j){if(e=G(c,d),e===ia?(i=!0,g=e.error,e=null):h=!0,b===e)return void C(b,t())}else e=d,h=!0;b._state!==ea||(j&&h?z(b,e):i?C(b,g):a===fa?B(b,e):a===ga&&C(b,e))}function I(a,b){try{b(function(b){z(a,b)},function(b){C(a,b)})}catch(c){C(a,c)}}function J(a){return new oa(this,a).promise}function K(a){function b(a){z(e,a)}function c(a){C(e,a)}var d=this,e=new d(r);if(!V(a))return C(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;e._state===ea&&f>g;g++)D(d.resolve(a[g]),void 0,b,c);return e}function L(a){var b=this,c=new b(r);return C(c,a),c}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(a){this._id=ma++,this._state=void 0,this._result=void 0,this._subscribers=[],r!==a&&("function"!=typeof a&&M(),this instanceof O?I(this,a):N())}function P(a,b){this._instanceConstructor=a,this.promise=new a(r),Array.isArray(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&B(this.promise,this._result))):C(this.promise,this._validationError())}function Q(){var a;if("undefined"!=typeof d)a=d;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var c=a.Promise;(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)&&(a.Promise=na)}var R;R=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var S,T,U,V=R,W=0,X=function(a,b){ba[W]=a,ba[W+1]=b,W+=2,2===W&&(T?T(n):U())},Y="undefined"!=typeof window?window:void 0,Z=Y||{},$=Z.MutationObserver||Z.WebKitMutationObserver,_="undefined"!=typeof c&&"[object process]"==={}.toString.call(c),aa="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ba=new Array(1e3);U=_?i():$?k():aa?l():void 0===Y&&"function"==typeof a?o():m();var ca=p,da=q,ea=void 0,fa=1,ga=2,ha=new F,ia=new F,ja=J,ka=K,la=L,ma=0,na=O;O.all=ja,O.race=ka,O.resolve=da,O.reject=la,O._setScheduler=g,O._setAsap=h,O._asap=X,O.prototype={constructor:O,then:ca,"catch":function(a){return this.then(null,a)}};var oa=P;P.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},P.prototype._enumerate=function(){for(var a=this.length,b=this._input,c=0;this._state===ea&&a>c;c++)this._eachEntry(b[c],c)},P.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===da){var e=u(a);if(e===ca&&a._state!==ea)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===na){var f=new c(r);y(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){b(a)}),b)}else this._willSettleAt(d(a),b)},P.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ea&&(this._remaining--,a===ga?C(d,c):this._result[b]=c),0===this._remaining&&B(d,this._result)},P.prototype._willSettleAt=function(a,b){var c=this;D(a,void 0,function(a){c._settledAt(fa,b,a)},function(a){c._settledAt(ga,b,a)})};var pa=Q,qa={Promise:na,polyfill:pa};"function"==typeof define&&define.amd?define(function(){return qa}):"undefined"!=typeof b&&b.exports?b.exports=qa:"undefined"!=typeof this&&(this.ES6Promise=qa),pa()}).call(this)}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:7}],119:[function(a,b,c){function d(a){return this instanceof d?(this.nodes=e(a),this):new d(a)}var e=a("./parse"),f=a("./walk"),g=a("./stringify");d.prototype.toString=function(){return Array.isArray(this.nodes)?g(this.nodes):""},d.prototype.walk=function(a,b){return f(this.nodes,a,b),this},d.unit=a("./unit"),d.walk=f,d.stringify=g,b.exports=d},{"./parse":120,"./stringify":121,"./unit":122,"./walk":123}],120:[function(a,b,c){var d="(".charCodeAt(0),e=")".charCodeAt(0),f="'".charCodeAt(0),g='"'.charCodeAt(0),h="\\".charCodeAt(0),i="/".charCodeAt(0),j=",".charCodeAt(0),k=":".charCodeAt(0),l="*".charCodeAt(0);b.exports=function(a){for(var b,c,m,n,o,p,q,r,s=[],t=a,u=0,v=t.charCodeAt(u),w=t.length,x=[{nodes:s}],y=0,z="",A="",B="";w>u;)if(32>=v){b=u;do b+=1,v=t.charCodeAt(b);while(32>=v);n=t.slice(u,b),m=s[s.length-1],v===e&&y?B=n:m&&"div"===m.type?m.after=n:v===j||v===k||v===i&&t.charCodeAt(b+1)!==l?A=n:s.push({type:"space",sourceIndex:u,value:n}),u=b}else if(v===f||v===g){b=u,c=v===f?"'":'"',n={type:"string",sourceIndex:u,quote:c};do if(o=!1,b=t.indexOf(c,b+1),~b)for(p=b;t.charCodeAt(p-1)===h;)p-=1,o=!o;else t+=c,b=t.length-1,n.unclosed=!0;while(o);n.value=t.slice(u+1,b),s.push(n),u=b+1,v=t.charCodeAt(u)}else if(v===i&&t.charCodeAt(u+1)===l)n={type:"comment",sourceIndex:u},b=t.indexOf("*/",u),-1===b&&(n.unclosed=!0,b=t.length),n.value=t.slice(u+2,b),s.push(n),u=b+2,v=t.charCodeAt(u);else if(v===i||v===j||v===k)n=t[u],s.push({type:"div",sourceIndex:u-A.length,value:n,before:A,after:""}),A="",u+=1,v=t.charCodeAt(u);else if(d===v){b=u;do b+=1,v=t.charCodeAt(b);while(32>=v);if(n={type:"function",sourceIndex:u-z.length,value:z,before:t.slice(u+1,b)},u=b,"url"===z&&v!==f&&v!==g){b-=1;do if(o=!1,b=t.indexOf(")",b+1),~b)for(p=b;t.charCodeAt(p-1)===h;)p-=1,o=!o;else t+=")",b=t.length-1,n.unclosed=!0;while(o);q=b;do q-=1,v=t.charCodeAt(q);while(32>=v);u!==q+1?n.nodes=[{type:"word",sourceIndex:u,value:t.slice(u,q+1)}]:n.nodes=[],n.unclosed&&q+1!==b?(n.after="",n.nodes.push({type:"space",sourceIndex:q+1,value:t.slice(q+1,b)})):n.after=t.slice(q+1,b),u=b+1,v=t.charCodeAt(u),s.push(n)}else y+=1,n.after="",s.push(n),x.push(n),s=n.nodes=[],r=n;z=""}else if(e===v&&y)u+=1,v=t.charCodeAt(u),r.after=B,B="",y-=1,x.pop(),r=x[y],s=r.nodes;else{b=u;do v===h&&(b+=1),b+=1,v=t.charCodeAt(b);while(w>b&&!(32>=v||v===f||v===g||v===j||v===k||v===i||v===d||v===e&&y));n=t.slice(u,b),d===v?z=n:s.push({type:"word",sourceIndex:u,value:n}),u=b}for(u=x.length-1;u;u-=1)x[u].unclosed=!0;return x[0].nodes}},{}],121:[function(a,b,c){function d(a,b){var c,d,f=a.type,g=a.value;return b&&void 0!==(d=b(a))?d:"word"===f||"space"===f?g:"string"===f?(c=a.quote||"",c+g+(a.unclosed?"":c)):"comment"===f?"/*"+g+(a.unclosed?"":"*/"):"div"===f?(a.before||"")+g+(a.after||""):Array.isArray(a.nodes)?(c=e(a.nodes),"function"!==f?c:g+"("+(a.before||"")+c+(a.after||"")+(a.unclosed?"":")")):g}function e(a,b){var c,e;if(Array.isArray(a)){for(c="",e=a.length-1;~e;e-=1)c=d(a[e],b)+c;return c}return d(a,b)}b.exports=e},{}],122:[function(a,b,c){var d="-".charCodeAt(0),e="+".charCodeAt(0),f=".".charCodeAt(0);b.exports=function(a){for(var b,c=0,g=a.length,h=!1,i=!1,j="";g>c;){if(b=a.charCodeAt(c),b>=48&&57>=b)j+=a[c],i=!0;else if(b===f){if(h)break;h=!0,j+=a[c]}else{if(b!==e&&b!==d)break;if(0!==c)break;j+=a[c]}c+=1}return i?{number:j,unit:a.slice(c)}:!1}},{}],123:[function(a,b,c){b.exports=function d(a,b,c){var e,f,g,h;for(e=0,f=a.length;f>e;e+=1)g=a[e],c||(h=b(g,e,a)),h!==!1&&"function"===g.type&&Array.isArray(g.nodes)&&d(g.nodes,b,c),c&&b(g,e,a)}},{}],124:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./container"),j=d(i),k=a("./warn-once"),l=d(k),m=function(a){function b(c){e(this,b);var d=f(this,a.call(this,c));return d.type="atrule",d}return g(b,a),b.prototype.append=function(){var b;this.nodes||(this.nodes=[]);for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return(b=a.prototype.append).call.apply(b,[this].concat(d))},b.prototype.prepend=function(){var b;this.nodes||(this.nodes=[]);for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return(b=a.prototype.prepend).call.apply(b,[this].concat(d))},h(b,[{key:"afterName",get:function(){return l["default"]("AtRule#afterName was deprecated. Use AtRule#raws.afterName"),this.raws.afterName},set:function(a){l["default"]("AtRule#afterName was deprecated. Use AtRule#raws.afterName"),this.raws.afterName=a}},{key:"_params",get:function(){return l["default"]("AtRule#_params was deprecated. Use AtRule#raws.params"),this.raws.params},set:function(a){l["default"]("AtRule#_params was deprecated. Use AtRule#raws.params"),this.raws.params=a}}]),b}(j["default"]);c["default"]=m,b.exports=c["default"]},{"./container":126,"./warn-once":146}],125:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./warn-once"),j=d(i),k=a("./node"),l=d(k),m=function(a){function b(c){e(this,b);var d=f(this,a.call(this,c));return d.type="comment",d}return g(b,a),h(b,[{key:"left",get:function(){return j["default"]("Comment#left was deprecated. Use Comment#raws.left"),this.raws.left},set:function(a){j["default"]("Comment#left was deprecated. Use Comment#raws.left"),this.raws.left=a}},{key:"right",get:function(){return j["default"]("Comment#right was deprecated. Use Comment#raws.right"),this.raws.right},set:function(a){j["default"]("Comment#right was deprecated. Use Comment#raws.right"),this.raws.right=a}}]),b}(l["default"]);c["default"]=m,b.exports=c["default"]},{"./node":133,"./warn-once":146}],126:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./declaration"),j=d(i),k=a("./warn-once"),l=d(k),m=a("./comment"),n=d(m),o=a("./node"),p=d(o),q=function(b){function c(){return e(this,c),f(this,b.apply(this,arguments))}return g(c,b),c.prototype.push=function(a){return a.parent=this,this.nodes.push(a),this},c.prototype.each=function(a){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;var b=this.lastEach;if(this.indexes[b]=0,!this.nodes)return void 0;for(var c=void 0,d=void 0;this.indexes[b]<this.nodes.length&&(c=this.indexes[b],d=a(this.nodes[c],c),d!==!1);)this.indexes[b]+=1;return delete this.indexes[b],d},c.prototype.walk=function(a){return this.each(function(b,c){var d=a(b,c);return d!==!1&&b.walk&&(d=b.walk(a)),d})},c.prototype.walkDecls=function(a,b){return b?a instanceof RegExp?this.walk(function(c,d){return"decl"===c.type&&a.test(c.prop)?b(c,d):void 0}):this.walk(function(c,d){return"decl"===c.type&&c.prop===a?b(c,d):void 0}):(b=a,this.walk(function(a,c){return"decl"===a.type?b(a,c):void 0}))},c.prototype.walkRules=function(a,b){return b?a instanceof RegExp?this.walk(function(c,d){return"rule"===c.type&&a.test(c.selector)?b(c,d):void 0}):this.walk(function(c,d){return"rule"===c.type&&c.selector===a?b(c,d):void 0}):(b=a,this.walk(function(a,c){return"rule"===a.type?b(a,c):void 0}))},c.prototype.walkAtRules=function(a,b){return b?a instanceof RegExp?this.walk(function(c,d){return"atrule"===c.type&&a.test(c.name)?b(c,d):void 0}):this.walk(function(c,d){return"atrule"===c.type&&c.name===a?b(c,d):void 0}):(b=a,this.walk(function(a,c){return"atrule"===a.type?b(a,c):void 0}))},c.prototype.walkComments=function(a){return this.walk(function(b,c){return"comment"===b.type?a(b,c):void 0})},c.prototype.append=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];for(var d=b,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}for(var h=g,i=this.normalize(h,this.last),j=i,k=Array.isArray(j),l=0,j=k?j:j[Symbol.iterator]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{if(l=j.next(),l.done)break;m=l.value}var n=m;this.nodes.push(n)}}return this},c.prototype.prepend=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];b=b.reverse();for(var d=b,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}for(var h=g,i=this.normalize(h,this.first,"prepend").reverse(),j=i,k=Array.isArray(j),l=0,j=k?j:j[Symbol.iterator]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{if(l=j.next(),l.done)break;m=l.value}var n=m;this.nodes.unshift(n)}for(var o in this.indexes)this.indexes[o]=this.indexes[o]+i.length}return this},c.prototype.cleanRaws=function(a){if(b.prototype.cleanRaws.call(this,a),this.nodes)for(var c=this.nodes,d=Array.isArray(c),e=0,c=d?c:c[Symbol.iterator]();;){var f;if(d){if(e>=c.length)break;f=c[e++]}else{if(e=c.next(),e.done)break;f=e.value}var g=f;g.cleanRaws(a)}},c.prototype.insertBefore=function(a,b){a=this.index(a);for(var c=0===a?"prepend":!1,d=this.normalize(b,this.nodes[a],c).reverse(),e=d,f=Array.isArray(e),g=0,e=f?e:e[Symbol.iterator]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{if(g=e.next(),g.done)break;h=g.value}var i=h;this.nodes.splice(a,0,i)}var j=void 0;for(var k in this.indexes)j=this.indexes[k],j>=a&&(this.indexes[k]=j+d.length);return this},c.prototype.insertAfter=function(a,b){a=this.index(a);for(var c=this.normalize(b,this.nodes[a]).reverse(),d=c,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;this.nodes.splice(a+1,0,h)}var i=void 0;for(var j in this.indexes)i=this.indexes[j],i>a&&(this.indexes[j]=i+c.length);return this},c.prototype.remove=function(a){return"undefined"!=typeof a?(l["default"]("Container#remove is deprecated. Use Container#removeChild"),this.removeChild(a)):b.prototype.remove.call(this),this},c.prototype.removeChild=function(a){a=this.index(a),this.nodes[a].parent=void 0,this.nodes.splice(a,1);var b=void 0;for(var c in this.indexes)b=this.indexes[c],b>=a&&(this.indexes[c]=b-1);return this},c.prototype.removeAll=function(){for(var a=this.nodes,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d;e.parent=void 0}return this.nodes=[],this},c.prototype.replaceValues=function(a,b,c){return c||(c=b,b={}),this.walkDecls(function(d){b.props&&-1===b.props.indexOf(d.prop)||b.fast&&-1===d.value.indexOf(b.fast)||(d.value=d.value.replace(a,c))}),this},c.prototype.every=function(a){return this.nodes.every(a)},c.prototype.some=function(a){return this.nodes.some(a)},c.prototype.index=function(a){return"number"==typeof a?a:this.nodes.indexOf(a)},c.prototype.normalize=function(b,c){var d=this;if("string"==typeof b){var e=a("./parse");b=e(b).nodes}else if(!Array.isArray(b))if("root"===b.type)b=b.nodes;else if(b.type)b=[b];else if(b.prop){if("undefined"==typeof b.value)throw new Error("Value field is missed in node creation");b=[new j["default"](b)]}else if(b.selector){var f=a("./rule");b=[new f(b)]}else if(b.name){var g=a("./at-rule");b=[new g(b)]}else{if(!b.text)throw new Error("Unknown node type in node creation");b=[new n["default"](b)]}var h=b.map(function(a){return"undefined"==typeof a.raws&&(a=d.rebuild(a)),a.parent&&(a=a.clone()),"undefined"==typeof a.raws.before&&c&&"undefined"!=typeof c.raws.before&&(a.raws.before=c.raws.before.replace(/[^\s]/g,"")),a.parent=d,a});return h},c.prototype.rebuild=function(b,c){var d=this,e=void 0;if("root"===b.type){var f=a("./root");e=new f}else if("atrule"===b.type){var g=a("./at-rule");e=new g}else if("rule"===b.type){var h=a("./rule");e=new h}else"decl"===b.type?e=new j["default"]:"comment"===b.type&&(e=new n["default"]);for(var i in b)"nodes"===i?e.nodes=b.nodes.map(function(a){return d.rebuild(a,e)}):"parent"===i&&c?e.parent=c:b.hasOwnProperty(i)&&(e[i]=b[i]);return e},c.prototype.eachInside=function(a){return l["default"]("Container#eachInside is deprecated. Use Container#walk instead."),this.walk(a)},c.prototype.eachDecl=function(a,b){return l["default"]("Container#eachDecl is deprecated. Use Container#walkDecls instead."),this.walkDecls(a,b)},c.prototype.eachRule=function(a,b){return l["default"]("Container#eachRule is deprecated. Use Container#walkRules instead."),this.walkRules(a,b)},c.prototype.eachAtRule=function(a,b){return l["default"]("Container#eachAtRule is deprecated. Use Container#walkAtRules instead."),this.walkAtRules(a,b)},c.prototype.eachComment=function(a){return l["default"]("Container#eachComment is deprecated. Use Container#walkComments instead."),this.walkComments(a)},h(c,[{key:"first",get:function(){return this.nodes?this.nodes[0]:void 0}},{key:"last",get:function(){return this.nodes?this.nodes[this.nodes.length-1]:void 0}},{key:"semicolon",get:function(){return l["default"]("Node#semicolon is deprecated. Use Node#raws.semicolon"),this.raws.semicolon},set:function(a){l["default"]("Node#semicolon is deprecated. Use Node#raws.semicolon"),this.raws.semicolon=a}},{key:"after",get:function(){return l["default"]("Node#after is deprecated. Use Node#raws.after"),this.raws.after},set:function(a){l["default"]("Node#after is deprecated. Use Node#raws.after"),this.raws.after=a}}]),c}(p["default"]);c["default"]=q,b.exports=c["default"]},{"./at-rule":124,"./comment":125,"./declaration":128,"./node":133,"./parse":134,"./root":140,"./rule":141,"./warn-once":146}],127:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("supports-color"),h=d(g),i=a("./warn-once"),j=d(i),k=function(){function a(b,c,d,f,g,h){e(this,a),this.name="CssSyntaxError",this.reason=b,g&&(this.file=g),f&&(this.source=f),h&&(this.plugin=h),"undefined"!=typeof c&&"undefined"!=typeof d&&(this.line=c,this.column=d),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype.setMessage=function(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>","undefined"!=typeof this.line&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason},a.prototype.showSourceCode=function(a){if(!this.source)return"";for(var b=this.line-1,c=this.source.split("\n"),d=b>0?c[b-1]+"\n":"",e=c[b],f=b<c.length-1?"\n"+c[b+1]:"",g="\n",i=0;i<this.column-1;i++)g+=" ";return"undefined"==typeof a&&(a=h["default"]),g+=a?"[1;31m^[0m":"^","\n"+d+e+g+f},a.prototype.toString=function(){return this.name+": "+this.message+this.showSourceCode()},f(a,[{key:"generated",get:function(){return j["default"]("CssSyntaxError#generated is depreacted. Use input instead."),this.input}}]),a}();c["default"]=k,b.exports=c["default"]},{"./warn-once":146,"supports-color":160}],128:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./warn-once"),j=d(i),k=a("./node"),l=d(k),m=function(a){function b(c){e(this,b);var d=f(this,a.call(this,c));return d.type="decl",d}return g(b,a),h(b,[{key:"_value",get:function(){return j["default"]("Node#_value was deprecated. Use Node#raws.value"),this.raws.value},set:function(a){j["default"]("Node#_value was deprecated. Use Node#raws.value"),this.raws.value=a}},{key:"_important",get:function(){return j["default"]("Node#_important was deprecated. Use Node#raws.important"),this.raws.important},set:function(a){j["default"]("Node#_important was deprecated. Use Node#raws.important"),this.raws.important=a}}]),b}(l["default"]);c["default"]=m,b.exports=c["default"]},{"./node":133,"./warn-once":146}],129:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./css-syntax-error"),h=d(g),i=a("./previous-map"),j=d(i),k=a("path"),l=d(k),m=0,n=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];e(this,a),this.css=b.toString(),("\ufeff"===this.css[0]||"￾"===this.css[0])&&(this.css=this.css.slice(1)),c.from&&(this.file=l["default"].resolve(c.from));var d=new j["default"](this.css,c);if(d.text){this.map=d;var f=d.consumer().file;!this.file&&f&&(this.file=this.mapResolve(f))}this.file||(m+=1,this.id="<input css "+m+">"),this.map&&(this.map.file=this.from)}return a.prototype.error=function(a,b,c){var d=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],e=void 0,f=this.origin(b,c);return e=f?new h["default"](a,f.line,f.column,f.source,f.file,d.plugin):new h["default"](a,b,c,this.css,this.file,d.plugin),e.input={line:b,column:c,source:this.css},this.file&&(e.input.file=this.file),e},a.prototype.origin=function(a,b){
if(!this.map)return!1;var c=this.map.consumer(),d=c.originalPositionFor({line:a,column:b});if(!d.source)return!1;var e={file:this.mapResolve(d.source),line:d.line,column:d.column},f=c.sourceContentFor(d.source);return f&&(e.source=f),e},a.prototype.mapResolve=function(a){return l["default"].resolve(this.map.consumer().sourceRoot||".",a)},f(a,[{key:"from",get:function(){return this.file||this.id}}]),a}();c["default"]=n,b.exports=c["default"]},{"./css-syntax-error":127,"./previous-map":137,path:6}],130:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){return"object"===("undefined"==typeof a?"undefined":h(a))&&"function"==typeof a.then}c.__esModule=!0;var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},i=a("./map-generator"),j=d(i),k=a("./stringify"),l=d(k),m=a("./warn-once"),n=d(m),o=a("./result"),p=d(o),q=a("./parse"),r=d(q),s=function(){function a(b,c,d){e(this,a),this.stringified=!1,this.processed=!1;var f=void 0;if("object"===("undefined"==typeof c?"undefined":h(c))&&"root"===c.type)f=c;else if(c instanceof a||c instanceof p["default"])f=c.root,c.map&&("undefined"==typeof d.map&&(d.map={}),d.map.inline||(d.map.inline=!1),d.map.prev=c.map);else{var g=r["default"];d.syntax&&(g=d.syntax.parse),d.parser&&(g=d.parser),g.parse&&(g=g.parse);try{f=g(c,d)}catch(i){this.error=i}}this.result=new p["default"](b,f,d)}return a.prototype.warnings=function(){return this.sync().warnings()},a.prototype.toString=function(){return this.css},a.prototype.then=function(a,b){return this.async().then(a,b)},a.prototype["catch"]=function(a){return this.async()["catch"](a)},a.prototype.handleError=function(a,b){try{if(this.error=a,"CssSyntaxError"!==a.name||a.plugin){if(b.postcssVersion){var c=b.postcssPlugin,d=b.postcssVersion,e=this.result.processor.version,f=d.split("."),g=e.split(".");(f[0]!==g[0]||parseInt(f[1])>parseInt(g[1]))&&n["default"]("Your current PostCSS version is "+e+", but "+c+" uses "+d+". Perhaps this is the source of the error below.")}}else a.plugin=b.postcssPlugin,a.setMessage()}catch(h){console&&console.error&&console.error(h)}},a.prototype.asyncTick=function(a,b){var c=this;if(this.plugin>=this.processor.plugins.length)return this.processed=!0,a();try{!function(){var d=c.processor.plugins[c.plugin],e=c.run(d);c.plugin+=1,f(e)?e.then(function(){c.asyncTick(a,b)})["catch"](function(a){c.handleError(a,d),c.processed=!0,b(a)}):c.asyncTick(a,b)}()}catch(d){this.processed=!0,b(d)}},a.prototype.async=function(){var a=this;return this.processed?new Promise(function(b,c){a.error?c(a.error):b(a.stringify())}):this.processing?this.processing:(this.processing=new Promise(function(b,c){return a.error?c(a.error):(a.plugin=0,void a.asyncTick(b,c))}).then(function(){return a.processed=!0,a.stringify()}),this.processing)},a.prototype.sync=function(){if(this.processed)return this.result;if(this.processed=!0,this.processing)throw new Error("Use process(css).then(cb) to work with async plugins");if(this.error)throw this.error;for(var a=this.result.processor.plugins,b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d,g=this.run(e);if(f(g))throw new Error("Use process(css).then(cb) to work with async plugins")}return this.result},a.prototype.run=function(a){this.result.lastPlugin=a;try{return a(this.result.root,this.result)}catch(b){throw this.handleError(b,a),b}},a.prototype.stringify=function(){if(this.stringified)return this.result;this.stringified=!0,this.sync();var a=this.result.opts,b=l["default"];a.syntax&&(b=a.syntax.stringify),a.stringifier&&(b=a.stringifier),b.stringify&&(b=b.stringify);var c=new j["default"](b,this.result.root,this.result.opts),d=c.generate();return this.result.css=d[0],this.result.map=d[1],this.result},g(a,[{key:"processor",get:function(){return this.result.processor}},{key:"opts",get:function(){return this.result.opts}},{key:"css",get:function(){return this.stringify().css}},{key:"content",get:function(){return this.stringify().content}},{key:"map",get:function(){return this.stringify().map}},{key:"root",get:function(){return this.sync().root}},{key:"messages",get:function(){return this.sync().messages}}]),a}();c["default"]=s,b.exports=c["default"]},{"./map-generator":132,"./parse":134,"./result":139,"./stringify":143,"./warn-once":146}],131:[function(a,b,c){"use strict";c.__esModule=!0;var d={split:function e(a,b,c){for(var d=[],f="",e=!1,g=0,h=!1,i=!1,j=0;j<a.length;j++){var k=a[j];h?i?i=!1:"\\"===k?i=!0:k===h&&(h=!1):'"'===k||"'"===k?h=k:"("===k?g+=1:")"===k?g>0&&(g-=1):0===g&&-1!==b.indexOf(k)&&(e=!0),e?(""!==f&&d.push(f.trim()),f="",e=!1):f+=k}return(c||""!==f)&&d.push(f.trim()),d},space:function(a){var b=[" ","\n","	"];return d.split(a,b)},comma:function f(a){var f=",";return d.split(a,[f],!0)}};c["default"]=d,b.exports=c["default"]},{}],132:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=a("js-base64"),g=a("source-map"),h=d(g),i=a("path"),j=d(i),k=function(){function a(b,c,d){e(this,a),this.stringify=b,this.mapOpts=d.map||{},this.root=c,this.opts=d}return a.prototype.isMap=function(){return"undefined"!=typeof this.opts.map?!!this.opts.map:this.previous().length>0},a.prototype.previous=function(){var a=this;return this.previousMaps||(this.previousMaps=[],this.root.walk(function(b){if(b.source&&b.source.input.map){var c=b.source.input.map;-1===a.previousMaps.indexOf(c)&&a.previousMaps.push(c)}})),this.previousMaps},a.prototype.isInline=function(){if("undefined"!=typeof this.mapOpts.inline)return this.mapOpts.inline;var a=this.mapOpts.annotation;return"undefined"!=typeof a&&a!==!0?!1:this.previous().length?this.previous().some(function(a){return a.inline}):!0},a.prototype.isSourcesContent=function(){return"undefined"!=typeof this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(function(a){return a.withContent()}):!0},a.prototype.clearAnnotation=function(){if(this.mapOpts.annotation!==!1)for(var a=void 0,b=this.root.nodes.length-1;b>=0;b--)a=this.root.nodes[b],"comment"===a.type&&0===a.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(b)},a.prototype.setSourcesContent=function(){var a=this,b={};this.root.walk(function(c){if(c.source){var d=c.source.input.from;if(d&&!b[d]){b[d]=!0;var e=a.relative(d);a.map.setSourceContent(e,c.source.input.css)}}})},a.prototype.applyPrevMaps=function(){for(var a=this.previous(),b=Array.isArray(a),c=0,a=b?a:a[Symbol.iterator]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{if(c=a.next(),c.done)break;d=c.value}var e=d,f=this.relative(e.file),g=e.root||j["default"].dirname(e.file),i=void 0;this.mapOpts.sourcesContent===!1?(i=new h["default"].SourceMapConsumer(e.text),i.sourcesContent&&(i.sourcesContent=i.sourcesContent.map(function(){return null}))):i=e.consumer(),this.map.applySourceMap(i,f,this.relative(g))}},a.prototype.isAnnotation=function(){return this.isInline()?!0:"undefined"!=typeof this.mapOpts.annotation?this.mapOpts.annotation:this.previous().length?this.previous().some(function(a){return a.annotation}):!0},a.prototype.addAnnotation=function(){var a=void 0;a=this.isInline()?"data:application/json;base64,"+f.Base64.encode(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:this.outputFile()+".map";var b="\n";-1!==this.css.indexOf("\r\n")&&(b="\r\n"),this.css+=b+"/*# sourceMappingURL="+a+" */"},a.prototype.outputFile=function(){return this.opts.to?this.relative(this.opts.to):this.opts.from?this.relative(this.opts.from):"to.css"},a.prototype.generateMap=function(){return this.generateString(),this.isSourcesContent()&&this.setSourcesContent(),this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]},a.prototype.relative=function(a){var b=this.opts.to?j["default"].dirname(this.opts.to):".";return"string"==typeof this.mapOpts.annotation&&(b=j["default"].dirname(j["default"].resolve(b,this.mapOpts.annotation))),a=j["default"].relative(b,a),"\\"===j["default"].sep?a.replace(/\\/g,"/"):a},a.prototype.sourcePath=function(a){return this.relative(a.source.input.from)},a.prototype.generateString=function(){var a=this;this.css="",this.map=new h["default"].SourceMapGenerator({file:this.outputFile()});var b=1,c=1,d=void 0,e=void 0;this.stringify(this.root,function(f,g,h){a.css+=f,g&&g.source&&g.source.start&&"end"!==h&&a.map.addMapping({source:a.sourcePath(g),original:{line:g.source.start.line,column:g.source.start.column-1},generated:{line:b,column:c-1}}),d=f.match(/\n/g),d?(b+=d.length,e=f.lastIndexOf("\n"),c=f.length-e):c+=f.length,g&&g.source&&g.source.end&&"start"!==h&&a.map.addMapping({source:a.sourcePath(g),original:{line:g.source.end.line,column:g.source.end.column},generated:{line:b,column:c-1}})})},a.prototype.generate=function(){if(this.clearAnnotation(),this.isMap())return this.generateMap();var a="";return this.stringify(this.root,function(b){a+=b}),[a]},a}();c["default"]=k,b.exports=c["default"]},{"js-base64":148,path:6,"source-map":159}],133:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},i=a("./css-syntax-error"),j=d(i),k=a("./stringifier"),l=d(k),m=a("./stringify"),n=d(m),o=a("./warn-once"),p=d(o),q=function s(a,b){var c=new a.constructor;for(var d in a)if(a.hasOwnProperty(d)){var e=a[d],f="undefined"==typeof e?"undefined":h(e);"parent"===d&&"object"===f?b&&(c[d]=b):"source"===d?c[d]=e:e instanceof Array?c[d]=e.map(function(a){return s(a,c)}):"before"!==d&&"after"!==d&&"between"!==d&&"semicolon"!==d&&("object"===f&&null!==e&&(e=s(e)),c[d]=e)}return c},r=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e(this,a),this.raws={};for(var c in b)this[c]=b[c]}return a.prototype.error=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.source){var c=this.positionBy(b);return this.source.input.error(a,c.line,c.column,b)}return new j["default"](a)},a.prototype.warn=function(a,b,c){return a.warn(b,f({node:this},c))},a.prototype.remove=function(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this},a.prototype.toString=function(){var a=arguments.length<=0||void 0===arguments[0]?n["default"]:arguments[0];a.stringify&&(a=a.stringify);var b="";return a(this,function(a){b+=a}),b},a.prototype.clone=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=q(this);for(var c in a)b[c]=a[c];return b},a.prototype.cloneBefore=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=this.clone(a);return this.parent.insertBefore(this,b),b},a.prototype.cloneAfter=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=this.clone(a);return this.parent.insertAfter(this,b),b},a.prototype.replaceWith=function(){if(this.parent){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];for(var d=b,e=Array.isArray(d),f=0,d=e?d:d[Symbol.iterator]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{if(f=d.next(),f.done)break;g=f.value}var h=g;this.parent.insertBefore(this,h)}this.remove()}return this},a.prototype.moveTo=function(a){return this.cleanRaws(this.root()===a.root()),this.remove(),a.append(this),this},a.prototype.moveBefore=function(a){return this.cleanRaws(this.root()===a.root()),this.remove(),a.parent.insertBefore(a,this),this},a.prototype.moveAfter=function(a){return this.cleanRaws(this.root()===a.root()),this.remove(),a.parent.insertAfter(a,this),this},a.prototype.next=function(){var a=this.parent.index(this);return this.parent.nodes[a+1]},a.prototype.prev=function(){var a=this.parent.index(this);return this.parent.nodes[a-1]},a.prototype.toJSON=function(){var a={};for(var b in this)if(this.hasOwnProperty(b)&&"parent"!==b){var c=this[b];c instanceof Array?a[b]=c.map(function(a){return"object"===("undefined"==typeof a?"undefined":h(a))&&a.toJSON?a.toJSON():a}):"object"===("undefined"==typeof c?"undefined":h(c))&&c.toJSON?a[b]=c.toJSON():a[b]=c}return a},a.prototype.raw=function(a,b){var c=new l["default"];return c.raw(this,a,b)},a.prototype.root=function(){for(var a=this;a.parent;)a=a.parent;return a},a.prototype.cleanRaws=function(a){delete this.raws.before,delete this.raws.after,a||delete this.raws.between},a.prototype.positionInside=function(a){for(var b=this.toString(),c=this.source.start.column,d=this.source.start.line,e=0;a>e;e++)"\n"===b[e]?(c=1,d+=1):c+=1;return{line:d,column:c}},a.prototype.positionBy=function(a){var b=this.source.start;if(a.index)b=this.positionInside(a.index);else if(a.word){var c=this.toString().indexOf(a.word);-1!==c&&(b=this.positionInside(c))}return b},a.prototype.removeSelf=function(){return p["default"]("Node#removeSelf is deprecated. Use Node#remove."),this.remove()},a.prototype.replace=function(a){return p["default"]("Node#replace is deprecated. Use Node#replaceWith"),this.replaceWith(a)},a.prototype.style=function(a,b){return p["default"]("Node#style() is deprecated. Use Node#raw()"),this.raw(a,b)},a.prototype.cleanStyles=function(a){return p["default"]("Node#cleanStyles() is deprecated. Use Node#cleanRaws()"),this.cleanRaws(a)},g(a,[{key:"before",get:function(){return p["default"]("Node#before is deprecated. Use Node#raws.before"),this.raws.before},set:function(a){p["default"]("Node#before is deprecated. Use Node#raws.before"),this.raws.before=a}},{key:"between",get:function(){return p["default"]("Node#between is deprecated. Use Node#raws.between"),this.raws.between},set:function(a){p["default"]("Node#between is deprecated. Use Node#raws.between"),this.raws.between=a}}]),a}();c["default"]=r,b.exports=c["default"]},{"./css-syntax-error":127,"./stringifier":142,"./stringify":143,"./warn-once":146}],134:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(b&&b.safe)throw new Error('Option safe was removed. Use parser: require("postcss-safe-parser")');var c=new i["default"](a,b),d=new g["default"](c);return d.tokenize(),d.loop(),d.root}c.__esModule=!0,c["default"]=e;var f=a("./parser"),g=d(f),h=a("./input"),i=d(h);b.exports=c["default"]},{"./input":129,"./parser":135}],135:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=a("./declaration"),g=d(f),h=a("./tokenize"),i=d(h),j=a("./comment"),k=d(j),l=a("./at-rule"),m=d(l),n=a("./root"),o=d(n),p=a("./rule"),q=d(p),r=function(){function a(b){e(this,a),this.input=b,this.pos=0,this.root=new o["default"],this.current=this.root,this.spaces="",this.semicolon=!1,this.root.source={input:b,start:{line:1,column:1}}}return a.prototype.tokenize=function(){this.tokens=i["default"](this.input)},a.prototype.loop=function(){for(var a=void 0;this.pos<this.tokens.length;){switch(a=this.tokens[this.pos],a[0]){case"word":case":":this.word();break;case"}":this.end(a);break;case"comment":this.comment(a);break;case"at-word":this.atrule(a);break;case"{":this.emptyRule(a);break;default:this.spaces+=a[1]}this.pos+=1}this.endFile()},a.prototype.comment=function(a){var b=new k["default"];this.init(b,a[2],a[3]),b.source.end={line:a[4],column:a[5]};var c=a[1].slice(2,-2);if(/^\s*$/.test(c))b.text="",b.raws.left=c,b.raws.right="";else{var d=c.match(/^(\s*)([^]*[^\s])(\s*)$/);b.text=d[2],b.raws.left=d[1],b.raws.right=d[3]}},a.prototype.emptyRule=function(a){var b=new q["default"];this.init(b,a[2],a[3]),b.selector="",b.raws.between="",this.current=b},a.prototype.word=function(){var a=void 0,b=!1,c=null,d=!1,e=null,f=0,g=this.pos;for(this.pos+=1;this.pos<this.tokens.length;){if(a=this.tokens[this.pos],c=a[0],"("===c)e||(e=a),f+=1;else if(0===f){if(";"===c){if(d)return void this.decl(this.tokens.slice(g,this.pos+1));break}if("{"===c)return void this.rule(this.tokens.slice(g,this.pos+1));if("}"===c){this.pos-=1,b=!0;break}":"===c&&(d=!0)}else")"===c&&(f-=1,0===f&&(e=null));this.pos+=1}if(this.pos===this.tokens.length&&(this.pos-=1,b=!0),f>0&&this.unclosedBracket(e),b&&d){for(;this.pos>g&&(a=this.tokens[this.pos][0],"space"===a||"comment"===a);)this.pos-=1;return void this.decl(this.tokens.slice(g,this.pos+1))}this.unknownWord(g)},a.prototype.rule=function(a){a.pop();var b=new q["default"];this.init(b,a[0][2],a[0][3]),b.raws.between=this.spacesFromEnd(a),this.raw(b,"selector",a),this.current=b},a.prototype.decl=function(a){var b=new g["default"];this.init(b);var c=a[a.length-1];for(";"===c[0]&&(this.semicolon=!0,a.pop()),c[4]?b.source.end={line:c[4],column:c[5]}:b.source.end={line:c[2],column:c[3]};"word"!==a[0][0];)b.raws.before+=a.shift()[1];for(b.source.start={line:a[0][2],column:a[0][3]},b.prop="";a.length;){var d=a[0][0];if(":"===d||"space"===d||"comment"===d)break;b.prop+=a.shift()[1]}b.raws.between="";for(var e=void 0;a.length;){if(e=a.shift(),":"===e[0]){b.raws.between+=e[1];break}b.raws.between+=e[1]}("_"===b.prop[0]||"*"===b.prop[0])&&(b.raws.before+=b.prop[0],b.prop=b.prop.slice(1)),b.raws.between+=this.spacesFromStart(a),this.precheckMissedSemicolon(a);for(var f=a.length-1;f>0;f--){if(e=a[f],"!important"===e[1]){b.important=!0;var h=this.stringFrom(a,f);h=this.spacesFromEnd(a)+h," !important"!==h&&(b.raws.important=h);break}if("important"===e[1]){for(var i=a.slice(0),j="",k=f;k>0;k--){var d=i[k][0];if(0===j.trim().indexOf("!")&&"space"!==d)break;j=i.pop()[1]+j}0===j.trim().indexOf("!")&&(b.important=!0,b.raws.important=j,a=i)}if("space"!==e[0]&&"comment"!==e[0])break}this.raw(b,"value",a),-1!==b.value.indexOf(":")&&this.checkMissedSemicolon(a)},a.prototype.atrule=function(a){var b=new m["default"];b.name=a[1].slice(1),""===b.name&&this.unnamedAtrule(b,a),this.init(b,a[2],a[3]);var c=!1,d=!1,e=[];for(this.pos+=1;this.pos<this.tokens.length;){if(a=this.tokens[this.pos],";"===a[0]){b.source.end={line:a[2],column:a[3]},this.semicolon=!0;break}if("{"===a[0]){d=!0;break}if("}"===a[0]){this.end(a);break}e.push(a),this.pos+=1}this.pos===this.tokens.length&&(c=!0),b.raws.between=this.spacesFromEnd(e),e.length?(b.raws.afterName=this.spacesFromStart(e),this.raw(b,"params",e),c&&(a=e[e.length-1],b.source.end={line:a[4],column:a[5]},this.spaces=b.raws.between,b.raws.between="")):(b.raws.afterName="",b.params=""),d&&(b.nodes=[],this.current=b)},a.prototype.end=function(a){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end={line:a[2],column:a[3]},this.current=this.current.parent):this.unexpectedClose(a)},a.prototype.endFile=function(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces},a.prototype.init=function(a,b,c){this.current.push(a),a.source={start:{line:b,column:c},input:this.input},a.raws.before=this.spaces,this.spaces="","comment"!==a.type&&(this.semicolon=!1)},a.prototype.raw=function b(a,c,d){for(var e=void 0,f=void 0,g=d.length,h="",i=!0,j=0;g>j;j+=1)e=d[j],f=e[0],"comment"===f||"space"===f&&j===g-1?i=!1:h+=e[1];if(!i){var b=d.reduce(function(a,b){return a+b[1]},"");a.raws[c]={value:h,raw:b}}a[c]=h},a.prototype.spacesFromEnd=function(a){for(var b=void 0,c="";a.length&&(b=a[a.length-1][0],"space"===b||"comment"===b);)c+=a.pop()[1];return c},a.prototype.spacesFromStart=function(a){for(var b=void 0,c="";a.length&&(b=a[0][0],"space"===b||"comment"===b);)c+=a.shift()[1];return c},a.prototype.stringFrom=function(a,b){for(var c="",d=b;d<a.length;d++)c+=a[d][1];return a.splice(b,a.length-b),c},a.prototype.colon=function(a){for(var b=0,c=void 0,d=void 0,e=void 0,f=0;f<a.length;f++){if(c=a[f],d=c[0],"("===d)b+=1;else if(")"===d)b-=1;else if(0===b&&":"===d){if(e){if("word"===e[0]&&"progid"===e[1])continue;return f}this.doubleColon(c)}e=c}return!1},a.prototype.unclosedBracket=function(a){throw this.input.error("Unclosed bracket",a[2],a[3])},a.prototype.unknownWord=function(a){var b=this.tokens[a];throw this.input.error("Unknown word",b[2],b[3])},a.prototype.unexpectedClose=function(a){throw this.input.error("Unexpected }",a[2],a[3])},a.prototype.unclosedBlock=function(){var a=this.current.source.start;throw this.input.error("Unclosed block",a.line,a.column)},a.prototype.doubleColon=function(a){throw this.input.error("Double colon",a[2],a[3])},a.prototype.unnamedAtrule=function(a,b){throw this.input.error("At-rule without name",b[2],b[3])},a.prototype.precheckMissedSemicolon=function(a){},a.prototype.checkMissedSemicolon=function(a){var b=this.colon(a);if(b!==!1){for(var c=0,d=void 0,e=b-1;e>=0&&(d=a[e],"space"===d[0]||(c+=1,2!==c));e--);throw this.input.error("Missed semicolon",d[2],d[3])}},a}();c["default"]=r,b.exports=c["default"]},{"./at-rule":124,"./comment":125,"./declaration":128,"./root":140,"./rule":141,"./tokenize":144}],136:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}c.__esModule=!0;var e=a("./declaration"),f=d(e),g=a("./processor"),h=d(g),i=a("./stringify"),j=d(i),k=a("./comment"),l=d(k),m=a("./at-rule"),n=d(m),o=a("./vendor"),p=d(o),q=a("./parse"),r=d(q),s=a("./list"),t=d(s),u=a("./rule"),v=d(u),w=a("./root"),x=d(w),y=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return 1===b.length&&Array.isArray(b[0])&&(b=b[0]),new h["default"](b)};y.plugin=function(a,b){var c=function(){var c=b.apply(void 0,arguments);return c.postcssPlugin=a,c.postcssVersion=(new h["default"]).version,c};return c.postcss=c(),c.process=function(a,b){return y([c(b)]).process(a,b)},c},y.stringify=j["default"],y.vendor=p["default"],y.parse=r["default"],y.list=t["default"],y.comment=function(a){return new l["default"](a)},y.atRule=function(a){return new n["default"](a)},y.decl=function(a){return new f["default"](a)},y.rule=function(a){return new v["default"](a)},y.root=function(a){return new x["default"](a)},c["default"]=y,b.exports=c["default"]},{"./at-rule":124,"./comment":125,"./declaration":128,"./list":131,"./parse":134,"./processor":138,"./root":140,"./rule":141,"./stringify":143,"./vendor":145}],137:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},g=a("js-base64"),h=a("source-map"),i=d(h),j=a("path"),k=d(j),l=a("fs"),m=d(l),n=function(){function a(b,c){e(this,a),this.loadAnnotation(b),this.inline=this.startWith(this.annotation,"data:");var d=c.map?c.map.prev:void 0,f=this.loadMap(c.from,d);f&&(this.text=f)}return a.prototype.consumer=function(){return this.consumerCache||(this.consumerCache=new i["default"].SourceMapConsumer(this.text)),this.consumerCache},a.prototype.withContent=function(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)},a.prototype.startWith=function(a,b){return a?a.substr(0,b.length)===b:!1},a.prototype.loadAnnotation=function(a){var b=a.match(/\/\*\s*# sourceMappingURL=(.*)\s*\*\//);b&&(this.annotation=b[1].trim())},a.prototype.decodeInline=function(a){var b="data:application/json;charset=utf-8;base64,",c="data:application/json;base64,",d="data:application/json,";if(this.startWith(a,d))return decodeURIComponent(a.substr(d.length));if(this.startWith(a,c))return g.Base64.decode(a.substr(c.length));if(this.startWith(a,b))return g.Base64.decode(a.substr(b.length));var e=a.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+e)},a.prototype.loadMap=function(a,b){if(b===!1)return!1;if(b){if("string"==typeof b)return b;if(b instanceof i["default"].SourceMapConsumer)return i["default"].SourceMapGenerator.fromSourceMap(b).toString();if(b instanceof i["default"].SourceMapGenerator)return b.toString();if(this.isMap(b))return JSON.stringify(b);throw new Error("Unsupported previous source map format: "+b.toString())}if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){var c=this.annotation;return a&&(c=k["default"].join(k["default"].dirname(a),c)),this.root=k["default"].dirname(c),m["default"].existsSync&&m["default"].existsSync(c)?m["default"].readFileSync(c,"utf-8").toString().trim():!1}},a.prototype.isMap=function(a){return"object"!==("undefined"==typeof a?"undefined":f(a))?!1:"string"==typeof a.mappings||"string"==typeof a._mappings},a}();c["default"]=n,b.exports=c["default"]},{fs:1,"js-base64":148,path:6,"source-map":159}],138:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},g=a("./lazy-result"),h=d(g),i=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];e(this,a),this.version="5.0.14",this.plugins=this.normalize(b)}return a.prototype.use=function(a){return this.plugins=this.plugins.concat(this.normalize([a])),this},a.prototype.process=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new h["default"](this,a,b)},a.prototype.normalize=function(a){for(var b=[],c=a,d=Array.isArray(c),e=0,c=d?c:c[Symbol.iterator]();;){var g;if(d){if(e>=c.length)break;g=c[e++]}else{if(e=c.next(),e.done)break;g=e.value}var h=g;if(h.postcss&&(h=h.postcss),"object"===("undefined"==typeof h?"undefined":f(h))&&Array.isArray(h.plugins))b=b.concat(h.plugins);else{if("function"!=typeof h)throw new Error(h+" is not a PostCSS plugin");b.push(h)}}return b},a}();c["default"]=i,b.exports=c["default"]},{"./lazy-result":130}],139:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./warning"),h=d(g),i=function(){function a(b,c,d){e(this,a),this.processor=b,this.messages=[],this.root=c,this.opts=d,this.css=void 0,this.map=void 0}return a.prototype.toString=function(){return this.css},a.prototype.warn=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];b.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(b.plugin=this.lastPlugin.postcssPlugin),this.messages.push(new h["default"](a,b))},a.prototype.warnings=function(){return this.messages.filter(function(a){return"warning"===a.type})},f(a,[{key:"content",get:function(){return this.css}}]),a}();c["default"]=i,b.exports=c["default"]},{"./warning":147}],140:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=a("./container"),i=d(h),j=a("./warn-once"),k=d(j),l=function(b){function c(a){e(this,c);var d=f(this,b.call(this,a));return d.type="root",d.nodes||(d.nodes=[]),d}return g(c,b),c.prototype.removeChild=function(a){return a=this.index(a),0===a&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[a].raws.before),b.prototype.removeChild.call(this,a)},c.prototype.normalize=function(a,c,d){var e=b.prototype.normalize.call(this,a);if(c)if("prepend"===d)this.nodes.length>1?c.raws.before=this.nodes[1].raws.before:delete c.raws.before;else if(this.first!==c)for(var f=e,g=Array.isArray(f),h=0,f=g?f:f[Symbol.iterator]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{if(h=f.next(),h.done)break;i=h.value}var j=i;j.raws.before=c.raws.before}return e},c.prototype.toResult=function(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=a("./lazy-result"),d=a("./processor"),e=new c(new d,this,b);return e.stringify()},c.prototype.remove=function(a){k["default"]("Root#remove is deprecated. Use Root#removeChild"),this.removeChild(a)},c.prototype.prevMap=function(){return k["default"]("Root#prevMap is deprecated. Use Root#source.input.map"),this.source.input.map},c}(i["default"]);c["default"]=l,b.exports=c["default"]},{"./container":126,"./lazy-result":130,"./processor":138,"./warn-once":146}],141:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.__esModule=!0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./container"),j=d(i),k=a("./warn-once"),l=d(k),m=a("./list"),n=d(m),o=function(a){function b(c){e(this,b);var d=f(this,a.call(this,c));return d.type="rule",d.nodes||(d.nodes=[]),d}return g(b,a),h(b,[{key:"selectors",get:function(){return n["default"].comma(this.selector)},set:function(a){var b=this.selector?this.selector.match(/,\s*/):null,c=b?b[0]:","+this.raw("between","beforeOpen");this.selector=a.join(c)}},{key:"_selector",get:function(){return l["default"]("Rule#_selector is deprecated. Use Rule#raws.selector"),this.raws.selector},set:function(a){l["default"]("Rule#_selector is deprecated. Use Rule#raws.selector"),this.raws.selector=a}}]),b}(j["default"]);
c["default"]=o,b.exports=c["default"]},{"./container":126,"./list":131,"./warn-once":146}],142:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){return a[0].toUpperCase()+a.slice(1)}c.__esModule=!0;var f={colon:": ",indent:"    ",beforeDecl:"\n",beforeRule:"\n",beforeOpen:" ",beforeClose:"\n",beforeComment:"\n",after:"\n",emptyBody:"",commentLeft:" ",commentRight:" "},g=function(){function a(b){d(this,a),this.builder=b}return a.prototype.stringify=function(a,b){this[a.type](a,b)},a.prototype.root=function(a){this.body(a),a.raws.after&&this.builder(a.raws.after)},a.prototype.comment=function(a){var b=this.raw(a,"left","commentLeft"),c=this.raw(a,"right","commentRight");this.builder("/*"+b+a.text+c+"*/",a)},a.prototype.decl=function(a,b){var c=this.raw(a,"between","colon"),d=a.prop+c+this.rawValue(a,"value");a.important&&(d+=a.raws.important||" !important"),b&&(d+=";"),this.builder(d,a)},a.prototype.rule=function(a){this.block(a,this.rawValue(a,"selector"))},a.prototype.atrule=function(a,b){var c="@"+a.name,d=a.params?this.rawValue(a,"params"):"";if("undefined"!=typeof a.raws.afterName?c+=a.raws.afterName:d&&(c+=" "),a.nodes)this.block(a,c+d);else{var e=(a.raws.between||"")+(b?";":"");this.builder(c+d+e,a)}},a.prototype.body=function(a){for(var b=a.nodes.length-1;b>0&&"comment"===a.nodes[b].type;)b-=1;for(var c=this.raw(a,"semicolon"),d=0;d<a.nodes.length;d++){var e=a.nodes[d],f=this.raw(e,"before");f&&this.builder(f),this.stringify(e,b!==d||c)}},a.prototype.block=function(a,b){var c=this.raw(a,"between","beforeOpen");this.builder(b+c+"{",a,"start");var d=void 0;a.nodes&&a.nodes.length?(this.body(a),d=this.raw(a,"after")):d=this.raw(a,"after","emptyBody"),d&&this.builder(d),this.builder("}",a,"end")},a.prototype.raw=function(a,b,c){var d=void 0;if(c||(c=b),b&&(d=a.raws[b],"undefined"!=typeof d))return d;var g=a.parent;if("before"===c&&(!g||"root"===g.type&&g.first===a))return"";if(!g)return f[c];var h=a.root();if(h.rawCache||(h.rawCache={}),"undefined"!=typeof h.rawCache[c])return h.rawCache[c];if("before"===c||"after"===c)return this.beforeAfter(a,c);var i="raw"+e(c);return this[i]?d=this[i](h,a):h.walk(function(a){return d=a.raws[b],"undefined"!=typeof d?!1:void 0}),"undefined"==typeof d&&(d=f[c]),h.rawCache[c]=d,d},a.prototype.rawSemicolon=function(a){var b=void 0;return a.walk(function(a){return a.nodes&&a.nodes.length&&"decl"===a.last.type&&(b=a.raws.semicolon,"undefined"!=typeof b)?!1:void 0}),b},a.prototype.rawEmptyBody=function(a){var b=void 0;return a.walk(function(a){return a.nodes&&0===a.nodes.length&&(b=a.raws.after,"undefined"!=typeof b)?!1:void 0}),b},a.prototype.rawIndent=function(a){if(a.raws.indent)return a.raws.indent;var b=void 0;return a.walk(function(c){var d=c.parent;if(d&&d!==a&&d.parent&&d.parent===a&&"undefined"!=typeof c.raws.before){var e=c.raws.before.split("\n");return b=e[e.length-1],b=b.replace(/[^\s]/g,""),!1}}),b},a.prototype.rawBeforeComment=function(a,b){var c=void 0;return a.walkComments(function(a){return"undefined"!=typeof a.raws.before?(c=a.raws.before,-1!==c.indexOf("\n")&&(c=c.replace(/[^\n]+$/,"")),!1):void 0}),"undefined"==typeof c&&(c=this.raw(b,null,"beforeDecl")),c},a.prototype.rawBeforeDecl=function(a,b){var c=void 0;return a.walkDecls(function(a){return"undefined"!=typeof a.raws.before?(c=a.raws.before,-1!==c.indexOf("\n")&&(c=c.replace(/[^\n]+$/,"")),!1):void 0}),"undefined"==typeof c&&(c=this.raw(b,null,"beforeRule")),c},a.prototype.rawBeforeRule=function(a){var b=void 0;return a.walk(function(c){return!c.nodes||c.parent===a&&a.first===c||"undefined"==typeof c.raws.before?void 0:(b=c.raws.before,-1!==b.indexOf("\n")&&(b=b.replace(/[^\n]+$/,"")),!1)}),b},a.prototype.rawBeforeClose=function(a){var b=void 0;return a.walk(function(a){return a.nodes&&a.nodes.length>0&&"undefined"!=typeof a.raws.after?(b=a.raws.after,-1!==b.indexOf("\n")&&(b=b.replace(/[^\n]+$/,"")),!1):void 0}),b},a.prototype.rawBeforeOpen=function(a){var b=void 0;return a.walk(function(a){return"decl"!==a.type&&(b=a.raws.between,"undefined"!=typeof b)?!1:void 0}),b},a.prototype.rawColon=function(a){var b=void 0;return a.walkDecls(function(a){return"undefined"!=typeof a.raws.between?(b=a.raws.between.replace(/[^\s:]/g,""),!1):void 0}),b},a.prototype.beforeAfter=function(a,b){var c=void 0;c="decl"===a.type?this.raw(a,null,"beforeDecl"):"comment"===a.type?this.raw(a,null,"beforeComment"):"before"===b?this.raw(a,null,"beforeRule"):this.raw(a,null,"beforeClose");for(var d=a.parent,e=0;d&&"root"!==d.type;)e+=1,d=d.parent;if(-1!==c.indexOf("\n")){var f=this.raw(a,null,"indent");if(f.length)for(var g=0;e>g;g++)c+=f}return c},a.prototype.rawValue=function(a,b){var c=a[b],d=a.raws[b];return d&&d.value===c?d.raw:c},a}();c["default"]=g,b.exports=c["default"]},{}],143:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){var c=new g["default"](b);c.stringify(a)}c.__esModule=!0,c["default"]=e;var f=a("./stringifier"),g=d(f);b.exports=c["default"]},{"./stringifier":142}],144:[function(a,b,c){"use strict";function d(a){function b(b){throw a.error("Unclosed "+b,N,O-M)}for(var c=[],d=a.css.valueOf(),y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=d.length,M=-1,N=1,O=0;L>O;){switch(y=d.charCodeAt(O),(y===i||y===k||y===m&&d.charCodeAt(O+1)!==i)&&(M=O,N+=1),y){case i:case j:case l:case m:case k:z=O;do z+=1,y=d.charCodeAt(z),y===i&&(M=z,N+=1);while(y===j||y===i||y===l||y===m||y===k);c.push(["space",d.slice(O,z)]),O=z-1;break;case p:c.push(["{","{",N,O-M]);break;case q:c.push(["}","}",N,O-M]);break;case t:c.push([":",":",N,O-M]);break;case r:c.push([";",";",N,O-M]);break;case n:if(J=c.length?c[c.length-1][1]:"",K=d.charCodeAt(O+1),"url"===J&&K!==e&&K!==f&&K!==j&&K!==i&&K!==l&&K!==k&&K!==m){z=O;do for(H=!1,z=d.indexOf(")",z+1),-1===z&&b("bracket"),I=z;d.charCodeAt(I-1)===g;)I-=1,H=!H;while(H);c.push(["brackets",d.slice(O,z+1),N,O-M,N,z-M]),O=z}else z=d.indexOf(")",O+1),D=d.slice(O,z+1),-1===z||x.test(D)?c.push(["(","(",N,O-M]):(c.push(["brackets",D,N,O-M,N,z-M]),O=z);break;case o:c.push([")",")",N,O-M]);break;case e:case f:A=y===e?"'":'"',z=O;do for(H=!1,z=d.indexOf(A,z+1),-1===z&&b("quote"),I=z;d.charCodeAt(I-1)===g;)I-=1,H=!H;while(H);D=d.slice(O,z+1),B=D.split("\n"),C=B.length-1,C>0?(F=N+C,G=z-B[C].length):(F=N,G=M),c.push(["string",d.slice(O,z+1),N,O-M,F,z-G]),M=G,N=F,O=z;break;case u:v.lastIndex=O+1,v.test(d),z=0===v.lastIndex?d.length-1:v.lastIndex-2,c.push(["at-word",d.slice(O,z+1),N,O-M,N,z-M]),O=z;break;case g:for(z=O,E=!0;d.charCodeAt(z+1)===g;)z+=1,E=!E;y=d.charCodeAt(z+1),E&&y!==h&&y!==j&&y!==i&&y!==l&&y!==m&&y!==k&&(z+=1),c.push(["word",d.slice(O,z+1),N,O-M,N,z-M]),O=z;break;default:y===h&&d.charCodeAt(O+1)===s?(z=d.indexOf("*/",O+2)+1,0===z&&b("comment"),D=d.slice(O,z+1),B=D.split("\n"),C=B.length-1,C>0?(F=N+C,G=z-B[C].length):(F=N,G=M),c.push(["comment",D,N,O-M,F,z-G]),M=G,N=F,O=z):(w.lastIndex=O+1,w.test(d),z=0===w.lastIndex?d.length-1:w.lastIndex-2,c.push(["word",d.slice(O,z+1),N,O-M,N,z-M]),O=z)}O++}return c}c.__esModule=!0,c["default"]=d;var e=39,f=34,g=92,h=47,i=10,j=32,k=12,l=9,m=13,n=40,o=41,p=123,q=125,r=59,s=42,t=58,u=64,v=/[ \n\t\r\f\{\(\)'"\\;/]/g,w=/[ \n\t\r\f\(\)\{\}:;@!'"\\]|\/(?=\*)/g,x=/.[\\\/\("'\n]/;b.exports=c["default"]},{}],145:[function(a,b,c){"use strict";c.__esModule=!0,c["default"]={prefix:function(a){if("-"===a[0]){var b=a.indexOf("-",1);return a.substr(0,b+1)}return""},unprefixed:function(a){if("-"===a[0]){var b=a.indexOf("-",1);return a.substr(b+1)}return a}},b.exports=c["default"]},{}],146:[function(a,b,c){"use strict";function d(a){e[a]||(e[a]=!0,"undefined"!=typeof console&&console.warn&&console.warn(a))}c.__esModule=!0,c["default"]=d;var e={};b.exports=c["default"]},{}],147:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.__esModule=!0;var e=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(d(this,a),this.type="warning",this.text=b,c.node&&c.node.source){var e=c.node.positionBy(c);this.line=e.line,this.column=e.column}for(var f in c)this[f]=c[f]}return a.prototype.toString=function(){return this.node?this.node.error(this.text,{plugin:this.plugin,index:this.index,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text},a}();c["default"]=e,b.exports=c["default"]},{}],148:[function(a,b,c){!function(c){"use strict";var d,e=c.Base64,f="2.1.9";if("undefined"!=typeof b&&b.exports)try{d=a("buffer").Buffer}catch(g){}var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a.charAt(c)]=c;return b}(h),j=String.fromCharCode,k=function(a){if(a.length<2){var b=a.charCodeAt(0);return 128>b?a:2048>b?j(192|b>>>6)+j(128|63&b):j(224|b>>>12&15)+j(128|b>>>6&63)+j(128|63&b)}var b=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return j(240|b>>>18&7)+j(128|b>>>12&63)+j(128|b>>>6&63)+j(128|63&b)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,m=function(a){return a.replace(l,k)},n=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),d=[h.charAt(c>>>18),h.charAt(c>>>12&63),b>=2?"=":h.charAt(c>>>6&63),b>=1?"=":h.charAt(63&c)];return d.join("")},o=c.btoa?function(a){return c.btoa(a)}:function(a){return a.replace(/[\s\S]{1,3}/g,n)},p=d?function(a){return(a.constructor===d.constructor?a:new d(a)).toString("base64")}:function(a){return o(m(a))},q=function(a,b){return b?p(String(a)).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):p(String(a))},r=function(a){return q(a,!0)},s=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),t=function(a){switch(a.length){case 4:var b=(7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3),c=b-65536;return j((c>>>10)+55296)+j((1023&c)+56320);case 3:return j((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return j((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},u=function(a){return a.replace(s,t)},v=function(a){var b=a.length,c=b%4,d=(b>0?i[a.charAt(0)]<<18:0)|(b>1?i[a.charAt(1)]<<12:0)|(b>2?i[a.charAt(2)]<<6:0)|(b>3?i[a.charAt(3)]:0),e=[j(d>>>16),j(d>>>8&255),j(255&d)];return e.length-=[0,0,2,1][c],e.join("")},w=c.atob?function(a){return c.atob(a)}:function(a){return a.replace(/[\s\S]{1,4}/g,v)},x=d?function(a){return(a.constructor===d.constructor?a:new d(a,"base64")).toString()}:function(a){return u(w(a))},y=function(a){return x(String(a).replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},z=function(){var a=c.Base64;return c.Base64=e,a};if(c.Base64={VERSION:f,atob:w,btoa:o,fromBase64:y,toBase64:q,utob:m,encode:q,encodeURI:r,btou:u,decode:y,noConflict:z},"function"==typeof Object.defineProperty){var A=function(a){return{value:a,enumerable:!1,writable:!0,configurable:!0}};c.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",A(function(){return y(this)})),Object.defineProperty(String.prototype,"toBase64",A(function(a){return q(this,a)})),Object.defineProperty(String.prototype,"toBase64URI",A(function(){return q(this,!0)}))}}c.Meteor&&(Base64=c.Base64)}(this)},{buffer:2}],149:[function(a,b,c){function d(){this._array=[],this._set=Object.create(null)}var e=a("./util"),f=Object.prototype.hasOwnProperty;d.fromArray=function(a,b){for(var c=new d,e=0,f=a.length;f>e;e++)c.add(a[e],b);return c},d.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},d.prototype.add=function(a,b){var c=e.toSetString(a),d=f.call(this._set,c),g=this._array.length;(!d||b)&&this._array.push(a),d||(this._set[c]=g)},d.prototype.has=function(a){var b=e.toSetString(a);return f.call(this._set,b)},d.prototype.indexOf=function(a){var b=e.toSetString(a);if(f.call(this._set,b))return this._set[b];throw new Error('"'+a+'" is not in the set.')},d.prototype.at=function(a){if(a>=0&&a<this._array.length)return this._array[a];throw new Error("No element indexed by "+a)},d.prototype.toArray=function(){return this._array.slice()},c.ArraySet=d},{"./util":158}],150:[function(a,b,c){function d(a){return 0>a?(-a<<1)+1:(a<<1)+0}function e(a){var b=1===(1&a),c=a>>1;return b?-c:c}var f=a("./base64"),g=5,h=1<<g,i=h-1,j=h;c.encode=function(a){var b,c="",e=d(a);do b=e&i,e>>>=g,e>0&&(b|=j),c+=f.encode(b);while(e>0);return c},c.decode=function(a,b,c){var d,h,k=a.length,l=0,m=0;do{if(b>=k)throw new Error("Expected more digits in base 64 VLQ value.");if(h=f.decode(a.charCodeAt(b++)),-1===h)throw new Error("Invalid base64 digit: "+a.charAt(b-1));d=!!(h&j),h&=i,l+=h<<m,m+=g}while(d);c.value=e(l),c.rest=b}},{"./base64":151}],151:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");c.encode=function(a){if(a>=0&&a<d.length)return d[a];throw new TypeError("Must be between 0 and 63: "+a)},c.decode=function(a){var b=65,c=90,d=97,e=122,f=48,g=57,h=43,i=47,j=26,k=52;return a>=b&&c>=a?a-b:a>=d&&e>=a?a-d+j:a>=f&&g>=a?a-f+k:a==h?62:a==i?63:-1}},{}],152:[function(a,b,c){function d(a,b,e,f,g,h){var i=Math.floor((b-a)/2)+a,j=g(e,f[i],!0);return 0===j?i:j>0?b-i>1?d(i,b,e,f,g,h):h==c.LEAST_UPPER_BOUND?b<f.length?b:-1:i:i-a>1?d(a,i,e,f,g,h):h==c.LEAST_UPPER_BOUND?i:0>a?-1:a}c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.search=function(a,b,e,f){if(0===b.length)return-1;var g=d(-1,b.length,a,b,e,f||c.GREATEST_LOWER_BOUND);if(0>g)return-1;for(;g-1>=0&&0===e(b[g],b[g-1],!0);)--g;return g}},{}],153:[function(a,b,c){function d(a,b){var c=a.generatedLine,d=b.generatedLine,e=a.generatedColumn,g=b.generatedColumn;return d>c||d==c&&g>=e||f.compareByGeneratedPositionsInflated(a,b)<=0}function e(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var f=a("./util");e.prototype.unsortedForEach=function(a,b){this._array.forEach(a,b)},e.prototype.add=function(a){d(this._last,a)?(this._last=a,this._array.push(a)):(this._sorted=!1,this._array.push(a))},e.prototype.toArray=function(){return this._sorted||(this._array.sort(f.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},c.MappingList=e},{"./util":158}],154:[function(a,b,c){function d(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function e(a,b){return Math.round(a+Math.random()*(b-a))}function f(a,b,c,g){if(g>c){var h=e(c,g),i=c-1;d(a,h,g);for(var j=a[g],k=c;g>k;k++)b(a[k],j)<=0&&(i+=1,d(a,i,k));d(a,i+1,k);var l=i+1;f(a,b,c,l-1),f(a,b,l+1,g)}}c.quickSort=function(a,b){f(a,b,0,a.length-1)}},{}],155:[function(a,b,c){function d(a){var b=a;return"string"==typeof a&&(b=JSON.parse(a.replace(/^\)\]\}'/,""))),null!=b.sections?new g(b):new e(b)}function e(a){var b=a;"string"==typeof a&&(b=JSON.parse(a.replace(/^\)\]\}'/,"")));var c=h.getArg(b,"version"),d=h.getArg(b,"sources"),e=h.getArg(b,"names",[]),f=h.getArg(b,"sourceRoot",null),g=h.getArg(b,"sourcesContent",null),i=h.getArg(b,"mappings"),k=h.getArg(b,"file",null);if(c!=this._version)throw new Error("Unsupported version: "+c);d=d.map(String).map(h.normalize).map(function(a){return f&&h.isAbsolute(f)&&h.isAbsolute(a)?h.relative(f,a):a}),this._names=j.fromArray(e.map(String),!0),this._sources=j.fromArray(d,!0),this.sourceRoot=f,this.sourcesContent=g,this._mappings=i,this.file=k}function f(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function g(a){var b=a;"string"==typeof a&&(b=JSON.parse(a.replace(/^\)\]\}'/,"")));var c=h.getArg(b,"version"),e=h.getArg(b,"sections");if(c!=this._version)throw new Error("Unsupported version: "+c);this._sources=new j,this._names=new j;var f={line:-1,column:0};this._sections=e.map(function(a){if(a.url)throw new Error("Support for url field in sections not implemented.");var b=h.getArg(a,"offset"),c=h.getArg(b,"line"),e=h.getArg(b,"column");if(c<f.line||c===f.line&&e<f.column)throw new Error("Section offsets must be ordered and non-overlapping.");return f=b,{generatedOffset:{generatedLine:c+1,generatedColumn:e+1},consumer:new d(h.getArg(a,"map"))}})}var h=a("./util"),i=a("./binary-search"),j=a("./array-set").ArraySet,k=a("./base64-vlq"),l=a("./quick-sort").quickSort;d.fromSourceMap=function(a){return e.fromSourceMap(a)},d.prototype._version=3,d.prototype.__generatedMappings=null,Object.defineProperty(d.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),d.prototype.__originalMappings=null,Object.defineProperty(d.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),d.prototype._charIsMappingSeparator=function(a,b){var c=a.charAt(b);return";"===c||","===c},d.prototype._parseMappings=function(a,b){throw new Error("Subclasses must implement _parseMappings")},d.GENERATED_ORDER=1,d.ORIGINAL_ORDER=2,d.GREATEST_LOWER_BOUND=1,d.LEAST_UPPER_BOUND=2,d.prototype.eachMapping=function(a,b,c){var e,f=b||null,g=c||d.GENERATED_ORDER;switch(g){case d.GENERATED_ORDER:e=this._generatedMappings;break;case d.ORIGINAL_ORDER:e=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var i=this.sourceRoot;e.map(function(a){var b=null===a.source?null:this._sources.at(a.source);return null!=b&&null!=i&&(b=h.join(i,b)),{source:b,generatedLine:a.generatedLine,generatedColumn:a.generatedColumn,originalLine:a.originalLine,originalColumn:a.originalColumn,name:null===a.name?null:this._names.at(a.name)}},this).forEach(a,f)},d.prototype.allGeneratedPositionsFor=function(a){var b=h.getArg(a,"line"),c={source:h.getArg(a,"source"),originalLine:b,originalColumn:h.getArg(a,"column",0)};if(null!=this.sourceRoot&&(c.source=h.relative(this.sourceRoot,c.source)),!this._sources.has(c.source))return[];c.source=this._sources.indexOf(c.source);var d=[],e=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",h.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(e>=0){var f=this._originalMappings[e];if(void 0===a.column)for(var g=f.originalLine;f&&f.originalLine===g;)d.push({line:h.getArg(f,"generatedLine",null),column:h.getArg(f,"generatedColumn",null),lastColumn:h.getArg(f,"lastGeneratedColumn",null)}),f=this._originalMappings[++e];else for(var j=f.originalColumn;f&&f.originalLine===b&&f.originalColumn==j;)d.push({line:h.getArg(f,"generatedLine",null),column:h.getArg(f,"generatedColumn",null),lastColumn:h.getArg(f,"lastGeneratedColumn",null)}),f=this._originalMappings[++e]}return d},c.SourceMapConsumer=d,e.prototype=Object.create(d.prototype),e.prototype.consumer=d,e.fromSourceMap=function(a){var b=Object.create(e.prototype),c=b._names=j.fromArray(a._names.toArray(),!0),d=b._sources=j.fromArray(a._sources.toArray(),!0);b.sourceRoot=a._sourceRoot,b.sourcesContent=a._generateSourcesContent(b._sources.toArray(),b.sourceRoot),b.file=a._file;for(var g=a._mappings.toArray().slice(),i=b.__generatedMappings=[],k=b.__originalMappings=[],m=0,n=g.length;n>m;m++){var o=g[m],p=new f;p.generatedLine=o.generatedLine,p.generatedColumn=o.generatedColumn,o.source&&(p.source=d.indexOf(o.source),p.originalLine=o.originalLine,p.originalColumn=o.originalColumn,o.name&&(p.name=c.indexOf(o.name)),k.push(p)),i.push(p)}return l(b.__originalMappings,h.compareByOriginalPositions),b},e.prototype._version=3,Object.defineProperty(e.prototype,"sources",{get:function(){return this._sources.toArray().map(function(a){return null!=this.sourceRoot?h.join(this.sourceRoot,a):a},this)}}),e.prototype._parseMappings=function(a,b){for(var c,d,e,g,i,j=1,m=0,n=0,o=0,p=0,q=0,r=a.length,s=0,t={},u={},v=[],w=[];r>s;)if(";"===a.charAt(s))j++,s++,m=0;else if(","===a.charAt(s))s++;else{for(c=new f,c.generatedLine=j,g=s;r>g&&!this._charIsMappingSeparator(a,g);g++);if(d=a.slice(s,g),e=t[d])s+=d.length;else{for(e=[];g>s;)k.decode(a,s,u),i=u.value,s=u.rest,e.push(i);if(2===e.length)throw new Error("Found a source, but no line and column");if(3===e.length)throw new Error("Found a source and line, but no column");t[d]=e}c.generatedColumn=m+e[0],m=c.generatedColumn,e.length>1&&(c.source=p+e[1],p+=e[1],c.originalLine=n+e[2],n=c.originalLine,c.originalLine+=1,c.originalColumn=o+e[3],o=c.originalColumn,e.length>4&&(c.name=q+e[4],q+=e[4])),w.push(c),"number"==typeof c.originalLine&&v.push(c)}l(w,h.compareByGeneratedPositionsDeflated),this.__generatedMappings=w,l(v,h.compareByOriginalPositions),this.__originalMappings=v},e.prototype._findMapping=function(a,b,c,d,e,f){if(a[c]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+a[c]);if(a[d]<0)throw new TypeError("Column must be greater than or equal to 0, got "+a[d]);return i.search(a,b,e,f)},e.prototype.computeColumnSpans=function(){for(var a=0;a<this._generatedMappings.length;++a){var b=this._generatedMappings[a];if(a+1<this._generatedMappings.length){var c=this._generatedMappings[a+1];if(b.generatedLine===c.generatedLine){b.lastGeneratedColumn=c.generatedColumn-1;continue}}b.lastGeneratedColumn=1/0}},e.prototype.originalPositionFor=function(a){var b={generatedLine:h.getArg(a,"line"),generatedColumn:h.getArg(a,"column")},c=this._findMapping(b,this._generatedMappings,"generatedLine","generatedColumn",h.compareByGeneratedPositionsDeflated,h.getArg(a,"bias",d.GREATEST_LOWER_BOUND));if(c>=0){var e=this._generatedMappings[c];if(e.generatedLine===b.generatedLine){var f=h.getArg(e,"source",null);null!==f&&(f=this._sources.at(f),null!=this.sourceRoot&&(f=h.join(this.sourceRoot,f)));var g=h.getArg(e,"name",null);return null!==g&&(g=this._names.at(g)),{source:f,line:h.getArg(e,"originalLine",null),column:h.getArg(e,"originalColumn",null),name:g}}}return{source:null,line:null,column:null,name:null}},e.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(a){return null==a}):!1},e.prototype.sourceContentFor=function(a,b){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(a=h.relative(this.sourceRoot,a)),this._sources.has(a))return this.sourcesContent[this._sources.indexOf(a)];var c;if(null!=this.sourceRoot&&(c=h.urlParse(this.sourceRoot))){var d=a.replace(/^file:\/\//,"");if("file"==c.scheme&&this._sources.has(d))return this.sourcesContent[this._sources.indexOf(d)];if((!c.path||"/"==c.path)&&this._sources.has("/"+a))return this.sourcesContent[this._sources.indexOf("/"+a)]}if(b)return null;throw new Error('"'+a+'" is not in the SourceMap.')},e.prototype.generatedPositionFor=function(a){var b=h.getArg(a,"source");if(null!=this.sourceRoot&&(b=h.relative(this.sourceRoot,b)),!this._sources.has(b))return{line:null,column:null,lastColumn:null};b=this._sources.indexOf(b);var c={source:b,originalLine:h.getArg(a,"line"),originalColumn:h.getArg(a,"column")},e=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",h.compareByOriginalPositions,h.getArg(a,"bias",d.GREATEST_LOWER_BOUND));if(e>=0){var f=this._originalMappings[e];if(f.source===c.source)return{line:h.getArg(f,"generatedLine",null),column:h.getArg(f,"generatedColumn",null),lastColumn:h.getArg(f,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},c.BasicSourceMapConsumer=e,g.prototype=Object.create(d.prototype),g.prototype.constructor=d,g.prototype._version=3,Object.defineProperty(g.prototype,"sources",{get:function(){for(var a=[],b=0;b<this._sections.length;b++)for(var c=0;c<this._sections[b].consumer.sources.length;c++)a.push(this._sections[b].consumer.sources[c]);return a}}),g.prototype.originalPositionFor=function(a){var b={generatedLine:h.getArg(a,"line"),generatedColumn:h.getArg(a,"column")},c=i.search(b,this._sections,function(a,b){var c=a.generatedLine-b.generatedOffset.generatedLine;return c?c:a.generatedColumn-b.generatedOffset.generatedColumn}),d=this._sections[c];return d?d.consumer.originalPositionFor({line:b.generatedLine-(d.generatedOffset.generatedLine-1),column:b.generatedColumn-(d.generatedOffset.generatedLine===b.generatedLine?d.generatedOffset.generatedColumn-1:0),bias:a.bias}):{source:null,line:null,column:null,name:null}},g.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(a){return a.consumer.hasContentsOfAllSources()})},g.prototype.sourceContentFor=function(a,b){for(var c=0;c<this._sections.length;c++){var d=this._sections[c],e=d.consumer.sourceContentFor(a,!0);if(e)return e}if(b)return null;throw new Error('"'+a+'" is not in the SourceMap.')},g.prototype.generatedPositionFor=function(a){for(var b=0;b<this._sections.length;b++){var c=this._sections[b];if(-1!==c.consumer.sources.indexOf(h.getArg(a,"source"))){var d=c.consumer.generatedPositionFor(a);if(d){var e={line:d.line+(c.generatedOffset.generatedLine-1),column:d.column+(c.generatedOffset.generatedLine===d.line?c.generatedOffset.generatedColumn-1:0)};return e}}}return{line:null,column:null}},g.prototype._parseMappings=function(a,b){this.__generatedMappings=[],this.__originalMappings=[];for(var c=0;c<this._sections.length;c++)for(var d=this._sections[c],e=d.consumer._generatedMappings,f=0;f<e.length;f++){var g=e[f],i=d.consumer._sources.at(g.source);null!==d.consumer.sourceRoot&&(i=h.join(d.consumer.sourceRoot,i)),this._sources.add(i),i=this._sources.indexOf(i);var j=d.consumer._names.at(g.name);this._names.add(j),j=this._names.indexOf(j);var k={source:i,generatedLine:g.generatedLine+(d.generatedOffset.generatedLine-1),generatedColumn:g.generatedColumn+(d.generatedOffset.generatedLine===g.generatedLine?d.generatedOffset.generatedColumn-1:0),originalLine:g.originalLine,originalColumn:g.originalColumn,name:j};this.__generatedMappings.push(k),"number"==typeof k.originalLine&&this.__originalMappings.push(k)}l(this.__generatedMappings,h.compareByGeneratedPositionsDeflated),l(this.__originalMappings,h.compareByOriginalPositions)},c.IndexedSourceMapConsumer=g},{"./array-set":149,"./base64-vlq":150,"./binary-search":152,"./quick-sort":154,"./util":158}],156:[function(a,b,c){function d(a){a||(a={}),this._file=f.getArg(a,"file",null),this._sourceRoot=f.getArg(a,"sourceRoot",null),this._skipValidation=f.getArg(a,"skipValidation",!1),this._sources=new g,this._names=new g,this._mappings=new h,this._sourcesContents=null}var e=a("./base64-vlq"),f=a("./util"),g=a("./array-set").ArraySet,h=a("./mapping-list").MappingList;d.prototype._version=3,d.fromSourceMap=function(a){var b=a.sourceRoot,c=new d({file:a.file,sourceRoot:b});return a.eachMapping(function(a){var d={generated:{line:a.generatedLine,column:a.generatedColumn}};null!=a.source&&(d.source=a.source,null!=b&&(d.source=f.relative(b,d.source)),d.original={line:a.originalLine,column:a.originalColumn},null!=a.name&&(d.name=a.name)),c.addMapping(d)}),a.sources.forEach(function(b){var d=a.sourceContentFor(b);null!=d&&c.setSourceContent(b,d)}),c},d.prototype.addMapping=function(a){var b=f.getArg(a,"generated"),c=f.getArg(a,"original",null),d=f.getArg(a,"source",null),e=f.getArg(a,"name",null);this._skipValidation||this._validateMapping(b,c,d,e),null!=d&&(d=String(d),this._sources.has(d)||this._sources.add(d)),null!=e&&(e=String(e),this._names.has(e)||this._names.add(e)),this._mappings.add({generatedLine:b.line,generatedColumn:b.column,originalLine:null!=c&&c.line,originalColumn:null!=c&&c.column,source:d,name:e})},d.prototype.setSourceContent=function(a,b){var c=a;null!=this._sourceRoot&&(c=f.relative(this._sourceRoot,c)),null!=b?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[f.toSetString(c)]=b):this._sourcesContents&&(delete this._sourcesContents[f.toSetString(c)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},d.prototype.applySourceMap=function(a,b,c){var d=b;if(null==b){if(null==a.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');d=a.file}var e=this._sourceRoot;null!=e&&(d=f.relative(e,d));var h=new g,i=new g;this._mappings.unsortedForEach(function(b){if(b.source===d&&null!=b.originalLine){var g=a.originalPositionFor({line:b.originalLine,column:b.originalColumn});null!=g.source&&(b.source=g.source,null!=c&&(b.source=f.join(c,b.source)),null!=e&&(b.source=f.relative(e,b.source)),b.originalLine=g.line,b.originalColumn=g.column,null!=g.name&&(b.name=g.name))}var j=b.source;null==j||h.has(j)||h.add(j);var k=b.name;null==k||i.has(k)||i.add(k)},this),this._sources=h,this._names=i,a.sources.forEach(function(b){var d=a.sourceContentFor(b);null!=d&&(null!=c&&(b=f.join(c,b)),null!=e&&(b=f.relative(e,b)),this.setSourceContent(b,d))},this)},d.prototype._validateMapping=function(a,b,c,d){if((!(a&&"line"in a&&"column"in a&&a.line>0&&a.column>=0)||b||c||d)&&!(a&&"line"in a&&"column"in a&&b&&"line"in b&&"column"in b&&a.line>0&&a.column>=0&&b.line>0&&b.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:a,source:c,original:b,name:d}))},d.prototype._serializeMappings=function(){for(var a,b,c,d,g=0,h=1,i=0,j=0,k=0,l=0,m="",n=this._mappings.toArray(),o=0,p=n.length;p>o;o++){if(b=n[o],a="",b.generatedLine!==h)for(g=0;b.generatedLine!==h;)a+=";",h++;else if(o>0){if(!f.compareByGeneratedPositionsInflated(b,n[o-1]))continue;a+=","}a+=e.encode(b.generatedColumn-g),g=b.generatedColumn,null!=b.source&&(d=this._sources.indexOf(b.source),a+=e.encode(d-l),l=d,a+=e.encode(b.originalLine-1-j),j=b.originalLine-1,a+=e.encode(b.originalColumn-i),i=b.originalColumn,null!=b.name&&(c=this._names.indexOf(b.name),a+=e.encode(c-k),k=c)),m+=a}return m},d.prototype._generateSourcesContent=function(a,b){return a.map(function(a){if(!this._sourcesContents)return null;null!=b&&(a=f.relative(b,a));var c=f.toSetString(a);return Object.prototype.hasOwnProperty.call(this._sourcesContents,c)?this._sourcesContents[c]:null},this)},d.prototype.toJSON=function(){var a={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(a.file=this._file),null!=this._sourceRoot&&(a.sourceRoot=this._sourceRoot),this._sourcesContents&&(a.sourcesContent=this._generateSourcesContent(a.sources,a.sourceRoot)),a},d.prototype.toString=function(){return JSON.stringify(this.toJSON())},c.SourceMapGenerator=d},{"./array-set":149,"./base64-vlq":150,"./mapping-list":153,"./util":158}],157:[function(a,b,c){function d(a,b,c,d,e){this.children=[],this.sourceContents={},this.line=null==a?null:a,this.column=null==b?null:b,this.source=null==c?null:c,this.name=null==e?null:e,this[i]=!0,null!=d&&this.add(d)}var e=a("./source-map-generator").SourceMapGenerator,f=a("./util"),g=/(\r?\n)/,h=10,i="$$$isSourceNode$$$";d.fromStringWithSourceMap=function(a,b,c){function e(a,b){if(null===a||void 0===a.source)h.add(b);else{var e=c?f.join(c,a.source):a.source;h.add(new d(a.originalLine,a.originalColumn,e,b,a.name))}}var h=new d,i=a.split(g),j=function(){var a=i.shift(),b=i.shift()||"";return a+b},k=1,l=0,m=null;return b.eachMapping(function(a){if(null!==m){if(!(k<a.generatedLine)){var b=i[0],c=b.substr(0,a.generatedColumn-l);return i[0]=b.substr(a.generatedColumn-l),l=a.generatedColumn,e(m,c),void(m=a)}e(m,j()),k++,l=0}for(;k<a.generatedLine;)h.add(j()),k++;if(l<a.generatedColumn){var b=i[0];h.add(b.substr(0,a.generatedColumn)),i[0]=b.substr(a.generatedColumn),l=a.generatedColumn}m=a},this),i.length>0&&(m&&e(m,j()),h.add(i.join(""))),b.sources.forEach(function(a){var d=b.sourceContentFor(a);null!=d&&(null!=c&&(a=f.join(c,a)),h.setSourceContent(a,d))}),h},d.prototype.add=function(a){if(Array.isArray(a))a.forEach(function(a){this.add(a)},this);else{if(!a[i]&&"string"!=typeof a)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);a&&this.children.push(a)}return this},d.prototype.prepend=function(a){if(Array.isArray(a))for(var b=a.length-1;b>=0;b--)this.prepend(a[b]);else{if(!a[i]&&"string"!=typeof a)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);
this.children.unshift(a)}return this},d.prototype.walk=function(a){for(var b,c=0,d=this.children.length;d>c;c++)b=this.children[c],b[i]?b.walk(a):""!==b&&a(b,{source:this.source,line:this.line,column:this.column,name:this.name})},d.prototype.join=function(a){var b,c,d=this.children.length;if(d>0){for(b=[],c=0;d-1>c;c++)b.push(this.children[c]),b.push(a);b.push(this.children[c]),this.children=b}return this},d.prototype.replaceRight=function(a,b){var c=this.children[this.children.length-1];return c[i]?c.replaceRight(a,b):"string"==typeof c?this.children[this.children.length-1]=c.replace(a,b):this.children.push("".replace(a,b)),this},d.prototype.setSourceContent=function(a,b){this.sourceContents[f.toSetString(a)]=b},d.prototype.walkSourceContents=function(a){for(var b=0,c=this.children.length;c>b;b++)this.children[b][i]&&this.children[b].walkSourceContents(a);for(var d=Object.keys(this.sourceContents),b=0,c=d.length;c>b;b++)a(f.fromSetString(d[b]),this.sourceContents[d[b]])},d.prototype.toString=function(){var a="";return this.walk(function(b){a+=b}),a},d.prototype.toStringWithSourceMap=function(a){var b={code:"",line:1,column:0},c=new e(a),d=!1,f=null,g=null,i=null,j=null;return this.walk(function(a,e){b.code+=a,null!==e.source&&null!==e.line&&null!==e.column?((f!==e.source||g!==e.line||i!==e.column||j!==e.name)&&c.addMapping({source:e.source,original:{line:e.line,column:e.column},generated:{line:b.line,column:b.column},name:e.name}),f=e.source,g=e.line,i=e.column,j=e.name,d=!0):d&&(c.addMapping({generated:{line:b.line,column:b.column}}),f=null,d=!1);for(var k=0,l=a.length;l>k;k++)a.charCodeAt(k)===h?(b.line++,b.column=0,k+1===l?(f=null,d=!1):d&&c.addMapping({source:e.source,original:{line:e.line,column:e.column},generated:{line:b.line,column:b.column},name:e.name})):b.column++}),this.walkSourceContents(function(a,b){c.setSourceContent(a,b)}),{code:b.code,map:c}},c.SourceNode=d},{"./source-map-generator":156,"./util":158}],158:[function(a,b,c){function d(a,b,c){if(b in a)return a[b];if(3===arguments.length)return c;throw new Error('"'+b+'" is a required argument.')}function e(a){var b=a.match(r);return b?{scheme:b[1],auth:b[2],host:b[3],port:b[4],path:b[5]}:null}function f(a){var b="";return a.scheme&&(b+=a.scheme+":"),b+="//",a.auth&&(b+=a.auth+"@"),a.host&&(b+=a.host),a.port&&(b+=":"+a.port),a.path&&(b+=a.path),b}function g(a){var b=a,d=e(a);if(d){if(!d.path)return a;b=d.path}for(var g,h=c.isAbsolute(b),i=b.split(/\/+/),j=0,k=i.length-1;k>=0;k--)g=i[k],"."===g?i.splice(k,1):".."===g?j++:j>0&&(""===g?(i.splice(k+1,j),j=0):(i.splice(k,2),j--));return b=i.join("/"),""===b&&(b=h?"/":"."),d?(d.path=b,f(d)):b}function h(a,b){""===a&&(a="."),""===b&&(b=".");var c=e(b),d=e(a);if(d&&(a=d.path||"/"),c&&!c.scheme)return d&&(c.scheme=d.scheme),f(c);if(c||b.match(s))return b;if(d&&!d.host&&!d.path)return d.host=b,f(d);var h="/"===b.charAt(0)?b:g(a.replace(/\/+$/,"")+"/"+b);return d?(d.path=h,f(d)):h}function i(a,b){""===a&&(a="."),a=a.replace(/\/$/,"");for(var c=0;0!==b.indexOf(a+"/");){var d=a.lastIndexOf("/");if(0>d)return b;if(a=a.slice(0,d),a.match(/^([^\/]+:\/)?\/*$/))return b;++c}return Array(c+1).join("../")+b.substr(a.length+1)}function j(a){return a}function k(a){return m(a)?"$"+a:a}function l(a){return m(a)?a.slice(1):a}function m(a){if(!a)return!1;var b=a.length;if(9>b)return!1;if(95!==a.charCodeAt(b-1)||95!==a.charCodeAt(b-2)||111!==a.charCodeAt(b-3)||116!==a.charCodeAt(b-4)||111!==a.charCodeAt(b-5)||114!==a.charCodeAt(b-6)||112!==a.charCodeAt(b-7)||95!==a.charCodeAt(b-8)||95!==a.charCodeAt(b-9))return!1;for(var c=b-10;c>=0;c--)if(36!==a.charCodeAt(c))return!1;return!0}function n(a,b,c){var d=a.source-b.source;return 0!==d?d:(d=a.originalLine-b.originalLine,0!==d?d:(d=a.originalColumn-b.originalColumn,0!==d||c?d:(d=a.generatedColumn-b.generatedColumn,0!==d?d:(d=a.generatedLine-b.generatedLine,0!==d?d:a.name-b.name))))}function o(a,b,c){var d=a.generatedLine-b.generatedLine;return 0!==d?d:(d=a.generatedColumn-b.generatedColumn,0!==d||c?d:(d=a.source-b.source,0!==d?d:(d=a.originalLine-b.originalLine,0!==d?d:(d=a.originalColumn-b.originalColumn,0!==d?d:a.name-b.name))))}function p(a,b){return a===b?0:a>b?1:-1}function q(a,b){var c=a.generatedLine-b.generatedLine;return 0!==c?c:(c=a.generatedColumn-b.generatedColumn,0!==c?c:(c=p(a.source,b.source),0!==c?c:(c=a.originalLine-b.originalLine,0!==c?c:(c=a.originalColumn-b.originalColumn,0!==c?c:p(a.name,b.name)))))}c.getArg=d;var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,s=/^data:.+\,.+$/;c.urlParse=e,c.urlGenerate=f,c.normalize=g,c.join=h,c.isAbsolute=function(a){return"/"===a.charAt(0)||!!a.match(r)},c.relative=i;var t=function(){var a=Object.create(null);return!("__proto__"in a)}();c.toSetString=t?j:k,c.fromSetString=t?j:l,c.compareByOriginalPositions=n,c.compareByGeneratedPositionsDeflated=o,c.compareByGeneratedPositionsInflated=q},{}],159:[function(a,b,c){c.SourceMapGenerator=a("./lib/source-map-generator").SourceMapGenerator,c.SourceMapConsumer=a("./lib/source-map-consumer").SourceMapConsumer,c.SourceNode=a("./lib/source-node").SourceNode},{"./lib/source-map-consumer":155,"./lib/source-map-generator":156,"./lib/source-node":157}],160:[function(a,b,c){"use strict";b.exports=!1},{}],161:[function(a,b,c){b.exports={name:"turbo-carto",version:"0.19.0",description:"CartoCSS preprocessor",main:"src/index.js",scripts:{test:"make test-all"},author:{name:"CartoDB",email:"wadus@cartodb.com",url:"http://cartodb.com/"},contributors:[{name:"Raul Ochoa",email:"rochoa@cartodb.com"}],license:"BSD-3-Clause",repository:{type:"git",url:"git+ssh://git@github.com/CartoDB/turbo-carto.git"},dependencies:{colorbrewer:"1.0.0",cartocolor:"4.0.0",debug:"2.2.0","es6-promise":"3.1.2",postcss:"5.0.19","postcss-value-parser":"3.3.0"},devDependencies:{"browser-request":"^0.3.3",browserify:"^12.0.1",istanbul:"^0.4.1",jshint:"^2.9.1-rc2",mocha:"^2.3.4",querystring:"^0.2.0",request:"^2.67.0",semistandard:"^7.0.4","semistandard-format":"^2.1.0",yargs:"^3.31.0"},semistandard:{globals:["describe","it"],ignore:["examples/app.js"]},readme:"# Turbo-Carto\n\nNext-Gen Styling for Data-Driven Maps, AKA CartoCSS preprocessor.\n\ntl;dr Enables adding functions to CartoCSS that can be evaluated asynchronously.\n\n[![Build Status](https://travis-ci.org/CartoDB/turbo-carto.png?branch=master)](https://travis-ci.org/CartoDB/turbo-carto)\n\n## Ramps\n\nIt's all about ramps.\n\nYou can create color and symbol size ramps with just a single line of code. You no longer need to worry about\ncalculating the bins for your thematic map, if your data changes your CartoCSS changes.\n\n\n### Very basic introduction to CartoCSS\n\nIn CartoCSS you usually assign values to properties and apply filters in order to change those values based on some\ndata attributes.\n\nThe general form for properties and filters is:\n\n```css\n#selector {\n    property: value;\n    [filter] {\n        property: value;\n    }\n}\n```\n\nAn example of a filter based on price attribute:\n\n```css\n#selector {\n    marker-width: 10;\n    [price > 100] {\n        marker-width: 20;\n    }\n}\n```\n\n### Turbo-Carto ramps\n\nTurbo-Carto high-level API for ramps is as follows:\n\n```css\n#selector {\n    property: ramp([attribute], (...values), (...filters), mapping);\n}\n```\n\nWhere:\n - `property` is the CartoCSS property you want to create.\n - `[attribute]` usually is a column/key name from your dataset.\n - `(...values)` is **what** `property` is gonna get for different filters.\n - `(...filters)` is **how** `property` is gonna get the different values.\n - `mapping` is the type of filter that will be applied: <, <=, >, >=, =.\n\nSo for the previous example you could write (see [examples/readme/example-0.css](./examples/readme/example-0.css)):\n\n```css\n#selector {\n    marker-width: ramp([price], (10, 20), (100));\n}\n```\n\nIn this case, the first value is the default value.\n\n\nIf you want to have a category map, to generate a CartoCSS like:\n\n```css\n#selector {\n    marker-fill: red;\n    [room_type = \"Private Room\"] {\n        marker-fill: green;\n    }\n}\n```\n\nYou can use the same approach but specifying the mapping type to be an equality (see [examples/readme/example-1.css](./examples/readme/example-1.css)):\n\n```css\n#selector {\n    marker-fill: ramp([room_type], (green, red), (\"Private room\"), =);\n}\n```\n\nSee that in this case the last value is the default value, and if the number of values is equal to the number of filters\nit won't have a default value, like in (see [examples/readme/example-2.css](./examples/readme/example-2.css)):\n\n```css\n#selector {\n    marker-width: ramp([room_type], (green, red), (\"Private room\"), =);\n}\n```\n\nThat's nice, but it is still unlinked from the actual data/attributes.\n\n#### Mappings default values\n\n`<` and `<=`: Last provided value will be the default value.\n`=`: Last provided value will be the default value, if the number of values is\nequal to the number of filters it won't have a default value.\n`>` and `>=`: First provided value will be the default value.\n\n#### Associate ramp filters to your data\n\nTo generate ramps based on actual data you have to say what kind of quantification you want to use, for that purpose\nTurbo-Carto provides some shorthand methods that will delegate the filters computation to different collaborators.\n\nLet's say you want to compute the ramp using jenks as quantification function (see [examples/readme/example-3.css](./examples/readme/example-3.css)):\n\n```css\n#selector {\n    marker-width: ramp([price], (10, 20, 30), jenks());\n}\n```\n\nOr generate a category map depending on the room_type property (see [examples/readme/example-4.css](./examples/readme/example-4.css)):\n\n```css\n#selector {\n    marker-fill: ramp([room_type], (red, green, blue), category(2));\n}\n```\n\nYou can override the mapping if you know your data requires an more strict filter (see [examples/readme/example-5.css](./examples/readme/example-5.css)):\n\n```css\n#selector {\n    marker-width: ramp([price], (10, 20, 30), jenks(), >=);\n}\n```\n\nShorthand methods include:\n - `category()`: default mapping is `=`.\n - `equal()`: default mapping is `>`.\n - `headtails()`: default mapping is `<`.\n - `jenks()`: default mapping is `>`.\n - `quantiles()`: default mapping is `>`.\n\n#### Color ramps\n\nFor color ramps, there are a couple of handy functions to retrieve color palettes: `cartocolor` and `colorbrewer`.\n\nYou can create a choropleth map using Reds color palette from colorbrewer (see [examples/readme/example-6.css](./examples/readme/example-6.css)):\n\n```css\n#selector {\n    polygon-fill: ramp([avg_price], colorbrewer(Reds), jenks());\n}\n```\n\nOr a category map using Bold color palette from cartocolor (see [examples/readme/example-7.css](./examples/readme/example-7.css)):\n\n```css\n#selector {\n    polygon-fill: ramp([room_type], cartocolor(Bold), category(4));\n}\n```\n\n#### Numeric ramps\n\nSometimes is really useful to have a continuous range that can be split in as many bins as desired, so you don't have to\nworry about how many values you have to provide for your calculated filters. You only specify the start and the end, and\nthe values are computed linearly (see [examples/readme/example-8.css](./examples/readme/example-8.css)):\n\n```css\n#selector {\n    marker-width: ramp([price], range(4, 40), equal(5));\n}\n```\n\nIt is kind of similar to color palettes where depending on your number of filters you get the correct number of values.\n\n\n## Dependencies\n\n * Node >=0.10\n * npm >=2.x\n\n## Install\n\nTo install the rest of the dependencies just run:\n\n```\nnpm install\n```\n\n#### Some examples\n\nCurrent examples expect to have CartoDB's SQL API running at http://development.localhost.lan:8080/. It should have a\npublicly accessible `populated_places_simple` table.\n\nExamples using a cli tool:\n\n```shell\n$ ./tools/cli.js examples/populated_places.css # will use a dummy datasource, check tools/cli.js source\n$ ./tools/cli.js examples/populated_places.css --datasource sql --query 'select * from populated_places_simple'\n```\n\nVisit `examples/index.html`, to test different styles using CartoDB's SQL API as datasource.\n\n## Tests\n\nTests suite can be run with:\n\n```\nnpm test\n```\n\nThat will check code style and run the tests.\n\n## TODO\n\nSee https://github.com/CartoDB/turbo-carto/issues\n",readmeFilename:"README.md",bugs:{url:"https://github.com/CartoDB/turbo-carto/issues"},homepage:"https://github.com/CartoDB/turbo-carto#readme",_id:"turbo-carto@0.19.0",_shasum:"83fb1932acd42acb426312eef216b5f6ac34708e",_resolved:"https://registry.npmjs.org/turbo-carto/-/turbo-carto-0.19.0.tgz",_from:"https://registry.npmjs.org/turbo-carto/-/turbo-carto-0.19.0.tgz"}},{}],162:[function(a,b,c){"use strict";function d(a){this.datasource=a,this.fnExecutors=[]}function e(a,b,c,d){var g=[];return Array.isArray(a.nodes)&&(g=a.nodes.reduce(function(a,f){switch(f.type){case"word":Number.isFinite(+f.value)?a.push(+f.value):a.push(f.value);break;case"string":a.push(f.value);break;case"function":a.push(e(f,b,c,d))}return a},[])),new f(b,a.value,g,c,d)}a("es6-promise").polyfill();var f=a("./executor");b.exports=d,d.prototype.add=function(a,b,c){this.fnExecutors.push({decl:a,fnExecutor:e(b,this.datasource,a,c)})},d.prototype.exec=function(){var a=this.fnExecutors.map(function(a){return a.fnExecutor.exec()});return Promise.all(a)}},{"./executor":163,"es6-promise":118}],163:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.datasource=a,this.fnName=b,this.args=c,this.decl=d,this.metadataHolder=e}a("es6-promise").polyfill();var e=a("../helper/debug")("fn-executor"),f=a("./factory");b.exports=d,d.prototype.exec=function(){var a=this;e("[ENTERING] Fn.prototype.exec %s(%j)",a.fnName,a.args);var b=f.create(a.fnName,a.datasource,a.decl,a.metadataHolder);return Promise.all(a.getNestedFns()).then(function(c){return e("[QUEUE DONE] %s=%j",a.fnName,c),c.forEach(function(b){a.args[b.index]=b.result}),b.apply(b,a.args)})},d.prototype.getNestedFns=function(){var a=this;return a.getNestedFnIndexes().map(function(b){return a.execFn(b)})},d.prototype.getNestedFnIndexes=function(){return this.args.reduce(function(a,b,c){return b instanceof d&&a.push(c),a},[])},d.prototype.execFn=function(a){return this.args[a].exec().then(function(b){return{index:a,result:b}})}},{"../helper/debug":178,"./factory":164,"es6-promise":118}],164:[function(a,b,c){"use strict";var d=[a("./fn-buckets"),a("./fn-buckets-category"),a("./fn-buckets-equal"),a("./fn-buckets-headtails"),a("./fn-buckets-jenks"),a("./fn-buckets-quantiles"),a("./fn-cartocolor"),a("./fn-colorbrewer"),a("./fn-ramp"),a("./fn-range")],e=d.reduce(function(a,b){return a[b.fnName]=b,a},{}),f=a("./fn-identity"),g=a("./fn-anonymous-tuple"),h={create:function(a,b,c,d){if(""===a)return g();var h=e[a];return h?h(b,c,d):f(a)}};b.exports=h},{"./fn-anonymous-tuple":165,"./fn-buckets":171,"./fn-buckets-category":166,"./fn-buckets-equal":167,"./fn-buckets-headtails":168,"./fn-buckets-jenks":169,"./fn-buckets-quantiles":170,"./fn-cartocolor":172,"./fn-colorbrewer":173,"./fn-identity":174,"./fn-ramp":175,"./fn-range":176}],165:[function(a,b,c){"use strict";a("es6-promise").polyfill();var d=a("../helper/debug")("fn-anonymous-tuple"),e=a("../model/values-result");b.exports=function(){return function(){d("fn$anonymousTuple(%j)",arguments);var a=arguments;return new Promise(function(b){var c=Object.keys(a).map(function(b){return a[b]});b(new e(c))})}},b.exports.fnName="anonymousTuple"},{"../helper/debug":178,"../model/values-result":188,"es6-promise":118}],166:[function(a,b,c){"use strict";var d=a("./fn-buckets").createBucketsFn,e="category";b.exports=function(a){return d(a,e,"==")},b.exports.fnName=e},{"./fn-buckets":171}],167:[function(a,b,c){"use strict";var d=a("./fn-buckets").createBucketsFn,e="equal";b.exports=function(a){return d(a,e,">")},b.exports.fnName=e},{"./fn-buckets":171}],168:[function(a,b,c){"use strict";var d=a("./fn-buckets").createBucketsFn,e="headtails";b.exports=function(a){return d(a,e,"<")},b.exports.fnName=e},{"./fn-buckets":171}],169:[function(a,b,c){"use strict";var d=a("./fn-buckets").createBucketsFn,e="jenks";b.exports=function(a){return d(a,e,">")},b.exports.fnName=e},{"./fn-buckets":171}],170:[function(a,b,c){"use strict";var d=a("./fn-buckets").createBucketsFn,e="quantiles";b.exports=function(a){return d(a,e,">")},b.exports.fnName=e},{"./fn-buckets":171}],171:[function(a,b,c){"use strict";function d(a){return function(b,c,d){return e("fn$buckets(%j)",arguments),e('Using "%s" datasource to calculate buckets',a.getName()),new Promise(function(e,i){return c?(d=Number.isFinite(+d)?+d:5,void a.getRamp(f(b),d,c,function(a,b){if(a)return i(new g("unable to compute ramp,",a));var c="max",d={};Array.isArray(b)||(c=b.strategy||"max",d=b.stats,b=b.ramp),e(new h(b,c,d))})):i(new g("Missing quantification method in buckets function"))})}}a("es6-promise").polyfill();var e=a("../helper/debug")("fn-buckets"),f=a("../helper/column-name"),g=a("../helper/turbo-carto-error"),h=a("../model/filters-result"),i=a("../model/lazy-filters-result");b.exports=d,b.exports.fnName="buckets",b.exports.createBucketsFn=function(a,b,c){return function(f){return e("fn$%s(%j)",b,arguments),e('Using "%s" datasource to calculate %s',a.getName(),b),new Promise(function(e){return e(new i(function(e,g){return d(a)(e,b,f).then(function(a){return a.strategy=g||c,new Promise(function(b){return b(a)})})}))})}}},{"../helper/column-name":177,"../helper/debug":178,"../helper/turbo-carto-error":181,"../model/filters-result":183,"../model/lazy-filters-result":185,"es6-promise":118}],172:[function(a,b,c){"use strict";a("es6-promise").polyfill();var d=a("cartocolor"),e=a("../model/values-result"),f=a("../helper/min-max-keys"),g=a("../helper/debug")("fn-cartocolor");b.exports=function(){return function(a,b){return g("fn$cartocolor(%j)",arguments),new Promise(function(c,g){if(!d.hasOwnProperty(a))return g(new Error('Invalid cartocolor scheme: "'+a+'"'));var h=d[a],i=f(h);b=Math.min(i.max,Math.max(i.min,b||5)),c(new e(h,b,null,i.max))})}},b.exports.fnName="cartocolor"},{"../helper/debug":178,"../helper/min-max-keys":180,"../model/values-result":188,cartocolor:"cartocolor","es6-promise":118}],173:[function(a,b,c){"use strict";a("es6-promise").polyfill();var d=a("colorbrewer"),e=a("../model/values-result"),f=a("../helper/min-max-keys"),g=a("../helper/debug")("fn-colorbrewer");b.exports=function(){return function(a,b){return g("fn$colorbrewer(%j)",arguments),new Promise(function(c,g){if(!d.hasOwnProperty(a))return g(new Error('Invalid colorbrewer scheme: "'+a+'"'));var h=d[a],i=f(h);b=Math.min(i.max,Math.max(i.min,b||5)),c(new e(h,b,null,i.max))})}},b.exports.fnName="colorbrewer"},{"../helper/debug":178,"../helper/min-max-keys":180,"../model/values-result":188,colorbrewer:114,"es6-promise":118}],174:[function(a,b,c){"use strict";a("es6-promise").polyfill();var d=a("../helper/debug")("fn-identity");b.exports=function(a){return function(){d("fn$identity(%j)",arguments);for(var b=new Array(arguments.length),c=0;c<b.length;++c)"string"==typeof arguments[c]?b[c]="'"+arguments[c]+"'":b[c]=arguments[c];return Promise.resolve(a+"("+b.join(",")+")")}},b.exports.fnName="pass"},{"../helper/debug":178,"es6-promise":118}],175:[function(a,b,c){"use strict";function d(a){return function(b,c,d,h,i){var j=c.filter(e),k=c.filter(g(e)),l=j.slice(1);"="===a&&(k=k.slice(1).concat([c.filter(g(e))[0]])),l=l.filter(g(f));var m=new w(new t(k),new u(l,null,d),a);return m.process(b,h,i)}}function e(a,b){return b%2===0}function f(a){return null===a}function g(a,b){return function(){return!a.apply(b,arguments)}}function h(a,b,c){if(0===c.length)return Promise.reject(new q("invalid number of arguments"));if(Number.isFinite(c[0]))return k(a,b,c);if(!r(c[1]))return j(a,b,c);var d=c[0],e=c[1],f=c[2],g=i(f);return e=e.is(t)?new u(e.get(),g):e,e.is(v)?e.get(b,g).then(n(d)):Promise.resolve(e).then(n(d))}function i(a){return y.hasOwnProperty(a)?y[a]:a}function j(a,b,c){var d=c[0],e=(c[1]||"quantiles").toLowerCase(),f=d.getLength();return l(a,b,f,e).then(m(d))}function k(a,b,c){if(c.length<2)return Promise.reject(new q("invalid number of arguments"));var d,e,f=+c[0],g=+c[1],h=null;if(Number.isFinite(c[2]))if(d=c[2],r(c[3])){if(h=c[3],e=null,h.getLength()!==d)return Promise.reject(new q("invalid ramp length, got "+h.getLength()+" values, expected "+d))}else h=null,e=c[3];else r(c[2])?(h=c[2],d=h.getLength(),e=null):(h=null,d=5,e=c[2]);var i=new t([f,g],d,s,Number.POSITIVE_INFINITY);return null===h?(e=(e||"quantiles").toLowerCase(),l(a,b,d,e).then(m(i))):(h=h.is(u)?h:new u(h.get(),"max"),Promise.resolve(h).then(m(i)))}function l(a,b,c,d){return new Promise(function(e,f){a.getRamp(p(b),c,d,function(a,b){if(a)return f(new q("unable to compute ramp,",a));var c="max",d={};Array.isArray(b)||(c=b.strategy||"max",d=b.stats,b=b.ramp),e(new u(b,c,d))})})}function m(a){return function(b){var c,d=Math.min(a.getLength(),b.getLength()),e=[],f=b.get(),g=a.get();if(d>0)for(c=0;d>c;c++)e.push(f[c]),e.push(g[c]);else e.push(null,g[0]);return{ramp:e,strategy:b.getStrategy(),stats:b.stats}}}function n(a){return function(b){if(w.supports(b.getStrategy()))return new w(a,b,b.getStrategy());var c,d=Math.min(a.getMaxSize(),b.getMaxSize()),e=[],f=b.get(),g=a.get(d);if(d>0)for(c=0;d>c;c++)e.push(f[c]),e.push(g[c]);else e.push(null,g[0]);return{ramp:e,strategy:b.getStrategy(),stats:b.stats}}}a("es6-promise").polyfill();var o=a("../helper/debug")("fn-ramp"),p=a("../helper/column-name"),q=a("../helper/turbo-carto-error"),r=a("../model/is-result"),s=a("../helper/linear-buckets"),t=a("../model/values-result"),u=a("../model/filters-result"),v=a("../model/lazy-filters-result"),w=a("../model/ramp/ramp-result"),x={max:function(a,b,c,d,h){var i=b.filter(g(e)),j=b.filter(e).filter(g(f)),k=new w(new t(i),new u(j,null,c),">");return k.process(a,d,h)},split:d(">"),exact:d("="),"=":d("=")};b.exports=function(a,b,c){return function(d,e){return o("fn$ramp(%j)",arguments),o('Using "%s" datasource to calculate ramp',a.getName()),e=Array.prototype.slice.call(arguments,1),h(a,d,e).then(function(a){if(a.constructor===w)return a.process(p(d),b,c);var e=x.hasOwnProperty(a.strategy)?x[a.strategy]:x.max;return e(p(d),a.ramp,a.stats,b,c)})["catch"](function(a){var c={};throw b.parent&&(c.selector=b.parent.selector),b.source&&(c.source={start:b.source.start,end:b.source.end}),new q('Failed to process "'+b.prop+'" property:',a,c)})}};var y={quantiles:"max",equal:"max",jenks:"max",headtails:"split",category:"exact"};b.exports.fnName="ramp"},{"../helper/column-name":177,"../helper/debug":178,"../helper/linear-buckets":179,"../helper/turbo-carto-error":181,"../model/filters-result":183,"../model/is-result":184,"../model/lazy-filters-result":185,"../model/ramp/ramp-result":187,"../model/values-result":188,"es6-promise":118}],176:[function(a,b,c){"use strict";a("es6-promise").polyfill();var d=a("../model/values-result"),e=a("../helper/debug")("fn-range"),f=a("../helper/linear-buckets");b.exports=function(){return function(a,b,c){return e("fn$range(%j)",arguments),new Promise(function(e){var g=[a,b];c=Number.isFinite(c)?c:5,e(new d(g,c,f,Number.POSITIVE_INFINITY))})}},b.exports.fnName="range"},{"../helper/debug":178,"../helper/linear-buckets":179,"../model/values-result":188,"es6-promise":118}],177:[function(a,b,c){"use strict";function d(a){return a.replace("[","").replace("]","")}b.exports=d},{}],178:[function(a,b,c){"use strict";var d=a("debug");b.exports=function(a){return d(["turbo-carto",a].join(":"))}},{debug:115}],179:[function(a,b,c){"use strict";b.exports=function(a,b,c){Array.isArray(a)&&(c=b,b=a[1],a=a[0]);var d=[],e=b-a,f=e/(c-1);(f===Number.POSITIVE_INFINITY||f===Number.NEGATIVE_INFINITY)&&(f=0);for(var g=0;c>g;g++)d.push(a+g*f);return d}},{}],180:[function(a,b,c){"use strict";function d(a){return Object.keys(a).reduce(function(a,b){return Number.isFinite(+b)&&(null===a.min&&(a.min=+b),null===a.max&&(a.max=+b),a.max=Math.max(a.max,+b),a.min=Math.min(a.min,+b)),a},{min:null,max:null})}b.exports=d},{}],181:[function(a,b,c){"use strict";function d(a,b,c){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,b&&(a+=" "+b.message),this.message=a,this.originalErr=b,this.context=c}a("util").inherits(d,Error),b.exports=d},{util:10}],182:[function(a,b,c){"use strict";function d(a,b,c){new e(a,b).getCartocss(c)}var e=a("./turbo-carto");b.exports=d,b.exports.TurboCarto=e,b.exports.version=a("../package.json").version},{"../package.json":161,"./turbo-carto":190}],183:[function(a,b,c){"use strict";function d(a,b,c){g.call(this,a,a.length),this.strategy=b,this.stats=c}function e(a){return!Number.isFinite(a)}var f=a("util"),g=a("./values-result");f.inherits(d,g),b.exports=d,d.prototype.getStrategy=function(){return this.result.some(e)?"=":this.strategy}},{"./values-result":188,util:10}],184:[function(a,b,c){"use strict";function d(a){return"object"==typeof a&&null!==a&&(a.constructor===e||a.constructor===f||a.constructor===g)}var e=a("./values-result"),f=a("./filters-result"),g=a("./lazy-filters-result");b.exports=d},{"./filters-result":183,"./lazy-filters-result":185,"./values-result":188}],185:[function(a,b,c){"use strict";function d(a){this.filterGenerator=a}a("es6-promise").polyfill();var e=a("util"),f=a("./filters-result");e.inherits(d,f),b.exports=d,d.prototype.get=function(a,b){return this.filterGenerator(a,b)}},{"./filters-result":183,"es6-promise":118,util:10}],186:[function(a,b,c){"use strict";function d(){this.rules=[]}b.exports=d,d.prototype.add=function(a){this.rules.push(a)}},{}],187:[function(a,b,c){"use strict";function d(a,b,c){this.values=a,this.filters=b,this.mapping=c||">",this.mapping="=="===this.mapping?"=":this.mapping}function e(a){return a=a||{},{min:a.min_val,max:a.max_val,avg:a.avg_val}}function f(a,b){return b=b||"",a&&"root"!==a.type&&(b=f(a.parent,a.selector+b)),b}var g=a("../../helper/turbo-carto-error"),h=a("postcss");b.exports=d;var i={"=":"equality","==":"equality",">":"greater_than_or_equal",">=":"greater_than_or_equal","<":"less_than_or_equal","<=":"less_than_or_equal"},j={CATEGORY:"category",DEFAULT:"default",RANGE:"range"};d.prototype.process=function(a,b,c){var d=i[this.mapping];return d===i["<"]?this.processLessThanOrEqual(a,b,c):d===i["=="]?this.processEquality(a,b,c):this.processGreaterThanOrEqual(a,b,c)},d.supports=function(a){return i.hasOwnProperty(a)||!a},d.prototype.processEquality=function(a,b,c){if(this.filters.getLength()>this.values.getMaxSize())throw new g("`"+this.mapping+"` requires more or same values than filters to work.");var d=this.values.get(this.filters.getLength()+1),e=this.filters.get(),i=b,k=null;d.length!==e.length&&(k=d[d.length-1],i=h.decl({prop:b.prop,value:k}),b.replaceWith(i));var l={start:0,end:e.length},m=0,n=this.processGeneric(i,a,k,d,e,l,m);if(d.length===e.length&&b.remove(),c){var o={selector:f(i.parent),prop:i.prop,column:a,mapping:this.mapping,buckets:[],stats:{}};o.buckets=e.map(function(a,b){return{filter:{name:a,type:j.CATEGORY},value:d[b]}}),null!==k&&o.buckets.push({filter:{type:j.DEFAULT},value:k}),c.add(o)}return n},d.prototype.processGreaterThanOrEqual=function(a,b,c){var d=Math.min(this.values.getMaxSize(),this.filters.getMaxSize()),g=this.values.get(1>=d?d+1:d),i=this.filters.get(d),k=g[0],l=h.decl({prop:b.prop,value:k});b.replaceWith(l);var m={start:0,end:Math.max(i.length-1,1)},n=1;if(c){var o=e(this.filters.stats),p={selector:f(l.parent),prop:l.prop,column:a,mapping:this.mapping,buckets:[],stats:{filter_avg:o.avg}},q=null;Number.isFinite(o.min)&&(q=o.min);var r=0;p.buckets=i.slice(m.start,m.end).map(function(a,b){var c={filter:{type:j.RANGE,start:q,end:a},value:g[b]};return q=a,r=b,c}),p.buckets.push({filter:{type:j.RANGE,start:q,end:o.max},value:g[r+1]}),c.add(p)}return this.processGeneric(l,a,k,g,i,m,n)},d.prototype.processLessThanOrEqual=function(a,b,c){var d=this.values.get(this.filters.getLength()),g=this.filters.get(),i=d[d.length-1],k=h.decl({prop:b.prop,value:i});b.replaceWith(k);var l={start:0,end:g.length-1},m=1;if(c){var n=e(this.filters.stats),o={selector:f(k.parent),prop:k.prop,column:a,mapping:this.mapping,buckets:[],stats:{filter_avg:n.avg}},p=null;Number.isFinite(n.min)&&(p=n.min);var q=0;o.buckets=g.slice(l.start,l.end).map(function(a,b){var c={filter:{type:j.RANGE,start:p,end:a},value:d[b]};return p=a,q=b,c}),o.buckets.push({filter:{type:j.RANGE,start:p,end:n.max},value:d[q+1]}),c.add(o)}var r=d.concat().reverse(),s=g.concat().reverse();return this.processGeneric(k,a,i,r,s,l,m)},d.prototype.processGeneric=function(a,b,c,d,e,f,g){var i=a;return e.slice(f.start,f.end).forEach(function(c,e){var f=Number.isFinite(c)?c:'"'+c+'"',j=h.rule({selector:"[ "+b+" "+this.mapping+" "+f+" ]"});j.append(h.decl({prop:a.prop,value:d[e+g]})),j.moveAfter(i),i=j}.bind(this)),{values:d,filters:e,mapping:this.mapping}}},{"../../helper/turbo-carto-error":181,postcss:136}],188:[function(a,b,c){"use strict";function d(a,b,c,d){this.result=a,this.defaultSize=b||a.length,this.getter=c,this.maxSize=d||a.length}b.exports=d,d.prototype.get=function(a){return a=a||this.defaultSize,this.getter?this.getter(this.result,a):Array.isArray(this.result)?a>0?this.result.slice(0,a):this.result:this.result.hasOwnProperty(a)?this.result[a]:this.result[this.defaultSize]},d.prototype.getLength=function(a){return this.get(a).length},d.prototype.getMaxSize=function(){return this.maxSize},d.prototype.toString=function(){return JSON.stringify({result:this.result,defaultSize:this.defaultSize,getter:this.getter&&this.getter.toString()})},d.prototype.is=function(a){return this.constructor===a}},{}],189:[function(a,b,c){"use strict";function d(a){this.datasource=a}a("es6-promise").polyfill();var e=a("postcss-value-parser"),f=a("postcss"),g=a("./fn/builder");b.exports=d,d.prototype.getPlugin=function(a){var b=this;return f.plugin("turbo-carto",function(){return function(c){var d=new g(b.datasource);return c.walkDecls(function(b){var c=e(b.value);c.walk(function(c){return"function"===c.type?(d.add(b,c,a),!1):void 0},!1)}),d.exec()}})}},{"./fn/builder":162,"es6-promise":118,postcss:136,"postcss-value-parser":119}],190:[function(a,b,c){"use strict";function d(a,b){this.cartocss=a,this.datasource=b,this.metadataHolder=new g}var e=a("postcss"),f=a("./postcss-turbo-carto"),g=a("./model/metadata-holder");d.prototype.getCartocss=function(a){var b=this,c=new f(this.datasource);e([c.getPlugin(this.metadataHolder)]).process(this.cartocss).then(function(c){a(null,c.css,b.metadataHolder)})["catch"](a)},d.prototype.getMetadata=function(a){return a(null,this.metadataHolder)},b.exports=d},{"./model/metadata-holder":186,"./postcss-turbo-carto":189,postcss:136}],191:[function(a,b,c){var d=a("simple-statistics");b.exports=function(a,b,c){var e=[],f=[];return a.features.forEach(function(a){void 0!==a.properties[b]&&e.push(a.properties[b])}),f=d.jenks(e,c)}},{"simple-statistics":192}],192:[function(a,b,c){"use strict";!function(){function a(){var a={},b=[];return a.data=function(c){return arguments.length?(b=c.slice(),a):b},a.mb=function(){var a,c,d=b.length;if(1===d)a=0,c=b[0][1];else{for(var e,f,g,h=0,i=0,j=0,k=0,l=0;d>l;l++)e=b[l],f=e[0],g=e[1],h+=f,i+=g,j+=f*f,k+=f*g;a=(d*k-h*i)/(d*j-h*h),c=i/d-a*h/d}return{m:a,b:c}},a.m=function(){return a.mb().m},a.b=function(){return a.mb().b},a.line=function(){var b=a.mb(),c=b.m,d=b.b;return function(a){return d+c*a}},a}function c(a,b){if(a.length<2)return 1;for(var c,d=0,e=0;e<a.length;e++)d+=a[e][1];c=d/a.length;for(var f=0,g=0;g<a.length;g++)f+=Math.pow(c-a[g][1],2);for(var h=0,i=0;i<a.length;i++)h+=Math.pow(a[i][1]-b(a[i][0]),2);return 1-h/f}function d(){var a={},b=0,c={};return a.train=function(a,d){c[d]||(c[d]={});for(var e in a){var f=a[e];void 0===c[d][e]&&(c[d][e]={}),void 0===c[d][e][f]&&(c[d][e][f]=0),c[d][e][a[e]]++}b++},a.score=function(a){var d,e={};for(var f in a){var g=a[f];for(d in c)void 0===e[d]&&(e[d]={}),c[d][f]?e[d][f+"_"+g]=(c[d][f][g]||0)/b:e[d][f+"_"+g]=0;
}var h={};for(d in e)for(var i in e[d])void 0===h[d]&&(h[d]=0),h[d]+=e[d][i];return h},a}function e(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b}function f(a){return 0===a.length?null:e(a)/a.length}function g(a){if(0===a.length)return null;for(var b=1,c=0;c<a.length;c++){if(a[c]<=0)return null;b*=a[c]}return Math.pow(b,1/a.length)}function h(a){if(0===a.length)return null;for(var b=0,c=0;c<a.length;c++){if(a[c]<=0)return null;b+=1/a[c]}return a.length/b}function i(a){if(0===a.length)return null;for(var b=0,c=0;c<a.length;c++)b+=Math.pow(a[c],2);return Math.sqrt(b/a.length)}function j(a){for(var b,c=0;c<a.length;c++)(a[c]<b||void 0===b)&&(b=a[c]);return b}function k(a){for(var b,c=0;c<a.length;c++)(a[c]>b||void 0===b)&&(b=a[c]);return b}function l(a){if(0===a.length)return null;for(var b=f(a),c=[],d=0;d<a.length;d++)c.push(Math.pow(a[d]-b,2));return f(c)}function m(a){return 0===a.length?null:Math.sqrt(l(a))}function n(a,b){for(var c=f(a),d=0,e=0;e<a.length;e++)d+=Math.pow(a[e]-c,b);return d}function o(a){if(a.length<=1)return null;var b=n(a,2);return b/(a.length-1)}function p(a){return a.length<=1?null:Math.sqrt(o(a))}function q(a,b){if(a.length<=1||a.length!==b.length)return null;for(var c=f(a),d=f(b),e=0,g=0;g<a.length;g++)e+=(a[g]-c)*(b[g]-d);return e/(a.length-1)}function r(a,b){var c=q(a,b),d=p(a),e=p(b);return null===c||null===d||null===e?null:c/d/e}function s(a){if(0===a.length)return null;var b=a.slice().sort(function(a,b){return a-b});if(b.length%2===1)return b[(b.length-1)/2];var c=b[b.length/2-1],d=b[b.length/2];return(c+d)/2}function t(a){if(0===a.length)return null;if(1===a.length)return a[0];for(var b,c=a.slice().sort(function(a,b){return a-b}),d=c[0],e=0,f=1,g=1;g<c.length+1;g++)c[g]!==d?(f>e&&(e=f,b=d),f=1,d=c[g]):f++;return b}function u(a,b){var c=f(a),d=m(a),e=Math.sqrt(a.length);return(c-b)/(d/e)}function v(a,b,c){var d=a.length,e=b.length;if(!d||!e)return null;c||(c=0);var g=f(a),h=f(b),i=((d-1)*o(a)+(e-1)*o(b))/(d+e-2);return(g-h-c)/Math.sqrt(i*(1/d+1/e))}function w(a,b){var c=[];if(0>=b)return null;for(var d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c}function x(a,b){b=b||Math.random;for(var c,d,e=a.length;e>0;)d=Math.floor(b()*e--),c=a[e],a[e]=a[d],a[d]=c;return a}function y(a,b){return a=a.slice(),x(a.slice(),b)}function z(a,b,c){var d=y(a,c);return d.slice(0,b)}function A(a,b){var c=a.length*b;return 0>b||b>1?null:1===b?a[a.length-1]:0===b?a[0]:c%1!==0?a[Math.ceil(c)-1]:a.length%2===0?(a[c-1]+a[c])/2:a[c]}function B(a,b){if(0===a.length)return null;var c=a.slice().sort(function(a,b){return a-b});if(b.length){for(var d=[],e=0;e<b.length;e++)d[e]=A(c,b[e]);return d}return A(c,b)}function C(a){return 0===a.length?null:B(a,.75)-B(a,.25)}function D(a){if(!a||0===a.length)return null;for(var b=s(a),c=[],d=0;d<a.length;d++)c.push(Math.abs(a[d]-b));return s(c)}function E(a,b){var c,d,e=[],f=[],g=0;for(c=0;c<a.length+1;c++){var h=[],i=[];for(d=0;b+1>d;d++)h.push(0),i.push(0);e.push(h),f.push(i)}for(c=1;b+1>c;c++)for(e[1][c]=1,f[1][c]=0,d=2;d<a.length+1;d++)f[d][c]=1/0;for(var j=2;j<a.length+1;j++){for(var k=0,l=0,m=0,n=0,o=1;j+1>o;o++){var p=j-o+1,q=a[p-1];if(m++,k+=q,l+=q*q,g=l-k*k/m,n=p-1,0!==n)for(d=2;b+1>d;d++)f[j][d]>=g+f[n][d-1]&&(e[j][d]=p,f[j][d]=g+f[n][d-1])}e[j][1]=1,f[j][1]=g}return{lower_class_limits:e,variance_combinations:f}}function F(a,b,c){var d=a.length,e=[],f=c;for(e[c]=a[a.length-1];f>0;)e[f-1]=a[b[d][f]-1],d=b[d][f]-1,f--;return e}function G(a,b){if(b>a.length)return null;a=a.slice().sort(function(a,b){return a-b});var c=E(a,b),d=c.lower_class_limits;return F(a,d,b)}function H(a){if(a.length<3)return null;var b=a.length,c=Math.pow(p(a),3),d=n(a,3);return b*d/((b-1)*(b-2)*c)}function I(a){var b=1/(1+.5*Math.abs(a)),c=b*Math.exp(-Math.pow(a,2)-1.26551223+1.00002368*b+.37409196*Math.pow(b,2)+.09678418*Math.pow(b,3)-.18628806*Math.pow(b,4)+.27886807*Math.pow(b,5)-1.13520398*Math.pow(b,6)+1.48851587*Math.pow(b,7)-.82215223*Math.pow(b,8)+.17087277*Math.pow(b,9));return a>=0?1-c:c-1}function J(a){var b=Math.abs(a),c=Math.min(Math.round(100*b),S.length-1);return a>=0?S[c]:+(1-S[c]).toFixed(4)}function K(a,b,c){return(a-b)/c}function L(a){if(0>a)return null;for(var b=1,c=2;a>=c;c++)b*=c;return b}function M(a,b){function c(a,b,c){return L(b)/(L(a)*L(b-a))*(Math.pow(c,a)*Math.pow(1-c,b-a))}if(0>b||b>1||0>=a||a%1!==0)return null;var d=0,e=0,f={};do f[d]=c(d,a,b),e+=f[d],d++;while(1-T>e);return f}function N(a){return 0>a||a>1?null:M(1,a)}function O(a){function b(a,b){return Math.pow(Math.E,-b)*Math.pow(b,a)/L(a)}if(0>=a)return null;var c=0,d=0,e={};do e[c]=b(c,a),d+=e[c],c++;while(1-T>d);return e}function P(a,b,c){for(var d,e,g=f(a),h=0,i=1,j=b(g),k=[],l=[],m=0;m<a.length;m++)void 0===k[a[m]]&&(k[a[m]]=0),k[a[m]]++;for(m=0;m<k.length;m++)void 0===k[m]&&(k[m]=0);for(e in j)e in k&&(l[e]=j[e]*a.length);for(e=l.length-1;e>=0;e--)l[e]<3&&(l[e-1]+=l[e],l.pop(),k[e-1]+=k[e],k.pop());for(e=0;e<k.length;e++)h+=Math.pow(k[e]-l[e],2)/l[e];return d=k.length-i-1,U[d][c]<h}function Q(a){function b(a){return function(){var b=Array.prototype.slice.apply(arguments);return b.unshift(this),R[a].apply(R,b)}}var c=!(!Object.defineProperty||!Object.defineProperties);if(!c)throw new Error("without defineProperty, simple-statistics cannot be mixed in");var d,e=["median","standard_deviation","sum","sample_skewness","mean","min","max","quantile","geometric_mean","harmonic_mean","root_mean_square"];d=a?a.slice():Array.prototype;for(var f=0;f<e.length;f++)Object.defineProperty(d,e[f],{value:b(e[f]),configurable:!0,enumerable:!1,writable:!0});return d}var R={};"undefined"!=typeof b?b.exports=R:this.ss=R;var S=[.5,.504,.508,.512,.516,.5199,.5239,.5279,.5319,.5359,.5398,.5438,.5478,.5517,.5557,.5596,.5636,.5675,.5714,.5753,.5793,.5832,.5871,.591,.5948,.5987,.6026,.6064,.6103,.6141,.6179,.6217,.6255,.6293,.6331,.6368,.6406,.6443,.648,.6517,.6554,.6591,.6628,.6664,.67,.6736,.6772,.6808,.6844,.6879,.6915,.695,.6985,.7019,.7054,.7088,.7123,.7157,.719,.7224,.7257,.7291,.7324,.7357,.7389,.7422,.7454,.7486,.7517,.7549,.758,.7611,.7642,.7673,.7704,.7734,.7764,.7794,.7823,.7852,.7881,.791,.7939,.7967,.7995,.8023,.8051,.8078,.8106,.8133,.8159,.8186,.8212,.8238,.8264,.8289,.8315,.834,.8365,.8389,.8413,.8438,.8461,.8485,.8508,.8531,.8554,.8577,.8599,.8621,.8643,.8665,.8686,.8708,.8729,.8749,.877,.879,.881,.883,.8849,.8869,.8888,.8907,.8925,.8944,.8962,.898,.8997,.9015,.9032,.9049,.9066,.9082,.9099,.9115,.9131,.9147,.9162,.9177,.9192,.9207,.9222,.9236,.9251,.9265,.9279,.9292,.9306,.9319,.9332,.9345,.9357,.937,.9382,.9394,.9406,.9418,.9429,.9441,.9452,.9463,.9474,.9484,.9495,.9505,.9515,.9525,.9535,.9545,.9554,.9564,.9573,.9582,.9591,.9599,.9608,.9616,.9625,.9633,.9641,.9649,.9656,.9664,.9671,.9678,.9686,.9693,.9699,.9706,.9713,.9719,.9726,.9732,.9738,.9744,.975,.9756,.9761,.9767,.9772,.9778,.9783,.9788,.9793,.9798,.9803,.9808,.9812,.9817,.9821,.9826,.983,.9834,.9838,.9842,.9846,.985,.9854,.9857,.9861,.9864,.9868,.9871,.9875,.9878,.9881,.9884,.9887,.989,.9893,.9896,.9898,.9901,.9904,.9906,.9909,.9911,.9913,.9916,.9918,.992,.9922,.9925,.9927,.9929,.9931,.9932,.9934,.9936,.9938,.994,.9941,.9943,.9945,.9946,.9948,.9949,.9951,.9952,.9953,.9955,.9956,.9957,.9959,.996,.9961,.9962,.9963,.9964,.9965,.9966,.9967,.9968,.9969,.997,.9971,.9972,.9973,.9974,.9974,.9975,.9976,.9977,.9977,.9978,.9979,.9979,.998,.9981,.9981,.9982,.9982,.9983,.9984,.9984,.9985,.9985,.9986,.9986,.9987,.9987,.9987,.9988,.9988,.9989,.9989,.9989,.999,.999],T=1e-4,U={1:{.995:0,.99:0,.975:0,.95:0,.9:.02,.5:.45,.1:2.71,.05:3.84,.025:5.02,.01:6.63,.005:7.88},2:{.995:.01,.99:.02,.975:.05,.95:.1,.9:.21,.5:1.39,.1:4.61,.05:5.99,.025:7.38,.01:9.21,.005:10.6},3:{.995:.07,.99:.11,.975:.22,.95:.35,.9:.58,.5:2.37,.1:6.25,.05:7.81,.025:9.35,.01:11.34,.005:12.84},4:{.995:.21,.99:.3,.975:.48,.95:.71,.9:1.06,.5:3.36,.1:7.78,.05:9.49,.025:11.14,.01:13.28,.005:14.86},5:{.995:.41,.99:.55,.975:.83,.95:1.15,.9:1.61,.5:4.35,.1:9.24,.05:11.07,.025:12.83,.01:15.09,.005:16.75},6:{.995:.68,.99:.87,.975:1.24,.95:1.64,.9:2.2,.5:5.35,.1:10.65,.05:12.59,.025:14.45,.01:16.81,.005:18.55},7:{.995:.99,.99:1.25,.975:1.69,.95:2.17,.9:2.83,.5:6.35,.1:12.02,.05:14.07,.025:16.01,.01:18.48,.005:20.28},8:{.995:1.34,.99:1.65,.975:2.18,.95:2.73,.9:3.49,.5:7.34,.1:13.36,.05:15.51,.025:17.53,.01:20.09,.005:21.96},9:{.995:1.73,.99:2.09,.975:2.7,.95:3.33,.9:4.17,.5:8.34,.1:14.68,.05:16.92,.025:19.02,.01:21.67,.005:23.59},10:{.995:2.16,.99:2.56,.975:3.25,.95:3.94,.9:4.87,.5:9.34,.1:15.99,.05:18.31,.025:20.48,.01:23.21,.005:25.19},11:{.995:2.6,.99:3.05,.975:3.82,.95:4.57,.9:5.58,.5:10.34,.1:17.28,.05:19.68,.025:21.92,.01:24.72,.005:26.76},12:{.995:3.07,.99:3.57,.975:4.4,.95:5.23,.9:6.3,.5:11.34,.1:18.55,.05:21.03,.025:23.34,.01:26.22,.005:28.3},13:{.995:3.57,.99:4.11,.975:5.01,.95:5.89,.9:7.04,.5:12.34,.1:19.81,.05:22.36,.025:24.74,.01:27.69,.005:29.82},14:{.995:4.07,.99:4.66,.975:5.63,.95:6.57,.9:7.79,.5:13.34,.1:21.06,.05:23.68,.025:26.12,.01:29.14,.005:31.32},15:{.995:4.6,.99:5.23,.975:6.27,.95:7.26,.9:8.55,.5:14.34,.1:22.31,.05:25,.025:27.49,.01:30.58,.005:32.8},16:{.995:5.14,.99:5.81,.975:6.91,.95:7.96,.9:9.31,.5:15.34,.1:23.54,.05:26.3,.025:28.85,.01:32,.005:34.27},17:{.995:5.7,.99:6.41,.975:7.56,.95:8.67,.9:10.09,.5:16.34,.1:24.77,.05:27.59,.025:30.19,.01:33.41,.005:35.72},18:{.995:6.26,.99:7.01,.975:8.23,.95:9.39,.9:10.87,.5:17.34,.1:25.99,.05:28.87,.025:31.53,.01:34.81,.005:37.16},19:{.995:6.84,.99:7.63,.975:8.91,.95:10.12,.9:11.65,.5:18.34,.1:27.2,.05:30.14,.025:32.85,.01:36.19,.005:38.58},20:{.995:7.43,.99:8.26,.975:9.59,.95:10.85,.9:12.44,.5:19.34,.1:28.41,.05:31.41,.025:34.17,.01:37.57,.005:40},21:{.995:8.03,.99:8.9,.975:10.28,.95:11.59,.9:13.24,.5:20.34,.1:29.62,.05:32.67,.025:35.48,.01:38.93,.005:41.4},22:{.995:8.64,.99:9.54,.975:10.98,.95:12.34,.9:14.04,.5:21.34,.1:30.81,.05:33.92,.025:36.78,.01:40.29,.005:42.8},23:{.995:9.26,.99:10.2,.975:11.69,.95:13.09,.9:14.85,.5:22.34,.1:32.01,.05:35.17,.025:38.08,.01:41.64,.005:44.18},24:{.995:9.89,.99:10.86,.975:12.4,.95:13.85,.9:15.66,.5:23.34,.1:33.2,.05:36.42,.025:39.36,.01:42.98,.005:45.56},25:{.995:10.52,.99:11.52,.975:13.12,.95:14.61,.9:16.47,.5:24.34,.1:34.28,.05:37.65,.025:40.65,.01:44.31,.005:46.93},26:{.995:11.16,.99:12.2,.975:13.84,.95:15.38,.9:17.29,.5:25.34,.1:35.56,.05:38.89,.025:41.92,.01:45.64,.005:48.29},27:{.995:11.81,.99:12.88,.975:14.57,.95:16.15,.9:18.11,.5:26.34,.1:36.74,.05:40.11,.025:43.19,.01:46.96,.005:49.65},28:{.995:12.46,.99:13.57,.975:15.31,.95:16.93,.9:18.94,.5:27.34,.1:37.92,.05:41.34,.025:44.46,.01:48.28,.005:50.99},29:{.995:13.12,.99:14.26,.975:16.05,.95:17.71,.9:19.77,.5:28.34,.1:39.09,.05:42.56,.025:45.72,.01:49.59,.005:52.34},30:{.995:13.79,.99:14.95,.975:16.79,.95:18.49,.9:20.6,.5:29.34,.1:40.26,.05:43.77,.025:46.98,.01:50.89,.005:53.67},40:{.995:20.71,.99:22.16,.975:24.43,.95:26.51,.9:29.05,.5:39.34,.1:51.81,.05:55.76,.025:59.34,.01:63.69,.005:66.77},50:{.995:27.99,.99:29.71,.975:32.36,.95:34.76,.9:37.69,.5:49.33,.1:63.17,.05:67.5,.025:71.42,.01:76.15,.005:79.49},60:{.995:35.53,.99:37.48,.975:40.48,.95:43.19,.9:46.46,.5:59.33,.1:74.4,.05:79.08,.025:83.3,.01:88.38,.005:91.95},70:{.995:43.28,.99:45.44,.975:48.76,.95:51.74,.9:55.33,.5:69.33,.1:85.53,.05:90.53,.025:95.02,.01:100.42,.005:104.22},80:{.995:51.17,.99:53.54,.975:57.15,.95:60.39,.9:64.28,.5:79.33,.1:96.58,.05:101.88,.025:106.63,.01:112.33,.005:116.32},90:{.995:59.2,.99:61.75,.975:65.65,.95:69.13,.9:73.29,.5:89.33,.1:107.57,.05:113.14,.025:118.14,.01:124.12,.005:128.3},100:{.995:67.33,.99:70.06,.975:74.22,.95:77.93,.9:82.36,.5:99.33,.1:118.5,.05:124.34,.025:129.56,.01:135.81,.005:140.17}};R.linear_regression=a,R.standard_deviation=m,R.r_squared=c,R.median=s,R.mean=f,R.mode=t,R.min=j,R.max=k,R.sum=e,R.quantile=B,R.quantile_sorted=A,R.iqr=C,R.mad=D,R.chunk=w,R.shuffle=y,R.shuffle_in_place=x,R.sample=z,R.sample_covariance=q,R.sample_correlation=r,R.sample_variance=o,R.sample_standard_deviation=p,R.sample_skewness=H,R.geometric_mean=g,R.harmonic_mean=h,R.root_mean_square=i,R.variance=l,R.t_test=u,R.t_test_two_sample=v,R.jenksMatrices=E,R.jenksBreaks=F,R.jenks=G,R.bayesian=d,R.epsilon=T,R.factorial=L,R.bernoulli_distribution=N,R.binomial_distribution=M,R.poisson_distribution=O,R.chi_squared_goodness_of_fit=P,R.z_score=K,R.cumulative_std_normal_probability=J,R.standard_normal_table=S,R.error_function=I,R.average=f,R.interquartile_range=C,R.mixin=Q,R.median_absolute_deviation=D,R.rms=i,R.erf=I}(this)},{}],193:[function(a,b,c){(function(a){function c(){for(var a=arguments,b=a[0],c=1;c<a.length;++c){var d=a[c];for(var e in d)b[e]=d[e]}return b}function d(a){return c({},a)}function e(a){return"function"==typeof a||!1}function f(a){return a&&"object"==typeof a&&"[object Array]"===Object.prototype.toString.call(a)}function g(){return!!document.createElement("canvas")}function h(){return"undefined"!=typeof navigator?navigator.userAgent:""}var i={};i.on=function(a,b){var c=this._evt_callbacks=this._evt_callbacks||{},d=c[a]||(c[a]=[]);return d.push(b),this},i.trigger=function(a){for(var b=this._evt_callbacks&&this._evt_callbacks[a],c=0;b&&c<b.length;++c)b[c].apply(this,Array.prototype.slice.call(arguments,1));return this},i.fire=i.trigger,i.off=function(a,b){var c=this._evt_callbacks&&this._evt_callbacks[a];if(c&&!b)return delete this._evt_callbacks[a],this;for(var d=[],e=0;c&&e<c.length;++e)c[e]===b&&d.push(e);for(;void 0!==(e=d.pop());)c.splice(e,1);return this},i.callbacks=function(a){return this._evt_callbacks&&this._evt_callbacks[a]||[]};var j={Uint8Array:"undefined"!=typeof a.Uint8Array?a.Uint8Array:Array,Uint8ClampedArray:"undefined"!=typeof a.Uint8ClampedArray?a.Uint8ClampedArray:Array,Uint32Array:"undefined"!=typeof a.Uint32Array?a.Uint32Array:Array,Int16Array:"undefined"!=typeof a.Int16Array?a.Int16Array:Array,Int32Array:"undefined"!=typeof a.Int32Array?a.Int32Array:Array},k={sprites_to_images:-1===h().indexOf("Safari")&&-1===h().indexOf("Firefox")};b.exports={Event:i,extend:c,clone:d,isFunction:e,isArray:f,types:j,isBrowserSupported:g,flags:k}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],194:[function(a,b,c){function d(a){this.filter=a}var e=a("d3"),f=a("turf-jenks");b.exports=d,d.prototype.getName=function(){return"CSSDataSource"},d.prototype.getRamp=function(a,b,c,d){var g=[],h=null,i=this.filter.getValues(),j=function(b){return b.properties[a]},k=e.extent(i,j);if(c&&"equal"!==c)if("quantiles"===c)g=e.scale.quantile().range(e.range(b)).domain(i.map(j)).quantiles();else if("jenks"===c){var l={type:"FeatureCollection",features:i};g=f(l,a,b)}else if("headstails"===c){var m=i.map(j).sort(function(a,b){return a-b});if(m.length<b)h="Number of bins should be lower than total number of rows";else if(m.length===b)g=m;else{var n=e.mean(m);g.push(n);for(var o=1;b>o;o++)g.push(e.mean(m.filter(function(a){return a>g[length-1]})))}}else h=new Error("Quantification method "+c+" is not supported");else{var p=e.scale.linear().domain([0,b]).range(k);g=e.range(b).map(p)}d(h,g)}},{d3:207,"turf-jenks":191}],195:[function(a,b,c){function d(a){this.options=a||{},this.idField=this.options.idField||"cartodb_id",this.crossfilter=new e,this.dimensions={},this.tiles={},this.visibleTiles=[],this.filters={}}var e=a("crossfilter"),f=a("./"),g=a("./geo");f.d3.extend(d.prototype,f.d3.Event,{addTile:function(a,b){var c=a.x+":"+a.y+":"+a.zoom;if("undefined"!=typeof this.tiles[c])return this.getTile(a);var d=[];return b.features.forEach(function(b){b.properties.tilePoint=a.x+":"+a.y+":"+a.zoom,d.push(b)}),this.crossfilter.add(d),this.tiles[c]=!0,this.fire("featuresChanged"),this.getTile(a)},removeTile:function(a){var b=a.x+":"+a.y+":"+a.zoom;this.dimensions.tiles&&(this.dimensions.tiles.filter(b),this.crossfilter.remove(),this.dimensions.tiles.filterAll(),delete this.tiles[b])},getTile:function(a){var b=a.x+":"+a.y+":"+a.zoom;this.dimensions.tiles||(this.dimensions.tiles=this.crossfilter.dimension(function(a){return a.properties.tilePoint}));var c={type:"FeatureCollection",features:null};return this.dimensions.tiles.filter(b),c.features=this.dimensions.tiles.top(1/0),this.dimensions.tiles.filterAll(),c},filterRange:function(a,b){this.filter(a,b)},filter:function(a,b){this._createDimension(a),this.dimensions[a].filter(b),this.filters[a]=b,this.fire("filterApplied")},filterAccept:function(a,b){this.filter(a,d.accept(b))},filterReject:function(a,b){this.filter(a,d.reject(b))},clearFilters:function(){for(var a in this.dimensions)this.dimensions[a].filterAll(),delete this.filters[a];this.fire("filterApplied")},clearFilter:function(a){this.dimensions[a].filterAll(),delete this.filters[a],this.fire("filterApplied")},getValues:function(a,b){if(!this.dimensions.tiles)return[];var c=[];if("undefined"==typeof a||a?c=this.dimensions.tiles.top(1/0):(this._createDimension(b),this.dimensions[b].filterAll(),c=this.dimensions[b].top(1/0),this.dimensions[b].filter(this.filters[b])),0===c.length)return c;var d=[],e={};if("undefined"==typeof c[0].properties[this.idField])d=c;else for(var f=0;f<c.length;f++)c[f].properties[this.idField]in e||(d.push(c[f]),e[c[f].properties[this.idField]]=!0);return this.visibleTiles.se&&(d=d.filter(function(a){return g.contains(this.visibleTiles,a)}.bind(this))),d},getColumnValues:function(a,b){return this._createDimension(a),this.dimensions[a].group().top(b||1/0)},setBoundingBox:function(a){this.visibleTiles=a},getMax:function(a){this._createDimension(a);try{return this.dimensions[a].top(1)[0].properties[a]}catch(b){return null}},getMin:function(a){this._createDimension(a);try{return this.dimensions[a].bottom(1)[0].properties[a]}catch(b){return null}},getCount:function(a){return this._createDimension(a),this.dimensions[a].groupAll().value()},surveyRandom:function(a,b){for(var c=[],d=this.getValues(),e=0;a>e;e++)c.push(d[Math.floor(Math.random()*d.length)]);return c.map(b)},_createDimension:function(a){if(!this.dimensions[a]){var b=this.surveyRandom(5,function(b){return"undefined"!=typeof b.properties[a]});if(b.some(function(a){return!a}))throw new Error("Couldn't create dimension: column "+a+" doesn't exist.");this.dimensions[a]=this.crossfilter.dimension(function(b){return b.properties[a]})}}}),d.accept=function(a){if("all"===a)return function(){return!0};if("none"===a)return function(){return!1};var b={};return a.forEach(function(a){b[a]=!0}),function(a){return b[a]?!0:!1}},d.reject=function(a){if("all"===a)return function(){return!1};if("none"===a)return function(){return!0};var b={};return a.forEach(function(a){b[a]=!0}),function(a){return b[a]?!1:!0}},b.exports=d},{"./":197,"./geo":196,crossfilter:112}],196:[function(a,b,c){b.exports={tile2lon:function(a,b){return a/Math.pow(2,b)*360-180},tile2lat:function(a,b){var c=Math.PI-2*Math.PI*a/Math.pow(2,b);return 180/Math.PI*Math.atan(.5*(Math.exp(c)-Math.exp(-c)))},geo2Webmercator:function(a,b){a%=180;var c=.017453292519943295*a,d=6378137*c,e=.017453292519943295*b,f=d,g=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e)));return{x:f,y:g}},wrapX:function(a,b){var c=Math.pow(2,b),d=(a%c+c)%c;return d},hashFeature:function(a,b){var c=b.x,d=b.zoom;"string"==typeof b&&(b=b.split(":"),c=b[0],d=b[2]);var e=Math.floor(c/Math.pow(2,d));return[a,e].join(":")},lng2tile:function(a,b){return Math.floor((a+180)/360*Math.pow(2,b))},lat2tile:function(a,b){return Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,b))},latLng2Tile:function(a,b,c){return{x:this.lng2tile(b,c),y:this.lat2tile(a,c),zoom:c}},contains:function(a,b){function c(b){return b.some(function(b){return d.pointInBB(a,b)})}var d=this;if("GeometryCollection"===b.geometry.type)return b.geometry.geometries.some(function(a){return a.coordinates.some(c)});if("number"==typeof b.geometry.coordinates[0])return this.pointInBB(a,b.geometry.coordinates);if("MultiLineString"===b.geometry.type||"MultiPolygon"===b.geometry.type)for(var e=b.geometry.coordinates,f=0;f<e.length;f++)for(var g=0;g<e[f].length;g++)return this.anyPointInBB(a,e[f][g]);else if("LineString"===b.geometry.type||"Polygon"===b.geometry.type)for(var e=b.geometry.coordinates,g=0;g<e.length;g++)return this.anyPointInBB(a,e[g])},anyPointInBB:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(this.pointInBB(a,d))return!0}},pointInBB:function(a,b){return a.se.x>=b[0]&&b[0]>=a.nw.x&&a.se.y<=b[1]&&b[1]<=a.nw.y}}},{}],197:[function(a,b,c){b.exports.d3=a("./core"),a("./leaflet_d3.js");var d={Util:a("./util.js"),geo:a("./geo.js"),Renderer:a("./renderer.js"),net:a("./net.js"),Filter:a("./filter.js"),provider:a("./providers")};for(var e in d)b.exports.d3[e]=d[e]},{"./core":193,"./filter.js":195,"./geo.js":196,"./leaflet_d3.js":198,"./net.js":199,"./providers":200,"./renderer.js":204,"./util.js":206}],198:[function(a,b,c){var d=a("./renderer"),e=a("./providers"),f=a("./tileloader"),g=a("./geo"),h=window.L;h.CartoDBd3Layer=h.TileLayer.extend({options:{minZoom:0,maxZoom:28,tileSize:256,zoomOffset:0,tileBuffer:50},events:{featureOver:null,featureOut:null,featureClick:null},initialize:function(a){a=a||{},this.renderers=[],this.svgTiles={},this.eventCallbacks={},this._animated=!0,h.Util.setOptions(this,a);var b=this.options.styles;b||(b=[this.options.cartocss],this.options.styles=b),this.options.layers&&this.options.user?this.provider=new e.WindshaftProvider(this.options):this.provider=new e.XYZProvider(this.options),this.provider.on("ready",this._resetRenderers.bind(this))},on:function(a,b){a in this.events?this.renderers.length>0?this.renderers.forEach(function(c){c.on(a,b)}):this.eventCallbacks[a]=b:h.TileLayer.prototype.on.call(this,arguments[0],arguments[1])},_getVisibleTiles:function(){for(var a=this._map.getBounds(),b=this._map.getZoom(),c=a.getNorthWest(),d=a.getSouthEast(),e=g.latLng2Tile(c.lat,c.lng,b),f=g.latLng2Tile(d.lat,d.lng,b),h=[],i=[],j=e.y;j<=f.y;j++)for(var k=e.x;k<=f.x;k++)j===e.y||j===f.y||k===e.x||k===f.x?i.push([k,j,b].join(":")):h.push([k,j,b].join(":"));var l=g.geo2Webmercator(d.lng,d.lat),m=g.geo2Webmercator(c.lng,c.lat);return{tiles:h,ring:i,se:l,nw:m}},applyFilter:function(a,b,c){var d=this.renderers[a];switch(b){case"accept":d.filter.filterAccept(c.column,c.values);break;case"reject":d.filter.filterReject(c.column,c.values);break;case"range":d.filter.filterRange(c.column,[c.min,c.max])}d.redraw()},setProvider:function(a){this.styles=a.styles,this.provider.setURL(a.urlTemplate)},setUrl:function(a){this.setProvider({styles:this.options.styles,urlTemplate:a})},featuresLoaded:function(){return this.provider?this.provider.allTilesLoaded():!1},getFilter:function(a){return this.renderers[a].filter},getFeatures:function(){var a=[];return this.renderers.length>0&&this.renderers.forEach(function(b){a.push(b.filter.getValues())}),a},onAdd:function(a){this._map=a,this.options.map=a,this.options.layer=this,this._initContainer(),this.tileLoader=new f({tileSize:this.options.tileSize,maxZoom:this.options.maxZoom,minZoom:this.options.minZoom,provider:this.provider,map:a}),this.tileLoader.loadTiles(),this._tileContainer.setAttribute("class","leaflet-zoom-animated leaflet-tile-container"),this._bgBuffer.setAttribute("class","leaflet-zoom-animated leaflet-tile-container"),this._container.style.paintOrder="stroke",this.tileLoader.on("tileAdded",this._renderTile,this),this.tileLoader.on("tileRemoved",this._clearTile,this),this.tileLoader.on("tilesLoaded",function(){this._setBoundingBox(),this.fire("featuresChanged",this.getFeatures())},this),this._map.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim,moveend:this._setBoundingBox},this)},onRemove:function(a){this.tileLoader.unbindAndClearTiles()},addTo:function(a){return a.addLayer(this),this},_setBoundingBox:function(){var a=this._getVisibleTiles();this.renderers.forEach(function(b){b.filter.setBoundingBox(a)})},_resetRenderers:function(){var a=this;this.renderers.length>0&&(this.renderers=[]);var b=this.options.styles;if(b.length>0)for(var c=0;c<b.length;c++)this.renderers.push(new d({cartocss:b[c],index:c,layer:this}));else this.renderers.push(new d({cartocss:"",index:0,layer:this}));for(var e in this.svgTiles){var f=e.split(":"),g={x:parseInt(f[0],10),y:parseInt(f[1],10),zoom:parseInt(f[2],10)};this.tileLoader._loadTile(g)}this.renderers.forEach(function(b){b.filter.on("filterApplied",function(){a.fire("featuresChanged",a.getFeatures())});for(var c in a.eventCallbacks)b.on(c,a.eventCallbacks[c])})},_renderTile:function(a){var b=a.tilePoint,c=a.geometry,d=this,e=b.x+":"+b.y+":"+b.zoom,f=this.svgTiles[e];f||(f=document.createElementNS("http://www.w3.org/2000/svg","svg"),f.setAttribute("class","leaflet-tile"),this.svgTiles[e]=f,this._tileContainer.appendChild(f));for(var g=0;g<d.renderers.length;g++){if(c.features.length>1&&"FeatureCollection"===c.features[0].type){if(c.features.length!==this.renderers.length)return}else if(this.renderers.length>1)return;var i=d.renderers.length>1?c.features[g]:c;d.renderers[g].render(f,i,b)}var j=this._getTilePos(b);f.style.width=f.style.height=this._getTileSize()+"px",h.DomUtil.setPosition(f,j,h.Browser.chrome)},_clearTile:function(a){var b=a.tileKey.split(":"),c={x:b[0],y:b[1],zoom:b[2]};this.renderers.forEach(function(a){a.filter.removeTile(c)}),this.svgTiles[a.tileKey].parentNode===this._tileContainer&&this._tileContainer.removeChild(this.svgTiles[a.tileKey]),delete this.svgTiles[a.tileKey]},_getTilePos:function(a){a=new h.Point(a.x,a.y);var b=this._map.getPixelOrigin(),c=this._getTileSize();return a.multiplyBy(c).subtract(b)},latLngToLayerPoint:function(a,b){return this._map.latLngToLayerPoint(new h.LatLng(a,b))},_getTileSize:function(){var a=this._map,b=a.getZoom()+this.options.zoomOffset,c=this.options.maxNativeZoom,d=this.options.tileSize;return c&&b>c&&(d=Math.round(a.getZoomScale(b)/a.getZoomScale(c)*d)),d},setCartoCSS:function(a,b){this.options.styles[a]=b;var c=arguments[2];this.renderers[a].setCartoCSS(b,c)},_getLoadedTilesPercentage:function(a){var b,c,d=a.getElementsByTagName("svg"),e=0;for(b=0,c=d.length;c>b;b++)d[b].complete&&e++;return e/c},_endZoomAnim:function(){var a=this._tileContainer,b=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),b.style.transform="",b.innerHTML="",h.Util.falseFn(b.offsetWidth),this._animating=!1},_stopLoadingImages:function(a){var b,c,d,e=Array.prototype.slice.call(a.getElementsByTagName("svg"));for(this.tileLoader._tilesLoading={},b=0,c=e.length;c>b;b++)d=e[b],d.parentNode.removeChild(d);this.provider.abortPending()}})},{"./geo":196,"./providers":200,"./renderer":204,"./tileloader":205}],199:[function(a,b,c){(function(c){var d=a("d3");b.exports.jsonp=function(a,b){function c(){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",b="",c=-1;++c<15;)b+=a.charAt(Math.floor(52*Math.random()));return b}function e(a){var d=a.match(/callback=(\w+)/),e=d?d[1]:c();return window[e]=function(a){b(a),delete window[e],g.remove()},e}var f=e(a),g=d.select("head").append("script").attr("type","text/javascript").attr("src",a.replace(/(\{|%7B)callback(\{|%7D)/,f))},b.exports.get=function(a,b,d){function e(){var a=g.status,c="arraybuffer"===d.responseType?g.response:g.responseText;b(!a&&c||a>=200&&300>a||304===a?g:null)}d=d||{method:"GET",data:null,responseType:"text"};var f=window.XMLHttpRequest;!c.XDomainRequest||"withCredentials"in f||!/^(http(s)?:)?\/\//.test(a)||(f=c.XDomainRequest);var g=new f;return g.open(d.method,a,!0),"onload"in g?g.onload=g.onerror=e:g.onreadystatechange=function(){g.readyState>3&&e()},g.onprogress=function(){},g.responseType=d.responseType,d.data&&(g.setRequestHeader("Content-type","application/json"),g.setRequestHeader("Accept","*")),g.send(d.data),g}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{d3:207}],200:[function(a,b,c){b.exports={SQLProvider:a("./sql.js"),XYZProvider:a("./xyz.js"),WindshaftProvider:a("./windshaft.js")}},{"./sql.js":201,"./windshaft.js":202,"./xyz.js":203}],201:[function(a,b,c){function d(a){this.sql_api_template=a.sql_api_template||"http://{user}.cartodb.com",this.user=a.user,this.table=a.table,this.format=a.format,this.tileCache={}}var e=a("d3"),f=a("../geo");d.prototype={getTile:function(a,b){var c=this.tileCache[a.zoom+":"+a.x+":"+a.y];if(c)b(a,c);else{var d={n:f.tile2lat(a.y,a.zoom),s:f.tile2lat(a.y+1,a.zoom),e:f.tile2lon(a.x,a.zoom),w:f.tile2lon(a.x+1,a.zoom)},e="SELECT * FROM "+this.table;e+=" WHERE the_geom && ST_MakeEnvelope({w},{s},{e},{n}, 4326)",e=e.replace("{w}",d.w).replace("{s}",d.s).replace("{e}",d.e).replace("{n}",d.n),this.getGeometry(e,a.zoom,function(c){this.tileCache[a.zoom+":"+a.x+":"+a.y]=c,b(a,c)}.bind(this))}},_query:function(a,b,c){var d=this.sql_api_template.replace("{user}",this.user);d+="/api/v2/sql?q="+encodeURIComponent(a),c&&(d+="&format="+c),e.json(d,b)},getGeometry:function(a,b,c){var d="select * from ("+a+") __cdb limit 0";this._query(d,function(d){var e=Object.keys(d.fields).filter(function(a){return"the_geom"!==a&&"the_geom_webmercator"!==a}),f=this.pixelSizeForZoom(b),g="st_transform(st_simplify(st_snaptogrid(the_geom_webmercator, {px}, {px}), {px}/2), 3857) as the_geom".replace(/{px}/g,f),h="select "+e.join(",")+","+g+" FROM ("+a+") __cdb";this._query(h,function(a){a.features=a.features.filter(function(a){return a.geometry&&a.geometry.coordinates.length>0}),c(a)},"geojson")}.bind(this))},pixelSizeForZoom:function(a){var b=40075017,c=256,d=b/c;return d/Math.pow(2,a)},invalidateCache:function(){this.tileCache={}}},b.exports=d},{"../geo":196,d3:207}],202:[function(a,b,c){function d(a){this.tiler_template=a.tiler_template||"http://{user}.cartodb.com",this.user=a.user,this.layers=a.layers,this.format=a.format,this.options=a,this._tileQueue=[],this.initialize(a),this._ready=!1,this.requests={}}var e=a("../"),f=a("./xyz.js");e.d3.extend(d.prototype,e.d3.Event,{initialize:function(a){this.options=a,this.tiler_template=this.tiler_template.replace("{user}",this.user);var b=this._generateMapconfig(this.table),c=this.tiler_template+"/api/v1/map?config="+encodeURIComponent(JSON.stringify(b));e.d3.net.jsonp(c+"&callback=mapconfig",function(a){this.layergroup=a,this._ready=!0,this.urlTemplate=this.tiler_template+"/api/v1/map/"+this.layergroup.layergroupid+"/mapnik/{z}/{x}/{y}.geojson",f.prototype._processQueue.apply(this),this.fire("ready")}.bind(this))},getTile:f.prototype.getTile,getGeometry:f.prototype.getGeometry,abortPending:f.prototype.abortPending,allTilesLoaded:f.prototype.allTilesLoaded,_generateMapconfig:function(a){var b=this,c={version:"1.0.1",layers:this.layers.map(function(a){var c={type:"cartodb",options:{sql:a.sql,cartocss:a.cartocss,cartocss_version:"2.1.1"}};return b.options.columns&&(c.options.columns=b.options.columns),c})};return c}}),b.exports=d},{"../":197,"./xyz.js":203}],203:[function(a,b,c){function d(a){this.format=a.format,this.urlTemplate=a.urlTemplate,this.tilejson=a.tilejson,this._tileQueue=[],this._ready=!1,this.requests={},this.urlTemplate?this._setReady():this.tilejson&&(this.urlTemplate=this.tilejson.tiles[0],this._setReady())}var e=a("d3"),f=a("../");f.d3.extend(d.prototype,f.d3.Event,{getTile:function(a,b){if(this._ready){var c=this;this.getGeometry(a,function(d,e){d||(c.requests[[a.x,a.y,a.zoom].join(":")].complete=!0,b(a,e))})}else this._tileQueue.push([a,b])},getGeometry:function(a,b){var c=this.urlTemplate.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",a.zoom).replace("{s}","abcd"[a.x*a.y%4]).replace(".png",".geojson"),d=[a.x,a.y,a.zoom].join(":"),f=e.json(c,b);this.requests[d]=f},_setReady:function(){this._ready=!0,window.setTimeout(function(){this.fire("ready"),this._processQueue()}.bind(this),0)},setURL:function(a){this.urlTemplate=a,this._setReady()},abortPending:function(){for(var a in this.requests)this.requests[a].abort();this.requests={}},allTilesLoaded:function(){for(var a in this.requests)if(!this.requests[a].complete)return!1;return!0},_processQueue:function(){var a=this;this._tileQueue.forEach(function(b){a.getTile.apply(a,b)})}}),b.exports=d},{"../":197,d3:207}],204:[function(a,b,c){(function(c){function d(a){if("markers"===a||"labels"===a){
var b=e.geo.path().projection(function(a){return a});return function(a){return"Point"===a.geometry.type?a._centroid||(a._centroid={type:"Point",properties:a.properties,coordinates:b.centroid(a)}):a}}return null}var e=c.d3||a("d3"),f=c.cartodb||{},g=c.carto||a("carto"),h=c._||a("underscore"),i=a("./geo"),j=a("./filter"),k=a("turbo-carto"),l=a("./datasource");f.d3=e||{},e.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var m=function(a){this.options=a,this.idField=a.idField||"cartodb_id",this.index=a.index,this.filter=new j({idField:this.idField}),this.styleHistory=[],a.cartocss&&this.setCartoCSS(a.cartocss),this.globalVariables={},this.layer=a.layer,this.geometries={}};m.prototype={events:{featureOver:null,featureOut:null,featureClick:null},setGlobal:function(){var a=Array.prototype.slice.call(arguments);2===a.length?this.globalVariables[a[0]]=a[1]:this.globalVariables=a[0]},setCartoCSS:function(a,b){var c=this;this.layer&&this.layer.tileLoader&&h.isEmpty(this.layer.tileLoader._tilesLoading)?c._setTurboCarto(a,b):this.filter.on("featuresChanged",function(){c._setTurboCarto(a,b)})},_setTurboCarto:function(a,b){this._preprocessCartoCSS(a,function(a,c){if(a)throw console.error(a.message),a;this._applyStyle(c,b)}.bind(this))},_applyStyle:function(a,b){if(this._addStyleToHistory(a),this.renderer=new g.RendererJS,a=m.cleanCSS(a),this.shader=this.renderer.render(a),this.layer)for(var c in this.layer.svgTiles){var d=c.split(":");d={x:d[0],y:d[1],zoom:d[2]},this.render(this.layer.svgTiles[c],null,d,!1,b)}},_addStyleToHistory:function(a){this.styleHistory[this.styleHistory.length-1]!==a&&this.styleHistory.push(a)},restoreCartoCSS:function(a){this.setCartoCSS(this.styleHistory[0],a)},_preprocessCartoCSS:function(a,b){var c=new l(this.filter);k(a,c,b)},on:function(a,b){var c=this;"featureOver"===a?this.events.featureOver=function(a){this.style.cursor="pointer";var b=e.select(this),d=b.data()[0].properties,f=m.getIndexFromFeature(this),g=c._getLayerPointFromEvent(c.layer._map,a),h=c.layer._map.layerPointToLatLng(g),i=c.layer._map.layerPointToContainerPoint(g);c.layer.eventCallbacks.featureOver(a,[h.lat,h.lng],i,d,f)}:"featureOut"===a?this.events.featureOut=function(a){var b=e.select(this),d=b.data()[0].properties,f=this.attributes["class"].value;b.reset=function(){b.style(c.styleForSymbolizer(f,"shader"))};var g=m.getIndexFromFeature(this),h=c._getLayerPointFromEvent(c.layer._map,a),i=c.layer._map.layerPointToLatLng(h),j=c.layer._map.layerPointToContainerPoint(h);c.layer.eventCallbacks.featureOut(a,[i.lat,i.lng],j,d,g)}:"featureClick"===a?this.events.featureClick=function(a){var b=e.select(this),d=b.data()[0].properties,f=m.getIndexFromFeature(this),g=c._getLayerPointFromEvent(c.layer._map,a),h=c.layer._map.layerPointToLatLng(g),i=c.layer._map.layerPointToContainerPoint(g);c.layer.eventCallbacks.featureClick(a,[h.lat,h.lng],i,d,f)}:"featuresChanged"===a&&this.filter.on("featuresChanged",b)},inferGeometryType:function(){return this.filter.surveyRandom(5,function(a){return"Point"===a.type||"Point"===a.geometry.type?"marker":a.geometry.type.toLowerCase().indexOf("polygon")>-1?"polygon":a.geometry.type.toLowerCase().indexOf("line")>-1?"line":void 0})[0]},_getLayerPointFromEvent:function(a,b){var c,d,e=0,f=0,g=a.getContainer();b.changedTouches&&b.changedTouches.length>0?(c=b.changedTouches[0].clientX+window.scrollX,d=b.changedTouches[0].clientY+window.scrollY):(c=b.clientX,d=b.clientY);var h,i;if(g.offsetParent&&g.offsetTop>0){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);h=c-e,i=d-f}else{var j=g.getBoundingClientRect(),k=window.scrollX||window.pageXOffset,l=window.scrollY||window.pageYOffset;h=(b.clientX?b.clientX:c)-j.left-g.clientLeft-k,i=(b.clientY?b.clientY:d)-j.top-g.clientTop-l}var m=new window.L.Point(h,i);return a.containerPointToLayerPoint(m)},redraw:function(a){if(this.layer)for(var b in this.layer.svgTiles){var c=b.split(":");this.layer.svgTiles[b].children[this.index].innerHTML="",c={x:c[0],y:c[1],zoom:c[2]},this.render(this.layer.svgTiles[b],null,c,!1)}},processLayersRules:function(a){var b=["hover"],c=[],d=[],e={};return a.forEach(function(a){-1!==b.indexOf(a.attachment())?d.push(a):(e[a.name()]=a,c.push(a))}),d.forEach(function(a){var b=e[a.name()];b?b[a.attachment()]=a:console.log("attachment without layer")}),c},styleForSymbolizer:function(a,b){return"polygon"===a||"line"===a?{fill:function(a){return a[b]["polygon-fill"]||"none"},"fill-opacity":function(a){return a[b]["polygon-opacity"]},stroke:function(a){return a[b]["line-color"]},"stroke-width":function(a){return a[b]["line-width"]},"stroke-opacity":function(a){return a[b]["line-opacity"]},"mix-blend-mode":function(a){var c="marker";return a.geometry.type.toLowerCase().indexOf("line")>-1?c="line":a.geometry.type.toLowerCase().indexOf("polygon")>-1&&(c="polygon"),a[b]["comp-op"]||a[b][c+"-comp-op"]},"stroke-dasharray":function(a){return a[b]["line-dasharray"]}}:"markers"===a?{fill:function(a){return a[b]["marker-fill"]||"none"},"fill-opacity":function(a){return a[b]["marker-fill-opacity"]},stroke:function(a){return a[b]["marker-line-color"]},"stroke-opacity":function(a){return a[b]["marker-line-opacity"]},"stroke-width":function(a){return a[b]["marker-line-width"]},radius:function(a){return a[b]["marker-width"]/2},"mix-blend-mode":function(a){return a[b]["comp-op"]||a[b]["marker-comp-op"]},"stroke-dasharray":function(a){return a[b]["line-dasharray"]}}:"text"===a?{fill:function(a){return a[b]["text-fill"]||"none"},"mix-blend-mode":function(a){return a[b]["comp-op"]||a[b]["text-comp-op"]}}:void 0},generateProjection:function(a){var b=i.wrapX(a.x,a.zoom);return function(c,d){var e=12756274*Math.PI,f=e/2,g=1/e,h=256*(1<<a.zoom);return c=h*(c+f)*g,d=h*(-d+f)*g,this.stream?void this.stream.point(c-256*b,d-256*a.y):{x:c-256*b,y:d-256*a.y}}},render:function(a,b,c,d,f){var g=this;b=this.filter.addTile(c,b);var h,i=e.select(a);if(h=a.children[this.index]?e.select(a.children[this.index]):i.append("g"),this.projection=this.generateProjection(c),this.path=e.geo.path().projection(e.geo.transform({point:this.projection})),this.shader&&b&&0!==b.features.length){var j=this.shader.getLayers();j=this.processLayersRules(j),j.forEach(function(a,i){if("Map::__default__"!==a.shader.attachment){var j,k=h[0][0].children;j=k[i]?e.select(k[i]):h.append("g");var l,m=g._getSymbolizers(a)[0];l=d?j.selectAll("."+m):g._createFeatures(a,b,j[0][0]),this.tilePoint=c,g._styleFeatures(a,l,this,f)}}),i.attr("class",i.attr("class")+" leaflet-tile-loaded")}},_styleFeatures:function(a,b,c,d){var f=this._getSymbolizers(a)[0],g=this;b.each(function(b){b.properties||(b.properties={});var d=i.hashFeature(b.properties[g.idField],c.tilePoint);g.geometries[d]||(g.geometries[d]=[]),g.geometries[d].push(this),b.geometry?"Polygon"===b.geometry.type||"MultiPolygon"===b.geometry.type?b.properties["mapnik::geometry_type"]=m.MAPNIK_GEOMETRY_TYPES.POLYGON:b.properties["mapnik::geometry_type"]=m.MAPNIK_GEOMETRY_TYPES.LINE:b.properties["mapnik::geometry_type"]=m.MAPNIK_GEOMETRY_TYPES.POINT,b.properties.global=g.globalVariables,b.shader=a.getStyle(b.properties,{zoom:c.tilePoint.zoom,time:g.time}),this.onmousemove=g.events.featureOver,this.onmouseleave=g.events.featureOut,this.onclick=g.events.featureClick,a.hover&&(b.shader_hover=a.hover.getStyle(b.properties,{zoom:c.tilePoint.zoom,time:g.time}),h.defaults(b.shader_hover,b.shader),g.events.featureOver=function(a){this.style.cursor="default";var b=e.select(this).data()[0],c=i.hashFeature(b.properties[g.idField],b.properties.tilePoint);g.geometries[c].forEach(function(a){e.select(a).style(g.styleForSymbolizer(f,"shader_hover"))})},g.events.featureOut=function(){var a=e.select(this).data()[0],b=i.hashFeature(a.properties[g.idField],a.properties.tilePoint);g.geometries[b].forEach(function(a){e.select(a).style(g.styleForSymbolizer(f,"shader"))})})}),"text"===f&&(b=this._transformText(b)),this._getSymbolizers(a).forEach(function(a){var c=g.styleForSymbolizer(a,"shader");d?b.filter("markers"===a?"circle":"path").transition().duration(500).delay(function(a){return Math.floor(500*Math.random())}).style(c).attr("r",c.radius):b.filter("markers"===a?"circle":"path").style(c).attr("r",c.radius)})},_createFeatures:function(a,b,c){var f=this,g=this._getSymbolizers(a)[0],h=b.features,i=d(g);i&&(h=h.map(i));var j=e.select(c).selectAll("."+g).data(h);return"text"===g?j.enter().append("svg:text").attr("class",g):j.enter().append(function(a){return document.createElementNS("http://www.w3.org/2000/svg",{Feature:"path",Point:"circle"}[a.type])}).each(function(a){var b=e.select(this);if("Feature"===a.type)b.attr("class",g).attr("d",f.path);else if(a.coordinates[0]){var c=f.projection.apply(this,a.coordinates);b.attr("class","markers").attr("cx",c.x).attr("cy",c.y)}}),j.exit().remove(),j},_getSymbolizers:function(a){var b=a.getSymbolizers();return b=h.filter(b,function(a){return"*"!==a}),b=h.uniq(b.map(function(a){return"line"===a?"polygon":a}))},_transformText:function(a){var b=this;return a.text(function(a){return a.shader["text-name"]}),a.attr("dy",function(a){return a.shader["text-dy"]}),a.attr("text-anchor","middle"),a.attr("x",function(a){if(a.geometry.coordinates[0]){var c=b.projection(a.geometry.coordinates[0],a.geometry.coordinates[1]);return c.x}this.remove()}),a.attr("y",function(a){if(a.geometry.coordinates[0]){var c=b.projection(a.geometry.coordinates[0],a.geometry.coordinates[1]);return c.y}this.remove()}),a}},m.MAPNIK_GEOMETRY_TYPES={POLYGON:3,LINE:2,POINT:1},m.getIndexFromFeature=function(a){for(var b=0,c=a.parentElement.parentElement;c=c.previousSibling;)b++;return b},m.isTurboCarto=function(a){var b=["ramp","colorbrewer","buckets"],c=b.map(function(a){return a+"("}).map(String.prototype.indexOf.bind(a)).every(function(a){return-1===a});return c},m.cleanCSS=function(a){return a.replace(/\#[^\n;:}]*?[\{[]/g,function(a){return a.replace(a.replace("#","").replace("{","").replace("[","").trim(),"layer")})},b.exports=m}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./datasource":194,"./filter":195,"./geo":196,carto:"carto",d3:207,"turbo-carto":182,underscore:"underscore"}],205:[function(a,b,c){var d=window.L;b.exports=d.Class.extend({includes:d.Mixin.Events,initialize:function(a){this.options=a,this.provider=a.provider,this._map=a.map,this._tiles={},this._tilesLoading={},this._tilesToLoad=0,this.lastDrag=0,this._map.on("moveend",this._reloadTiles,this)},loadTiles:function(){this._reloadTiles()},_reloadTiles:function(){if(this._map){var a=this._map.getPixelBounds(),b=this._map.getZoom(),c=this.options.tileSize;if(!(b>this.options.maxZoom||b<this.options.minZoom)){var e=new d.Point(Math.floor(a.min.x/c),Math.floor(a.min.y/c)),f=new d.Point(Math.floor(a.max.x/c),Math.floor(a.max.y/c)),g=new d.Bounds(e,f);this._addTilesFromCenterOut(g),this._removeOtherTiles(g)}}},_addTilesFromCenterOut:function(a){var b,c,e,f=[],g=a.getCenter(),h=this._map.getZoom();for(b=a.min.y;b<=a.max.y;b++)for(c=a.min.x;c<=a.max.x;c++)e=new d.Point(c,b),e.zoom=h,this._tileShouldBeLoaded(e)&&f.push(e);var i=f.length;if(0!==i){for(f.sort(function(a,b){return a.distanceTo(g)-b.distanceTo(g)}),this._tilesToLoad+=i,c=0;i>c;c++)this._loadTile(f[c]);this.fire("tilesLoading")}},_loadTile:function(a){var b=this._tileKey(a);this._tilesLoading[b]=a,this.provider.getTile(a,function(a,c){a.zoom===this._map.getZoom()&&(this._tiles[b]=!0,delete this._tilesLoading[b],this._tilesToLoad--,this.fire("tileAdded",{tilePoint:a,geometry:c}),this.provider.allTilesLoaded()&&this.fire("tilesLoaded"))}.bind(this))},_removeOtherTiles:function(a){var b,c,d,e,f,g=this._map.getZoom();for(f in this._tiles)this._tiles.hasOwnProperty(f)&&(b=f.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),e=parseInt(b[2],10),(g!==e||c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(f))},unbindAndClearTiles:function(){this._map.off("moveend",this._reloadTiles,this),this._map.off("zoomstart",this._invalidateProviderCache,this),this._removeTiles()},_removeTiles:function(a){for(var b in this._tiles)this._removeTile(b)},_removeTile:function(a){this.fire("tileRemoved",{tileKey:a}),delete this._tiles[a],delete this._tilesLoading[a]},_tileShouldBeLoaded:function(a){var b=this._tileKey(a);return!(b in this._tiles||b in this._tilesLoading)},_tileKey:function(a){return a.x+":"+a.y+":"+a.zoom}})},{}],206:[function(a,b,c){var d=window.L,e=a("../");b.exports={viz:function(a,b,c,f){f=f||{},e.d3.net.jsonp(a+"?callback=vizjson",function(a){b.setView(JSON.parse(a.center),a.zoom);var e=a.layers[0];e.options.urlTemplate?b.addLayer(new d.TileLayer(e.options.urlTemplate,{subdomains:e.options.subdomains||"abcd"})):e.options.color&&(document.getElementById("map").style["background-color"]=e.options.color);var g=a.layers[1];if("layergroup"===g.type){var h=g.options.layer_definition.layers.map(function(a){return{sql:a.options.sql.replace(/\n/g," "),cartocss:a.options.cartocss}}),i=new d.CartoDBd3Layer({user:g.options.user_name,layers:h,styles:h.map(function(a){return a.cartocss}),columns:f.columns}).addTo(b);c(null,i,h)}else c(new Error("named maps not supported"))})}}},{"../":197}],207:[function(a,b,c){arguments[4][13][0].apply(c,arguments)},{dup:13}],208:[function(a,b,c){!function(a,c,d){var e=a.L,f={};f.version="0.7.2","object"==typeof b&&"object"==typeof b.exports?b.exports=f:"function"==typeof define&&define.amd&&define(f),f.noConflict=function(){return a.L=e,this},a.L=f,f.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c]||{};for(b in e)e.hasOwnProperty(b)&&(a[b]=e[b])}return a},bind:function(a,b){var c=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return a.apply(b,c||arguments)}},stamp:function(){var a=0,b="_leaflet_id";return function(c){return c[b]=c[b]||++a,c[b]}}(),invokeEach:function(a,b,c){var d,e;if("object"==typeof a){e=Array.prototype.slice.call(arguments,3);for(d in a)b.apply(c,[d,a[d]].concat(e));return!0}return!1},limitExecByInterval:function(a,b,c){var d,e;return function f(){var g=arguments;return d?void(e=!0):(d=!0,setTimeout(function(){d=!1,e&&(f.apply(c,g),e=!1)},b),void a.apply(c,g))}},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return f.Util.trim(a).split(/\s+/)},setOptions:function(a,b){return a.options=f.extend({},a.options,b),a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,c){var e=b[c];if(e===d)throw new Error("No value provided for variable "+a);return"function"==typeof e&&(e=e(b)),e})},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function b(b){var c,d,e=["webkit","moz","o","ms"];for(c=0;c<e.length&&!d;c++)d=a[e[c]+b];return d}function c(b){var c=+new Date,e=Math.max(0,16-(c-d));return d=c+e,a.setTimeout(b,e)}var d=0,e=a.requestAnimationFrame||b("RequestAnimationFrame")||c,g=a.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(b){a.clearTimeout(b)};f.Util.requestAnimFrame=function(b,d,g,h){return b=f.bind(b,d),g&&e===c?void b():e.call(a,b,h)},f.Util.cancelAnimFrame=function(b){b&&g.call(a,b)}}(),f.extend=f.Util.extend,f.bind=f.Util.bind,f.stamp=f.Util.stamp,f.setOptions=f.Util.setOptions,f.Class=function(){},f.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},c=function(){};c.prototype=this.prototype;var d=new c;d.constructor=b,b.prototype=d;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);a.statics&&(f.extend(b,a.statics),delete a.statics),a.includes&&(f.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),a.options&&d.options&&(a.options=f.extend({},d.options,a.options)),f.extend(d,a),d._initHooks=[];var g=this;return b.__super__=g.prototype,d.callInitHooks=function(){if(!this._initHooksCalled){g.prototype.callInitHooks&&g.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},f.Class.include=function(a){f.extend(this.prototype,a)},f.Class.mergeOptions=function(a){f.extend(this.prototype.options,a)},f.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c)};var g="_leaflet_events";f.Mixin={},f.Mixin.Events={addEventListener:function(a,b,c){if(f.Util.invokeEach(a,this.addEventListener,this,b,c))return this;var d,e,h,i,j,k,l,m=this[g]=this[g]||{},n=c&&c!==this&&f.stamp(c);for(a=f.Util.splitWords(a),d=0,e=a.length;e>d;d++)h={action:b,context:c||this},i=a[d],n?(j=i+"_idx",k=j+"_len",l=m[j]=m[j]||{},l[n]||(l[n]=[],m[k]=(m[k]||0)+1),l[n].push(h)):(m[i]=m[i]||[],m[i].push(h));return this},hasEventListeners:function(a){var b=this[g];return!!b&&(a in b&&b[a].length>0||a+"_idx"in b&&b[a+"_idx_len"]>0)},removeEventListener:function(a,b,c){if(!this[g])return this;if(!a)return this.clearAllEventListeners();if(f.Util.invokeEach(a,this.removeEventListener,this,b,c))return this;var d,e,h,i,j,k,l,m,n,o=this[g],p=c&&c!==this&&f.stamp(c);for(a=f.Util.splitWords(a),d=0,e=a.length;e>d;d++)if(h=a[d],k=h+"_idx",l=k+"_len",m=o[k],b){if(i=p&&m?m[p]:o[h]){for(j=i.length-1;j>=0;j--)i[j].action!==b||c&&i[j].context!==c||(n=i.splice(j,1),n[0].action=f.Util.falseFn);c&&m&&0===i.length&&(delete m[p],o[l]--)}}else delete o[h],delete o[k],delete o[l];return this},clearAllEventListeners:function(){return delete this[g],this},fireEvent:function(a,b){if(!this.hasEventListeners(a))return this;var c,d,e,h,i,j=f.Util.extend({},b,{type:a,target:this}),k=this[g];if(k[a])for(c=k[a].slice(),d=0,e=c.length;e>d;d++)c[d].action.call(c[d].context,j);h=k[a+"_idx"];for(i in h)if(c=h[i].slice())for(d=0,e=c.length;e>d;d++)c[d].action.call(c[d].context,j);return this},addOneTimeEventListener:function(a,b,c){if(f.Util.invokeEach(a,this.addOneTimeEventListener,this,b,c))return this;var d=f.bind(function(){this.removeEventListener(a,b,c).removeEventListener(a,d,c)},this);return this.addEventListener(a,b,c).addEventListener(a,d,c)}},f.Mixin.Events.on=f.Mixin.Events.addEventListener,f.Mixin.Events.off=f.Mixin.Events.removeEventListener,f.Mixin.Events.once=f.Mixin.Events.addOneTimeEventListener,f.Mixin.Events.fire=f.Mixin.Events.fireEvent,function(){var b="ActiveXObject"in a,e=b&&!c.addEventListener,g=navigator.userAgent.toLowerCase(),h=-1!==g.indexOf("webkit"),i=-1!==g.indexOf("chrome"),j=-1!==g.indexOf("phantom"),k=-1!==g.indexOf("android"),l=-1!==g.search("android [23]"),m=-1!==g.indexOf("gecko"),n=typeof orientation!=d+"",o=a.navigator&&a.navigator.msPointerEnabled&&a.navigator.msMaxTouchPoints&&!a.PointerEvent,p=a.PointerEvent&&a.navigator.pointerEnabled&&a.navigator.maxTouchPoints||o,q="devicePixelRatio"in a&&a.devicePixelRatio>1||"matchMedia"in a&&a.matchMedia("(min-resolution:144dpi)")&&a.matchMedia("(min-resolution:144dpi)").matches,r=c.documentElement,s=b&&"transition"in r.style,t="WebKitCSSMatrix"in a&&"m11"in new a.WebKitCSSMatrix&&!l,u="MozPerspective"in r.style,v="OTransition"in r.style,w=!a.L_DISABLE_3D&&(s||t||u||v)&&!j,x=!a.L_NO_TOUCH&&!j&&function(){var a="ontouchstart";if(p||a in r)return!0;var b=c.createElement("div"),d=!1;return b.setAttribute?(b.setAttribute(a,"return;"),"function"==typeof b[a]&&(d=!0),b.removeAttribute(a),b=null,d):!1}();f.Browser={ie:b,ielt9:e,webkit:h,gecko:m&&!h&&!a.opera&&!b,android:k,android23:l,chrome:i,ie3d:s,webkit3d:t,gecko3d:u,opera3d:v,any3d:w,mobile:n,mobileWebkit:n&&h,mobileWebkit3d:n&&t,mobileOpera:n&&a.opera,touch:x,msPointer:o,pointer:p,retina:q}}(),f.Point=function(a,b,c){this.x=c?Math.round(a):a,this.y=c?Math.round(b):b},f.Point.prototype={clone:function(){return new f.Point(this.x,this.y)},add:function(a){return this.clone()._add(f.point(a))},_add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.clone()._subtract(f.point(a))},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){return this.x/=a,this.y/=a,this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){return this.x*=a,this.y*=a,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(a){a=f.point(a);var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},equals:function(a){return a=f.point(a),a.x===this.x&&a.y===this.y},contains:function(a){return a=f.point(a),Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+f.Util.formatNum(this.x)+", "+f.Util.formatNum(this.y)+")"}},f.point=function(a,b,c){return a instanceof f.Point?a:f.Util.isArray(a)?new f.Point(a[0],a[1]):a===d||null===a?a:new f.Point(a,b,c)},f.Bounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},f.Bounds.prototype={extend:function(a){return a=f.point(a),this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone()),this},getCenter:function(a){return new f.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new f.Point(this.min.x,this.max.y)},getTopRight:function(){return new f.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(a){var b,c;return a="number"==typeof a[0]||a instanceof f.Point?f.point(a):f.bounds(a),a instanceof f.Bounds?(b=a.min,c=a.max):b=c=a,b.x>=this.min.x&&c.x<=this.max.x&&b.y>=this.min.y&&c.y<=this.max.y},intersects:function(a){a=f.bounds(a);var b=this.min,c=this.max,d=a.min,e=a.max,g=e.x>=b.x&&d.x<=c.x,h=e.y>=b.y&&d.y<=c.y;return g&&h},isValid:function(){return!(!this.min||!this.max)}},f.bounds=function(a,b){return!a||a instanceof f.Bounds?a:new f.Bounds(a,b)},f.Transformation=function(a,b,c,d){this._a=a,this._b=b,this._c=c,this._d=d},f.Transformation.prototype={transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){return b=b||1,a.x=b*(this._a*a.x+this._b),a.y=b*(this._c*a.y+this._d),a},untransform:function(a,b){return b=b||1,new f.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}},f.DomUtil={get:function(a){return"string"==typeof a?c.getElementById(a):a},getStyle:function(a,b){var d=a.style[b];if(!d&&a.currentStyle&&(d=a.currentStyle[b]),(!d||"auto"===d)&&c.defaultView){var e=c.defaultView.getComputedStyle(a,null);d=e?e[b]:null}return"auto"===d?null:d},getViewportOffset:function(a){var b,d=0,e=0,g=a,h=c.body,i=c.documentElement;do{if(d+=g.offsetTop||0,e+=g.offsetLeft||0,d+=parseInt(f.DomUtil.getStyle(g,"borderTopWidth"),10)||0,e+=parseInt(f.DomUtil.getStyle(g,"borderLeftWidth"),10)||0,b=f.DomUtil.getStyle(g,"position"),g.offsetParent===h&&"absolute"===b)break;if("fixed"===b){d+=h.scrollTop||i.scrollTop||0,e+=h.scrollLeft||i.scrollLeft||0;break}if("relative"===b&&!g.offsetLeft){var j=f.DomUtil.getStyle(g,"width"),k=f.DomUtil.getStyle(g,"max-width"),l=g.getBoundingClientRect();("none"!==j||"none"!==k)&&(e+=l.left+g.clientLeft),d+=l.top+(h.scrollTop||i.scrollTop||0);break}g=g.offsetParent}while(g);g=a;do{if(g===h)break;d-=g.scrollTop||0,e-=g.scrollLeft||0,g=g.parentNode}while(g);return new f.Point(e,d)},documentIsLtr:function(){return f.DomUtil._docIsLtrCached||(f.DomUtil._docIsLtrCached=!0,f.DomUtil._docIsLtr="ltr"===f.DomUtil.getStyle(c.body,"direction")),f.DomUtil._docIsLtr},create:function(a,b,d){var e=c.createElement(a);return e.className=b,d&&d.appendChild(e),e},hasClass:function(a,b){if(a.classList!==d)return a.classList.contains(b);var c=f.DomUtil._getClass(a);return c.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){if(a.classList!==d)for(var c=f.Util.splitWords(b),e=0,g=c.length;g>e;e++)a.classList.add(c[e]);else if(!f.DomUtil.hasClass(a,b)){var h=f.DomUtil._getClass(a);f.DomUtil._setClass(a,(h?h+" ":"")+b)}},removeClass:function(a,b){a.classList!==d?a.classList.remove(b):f.DomUtil._setClass(a,f.Util.trim((" "+f.DomUtil._getClass(a)+" ").replace(" "+b+" "," ")))},_setClass:function(a,b){a.className.baseVal===d?a.className=b:a.className.baseVal=b},_getClass:function(a){return a.className.baseVal===d?a.className:a.className.baseVal},setOpacity:function(a,b){if("opacity"in a.style)a.style.opacity=b;else if("filter"in a.style){var c=!1,d="DXImageTransform.Microsoft.Alpha";try{c=a.filters.item(d)}catch(e){if(1===b)return}b=Math.round(100*b),c?(c.Enabled=100!==b,c.Opacity=b):a.style.filter+=" progid:"+d+"(opacity="+b+")"}},testProp:function(a){for(var b=c.documentElement.style,d=0;d<a.length;d++)if(a[d]in b)return a[d];return!1},getTranslateString:function(a){var b=f.Browser.webkit3d,c="translate"+(b?"3d":"")+"(",d=(b?",0":"")+")";return c+a.x+"px,"+a.y+"px"+d},getScaleString:function(a,b){var c=f.DomUtil.getTranslateString(b.add(b.multiplyBy(-1*a))),d=" scale("+a+") ";return c+d},setPosition:function(a,b,c){a._leaflet_pos=b,!c&&f.Browser.any3d?a.style[f.DomUtil.TRANSFORM]=f.DomUtil.getTranslateString(b):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._leaflet_pos}},f.DomUtil.TRANSFORM=f.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),f.DomUtil.TRANSITION=f.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),f.DomUtil.TRANSITION_END="webkitTransition"===f.DomUtil.TRANSITION||"OTransition"===f.DomUtil.TRANSITION?f.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in c)f.extend(f.DomUtil,{disableTextSelection:function(){f.DomEvent.on(a,"selectstart",f.DomEvent.preventDefault)},enableTextSelection:function(){f.DomEvent.off(a,"selectstart",f.DomEvent.preventDefault)}});else{var b=f.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);f.extend(f.DomUtil,{disableTextSelection:function(){if(b){var a=c.documentElement.style;this._userSelect=a[b],a[b]="none"}},enableTextSelection:function(){b&&(c.documentElement.style[b]=this._userSelect,delete this._userSelect)}})}f.extend(f.DomUtil,{disableImageDrag:function(){f.DomEvent.on(a,"dragstart",f.DomEvent.preventDefault)},enableImageDrag:function(){f.DomEvent.off(a,"dragstart",f.DomEvent.preventDefault)}})}(),f.LatLng=function(a,b,c){if(a=parseFloat(a),b=parseFloat(b),isNaN(a)||isNaN(b))throw new Error("Invalid LatLng object: ("+a+", "+b+")");this.lat=a,this.lng=b,c!==d&&(this.alt=parseFloat(c))},f.extend(f.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),f.LatLng.prototype={equals:function(a){if(!a)return!1;a=f.latLng(a);var b=Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng));return b<=f.LatLng.MAX_MARGIN},toString:function(a){return"LatLng("+f.Util.formatNum(this.lat,a)+", "+f.Util.formatNum(this.lng,a)+")"},distanceTo:function(a){a=f.latLng(a);var b=6378137,c=f.LatLng.DEG_TO_RAD,d=(a.lat-this.lat)*c,e=(a.lng-this.lng)*c,g=this.lat*c,h=a.lat*c,i=Math.sin(d/2),j=Math.sin(e/2),k=i*i+j*j*Math.cos(g)*Math.cos(h);return 2*b*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))},wrap:function(a,b){var c=this.lng;return a=a||-180,b=b||180,c=(c+b)%(b-a)+(a>c||c===b?b:a),new f.LatLng(this.lat,c)}},f.latLng=function(a,b){return a instanceof f.LatLng?a:f.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new f.LatLng(a[0],a[1],a[2]):null:a===d||null===a?a:"object"==typeof a&&"lat"in a?new f.LatLng(a.lat,"lng"in a?a.lng:a.lon):b===d?null:new f.LatLng(a,b)},f.LatLngBounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},f.LatLngBounds.prototype={extend:function(a){if(!a)return this;var b=f.latLng(a);return a=null!==b?b:f.latLngBounds(a),a instanceof f.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):(this._southWest=new f.LatLng(a.lat,a.lng),this._northEast=new f.LatLng(a.lat,a.lng)):a instanceof f.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast)),this},pad:function(a){var b=this._southWest,c=this._northEast,d=Math.abs(b.lat-c.lat)*a,e=Math.abs(b.lng-c.lng)*a;return new f.LatLngBounds(new f.LatLng(b.lat-d,b.lng-e),new f.LatLng(c.lat+d,c.lng+e))},getCenter:function(){return new f.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new f.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new f.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(a){a="number"==typeof a[0]||a instanceof f.LatLng?f.latLng(a):f.latLngBounds(a);var b,c,d=this._southWest,e=this._northEast;return a instanceof f.LatLngBounds?(b=a.getSouthWest(),c=a.getNorthEast()):b=c=a,b.lat>=d.lat&&c.lat<=e.lat&&b.lng>=d.lng&&c.lng<=e.lng},intersects:function(a){a=f.latLngBounds(a);var b=this._southWest,c=this._northEast,d=a.getSouthWest(),e=a.getNorthEast(),g=e.lat>=b.lat&&d.lat<=c.lat,h=e.lng>=b.lng&&d.lng<=c.lng;return g&&h},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(a){return a?(a=f.latLngBounds(a),this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},f.latLngBounds=function(a,b){return!a||a instanceof f.LatLngBounds?a:new f.LatLngBounds(a,b)},f.Projection={},f.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(a){var b=f.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),e=a.lng*b,g=d*b;return g=Math.log(Math.tan(Math.PI/4+g/2)),new f.Point(e,g)},unproject:function(a){var b=f.LatLng.RAD_TO_DEG,c=a.x*b,d=(2*Math.atan(Math.exp(a.y))-Math.PI/2)*b;return new f.LatLng(d,c)}},f.Projection.LonLat={project:function(a){return new f.Point(a.lng,a.lat)},unproject:function(a){return new f.LatLng(a.y,a.x)}},f.CRS={latLngToPoint:function(a,b){var c=this.projection.project(a),d=this.scale(b);return this.transformation._transform(c,d)},pointToLatLng:function(a,b){var c=this.scale(b),d=this.transformation.untransform(a,c);return this.projection.unproject(d)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)},getSize:function(a){var b=this.scale(a);return f.point(b,b)}},f.CRS.Simple=f.extend({},f.CRS,{projection:f.Projection.LonLat,transformation:new f.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)}}),f.CRS.EPSG3857=f.extend({},f.CRS,{code:"EPSG:3857",projection:f.Projection.SphericalMercator,transformation:new f.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(a){var b=this.projection.project(a),c=6378137;return b.multiplyBy(c)}}),f.CRS.EPSG900913=f.extend({},f.CRS.EPSG3857,{code:"EPSG:900913"}),f.CRS.EPSG4326=f.extend({},f.CRS,{code:"EPSG:4326",projection:f.Projection.LonLat,
transformation:new f.Transformation(1/360,.5,-1/360,.5)}),f.Map=f.Class.extend({includes:f.Mixin.Events,options:{crs:f.CRS.EPSG3857,fadeAnimation:f.DomUtil.TRANSITION&&!f.Browser.android23,trackResize:!0,markerZoomAnimation:f.DomUtil.TRANSITION&&f.Browser.any3d},initialize:function(a,b){b=f.setOptions(this,b),this._initContainer(a),this._initLayout(),this._onResize=f.bind(this._onResize,this),this._initEvents(),b.maxBounds&&this.setMaxBounds(b.maxBounds),b.center&&b.zoom!==d&&this.setView(f.latLng(b.center),b.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(b.layers)},setView:function(a,b){return b=b===d?this.getZoom():b,this._resetView(f.latLng(a),this._limitZoom(b)),this},setZoom:function(a,b){return this._loaded?this.setView(this.getCenter(),a,{zoom:b}):(this._zoom=this._limitZoom(a),this)},zoomIn:function(a,b){return this.setZoom(this._zoom+(a||1),b)},zoomOut:function(a,b){return this.setZoom(this._zoom-(a||1),b)},setZoomAround:function(a,b,c){var d=this.getZoomScale(b),e=this.getSize().divideBy(2),g=a instanceof f.Point?a:this.latLngToContainerPoint(a),h=g.subtract(e).multiplyBy(1-1/d),i=this.containerPointToLatLng(e.add(h));return this.setView(i,b,{zoom:c})},fitBounds:function(a,b){b=b||{},a=a.getBounds?a.getBounds():f.latLngBounds(a);var c=f.point(b.paddingTopLeft||b.padding||[0,0]),d=f.point(b.paddingBottomRight||b.padding||[0,0]),e=this.getBoundsZoom(a,!1,c.add(d)),g=d.subtract(c).divideBy(2),h=this.project(a.getSouthWest(),e),i=this.project(a.getNorthEast(),e),j=this.unproject(h.add(i).divideBy(2).add(g),e);return e=b&&b.maxZoom?Math.min(b.maxZoom,e):e,this.setView(j,e,b)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,b){return this.setView(a,this._zoom,{pan:b})},panBy:function(a){return this.fire("movestart"),this._rawPanBy(f.point(a)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(a){return a=f.latLngBounds(a),this.options.maxBounds=a,a?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(a,b){var c=this.getCenter(),d=this._limitCenter(c,this._zoom,a);return c.equals(d)?this:this.panTo(d,b)},addLayer:function(a){var b=f.stamp(a);return this._layers[b]?this:(this._layers[b]=a,!a.options||isNaN(a.options.maxZoom)&&isNaN(a.options.minZoom)||(this._zoomBoundLayers[b]=a,this._updateZoomLevels()),this.options.zoomAnimation&&f.TileLayer&&a instanceof f.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(a),this)},removeLayer:function(a){var b=f.stamp(a);return this._layers[b]?(this._loaded&&a.onRemove(this),delete this._layers[b],this._loaded&&this.fire("layerremove",{layer:a}),this._zoomBoundLayers[b]&&(delete this._zoomBoundLayers[b],this._updateZoomLevels()),this.options.zoomAnimation&&f.TileLayer&&a instanceof f.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(a){return a?f.stamp(a)in this._layers:!1},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},invalidateSize:function(a){if(!this._loaded)return this;a=f.extend({animate:!1,pan:!0},a===!0?{animate:!0}:a);var b=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var c=this.getSize(),d=b.divideBy(2).round(),e=c.divideBy(2).round(),g=d.subtract(e);return g.x||g.y?(a.animate&&a.pan?this.panBy(g):(a.pan&&this._rawPanBy(g),this.fire("move"),a.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(f.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:b,newSize:c})):this},addHandler:function(a,b){if(!b)return this;var c=this[a]=new b(this);return this._handlers.push(c),this.options[a]&&c.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(a){this._container._leaflet=d}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var a=this.getPixelBounds(),b=this.unproject(a.getBottomLeft()),c=this.unproject(a.getTopRight());return new f.LatLngBounds(b,c)},getMinZoom:function(){return this.options.minZoom===d?this._layersMinZoom===d?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===d?this._layersMaxZoom===d?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(a,b,c){a=f.latLngBounds(a);var d,e=this.getMinZoom()-(b?1:0),g=this.getMaxZoom(),h=this.getSize(),i=a.getNorthWest(),j=a.getSouthEast(),k=!0;c=f.point(c||[0,0]);do e++,d=this.project(j,e).subtract(this.project(i,e)).add(c),k=b?d.x<h.x||d.y<h.y:h.contains(d);while(k&&g>=e);return k&&b?null:b?e:e-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new f.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var a=this._getTopLeftPoint();return new f.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a){var b=this.options.crs;return b.scale(a)/b.scale(this._zoom)},getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2},project:function(a,b){return b=b===d?this._zoom:b,this.options.crs.latLngToPoint(f.latLng(a),b)},unproject:function(a,b){return b=b===d?this._zoom:b,this.options.crs.pointToLatLng(f.point(a),b)},layerPointToLatLng:function(a){var b=f.point(a).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(a){var b=this.project(f.latLng(a))._round();return b._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(a){return f.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return f.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){var b=this.containerPointToLayerPoint(f.point(a));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(f.latLng(a)))},mouseEventToContainerPoint:function(a){return f.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){var b=this._container=f.DomUtil.get(a);if(!b)throw new Error("Map container not found.");if(b._leaflet)throw new Error("Map container is already initialized.");b._leaflet=!0},_initLayout:function(){var a=this._container;f.DomUtil.addClass(a,"leaflet-container"+(f.Browser.touch?" leaflet-touch":"")+(f.Browser.retina?" leaflet-retina":"")+(f.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var b=f.DomUtil.getStyle(a,"position");"absolute"!==b&&"relative"!==b&&"fixed"!==b&&(a.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),a.shadowPane=this._createPane("leaflet-shadow-pane"),a.overlayPane=this._createPane("leaflet-overlay-pane"),a.markerPane=this._createPane("leaflet-marker-pane"),a.popupPane=this._createPane("leaflet-popup-pane");var b=" leaflet-zoom-hide";this.options.markerZoomAnimation||(f.DomUtil.addClass(a.markerPane,b),f.DomUtil.addClass(a.shadowPane,b),f.DomUtil.addClass(a.popupPane,b))},_createPane:function(a,b){return f.DomUtil.create("div",a,b||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(a){a=a?f.Util.isArray(a)?a:[a]:[];for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},_resetView:function(a,b,c,d){var e=this._zoom!==b;d||(this.fire("movestart"),e&&this.fire("zoomstart")),this._zoom=b,this._initialCenter=a,this._initialTopLeftPoint=this._getNewTopLeftPoint(a),c?this._initialTopLeftPoint._add(this._getMapPanePos()):f.DomUtil.setPosition(this._mapPane,new f.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var g=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!c}),g&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(e||d)&&this.fire("zoomend"),this.fire("moveend",{hard:!c})},_rawPanBy:function(a){f.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var a,b=1/0,c=-(1/0),e=this._getZoomSpan();for(a in this._zoomBoundLayers){var f=this._zoomBoundLayers[a];isNaN(f.options.minZoom)||(b=Math.min(b,f.options.minZoom)),isNaN(f.options.maxZoom)||(c=Math.max(c,f.options.maxZoom))}a===d?this._layersMaxZoom=this._layersMinZoom=d:(this._layersMaxZoom=c,this._layersMinZoom=b),e!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(b){if(f.DomEvent){b=b||"on",f.DomEvent[b](this._container,"click",this._onMouseClick,this);var c,d,e=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(c=0,d=e.length;d>c;c++)f.DomEvent[b](this._container,e[c],this._fireMouseEvent,this);this.options.trackResize&&f.DomEvent[b](a,"resize",this._onResize,this)}},_onResize:function(){f.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=f.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(a){!this._loaded||!a._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||f.DomEvent._skipped(a)||(this.fire("preclick"),this._fireMouseEvent(a))},_fireMouseEvent:function(a){if(this._loaded&&!f.DomEvent._skipped(a)){var b=a.type;if(b="mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,this.hasEventListeners(b)){"contextmenu"===b&&f.DomEvent.preventDefault(a);var c=this.mouseEventToContainerPoint(a),d=this.containerPointToLayerPoint(c),e=this.layerPointToLatLng(d);this.fire(b,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var a=0,b=this._handlers.length;b>a;a++)this._handlers[a].disable()},whenReady:function(a,b){return this._loaded?a.call(b||this,this):this.on("load",a,b),this},_layerAdd:function(a){a.onAdd(this),this.fire("layeradd",{layer:a})},_getMapPanePos:function(){return f.DomUtil.getPosition(this._mapPane)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(a,b){var c=this.getSize()._divideBy(2);return this.project(a,b)._subtract(c)._round()},_latLngToNewLayerPoint:function(a,b,c){var d=this._getNewTopLeftPoint(c,b).add(this._getMapPanePos());return this.project(a,b)._subtract(d)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(a,b,c){if(!c)return a;var d=this.project(a,b),e=this.getSize().divideBy(2),g=new f.Bounds(d.subtract(e),d.add(e)),h=this._getBoundsOffset(g,c,b);return this.unproject(d.add(h),b)},_limitOffset:function(a,b){if(!b)return a;var c=this.getPixelBounds(),d=new f.Bounds(c.min.add(a),c.max.add(a));return a.add(this._getBoundsOffset(d,b))},_getBoundsOffset:function(a,b,c){var d=this.project(b.getNorthWest(),c).subtract(a.min),e=this.project(b.getSouthEast(),c).subtract(a.max),g=this._rebound(d.x,-e.x),h=this._rebound(d.y,-e.y);return new f.Point(g,h)},_rebound:function(a,b){return a+b>0?Math.round(a-b)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(b))},_limitZoom:function(a){var b=this.getMinZoom(),c=this.getMaxZoom();return Math.max(b,Math.min(c,a))}}),f.map=function(a,b){return new f.Map(a,b)},f.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(a){var b=f.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),e=this.R_MAJOR,g=this.R_MINOR,h=a.lng*b*e,i=d*b,j=g/e,k=Math.sqrt(1-j*j),l=k*Math.sin(i);l=Math.pow((1-l)/(1+l),.5*k);var m=Math.tan(.5*(.5*Math.PI-i))/l;return i=-e*Math.log(m),new f.Point(h,i)},unproject:function(a){for(var b,c=f.LatLng.RAD_TO_DEG,d=this.R_MAJOR,e=this.R_MINOR,g=a.x*c/d,h=e/d,i=Math.sqrt(1-h*h),j=Math.exp(-a.y/d),k=Math.PI/2-2*Math.atan(j),l=15,m=1e-7,n=l,o=.1;Math.abs(o)>m&&--n>0;)b=i*Math.sin(k),o=Math.PI/2-2*Math.atan(j*Math.pow((1-b)/(1+b),.5*i))-k,k+=o;return new f.LatLng(k*c,g)}},f.CRS.EPSG3395=f.extend({},f.CRS,{code:"EPSG:3395",projection:f.Projection.Mercator,transformation:function(){var a=f.Projection.Mercator,b=a.R_MAJOR,c=.5/(Math.PI*b);return new f.Transformation(c,.5,-c,.5)}()}),f.TileLayer=f.Class.extend({includes:f.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:f.Browser.mobile,updateWhenIdle:f.Browser.mobile},initialize:function(a,b){b=f.setOptions(this,b),b.detectRetina&&f.Browser.retina&&b.maxZoom>0&&(b.tileSize=Math.floor(b.tileSize/2),b.zoomOffset++,b.minZoom>0&&b.minZoom--,this.options.maxZoom--),b.bounds&&(b.bounds=f.latLngBounds(b.bounds)),this._url=a;var c=this.options.subdomains;"string"==typeof c&&(this.options.subdomains=c.split(""))},onAdd:function(a){this._map=a,this._animated=a._zoomAnimated,this._initContainer(),a.on({viewreset:this._reset,moveend:this._update},this),this._animated&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=f.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,moveend:this._update},this),this._animated&&a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var a=this._map._panes.tilePane;return this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max)),this},bringToBack:function(){var a=this._map._panes.tilePane;return this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},setUrl:function(a,b){return this._url=a,b||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==d&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(a,b){var c,d,e,f=a.children,g=-b(1/0,-(1/0));for(d=0,e=f.length;e>d;d++)f[d]!==this._container&&(c=parseInt(f[d].style.zIndex,10),isNaN(c)||(g=b(g,c)));this.options.zIndex=this._container.style.zIndex=(isFinite(g)?g:0)+b(1,-1)},_updateOpacity:function(){var a,b=this._tiles;if(f.Browser.ielt9)for(a in b)f.DomUtil.setOpacity(b[a],this.options.opacity);else f.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){if(this._container=f.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var b="leaflet-tile-container";this._bgBuffer=f.DomUtil.create("div",b,this._container),this._tileContainer=f.DomUtil.create("div",b,this._container)}else this._tileContainer=this._container;a.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(a){for(var b in this._tiles)this.fire("tileunload",{tile:this._tiles[b]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&a&&a.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var a=this._map,b=a.getZoom()+this.options.zoomOffset,c=this.options.maxNativeZoom,d=this.options.tileSize;return c&&b>c&&(d=Math.round(a.getZoomScale(b)/a.getZoomScale(c)*d)),d},_update:function(){if(this._map){var a=this._map,b=a.getPixelBounds(),c=a.getZoom(),d=this._getTileSize();if(!(c>this.options.maxZoom||c<this.options.minZoom)){var e=f.bounds(b.min.divideBy(d)._floor(),b.max.divideBy(d)._floor());this._addTilesFromCenterOut(e),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(e)}}},_addTilesFromCenterOut:function(a){var b,d,e,g=[],h=a.getCenter();for(b=a.min.y;b<=a.max.y;b++)for(d=a.min.x;d<=a.max.x;d++)e=new f.Point(d,b),this._tileShouldBeLoaded(e)&&g.push(e);var i=g.length;if(0!==i){g.sort(function(a,b){return a.distanceTo(h)-b.distanceTo(h)});var j=c.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=i,d=0;i>d;d++)this._addTile(g[d],j);this._tileContainer.appendChild(j)}},_tileShouldBeLoaded:function(a){if(a.x+":"+a.y in this._tiles)return!1;var b=this.options;if(!b.continuousWorld){var c=this._getWrapTileNum();if(b.noWrap&&(a.x<0||a.x>=c.x)||a.y<0||a.y>=c.y)return!1}if(b.bounds){var d=b.tileSize,e=a.multiplyBy(d),f=e.add([d,d]),g=this._map.unproject(e),h=this._map.unproject(f);if(b.continuousWorld||b.noWrap||(g=g.wrap(),h=h.wrap()),!b.bounds.intersects([g,h]))return!1}return!0},_removeOtherTiles:function(a){var b,c,d,e;for(e in this._tiles)b=e.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),(c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(e)},_removeTile:function(a){var b=this._tiles[a];this.fire("tileunload",{tile:b,url:b.src}),this.options.reuseTiles?(f.DomUtil.removeClass(b,"leaflet-tile-loaded"),this._unusedTiles.push(b)):b.parentNode===this._tileContainer&&this._tileContainer.removeChild(b),f.Browser.android||(b.onload=null,b.src=f.Util.emptyImageUrl),delete this._tiles[a]},_addTile:function(a,b){var c=this._getTilePos(a),d=this._getTile();f.DomUtil.setPosition(d,c,f.Browser.chrome),this._tiles[a.x+":"+a.y]=d,this._loadTile(d,a),d.parentNode!==this._tileContainer&&b.appendChild(d)},_getZoomForUrl:function(){var a=this.options,b=this._map.getZoom();return a.zoomReverse&&(b=a.maxZoom-b),b+=a.zoomOffset,a.maxNativeZoom?Math.min(b,a.maxNativeZoom):b},_getTilePos:function(a){var b=this._map.getPixelOrigin(),c=this._getTileSize();return a.multiplyBy(c).subtract(b)},getTileUrl:function(a){return f.Util.template(this._url,f.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y},this.options))},_getWrapTileNum:function(){var a=this._map.options.crs,b=a.getSize(this._map.getZoom());return b.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(a){var b=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(a.x=(a.x%b.x+b.x)%b.x),this.options.tms&&(a.y=b.y-a.y-1),a.z=this._getZoomForUrl()},_getSubdomain:function(a){var b=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[b]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();return this._resetTile(a),a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=f.DomUtil.create("img","leaflet-tile");return a.style.width=a.style.height=this._getTileSize()+"px",a.galleryimg="no",a.onselectstart=a.onmousemove=f.Util.falseFn,f.Browser.ielt9&&this.options.opacity!==d&&f.DomUtil.setOpacity(a,this.options.opacity),f.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden"),a},_loadTile:function(a,b){a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(b),a.src=this.getTileUrl(b),this.fire("tileloadstart",{tile:a,url:a.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&f.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(f.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var a=this._layer;this.src!==f.Util.emptyImageUrl&&(f.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src})),a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;b&&(this.src=b),a._tileLoaded()}}),f.tileLayer=function(a,b){return new f.TileLayer(a,b)},f.TileLayer.WMS=f.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(a,b){this._url=a;var c=f.extend({},this.defaultWmsParams),d=b.tileSize||this.options.tileSize;b.detectRetina&&f.Browser.retina?c.width=c.height=2*d:c.width=c.height=d;for(var e in b)this.options.hasOwnProperty(e)||"crs"===e||(c[e]=b[e]);this.wmsParams=c,f.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,f.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(a){var b=this._map,c=this.options.tileSize,d=a.multiplyBy(c),e=d.add([c,c]),g=this._crs.project(b.unproject(d,a.z)),h=this._crs.project(b.unproject(e,a.z)),i=this._wmsVersion>=1.3&&this._crs===f.CRS.EPSG4326?[h.y,g.x,g.y,h.x].join(","):[g.x,h.y,h.x,g.y].join(","),j=f.Util.template(this._url,{s:this._getSubdomain(a)});return j+f.Util.getParamString(this.wmsParams,j,!0)+"&BBOX="+i},setParams:function(a,b){return f.extend(this.wmsParams,a),b||this.redraw(),this}}),f.tileLayer.wms=function(a,b){return new f.TileLayer.WMS(a,b)},f.TileLayer.Canvas=f.TileLayer.extend({options:{async:!1},initialize:function(a){f.setOptions(this,a)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var a in this._tiles)this._redrawTile(this._tiles[a]);return this},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom)},_createTile:function(){var a=f.DomUtil.create("canvas","leaflet-tile");return a.width=a.height=this.options.tileSize,a.onselectstart=a.onmousemove=f.Util.falseFn,a},_loadTile:function(a,b){a._layer=this,a._tilePoint=b,this._redrawTile(a),this.options.async||this.tileDrawn(a)},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}}),f.tileLayer.canvas=function(a){return new f.TileLayer.Canvas(a)},f.ImageOverlay=f.Class.extend({includes:f.Mixin.Events,options:{opacity:1},initialize:function(a,b,c){this._url=a,this._bounds=f.latLngBounds(b),f.setOptions(this,c)},onAdd:function(a){this._map=a,this._image||this._initImage(),a._panes.overlayPane.appendChild(this._image),a.on("viewreset",this._reset,this),a.options.zoomAnimation&&f.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image),a.off("viewreset",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var a=this._map._panes.overlayPane;return this._image&&a.insertBefore(this._image,a.firstChild),this},setUrl:function(a){this._url=a,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=f.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&f.Browser.any3d?f.DomUtil.addClass(this._image,"leaflet-zoom-animated"):f.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),f.extend(this._image,{galleryimg:"no",onselectstart:f.Util.falseFn,onmousemove:f.Util.falseFn,onload:f.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(a){var b=this._map,c=this._image,d=b.getZoomScale(a.zoom),e=this._bounds.getNorthWest(),g=this._bounds.getSouthEast(),h=b._latLngToNewLayerPoint(e,a.zoom,a.center),i=b._latLngToNewLayerPoint(g,a.zoom,a.center)._subtract(h),j=h._add(i._multiplyBy(.5*(1-1/d)));c.style[f.DomUtil.TRANSFORM]=f.DomUtil.getTranslateString(j)+" scale("+d+") "},_reset:function(){var a=this._image,b=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),c=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(b);f.DomUtil.setPosition(a,b),a.style.width=c.x+"px",a.style.height=c.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){f.DomUtil.setOpacity(this._image,this.options.opacity)}}),f.imageOverlay=function(a,b,c){return new f.ImageOverlay(a,b,c)},f.Icon=f.Class.extend({options:{className:""},initialize:function(a){f.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(a,b){var c=this._getIconUrl(a);if(!c){if("icon"===a)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var d;return d=b&&"IMG"===b.tagName?this._createImg(c,b):this._createImg(c),this._setIconStyles(d,a),d},_setIconStyles:function(a,b){var c,d=this.options,e=f.point(d[b+"Size"]);c="shadow"===b?f.point(d.shadowAnchor||d.iconAnchor):f.point(d.iconAnchor),!c&&e&&(c=e.divideBy(2,!0)),a.className="leaflet-marker-"+b+" "+d.className,c&&(a.style.marginLeft=-c.x+"px",a.style.marginTop=-c.y+"px"),e&&(a.style.width=e.x+"px",a.style.height=e.y+"px")},_createImg:function(a,b){return b=b||c.createElement("img"),b.src=a,b},_getIconUrl:function(a){return f.Browser.retina&&this.options[a+"RetinaUrl"]?this.options[a+"RetinaUrl"]:this.options[a+"Url"]}}),f.icon=function(a){return new f.Icon(a)},f.Icon.Default=f.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(a){var b=a+"Url";if(this.options[b])return this.options[b];f.Browser.retina&&"icon"===a&&(a+="-2x");var c=f.Icon.Default.imagePath;if(!c)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return c+"/marker-"+a+".png"}}),f.Icon.Default.imagePath=function(){var a,b,d,e,f,g=c.getElementsByTagName("script"),h=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,b=g.length;b>a;a++)if(d=g[a].src,e=d.match(h))return f=d.split(h)[0],(f?f+"/":"")+"images"}(),f.Marker=f.Class.extend({includes:f.Mixin.Events,options:{icon:new f.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(a,b){f.setOptions(this,b),this._latlng=f.latLng(a)},onAdd:function(a){this._map=a,a.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),a.options.zoomAnimation&&a.options.markerZoomAnimation&&a.on("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),a.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=f.latLng(a),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(a){return this.options.zIndexOffset=a,this.update(),this},setIcon:function(a){return this.options.icon=a,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a)}return this},_initIcon:function(){var a=this.options,b=this._map,c=b.options.zoomAnimation&&b.options.markerZoomAnimation,d=c?"leaflet-zoom-animated":"leaflet-zoom-hide",e=a.icon.createIcon(this._icon),g=!1;e!==this._icon&&(this._icon&&this._removeIcon(),g=!0,a.title&&(e.title=a.title),a.alt&&(e.alt=a.alt)),f.DomUtil.addClass(e,d),a.keyboard&&(e.tabIndex="0"),this._icon=e,this._initInteraction(),a.riseOnHover&&f.DomEvent.on(e,"mouseover",this._bringToFront,this).on(e,"mouseout",this._resetZIndex,this);var h=a.icon.createShadow(this._shadow),i=!1;h!==this._shadow&&(this._removeShadow(),i=!0),h&&f.DomUtil.addClass(h,d),this._shadow=h,a.opacity<1&&this._updateOpacity();var j=this._map._panes;g&&j.markerPane.appendChild(this._icon),h&&i&&j.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&f.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(a){f.DomUtil.setPosition(this._icon,a),this._shadow&&f.DomUtil.setPosition(this._shadow,a),this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(b)},_initInteraction:function(){if(this.options.clickable){var a=this._icon,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];f.DomUtil.addClass(a,"leaflet-clickable"),f.DomEvent.on(a,"click",this._onMouseClick,this),f.DomEvent.on(a,"keypress",this._onKeyPress,this);for(var c=0;c<b.length;c++)f.DomEvent.on(a,b[c],this._fireMouseEvent,this);f.Handler.MarkerDrag&&(this.dragging=new f.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(a){var b=this.dragging&&this.dragging.moved();(this.hasEventListeners(a.type)||b)&&f.DomEvent.stopPropagation(a),b||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a,latlng:this._latlng})},_onKeyPress:function(a){13===a.keyCode&&this.fire("click",{originalEvent:a,latlng:this._latlng})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&f.DomEvent.preventDefault(a),"mousedown"!==a.type?f.DomEvent.stopPropagation(a):f.DomEvent.preventDefault(a)},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},_updateOpacity:function(){f.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&f.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),f.marker=function(a,b){return new f.Marker(a,b)},f.DivIcon=f.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(a){var b=a&&"DIV"===a.tagName?a:c.createElement("div"),d=this.options;return d.html!==!1?b.innerHTML=d.html:b.innerHTML="",d.bgPos&&(b.style.backgroundPosition=-d.bgPos.x+"px "+-d.bgPos.y+"px"),this._setIconStyles(b,"icon"),b},createShadow:function(){return null}}),f.divIcon=function(a){return new f.DivIcon(a)},f.Map.mergeOptions({closePopupOnClick:!0}),f.Popup=f.Class.extend({includes:f.Mixin.Events,
options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(a,b){f.setOptions(this,a),this._source=b,this._animated=f.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._container||this._initLayout();var b=a.options.fadeAnimation;b&&f.DomUtil.setOpacity(this._container,0),a._panes.popupPane.appendChild(this._container),a.on(this._getEvents(),this),this.update(),b&&f.DomUtil.setOpacity(this._container,1),this.fire("open"),a.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(a){return a.addLayer(this),this},openOn:function(a){return a.openPopup(this),this},onRemove:function(a){a._panes.popupPane.removeChild(this._container),f.Util.falseFn(this._container.offsetWidth),a.off(this._getEvents(),this),a.options.fadeAnimation&&f.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),a.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=f.latLng(a),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(a){return this._content=a,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var a={viewreset:this._updatePosition};return this._animated&&(a.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(a.preclick=this._close),this.options.keepInView&&(a.moveend=this._adjustPan),a},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var a,b="leaflet-popup",c=b+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),d=this._container=f.DomUtil.create("div",c);this.options.closeButton&&(a=this._closeButton=f.DomUtil.create("a",b+"-close-button",d),a.href="#close",a.innerHTML="&#215;",f.DomEvent.disableClickPropagation(a),f.DomEvent.on(a,"click",this._onCloseButtonClick,this));var e=this._wrapper=f.DomUtil.create("div",b+"-content-wrapper",d);f.DomEvent.disableClickPropagation(e),this._contentNode=f.DomUtil.create("div",b+"-content",e),f.DomEvent.disableScrollPropagation(this._contentNode),f.DomEvent.on(e,"contextmenu",f.DomEvent.stopPropagation),this._tipContainer=f.DomUtil.create("div",b+"-tip-container",d),this._tip=f.DomUtil.create("div",b+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var a=this._contentNode,b=a.style;b.width="",b.whiteSpace="nowrap";var c=a.offsetWidth;c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth),b.width=c+1+"px",b.whiteSpace="",b.height="";var d=a.offsetHeight,e=this.options.maxHeight,g="leaflet-popup-scrolled";e&&d>e?(b.height=e+"px",f.DomUtil.addClass(a,g)):f.DomUtil.removeClass(a,g),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var a=this._map.latLngToLayerPoint(this._latlng),b=this._animated,c=f.point(this.options.offset);b&&f.DomUtil.setPosition(this._container,a),this._containerBottom=-c.y-(b?0:a.y),this._containerLeft=-Math.round(this._containerWidth/2)+c.x+(b?0:a.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);f.DomUtil.setPosition(this._container,b)},_adjustPan:function(){if(this.options.autoPan){var a=this._map,b=this._container.offsetHeight,c=this._containerWidth,d=new f.Point(this._containerLeft,-b-this._containerBottom);this._animated&&d._add(f.DomUtil.getPosition(this._container));var e=a.layerPointToContainerPoint(d),g=f.point(this.options.autoPanPadding),h=f.point(this.options.autoPanPaddingTopLeft||g),i=f.point(this.options.autoPanPaddingBottomRight||g),j=a.getSize(),k=0,l=0;e.x+c+i.x>j.x&&(k=e.x+c-j.x+i.x),e.x-k-h.x<0&&(k=e.x-h.x),e.y+b+i.y>j.y&&(l=e.y+b-j.y+i.y),e.y-l-h.y<0&&(l=e.y-h.y),(k||l)&&a.fire("autopanstart").panBy([k,l])}},_onCloseButtonClick:function(a){this._close(),f.DomEvent.stop(a)}}),f.popup=function(a,b){return new f.Popup(a,b)},f.Map.include({openPopup:function(a,b,c){if(this.closePopup(),!(a instanceof f.Popup)){var d=a;a=new f.Popup(c).setLatLng(b).setContent(d)}return a._isOpen=!0,this._popup=a,this.addLayer(a)},closePopup:function(a){return a&&a!==this._popup||(a=this._popup,this._popup=null),a&&(this.removeLayer(a),a._isOpen=!1),this}}),f.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(a,b){var c=f.point(this.options.icon.options.popupAnchor||[0,0]);return c=c.add(f.Popup.prototype.options.offset),b&&b.offset&&(c=c.add(b.offset)),b=f.extend({offset:c},b),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),a instanceof f.Popup?(f.setOptions(a,b),this._popup=a):this._popup=new f.Popup(b,this).setContent(a),this},setPopupContent:function(a){return this._popup&&this._popup.setContent(a),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(a){this._popup.setLatLng(a.latlng)}}),f.LayerGroup=f.Class.extend({initialize:function(a){this._layers={};var b,c;if(a)for(b=0,c=a.length;c>b;b++)this.addLayer(a[b])},addLayer:function(a){var b=this.getLayerId(a);return this._layers[b]=a,this._map&&this._map.addLayer(a),this},removeLayer:function(a){var b=a in this._layers?a:this.getLayerId(a);return this._map&&this._layers[b]&&this._map.removeLayer(this._layers[b]),delete this._layers[b],this},hasLayer:function(a){return a?a in this._layers||this.getLayerId(a)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(a){var b,c,d=Array.prototype.slice.call(arguments,1);for(b in this._layers)c=this._layers[b],c[a]&&c[a].apply(c,d);return this},onAdd:function(a){this._map=a,this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a),this._map=null},addTo:function(a){return a.addLayer(this),this},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var a=[];for(var b in this._layers)a.push(this._layers[b]);return a},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return f.stamp(a)}}),f.layerGroup=function(a){return new f.LayerGroup(a)},f.FeatureGroup=f.LayerGroup.extend({includes:f.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){return this.hasLayer(a)?this:("on"in a&&a.on(f.FeatureGroup.EVENTS,this._propagateEvent,this),f.LayerGroup.prototype.addLayer.call(this,a),this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:a}))},removeLayer:function(a){return this.hasLayer(a)?(a in this._layers&&(a=this._layers[a]),a.off(f.FeatureGroup.EVENTS,this._propagateEvent,this),f.LayerGroup.prototype.removeLayer.call(this,a),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:a})):this},bindPopup:function(a,b){return this._popupContent=a,this._popupOptions=b,this.invoke("bindPopup",a,b)},openPopup:function(a){for(var b in this._layers){this._layers[b].openPopup(a);break}return this},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new f.LatLngBounds;return this.eachLayer(function(b){a.extend(b instanceof f.Marker?b.getLatLng():b.getBounds())}),a},_propagateEvent:function(a){a=f.extend({layer:a.target,target:this},a),this.fire(a.type,a)}}),f.featureGroup=function(a){return new f.FeatureGroup(a)},f.Path=f.Class.extend({includes:[f.Mixin.Events],statics:{CLIP_PADDING:function(){var b=f.Browser.mobile?1280:2e3,c=(b/Math.max(a.outerWidth,a.outerHeight)-1)/2;return Math.max(0,Math.min(.5,c))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(a){f.setOptions(this,a)},onAdd:function(a){this._map=a,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){a._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,f.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){return f.setOptions(this,a),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),f.Map.include({_updatePathViewport:function(){var a=f.Path.CLIP_PADDING,b=this.getSize(),c=f.DomUtil.getPosition(this._mapPane),d=c.multiplyBy(-1)._subtract(b.multiplyBy(a)._round()),e=d.add(b.multiplyBy(1+2*a)._round());this._pathViewport=new f.Bounds(d,e)}}),f.Path.SVG_NS="http://www.w3.org/2000/svg",f.Browser.svg=!(!c.createElementNS||!c.createElementNS(f.Path.SVG_NS,"svg").createSVGRect),f.Path=f.Path.extend({statics:{SVG:f.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,b=this._container;return b&&a.lastChild!==b&&a.appendChild(b),this},bringToBack:function(){var a=this._map._pathRoot,b=this._container,c=a.firstChild;return b&&c!==b&&a.insertBefore(b,c),this},getPathString:function(){},_createElement:function(a){return c.createElementNS(f.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&f.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var a=this.getPathString();a||(a="M0 0"),this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){(f.Browser.svg||!f.Browser.vml)&&f.DomUtil.addClass(this._path,"leaflet-clickable"),f.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],b=0;b<a.length;b++)f.DomEvent.on(this._container,a[b],this._fireMouseEvent,this)}},_onMouseClick:function(a){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(a)},_fireMouseEvent:function(a){if(this.hasEventListeners(a.type)){var b=this._map,c=b.mouseEventToContainerPoint(a),d=b.containerPointToLayerPoint(c),e=b.layerPointToLatLng(d);this.fire(a.type,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a}),"contextmenu"===a.type&&f.DomEvent.preventDefault(a),"mousemove"!==a.type&&f.DomEvent.stopPropagation(a)}}}),f.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=f.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&f.Browser.any3d?(f.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):f.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(a){var b=this.getZoomScale(a.zoom),c=this._getCenterOffset(a.center)._multiplyBy(-b)._add(this._pathViewport.min);this._pathRoot.style[f.DomUtil.TRANSFORM]=f.DomUtil.getTranslateString(c)+" scale("+b+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max,d=c.x-b.x,e=c.y-b.y,g=this._pathRoot,h=this._panes.overlayPane;f.Browser.mobileWebkit&&h.removeChild(g),f.DomUtil.setPosition(g,b),g.setAttribute("width",d),g.setAttribute("height",e),g.setAttribute("viewBox",[b.x,b.y,d,e].join(" ")),f.Browser.mobileWebkit&&h.appendChild(g)}}}),f.Path.include({bindPopup:function(a,b){return a instanceof f.Popup?this._popup=a:((!this._popup||b)&&(this._popup=new f.Popup(b,this)),this._popup.setContent(a)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(a){return this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(a){this._popup.setLatLng(a.latlng),this._map.openPopup(this._popup)}}),f.Browser.vml=!f.Browser.svg&&function(){try{var a=c.createElement("div");a.innerHTML='<v:shape adj="1"/>';var b=a.firstChild;return b.style.behavior="url(#default#VML)",b&&"object"==typeof b.adj}catch(d){return!1}}(),f.Path=f.Browser.svg||!f.Browser.vml?f.Path:f.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return c.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(a){return c.createElement("<lvml:"+a+' class="lvml">')}}catch(a){return function(a){return c.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var a=this._container=this._createElement("shape");f.DomUtil.addClass(a,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&f.DomUtil.addClass(a,"leaflet-clickable"),a.coordsize="1 1",this._path=this._createElement("path"),a.appendChild(this._path),this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var a=this._stroke,b=this._fill,c=this.options,d=this._container;d.stroked=c.stroke,d.filled=c.fill,c.stroke?(a||(a=this._stroke=this._createElement("stroke"),a.endcap="round",d.appendChild(a)),a.weight=c.weight+"px",a.color=c.color,a.opacity=c.opacity,c.dashArray?a.dashStyle=f.Util.isArray(c.dashArray)?c.dashArray.join(" "):c.dashArray.replace(/( *, *)/g," "):a.dashStyle="",c.lineCap&&(a.endcap=c.lineCap.replace("butt","flat")),c.lineJoin&&(a.joinstyle=c.lineJoin)):a&&(d.removeChild(a),this._stroke=null),c.fill?(b||(b=this._fill=this._createElement("fill"),d.appendChild(b)),b.color=c.fillColor||c.color,b.opacity=c.fillOpacity):b&&(d.removeChild(b),this._fill=null)},_updatePath:function(){var a=this._container.style;a.display="none",this._path.v=this.getPathString()+" ",a.display=""}}),f.Map.include(f.Browser.svg||!f.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=c.createElement("div");a.className="leaflet-vml-container",this._panes.overlayPane.appendChild(a),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),f.Browser.canvas=function(){return!!c.createElement("canvas").getContext}(),f.Path=f.Path.SVG&&!a.L_PREFER_CANVAS||!f.Browser.canvas?f.Path:f.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(a){return f.setOptions(this,a),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!f.Path._updateRequest&&(f.Path._updateRequest=f.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){f.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color),a.fill&&(this._ctx.fillStyle=a.fillColor||a.color)},_drawPath:function(){var a,b,c,d,e,g;for(this._ctx.beginPath(),a=0,c=this._parts.length;c>a;a++){for(b=0,d=this._parts[a].length;d>b;b++)e=this._parts[a][b],g=(0===b?"move":"line")+"To",this._ctx[g](e.x,e.y);this instanceof f.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,b=this.options;this._drawPath(),a.save(),this._updateStyle(),b.fill&&(a.globalAlpha=b.fillOpacity,a.fill()),b.stroke&&(a.globalAlpha=b.opacity,a.stroke()),a.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(a){this._containsPoint(a.layerPoint)&&this.fire("click",a)},_onMouseMove:function(a){this._map&&!this._map._animatingZoom&&(this._containsPoint(a.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",a)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",a)))}}),f.Map.include(f.Path.SVG&&!a.L_PREFER_CANVAS||!f.Browser.canvas?{}:{_initPathRoot:function(){var a,b=this._pathRoot;b||(b=this._pathRoot=c.createElement("canvas"),b.style.position="absolute",a=this._canvasCtx=b.getContext("2d"),a.lineCap="round",a.lineJoin="round",this._panes.overlayPane.appendChild(b),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max.subtract(b),d=this._pathRoot;f.DomUtil.setPosition(d,b),d.width=c.x,d.height=c.y,d.getContext("2d").translate(-b.x,-b.y)}}}),f.LineUtil={simplify:function(a,b){if(!b||!a.length)return a.slice();var c=b*b;return a=this._reducePoints(a,c),a=this._simplifyDP(a,c)},pointToSegmentDistance:function(a,b,c){return Math.sqrt(this._sqClosestPointOnSegment(a,b,c,!0))},closestPointOnSegment:function(a,b,c){return this._sqClosestPointOnSegment(a,b,c)},_simplifyDP:function(a,b){var c=a.length,e=typeof Uint8Array!=d+""?Uint8Array:Array,f=new e(c);f[0]=f[c-1]=1,this._simplifyDPStep(a,f,b,0,c-1);var g,h=[];for(g=0;c>g;g++)f[g]&&h.push(a[g]);return h},_simplifyDPStep:function(a,b,c,d,e){var f,g,h,i=0;for(g=d+1;e-1>=g;g++)h=this._sqClosestPointOnSegment(a[g],a[d],a[e],!0),h>i&&(f=g,i=h);i>c&&(b[f]=1,this._simplifyDPStep(a,b,c,d,f),this._simplifyDPStep(a,b,c,f,e))},_reducePoints:function(a,b){for(var c=[a[0]],d=1,e=0,f=a.length;f>d;d++)this._sqDist(a[d],a[e])>b&&(c.push(a[d]),e=d);return f-1>e&&c.push(a[f-1]),c},clipSegment:function(a,b,c,d){var e,f,g,h=d?this._lastCode:this._getBitCode(a,c),i=this._getBitCode(b,c);for(this._lastCode=i;;){if(!(h|i))return[a,b];if(h&i)return!1;e=h||i,f=this._getEdgeIntersection(a,b,e,c),g=this._getBitCode(f,c),e===h?(a=f,h=g):(b=f,i=g)}},_getEdgeIntersection:function(a,b,c,d){var e=b.x-a.x,g=b.y-a.y,h=d.min,i=d.max;return 8&c?new f.Point(a.x+e*(i.y-a.y)/g,i.y):4&c?new f.Point(a.x+e*(h.y-a.y)/g,h.y):2&c?new f.Point(i.x,a.y+g*(i.x-a.x)/e):1&c?new f.Point(h.x,a.y+g*(h.x-a.x)/e):void 0},_getBitCode:function(a,b){var c=0;return a.x<b.min.x?c|=1:a.x>b.max.x&&(c|=2),a.y<b.min.y?c|=4:a.y>b.max.y&&(c|=8),c},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},_sqClosestPointOnSegment:function(a,b,c,d){var e,g=b.x,h=b.y,i=c.x-g,j=c.y-h,k=i*i+j*j;return k>0&&(e=((a.x-g)*i+(a.y-h)*j)/k,e>1?(g=c.x,h=c.y):e>0&&(g+=i*e,h+=j*e)),i=a.x-g,j=a.y-h,d?i*i+j*j:new f.Point(g,h)}},f.Polyline=f.Path.extend({initialize:function(a,b){f.Path.prototype.initialize.call(this,b),this._latlngs=this._convertLatLngs(a)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;b>a;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getPathString:function(){for(var a=0,b=this._parts.length,c="";b>a;a++)c+=this._getPathPartStr(this._parts[a]);return c},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){return this._latlngs=this._convertLatLngs(a),this.redraw()},addLatLng:function(a){return this._latlngs.push(f.latLng(a)),this.redraw()},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),a},closestLayerPoint:function(a){for(var b,c,d=1/0,e=this._parts,g=null,h=0,i=e.length;i>h;h++)for(var j=e[h],k=1,l=j.length;l>k;k++){b=j[k-1],c=j[k];var m=f.LineUtil._sqClosestPointOnSegment(a,b,c,!0);d>m&&(d=m,g=f.LineUtil._sqClosestPointOnSegment(a,b,c))}return g&&(g.distance=Math.sqrt(d)),g},getBounds:function(){return new f.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(a,b){var c,d,e=b?a:[];for(c=0,d=a.length;d>c;c++){if(f.Util.isArray(a[c])&&"number"!=typeof a[c][0])return;e[c]=f.latLng(a[c])}return e},_initEvents:function(){f.Path.prototype._initEvents.call(this)},_getPathPartStr:function(a){for(var b,c=f.Path.VML,d=0,e=a.length,g="";e>d;d++)b=a[d],c&&b._round(),g+=(d?"L":"M")+b.x+" "+b.y;return g},_clipPoints:function(){var a,b,c,d=this._originalPoints,e=d.length;if(this.options.noClip)return void(this._parts=[d]);this._parts=[];var g=this._parts,h=this._map._pathViewport,i=f.LineUtil;for(a=0,b=0;e-1>a;a++)c=i.clipSegment(d[a],d[a+1],h,a),c&&(g[b]=g[b]||[],g[b].push(c[0]),(c[1]!==d[a+1]||a===e-2)&&(g[b].push(c[1]),b++))},_simplifyPoints:function(){for(var a=this._parts,b=f.LineUtil,c=0,d=a.length;d>c;c++)a[c]=b.simplify(a[c],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),f.Path.prototype._updatePath.call(this))}}),f.polyline=function(a,b){return new f.Polyline(a,b)},f.PolyUtil={},f.PolyUtil.clipPolygon=function(a,b){var c,d,e,g,h,i,j,k,l,m=[1,4,2,8],n=f.LineUtil;for(d=0,j=a.length;j>d;d++)a[d]._code=n._getBitCode(a[d],b);for(g=0;4>g;g++){for(k=m[g],c=[],d=0,j=a.length,e=j-1;j>d;e=d++)h=a[d],i=a[e],h._code&k?i._code&k||(l=n._getEdgeIntersection(i,h,k,b),l._code=n._getBitCode(l,b),c.push(l)):(i._code&k&&(l=n._getEdgeIntersection(i,h,k,b),l._code=n._getBitCode(l,b),c.push(l)),c.push(h));a=c}return a},f.Polygon=f.Polyline.extend({options:{fill:!0},initialize:function(a,b){f.Polyline.prototype.initialize.call(this,a,b),this._initWithHoles(a)},_initWithHoles:function(a){var b,c,d;if(a&&f.Util.isArray(a[0])&&"number"!=typeof a[0][0])for(this._latlngs=this._convertLatLngs(a[0]),this._holes=a.slice(1),b=0,c=this._holes.length;c>b;b++)d=this._holes[b]=this._convertLatLngs(this._holes[b]),d[0].equals(d[d.length-1])&&d.pop();a=this._latlngs,a.length>=2&&a[0].equals(a[a.length-1])&&a.pop()},projectLatlngs:function(){if(f.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var a,b,c,d;for(a=0,c=this._holes.length;c>a;a++)for(this._holePoints[a]=[],b=0,d=this._holes[a].length;d>b;b++)this._holePoints[a][b]=this._map.latLngToLayerPoint(this._holes[a][b])}},setLatLngs:function(a){return a&&f.Util.isArray(a[0])&&"number"!=typeof a[0][0]?(this._initWithHoles(a),this.redraw()):f.Polyline.prototype.setLatLngs.call(this,a)},_clipPoints:function(){var a=this._originalPoints,b=[];if(this._parts=[a].concat(this._holePoints),!this.options.noClip){for(var c=0,d=this._parts.length;d>c;c++){var e=f.PolyUtil.clipPolygon(this._parts[c],this._map._pathViewport);e.length&&b.push(e)}this._parts=b}},_getPathPartStr:function(a){var b=f.Polyline.prototype._getPathPartStr.call(this,a);return b+(f.Browser.svg?"z":"x")}}),f.polygon=function(a,b){return new f.Polygon(a,b)},function(){function a(a){return f.FeatureGroup.extend({initialize:function(a,b){this._layers={},this._options=b,this.setLatLngs(a)},setLatLngs:function(b){var c=0,d=b.length;for(this.eachLayer(function(a){d>c?a.setLatLngs(b[c++]):this.removeLayer(a)},this);d>c;)this.addLayer(new a(b[c++],this._options));return this},getLatLngs:function(){var a=[];return this.eachLayer(function(b){a.push(b.getLatLngs())}),a}})}f.MultiPolyline=a(f.Polyline),f.MultiPolygon=a(f.Polygon),f.multiPolyline=function(a,b){return new f.MultiPolyline(a,b)},f.multiPolygon=function(a,b){return new f.MultiPolygon(a,b)}}(),f.Rectangle=f.Polygon.extend({initialize:function(a,b){f.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),b)},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){return a=f.latLngBounds(a),[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]}}),f.rectangle=function(a,b){return new f.Rectangle(a,b)},f.Circle=f.Path.extend({initialize:function(a,b,c){f.Path.prototype.initialize.call(this,c),this._latlng=f.latLng(a),this._mRadius=b},options:{fill:!0},setLatLng:function(a){return this._latlng=f.latLng(a),this.redraw()},setRadius:function(a){return this._mRadius=a,this.redraw()},projectLatlngs:function(){var a=this._getLngRadius(),b=this._latlng,c=this._map.latLngToLayerPoint([b.lat,b.lng-a]);this._point=this._map.latLngToLayerPoint(b),this._radius=Math.max(this._point.x-c.x,1)},getBounds:function(){var a=this._getLngRadius(),b=this._mRadius/40075017*360,c=this._latlng;return new f.LatLngBounds([c.lat-b,c.lng-a],[c.lat+b,c.lng+a])},getLatLng:function(){return this._latlng},getPathString:function(){var a=this._point,b=this._radius;return this._checkIfEmpty()?"":f.Browser.svg?"M"+a.x+","+(a.y-b)+"A"+b+","+b+",0,1,1,"+(a.x-.1)+","+(a.y-b)+" z":(a._round(),b=Math.round(b),"AL "+a.x+","+a.y+" "+b+","+b+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(f.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var a=this._map._pathViewport,b=this._radius,c=this._point;return c.x-b>a.max.x||c.y-b>a.max.y||c.x+b<a.min.x||c.y+b<a.min.y}}),f.circle=function(a,b,c){return new f.Circle(a,b,c)},f.CircleMarker=f.Circle.extend({options:{radius:10,weight:2},initialize:function(a,b){f.Circle.prototype.initialize.call(this,a,null,b),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){f.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(a){return f.Circle.prototype.setLatLng.call(this,a),this._popup&&this._popup._isOpen&&this._popup.setLatLng(a),this},setRadius:function(a){return this.options.radius=this._radius=a,this.redraw()},getRadius:function(){return this._radius}}),f.circleMarker=function(a,b){return new f.CircleMarker(a,b)},f.Polyline.include(f.Path.CANVAS?{_containsPoint:function(a,b){var c,d,e,g,h,i,j,k=this.options.weight/2;for(f.Browser.touch&&(k+=10),c=0,g=this._parts.length;g>c;c++)for(j=this._parts[c],d=0,h=j.length,e=h-1;h>d;e=d++)if((b||0!==d)&&(i=f.LineUtil.pointToSegmentDistance(a,j[e],j[d]),k>=i))return!0;return!1}}:{}),f.Polygon.include(f.Path.CANVAS?{_containsPoint:function(a){var b,c,d,e,g,h,i,j,k=!1;if(f.Polyline.prototype._containsPoint.call(this,a,!0))return!0;for(e=0,i=this._parts.length;i>e;e++)for(b=this._parts[e],g=0,j=b.length,h=j-1;j>g;h=g++)c=b[g],d=b[h],c.y>a.y!=d.y>a.y&&a.x<(d.x-c.x)*(a.y-c.y)/(d.y-c.y)+c.x&&(k=!k);return k}}:{}),f.Circle.include(f.Path.CANVAS?{_drawPath:function(){var a=this._point;this._ctx.beginPath(),this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(a){var b=this._point,c=this.options.stroke?this.options.weight/2:0;return a.distanceTo(b)<=this._radius+c}}:{}),f.CircleMarker.include(f.Path.CANVAS?{_updateStyle:function(){f.Path.prototype._updateStyle.call(this)}}:{}),f.GeoJSON=f.FeatureGroup.extend({initialize:function(a,b){f.setOptions(this,b),this._layers={},a&&this.addData(a)},addData:function(a){var b,c,d,e=f.Util.isArray(a)?a:a.features;if(e){for(b=0,c=e.length;c>b;b++)d=e[b],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(e[b]);return this}var g=this.options;if(!g.filter||g.filter(a)){var h=f.GeoJSON.geometryToLayer(a,g.pointToLayer,g.coordsToLatLng,g);return h.feature=f.GeoJSON.asFeature(a),h.defaultOptions=h.options,this.resetStyle(h),g.onEachFeature&&g.onEachFeature(a,h),this.addLayer(h)}},resetStyle:function(a){var b=this.options.style;b&&(f.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,b))},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"==typeof b&&(b=b(a.feature)),a.setStyle&&a.setStyle(b)}}),f.extend(f.GeoJSON,{geometryToLayer:function(a,b,c,d){var e,g,h,i,j="Feature"===a.type?a.geometry:a,k=j.coordinates,l=[];switch(c=c||this.coordsToLatLng,j.type){case"Point":return e=c(k),b?b(a,e):new f.Marker(e);case"MultiPoint":for(h=0,i=k.length;i>h;h++)e=c(k[h]),l.push(b?b(a,e):new f.Marker(e));return new f.FeatureGroup(l);case"LineString":return g=this.coordsToLatLngs(k,0,c),new f.Polyline(g,d);case"Polygon":if(2===k.length&&!k[1].length)throw new Error("Invalid GeoJSON object.");return g=this.coordsToLatLngs(k,1,c),new f.Polygon(g,d);case"MultiLineString":return g=this.coordsToLatLngs(k,1,c),new f.MultiPolyline(g,d);case"MultiPolygon":return g=this.coordsToLatLngs(k,2,c),new f.MultiPolygon(g,d);case"GeometryCollection":for(h=0,i=j.geometries.length;i>h;h++)l.push(this.geometryToLayer({geometry:j.geometries[h],type:"Feature",properties:a.properties},b,c,d));return new f.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new f.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(a,b,c){var d,e,f,g=[];for(e=0,f=a.length;f>e;e++)d=b?this.coordsToLatLngs(a[e],b-1,c):(c||this.coordsToLatLng)(a[e]),
g.push(d);return g},latLngToCoords:function(a){var b=[a.lng,a.lat];return a.alt!==d&&b.push(a.alt),b},latLngsToCoords:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(f.GeoJSON.latLngToCoords(a[c]));return b},getFeature:function(a,b){return a.feature?f.extend({},a.feature,{geometry:b}):f.GeoJSON.asFeature(b)},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a}}});var h={toGeoJSON:function(){return f.GeoJSON.getFeature(this,{type:"Point",coordinates:f.GeoJSON.latLngToCoords(this.getLatLng())})}};f.Marker.include(h),f.Circle.include(h),f.CircleMarker.include(h),f.Polyline.include({toGeoJSON:function(){return f.GeoJSON.getFeature(this,{type:"LineString",coordinates:f.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),f.Polygon.include({toGeoJSON:function(){var a,b,c,d=[f.GeoJSON.latLngsToCoords(this.getLatLngs())];if(d[0].push(d[0][0]),this._holes)for(a=0,b=this._holes.length;b>a;a++)c=f.GeoJSON.latLngsToCoords(this._holes[a]),c.push(c[0]),d.push(c);return f.GeoJSON.getFeature(this,{type:"Polygon",coordinates:d})}}),function(){function a(a){return function(){var b=[];return this.eachLayer(function(a){b.push(a.toGeoJSON().geometry.coordinates)}),f.GeoJSON.getFeature(this,{type:a,coordinates:b})}}f.MultiPolyline.include({toGeoJSON:a("MultiLineString")}),f.MultiPolygon.include({toGeoJSON:a("MultiPolygon")}),f.LayerGroup.include({toGeoJSON:function(){var b,c=this.feature&&this.feature.geometry,d=[];if(c&&"MultiPoint"===c.type)return a("MultiPoint").call(this);var e=c&&"GeometryCollection"===c.type;return this.eachLayer(function(a){a.toGeoJSON&&(b=a.toGeoJSON(),d.push(e?b.geometry:f.GeoJSON.asFeature(b)))}),e?f.GeoJSON.getFeature(this,{geometries:d,type:"GeometryCollection"}):{type:"FeatureCollection",features:d}}})}(),f.geoJson=function(a,b){return new f.GeoJSON(a,b)},f.DomEvent={addListener:function(a,b,c,d){var e,g,h,i=f.stamp(c),j="_leaflet_"+b+i;return a[j]?this:(e=function(b){return c.call(d||a,b||f.DomEvent._getEvent())},f.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,e,i):(f.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,e,i),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",e,!1),a.addEventListener(b,e,!1)):"mouseenter"===b||"mouseleave"===b?(g=e,h="mouseenter"===b?"mouseover":"mouseout",e=function(b){return f.DomEvent._checkMouse(a,b)?g(b):void 0},a.addEventListener(h,e,!1)):"click"===b&&f.Browser.android?(g=e,e=function(a){return f.DomEvent._filterClick(a,g)},a.addEventListener(b,e,!1)):a.addEventListener(b,e,!1):"attachEvent"in a&&a.attachEvent("on"+b,e),a[j]=e,this))},removeListener:function(a,b,c){var d=f.stamp(c),e="_leaflet_"+b+d,g=a[e];return g?(f.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,d):f.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,d):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",g,!1),a.removeEventListener(b,g,!1)):"mouseenter"===b||"mouseleave"===b?a.removeEventListener("mouseenter"===b?"mouseover":"mouseout",g,!1):a.removeEventListener(b,g,!1):"detachEvent"in a&&a.detachEvent("on"+b,g),a[e]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,f.DomEvent._skipped(a),this},disableScrollPropagation:function(a){var b=f.DomEvent.stopPropagation;return f.DomEvent.on(a,"mousewheel",b).on(a,"MozMousePixelScroll",b)},disableClickPropagation:function(a){for(var b=f.DomEvent.stopPropagation,c=f.Draggable.START.length-1;c>=0;c--)f.DomEvent.on(a,f.Draggable.START[c],b);return f.DomEvent.on(a,"click",f.DomEvent._fakeStop).on(a,"dblclick",b)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return f.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(a,b){if(!b)return new f.Point(a.clientX,a.clientY);var c=b.getBoundingClientRect();return new f.Point(a.clientX-c.left-b.clientLeft,a.clientY-c.top-b.clientTop)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){f.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_getEvent:function(){var b=a.event;if(!b)for(var c=arguments.callee.caller;c&&(b=c.arguments[0],!b||a.Event!==b.constructor);)c=c.caller;return b},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=f.DomEvent._lastClick&&c-f.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void f.DomEvent.stop(a):(f.DomEvent._lastClick=c,b(a))}},f.DomEvent.on=f.DomEvent.addListener,f.DomEvent.off=f.DomEvent.removeListener,f.Draggable=f.Class.extend({includes:f.Mixin.Events,statics:{START:f.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,b){this._element=a,this._dragStartTarget=b||a},enable:function(){if(!this._enabled){for(var a=f.Draggable.START.length-1;a>=0;a--)f.DomEvent.on(this._dragStartTarget,f.Draggable.START[a],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var a=f.Draggable.START.length-1;a>=0;a--)f.DomEvent.off(this._dragStartTarget,f.Draggable.START[a],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(a){if(this._moved=!1,!a.shiftKey&&(1===a.which||1===a.button||a.touches)&&(f.DomEvent.stopPropagation(a),!f.Draggable._disabled&&(f.DomUtil.disableImageDrag(),f.DomUtil.disableTextSelection(),!this._moving))){var b=a.touches?a.touches[0]:a;this._startPoint=new f.Point(b.clientX,b.clientY),this._startPos=this._newPos=f.DomUtil.getPosition(this._element),f.DomEvent.on(c,f.Draggable.MOVE[a.type],this._onMove,this).on(c,f.Draggable.END[a.type],this._onUp,this)}},_onMove:function(a){if(a.touches&&a.touches.length>1)return void(this._moved=!0);var b=a.touches&&1===a.touches.length?a.touches[0]:a,d=new f.Point(b.clientX,b.clientY),e=d.subtract(this._startPoint);(e.x||e.y)&&(f.Browser.touch&&Math.abs(e.x)+Math.abs(e.y)<3||(f.DomEvent.preventDefault(a),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=f.DomUtil.getPosition(this._element).subtract(e),f.DomUtil.addClass(c.body,"leaflet-dragging"),this._lastTarget=a.target||a.srcElement,f.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(e),this._moving=!0,f.Util.cancelAnimFrame(this._animRequest),this._animRequest=f.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),f.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){f.DomUtil.removeClass(c.body,"leaflet-dragging"),this._lastTarget&&(f.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var a in f.Draggable.MOVE)f.DomEvent.off(c,f.Draggable.MOVE[a],this._onMove).off(c,f.Draggable.END[a],this._onUp);f.DomUtil.enableImageDrag(),f.DomUtil.enableTextSelection(),this._moved&&this._moving&&(f.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),f.Handler=f.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),f.Map.mergeOptions({dragging:!0,inertia:!f.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:f.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),f.Map.Drag=f.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new f.Draggable(a._mapPane,a._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this),a.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop(),a.fire("movestart").fire("dragstart"),a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,b=this._lastPos=this._draggable._newPos;this._positions.push(b),this._times.push(a),a-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var a=this._map.getSize()._divideBy(2),b=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=b.subtract(a).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var a=this._worldWidth,b=Math.round(a/2),c=this._initialWorldOffset,d=this._draggable._newPos.x,e=(d-b+c)%a+b-c,f=(d+b+c)%a-b-c,g=Math.abs(e+c)<Math.abs(f+c)?e:f;this._draggable._newPos.x=g},_onDragEnd:function(a){var b=this._map,c=b.options,d=+new Date-this._lastTime,e=!c.inertia||d>c.inertiaThreshold||!this._positions[0];if(b.fire("dragend",a),e)b.fire("moveend");else{var g=this._lastPos.subtract(this._positions[0]),h=(this._lastTime+d-this._times[0])/1e3,i=c.easeLinearity,j=g.multiplyBy(i/h),k=j.distanceTo([0,0]),l=Math.min(c.inertiaMaxSpeed,k),m=j.multiplyBy(l/k),n=l/(c.inertiaDeceleration*i),o=m.multiplyBy(-n/2).round();o.x&&o.y?(o=b._limitOffset(o,b.options.maxBounds),f.Util.requestAnimFrame(function(){b.panBy(o,{duration:n,easeLinearity:i,noMoveStart:!0})})):b.fire("moveend")}}}),f.Map.addInitHook("addHandler","dragging",f.Map.Drag),f.Map.mergeOptions({doubleClickZoom:!0}),f.Map.DoubleClickZoom=f.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(a){var b=this._map,c=b.getZoom()+(a.originalEvent.shiftKey?-1:1);"center"===b.options.doubleClickZoom?b.setZoom(c):b.setZoomAround(a.containerPoint,c)}}),f.Map.addInitHook("addHandler","doubleClickZoom",f.Map.DoubleClickZoom),f.Map.mergeOptions({scrollWheelZoom:!0}),f.Map.ScrollWheelZoom=f.Handler.extend({addHooks:function(){f.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),f.DomEvent.on(this._map._container,"MozMousePixelScroll",f.DomEvent.preventDefault),this._delta=0},removeHooks:function(){f.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),f.DomEvent.off(this._map._container,"MozMousePixelScroll",f.DomEvent.preventDefault)},_onWheelScroll:function(a){var b=f.DomEvent.getWheelDelta(a);this._delta+=b,this._lastMousePos=this._map.mouseEventToContainerPoint(a),this._startTime||(this._startTime=+new Date);var c=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(f.bind(this._performZoom,this),c),f.DomEvent.preventDefault(a),f.DomEvent.stopPropagation(a)},_performZoom:function(){var a=this._map,b=this._delta,c=a.getZoom();b=b>0?Math.ceil(b):Math.floor(b),b=Math.max(Math.min(b,4),-4),b=a._limitZoom(c+b)-c,this._delta=0,this._startTime=null,b&&("center"===a.options.scrollWheelZoom?a.setZoom(c+b):a.setZoomAround(this._lastMousePos,c+b))}}),f.Map.addInitHook("addHandler","scrollWheelZoom",f.Map.ScrollWheelZoom),f.extend(f.DomEvent,{_touchstart:f.Browser.msPointer?"MSPointerDown":f.Browser.pointer?"pointerdown":"touchstart",_touchend:f.Browser.msPointer?"MSPointerUp":f.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(a,b,d){function e(a){var b;if(f.Browser.pointer?(o.push(a.pointerId),b=o.length):b=a.touches.length,!(b>1)){var c=Date.now(),d=c-(h||c);i=a.touches?a.touches[0]:a,j=d>0&&k>=d,h=c}}function g(a){if(f.Browser.pointer){var c=o.indexOf(a.pointerId);if(-1===c)return;o.splice(c,1)}if(j){if(f.Browser.pointer){var d,e={};for(var g in i)d=i[g],"function"==typeof d?e[g]=d.bind(i):e[g]=d;i=e}i.type="dblclick",b(i),h=null}}var h,i,j=!1,k=250,l="_leaflet_",m=this._touchstart,n=this._touchend,o=[];a[l+m+d]=e,a[l+n+d]=g;var p=f.Browser.pointer?c.documentElement:a;return a.addEventListener(m,e,!1),p.addEventListener(n,g,!1),f.Browser.pointer&&p.addEventListener(f.DomEvent.POINTER_CANCEL,g,!1),this},removeDoubleTapListener:function(a,b){var d="_leaflet_";return a.removeEventListener(this._touchstart,a[d+this._touchstart+b],!1),(f.Browser.pointer?c.documentElement:a).removeEventListener(this._touchend,a[d+this._touchend+b],!1),f.Browser.pointer&&c.documentElement.removeEventListener(f.DomEvent.POINTER_CANCEL,a[d+this._touchend+b],!1),this}}),f.extend(f.DomEvent,{POINTER_DOWN:f.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:f.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:f.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:f.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(a,b,c,d){switch(b){case"touchstart":return this.addPointerListenerStart(a,b,c,d);case"touchend":return this.addPointerListenerEnd(a,b,c,d);case"touchmove":return this.addPointerListenerMove(a,b,c,d);default:throw"Unknown touch event type"}},addPointerListenerStart:function(a,b,d,e){var g="_leaflet_",h=this._pointers,i=function(a){f.DomEvent.preventDefault(a);for(var b=!1,c=0;c<h.length;c++)if(h[c].pointerId===a.pointerId){b=!0;break}b||h.push(a),a.touches=h.slice(),a.changedTouches=[a],d(a)};if(a[g+"touchstart"+e]=i,a.addEventListener(this.POINTER_DOWN,i,!1),!this._pointerDocumentListener){var j=function(a){for(var b=0;b<h.length;b++)if(h[b].pointerId===a.pointerId){h.splice(b,1);break}};c.documentElement.addEventListener(this.POINTER_UP,j,!1),c.documentElement.addEventListener(this.POINTER_CANCEL,j,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(a,b,c,d){function e(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var b=0;b<g.length;b++)if(g[b].pointerId===a.pointerId){g[b]=a;break}a.touches=g.slice(),a.changedTouches=[a],c(a)}}var f="_leaflet_",g=this._pointers;return a[f+"touchmove"+d]=e,a.addEventListener(this.POINTER_MOVE,e,!1),this},addPointerListenerEnd:function(a,b,c,d){var e="_leaflet_",f=this._pointers,g=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}a.touches=f.slice(),a.changedTouches=[a],c(a)};return a[e+"touchend"+d]=g,a.addEventListener(this.POINTER_UP,g,!1),a.addEventListener(this.POINTER_CANCEL,g,!1),this},removePointerListener:function(a,b,c){var d="_leaflet_",e=a[d+b+c];switch(b){case"touchstart":a.removeEventListener(this.POINTER_DOWN,e,!1);break;case"touchmove":a.removeEventListener(this.POINTER_MOVE,e,!1);break;case"touchend":a.removeEventListener(this.POINTER_UP,e,!1),a.removeEventListener(this.POINTER_CANCEL,e,!1)}return this}}),f.Map.mergeOptions({touchZoom:f.Browser.touch&&!f.Browser.android23,bounceAtZoomLimits:!0}),f.Map.TouchZoom=f.Handler.extend({addHooks:function(){f.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){f.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&!b._animatingZoom&&!this._zooming){var d=b.mouseEventToLayerPoint(a.touches[0]),e=b.mouseEventToLayerPoint(a.touches[1]),g=b._getCenterLayerPoint();this._startCenter=d.add(e)._divideBy(2),this._startDist=d.distanceTo(e),this._moved=!1,this._zooming=!0,this._centerOffset=g.subtract(this._startCenter),b._panAnim&&b._panAnim.stop(),f.DomEvent.on(c,"touchmove",this._onTouchMove,this).on(c,"touchend",this._onTouchEnd,this),f.DomEvent.preventDefault(a)}},_onTouchMove:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&this._zooming){var c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]);this._scale=c.distanceTo(d)/this._startDist,this._delta=c._add(d)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(b.options.bounceAtZoomLimits||!(b.getZoom()===b.getMinZoom()&&this._scale<1||b.getZoom()===b.getMaxZoom()&&this._scale>1))&&(this._moved||(f.DomUtil.addClass(b._mapPane,"leaflet-touching"),b.fire("movestart").fire("zoomstart"),this._moved=!0),f.Util.cancelAnimFrame(this._animRequest),this._animRequest=f.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),f.DomEvent.preventDefault(a))}},_updateOnMove:function(){var a=this._map,b=this._getScaleOrigin(),c=a.layerPointToLatLng(b),d=a.getScaleZoom(this._scale);a._animateZoom(c,d,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var a=this._map;this._zooming=!1,f.DomUtil.removeClass(a._mapPane,"leaflet-touching"),f.Util.cancelAnimFrame(this._animRequest),f.DomEvent.off(c,"touchmove",this._onTouchMove).off(c,"touchend",this._onTouchEnd);var b=this._getScaleOrigin(),d=a.layerPointToLatLng(b),e=a.getZoom(),g=a.getScaleZoom(this._scale)-e,h=g>0?Math.ceil(g):Math.floor(g),i=a._limitZoom(e+h),j=a.getZoomScale(i)/this._scale;a._animateZoom(d,i,b,j)},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}}),f.Map.addInitHook("addHandler","touchZoom",f.Map.TouchZoom),f.Map.mergeOptions({tap:!0,tapTolerance:15}),f.Map.Tap=f.Handler.extend({addHooks:function(){f.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){f.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(a){if(a.touches){if(f.DomEvent.preventDefault(a),this._fireClick=!0,a.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var b=a.touches[0],d=b.target;this._startPos=this._newPos=new f.Point(b.clientX,b.clientY),d.tagName&&"a"===d.tagName.toLowerCase()&&f.DomUtil.addClass(d,"leaflet-active"),this._holdTimeout=setTimeout(f.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",b))},this),1e3),f.DomEvent.on(c,"touchmove",this._onMove,this).on(c,"touchend",this._onUp,this)}},_onUp:function(a){if(clearTimeout(this._holdTimeout),f.DomEvent.off(c,"touchmove",this._onMove,this).off(c,"touchend",this._onUp,this),this._fireClick&&a&&a.changedTouches){var b=a.changedTouches[0],d=b.target;d&&d.tagName&&"a"===d.tagName.toLowerCase()&&f.DomUtil.removeClass(d,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",b)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){var b=a.touches[0];this._newPos=new f.Point(b.clientX,b.clientY)},_simulateEvent:function(b,d){var e=c.createEvent("MouseEvents");e._simulated=!0,d.target._simulatedClick=!0,e.initMouseEvent(b,!0,!0,a,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(e)}}),f.Browser.touch&&!f.Browser.pointer&&f.Map.addInitHook("addHandler","tap",f.Map.Tap),f.Map.mergeOptions({boxZoom:!0}),f.Map.BoxZoom=f.Handler.extend({initialize:function(a){this._map=a,this._container=a._container,this._pane=a._panes.overlayPane,this._moved=!1},addHooks:function(){f.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){f.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(a){return this._moved=!1,!a.shiftKey||1!==a.which&&1!==a.button?!1:(f.DomUtil.disableTextSelection(),f.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(a),void f.DomEvent.on(c,"mousemove",this._onMouseMove,this).on(c,"mouseup",this._onMouseUp,this).on(c,"keydown",this._onKeyDown,this))},_onMouseMove:function(a){this._moved||(this._box=f.DomUtil.create("div","leaflet-zoom-box",this._pane),f.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var b=this._startLayerPoint,c=this._box,d=this._map.mouseEventToLayerPoint(a),e=d.subtract(b),g=new f.Point(Math.min(d.x,b.x),Math.min(d.y,b.y));f.DomUtil.setPosition(c,g),this._moved=!0,c.style.width=Math.max(0,Math.abs(e.x)-4)+"px",c.style.height=Math.max(0,Math.abs(e.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),f.DomUtil.enableTextSelection(),f.DomUtil.enableImageDrag(),f.DomEvent.off(c,"mousemove",this._onMouseMove).off(c,"mouseup",this._onMouseUp).off(c,"keydown",this._onKeyDown)},_onMouseUp:function(a){this._finish();var b=this._map,c=b.mouseEventToLayerPoint(a);if(!this._startLayerPoint.equals(c)){var d=new f.LatLngBounds(b.layerPointToLatLng(this._startLayerPoint),b.layerPointToLatLng(c));b.fitBounds(d),b.fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(a){27===a.keyCode&&this._finish()}}),f.Map.addInitHook("addHandler","boxZoom",f.Map.BoxZoom),f.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),f.Map.Keyboard=f.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a,this._setPanOffset(a.options.keyboardPanOffset),this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0"),f.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;f.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var b=c.body,d=c.documentElement,e=b.scrollTop||d.scrollTop,f=b.scrollLeft||d.scrollLeft;this._map._container.focus(),a.scrollTo(f,e)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(a){var b,c,d=this._panKeys={},e=this.keyCodes;for(b=0,c=e.left.length;c>b;b++)d[e.left[b]]=[-1*a,0];for(b=0,c=e.right.length;c>b;b++)d[e.right[b]]=[a,0];for(b=0,c=e.down.length;c>b;b++)d[e.down[b]]=[0,a];for(b=0,c=e.up.length;c>b;b++)d[e.up[b]]=[0,-1*a]},_setZoomOffset:function(a){var b,c,d=this._zoomKeys={},e=this.keyCodes;for(b=0,c=e.zoomIn.length;c>b;b++)d[e.zoomIn[b]]=a;for(b=0,c=e.zoomOut.length;c>b;b++)d[e.zoomOut[b]]=-a},_addHooks:function(){f.DomEvent.on(c,"keydown",this._onKeyDown,this)},_removeHooks:function(){f.DomEvent.off(c,"keydown",this._onKeyDown,this)},_onKeyDown:function(a){var b=a.keyCode,c=this._map;if(b in this._panKeys){if(c._panAnim&&c._panAnim._inProgress)return;c.panBy(this._panKeys[b]),c.options.maxBounds&&c.panInsideBounds(c.options.maxBounds)}else{if(!(b in this._zoomKeys))return;c.setZoom(c.getZoom()+this._zoomKeys[b])}f.DomEvent.stop(a)}}),f.Map.addInitHook("addHandler","keyboard",f.Map.Keyboard),f.Handler.MarkerDrag=f.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new f.Draggable(a,a)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),f.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),f.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var a=this._marker,b=a._shadow,c=f.DomUtil.getPosition(a._icon),d=a._map.layerPointToLatLng(c);b&&f.DomUtil.setPosition(b,c),a._latlng=d,a.fire("move",{latlng:d}).fire("drag")},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}}),f.Control=f.Class.extend({options:{position:"topright"},initialize:function(a){f.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;return b&&b.removeControl(this),this.options.position=a,b&&b.addControl(this),this},getContainer:function(){return this._container},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),d=a._controlCorners[c];return f.DomUtil.addClass(b,"leaflet-control"),-1!==c.indexOf("bottom")?d.insertBefore(b,d.firstChild):d.appendChild(b),this},removeFrom:function(a){var b=this.getPosition(),c=a._controlCorners[b];return c.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(a),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),f.control=function(a){return new f.Control(a)},f.Map.include({addControl:function(a){return a.addTo(this),this},removeControl:function(a){return a.removeFrom(this),this},_initControlPos:function(){function a(a,e){var g=c+a+" "+c+e;b[a+e]=f.DomUtil.create("div",g,d)}var b=this._controlCorners={},c="leaflet-",d=this._controlContainer=f.DomUtil.create("div",c+"control-container",this._container);a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),f.Control.Zoom=f.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(a){var b="leaflet-control-zoom",c=f.DomUtil.create("div",b+" leaflet-bar");return this._map=a,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,b+"-in",c,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,b+"-out",c,this._zoomOut,this),this._updateDisabled(),a.on("zoomend zoomlevelschange",this._updateDisabled,this),c},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_createButton:function(a,b,c,d,e,g){var h=f.DomUtil.create("a",c,d);h.innerHTML=a,h.href="#",h.title=b;var i=f.DomEvent.stopPropagation;return f.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",f.DomEvent.preventDefault).on(h,"click",e,g).on(h,"click",this._refocusOnMap,g),h},_updateDisabled:function(){var a=this._map,b="leaflet-disabled";f.DomUtil.removeClass(this._zoomInButton,b),f.DomUtil.removeClass(this._zoomOutButton,b),a._zoom===a.getMinZoom()&&f.DomUtil.addClass(this._zoomOutButton,b),a._zoom===a.getMaxZoom()&&f.DomUtil.addClass(this._zoomInButton,b)}}),f.Map.mergeOptions({zoomControl:!0}),f.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new f.Control.Zoom,this.addControl(this.zoomControl))}),f.control.zoom=function(a){return new f.Control.Zoom(a)},f.Control.Attribution=f.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(a){f.setOptions(this,a),this._attributions={}},onAdd:function(a){this._container=f.DomUtil.create("div","leaflet-control-attribution"),f.DomEvent.disableClickPropagation(this._container);for(var b in a._layers)a._layers[b].getAttribution&&this.addAttribution(a._layers[b].getAttribution());return a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(a){return this.options.prefix=a,this._update(),this},addAttribution:function(a){return a?(this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this):void 0},removeAttribution:function(a){return a?(this._attributions[a]&&(this._attributions[a]--,this._update()),this):void 0},_update:function(){if(this._map){var a=[];for(var b in this._attributions)this._attributions[b]&&a.push(b);var c=[];this.options.prefix&&c.push(this.options.prefix),a.length&&c.push(a.join(", ")),this._container.innerHTML=c.join(" | ")}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution())},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution())}}),f.Map.mergeOptions({attributionControl:!0}),f.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new f.Control.Attribution).addTo(this))}),f.control.attribution=function(a){return new f.Control.Attribution(a)},f.Control.Scale=f.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(a){this._map=a;var b="leaflet-control-scale",c=f.DomUtil.create("div",b),d=this.options;return this._addScales(d,b,c),a.on(d.updateWhenIdle?"moveend":"move",this._update,this),a.whenReady(this._update,this),c},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(a,b,c){a.metric&&(this._mScale=f.DomUtil.create("div",b+"-line",c)),a.imperial&&(this._iScale=f.DomUtil.create("div",b+"-line",c))},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,c=6378137*Math.PI*Math.cos(b*Math.PI/180),d=c*(a.getNorthEast().lng-a.getSouthWest().lng)/180,e=this._map.getSize(),f=this.options,g=0;e.x>0&&(g=d*(f.maxWidth/e.x)),this._updateScales(f,g)},_updateScales:function(a,b){a.metric&&b&&this._updateMetric(b),a.imperial&&b&&this._updateImperial(b)},_updateMetric:function(a){var b=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(b/a)+"px",this._mScale.innerHTML=1e3>b?b+" m":b/1e3+" km"},_updateImperial:function(a){var b,c,d,e=3.2808399*a,f=this._iScale;e>5280?(b=e/5280,c=this._getRoundNum(b),f.style.width=this._getScaleWidth(c/b)+"px",f.innerHTML=c+" mi"):(d=this._getRoundNum(e),f.style.width=this._getScaleWidth(d/e)+"px",f.innerHTML=d+" ft")},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(a){var b=Math.pow(10,(Math.floor(a)+"").length-1),c=a/b;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,b*c}}),f.control.scale=function(a){return new f.Control.Scale(a)},f.Control.Layers=f.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(a,b,c){f.setOptions(this,c),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var d in a)this._addLayer(a[d],d);for(d in b)this._addLayer(b[d],d,!0)},onAdd:function(a){return this._initLayout(),this._update(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(a,b){return this._addLayer(a,b),this._update(),this},addOverlay:function(a,b){return this._addLayer(a,b,!0),this._update(),this},removeLayer:function(a){var b=f.stamp(a);return delete this._layers[b],this._update(),this},_initLayout:function(){var a="leaflet-control-layers",b=this._container=f.DomUtil.create("div",a);b.setAttribute("aria-haspopup",!0),f.Browser.touch?f.DomEvent.on(b,"click",f.DomEvent.stopPropagation):f.DomEvent.disableClickPropagation(b).disableScrollPropagation(b);var c=this._form=f.DomUtil.create("form",a+"-list");if(this.options.collapsed){f.Browser.android||f.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var d=this._layersLink=f.DomUtil.create("a",a+"-toggle",b);d.href="#",d.title="Layers",f.Browser.touch?f.DomEvent.on(d,"click",f.DomEvent.stop).on(d,"click",this._expand,this):f.DomEvent.on(d,"focus",this._expand,this),
f.DomEvent.on(c,"click",function(){setTimeout(f.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=f.DomUtil.create("div",a+"-base",c),this._separator=f.DomUtil.create("div",a+"-separator",c),this._overlaysList=f.DomUtil.create("div",a+"-overlays",c),b.appendChild(c)},_addLayer:function(a,b,c){var d=f.stamp(a);this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var a,b,c=!1,d=!1;for(a in this._layers)b=this._layers[a],this._addItem(b),d=d||b.overlay,c=c||!b.overlay;this._separator.style.display=d&&c?"":"none"}},_onLayerChange:function(a){var b=this._layers[f.stamp(a.layer)];if(b){this._handlingClick||this._update();var c=b.overlay?"layeradd"===a.type?"overlayadd":"overlayremove":"layeradd"===a.type?"baselayerchange":null;c&&this._map.fire(c,b)}},_createRadioElement:function(a,b){var d='<input type="radio" class="leaflet-control-layers-selector" name="'+a+'"';b&&(d+=' checked="checked"'),d+="/>";var e=c.createElement("div");return e.innerHTML=d,e.firstChild},_addItem:function(a){var b,d=c.createElement("label"),e=this._map.hasLayer(a.layer);a.overlay?(b=c.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=e):b=this._createRadioElement("leaflet-base-layers",e),b.layerId=f.stamp(a.layer),f.DomEvent.on(b,"click",this._onInputClick,this);var g=c.createElement("span");g.innerHTML=" "+a.name,d.appendChild(b),d.appendChild(g);var h=a.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(d),d},_onInputClick:function(){var a,b,c,d=this._form.getElementsByTagName("input"),e=d.length;for(this._handlingClick=!0,a=0;e>a;a++)b=d[a],c=this._layers[b.layerId],b.checked&&!this._map.hasLayer(c.layer)?this._map.addLayer(c.layer):!b.checked&&this._map.hasLayer(c.layer)&&this._map.removeLayer(c.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){f.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),f.control.layers=function(a,b,c){return new f.Control.Layers(a,b,c)},f.PosAnimation=f.Class.extend({includes:f.Mixin.Events,run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._newPos=b,this.fire("start"),a.style[f.DomUtil.TRANSITION]="all "+(c||.25)+"s cubic-bezier(0,0,"+(d||.5)+",1)",f.DomEvent.on(a,f.DomUtil.TRANSITION_END,this._onTransitionEnd,this),f.DomUtil.setPosition(a,b),f.Util.falseFn(a.offsetWidth),this._stepTimer=setInterval(f.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(f.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),f.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var a=this._getPos();return a?(this._el._leaflet_pos=a,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var b,c,d,e=this._el,g=a.getComputedStyle(e);if(f.Browser.any3d){if(d=g[f.DomUtil.TRANSFORM].match(this._transformRe),!d)return;b=parseFloat(d[1]),c=parseFloat(d[2])}else b=parseFloat(g.left),c=parseFloat(g.top);return new f.Point(b,c,!0)},_onTransitionEnd:function(){f.DomEvent.off(this._el,f.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[f.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),f.Map.include({setView:function(a,b,c){if(b=b===d?this._zoom:this._limitZoom(b),a=this._limitCenter(f.latLng(a),b,this.options.maxBounds),c=c||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!c.reset&&c!==!0){c.animate!==d&&(c.zoom=f.extend({animate:c.animate},c.zoom),c.pan=f.extend({animate:c.animate},c.pan));var e=this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,b,c.zoom):this._tryAnimatedPan(a,c.pan);if(e)return clearTimeout(this._sizeTimer),this}return this._resetView(a,b),this},panBy:function(a,b){if(a=f.point(a).round(),b=b||{},!a.x&&!a.y)return this;if(this._panAnim||(this._panAnim=new f.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),b.noMoveStart||this.fire("movestart"),b.animate!==!1){f.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var c=this._getMapPanePos().subtract(a);this._panAnim.run(this._mapPane,c,b.duration||.25,b.easeLinearity)}else this._rawPanBy(a),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){f.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(a,b){var c=this._getCenterOffset(a)._floor();return(b&&b.animate)===!0||this.getSize().contains(c)?(this.panBy(c,b),!0):!1}}),f.PosAnimation=f.DomUtil.TRANSITION?f.PosAnimation:f.PosAnimation.extend({run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._duration=c||.25,this._easeOutPower=1/Math.max(d||.5,.2),this._startPos=f.DomUtil.getPosition(a),this._offset=b.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=f.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var a=+new Date-this._startTime,b=1e3*this._duration;b>a?this._runFrame(this._easeOut(a/b)):(this._runFrame(1),this._complete())},_runFrame:function(a){var b=this._startPos.add(this._offset.multiplyBy(a));f.DomUtil.setPosition(this._el,b),this.fire("step")},_complete:function(){f.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}}),f.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),f.DomUtil.TRANSITION&&f.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&f.DomUtil.TRANSITION&&f.Browser.any3d&&!f.Browser.android23&&!f.Browser.mobileOpera,this._zoomAnimated&&f.DomEvent.on(this._mapPane,f.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),f.Map.include(f.DomUtil.TRANSITION?{_catchTransitionEnd:function(a){this._animatingZoom&&a.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(a,b,c){if(this._animatingZoom)return!0;if(c=c||{},!this._zoomAnimated||c.animate===!1||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var d=this.getZoomScale(b),e=this._getCenterOffset(a)._divideBy(1-1/d),f=this._getCenterLayerPoint()._add(e);return c.animate===!0||this.getSize().contains(e)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(a,b,f,d,null,!0),!0):!1},_animateZoom:function(a,b,c,d,e,g,h){h||(this._animatingZoom=!0),f.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=a,this._animateToZoom=b,f.Draggable&&(f.Draggable._disabled=!0),f.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:a,zoom:b,origin:c,scale:d,delta:e,backwards:g})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,f.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),f.Draggable&&(f.Draggable._disabled=!1)}}:{}),f.TileLayer.include({_animateZoom:function(a){this._animating||(this._animating=!0,this._prepareBgBuffer());var b=this._bgBuffer,c=f.DomUtil.TRANSFORM,d=a.delta?f.DomUtil.getTranslateString(a.delta):b.style[c],e=f.DomUtil.getScaleString(a.scale,a.origin);b.style[c]=a.backwards?e+" "+d:d+" "+e},_endZoomAnim:function(){var a=this._tileContainer,b=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),f.Util.falseFn(b.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var a=this._map;!a||a._animatingZoom||a.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[f.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var a=this._tileContainer,b=this._bgBuffer,c=this._getLoadedTilesPercentage(b),d=this._getLoadedTilesPercentage(a);return b&&c>.5&&.5>d?(a.style.visibility="hidden",void this._stopLoadingImages(a)):(b.style.visibility="hidden",b.style[f.DomUtil.TRANSFORM]="",this._tileContainer=b,b=this._bgBuffer=a,this._stopLoadingImages(b),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(a){var b,c,d=a.getElementsByTagName("img"),e=0;for(b=0,c=d.length;c>b;b++)d[b].complete&&e++;return e/c},_stopLoadingImages:function(a){var b,c,d,e=Array.prototype.slice.call(a.getElementsByTagName("img"));for(b=0,c=e.length;c>b;b++)d=e[b],d.complete||(d.onload=f.Util.falseFn,d.onerror=f.Util.falseFn,d.src=f.Util.emptyImageUrl,d.parentNode.removeChild(d))}}),f.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(a){if(a=this._locateOptions=f.extend(this._defaultLocateOptions,a),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=f.bind(this._handleGeolocationResponse,this),c=f.bind(this._handleGeolocationError,this);return a.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,c,a):navigator.geolocation.getCurrentPosition(b,c,a),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(a){var b=a.code,c=a.message||(1===b?"permission denied":2===b?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:b,message:"Geolocation error: "+c+"."})},_handleGeolocationResponse:function(a){var b=a.coords.latitude,c=a.coords.longitude,d=new f.LatLng(b,c),e=180*a.coords.accuracy/40075017,g=e/Math.cos(f.LatLng.DEG_TO_RAD*b),h=f.latLngBounds([b-e,c-g],[b+e,c+g]),i=this._locateOptions;if(i.setView){var j=Math.min(this.getBoundsZoom(h),i.maxZoom);this.setView(d,j)}var k={latlng:d,bounds:h,timestamp:a.timestamp};for(var l in a.coords)"number"==typeof a.coords[l]&&(k[l]=a.coords[l]);this.fire("locationfound",k)}})}(window,document)},{}],209:[function(a,b,c){!function(a,b){"object"==typeof c&&c?b(c):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Mustache={})}(this,function(a){function b(a){return"function"==typeof a}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a,b){return o.call(a,b)}function e(a){return!d(p,a)}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return q[a]})}function g(b,d){function f(){if(w&&!x)for(;q.length;)delete p[q.pop()];else q=[];w=!1,x=!1}function g(a){if("string"==typeof a&&(a=a.split(s,2)),!n(a)||2!==a.length)throw new Error("Invalid tags: "+a);k=new RegExp(c(a[0])+"\\s*"),l=new RegExp("\\s*"+c(a[1])),m=new RegExp("\\s*"+c("}"+a[1]))}if(!b)return[];var k,l,m,o=[],p=[],q=[],w=!1,x=!1;g(d||a.tags);for(var y,z,A,B,C,D,E=new j(b);!E.eos();){if(y=E.pos,A=E.scanUntil(k))for(var F=0,G=A.length;G>F;++F)B=A.charAt(F),e(B)?q.push(p.length):x=!0,p.push(["text",B,y,y+1]),y+=1,"\n"===B&&f();if(!E.scan(k))break;if(w=!0,z=E.scan(v)||"name",E.scan(r),"="===z?(A=E.scanUntil(t),E.scan(t),E.scanUntil(l)):"{"===z?(A=E.scanUntil(m),E.scan(u),E.scanUntil(l),z="&"):A=E.scanUntil(l),!E.scan(l))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],p.push(C),"#"===z||"^"===z)o.push(C);else if("/"===z){if(D=o.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?x=!0:"="===z&&g(A)}if(D=o.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return i(h(p))}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function i(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;h>g;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function j(a){this.string=a,this.tail=a,this.pos=0}function k(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function l(){this.cache={}}var m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=RegExp.prototype.test,p=/\S/,q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r=/\s*/,s=/\s+/,t=/\s*=/,u=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;j.prototype.eos=function(){return""===this.tail},j.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},j.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},k.prototype.push=function(a){return new k(a,this)},k.prototype.lookup=function(a){var c,d=this.cache;if(a in d)c=d[a];else{for(var e,f,g=this;g;){if(a.indexOf(".")>0)for(c=g.view,e=a.split("."),f=0;null!=c&&f<e.length;)c=c[e[f++]];else"object"==typeof g.view&&(c=g.view[a]);if(null!=c)break;g=g.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},l.prototype.clearCache=function(){this.cache={}},l.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=g(a,b)),d},l.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof k?b:new k(b);return this.renderTokens(d,e,c,a)},l.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;j>i;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this._renderSection(e,b,c,d):"^"===f?g=this._renderInverted(e,b,c,d):">"===f?g=this._renderPartial(e,b,c,d):"&"===f?g=this._unescapedValue(e,b):"name"===f?g=this._escapedValue(e,b):"text"===f&&(g=this._rawValue(e)),void 0!==g&&(h+=g);return h},l.prototype._renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(n(i))for(var j=0,k=i.length;k>j;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,e.slice(a[3],a[5]),f),null!=i&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},l.prototype._renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);return!e||n(e)&&0===e.length?this.renderTokens(a[4],b,c,d):void 0},l.prototype._renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},l.prototype._unescapedValue=function(a,b){var c=b.lookup(a[1]);return null!=c?c:void 0},l.prototype._escapedValue=function(b,c){var d=c.lookup(b[1]);return null!=d?a.escape(d):void 0},l.prototype._rawValue=function(a){return a[1]},a.name="mustache.js",a.version="1.1.0",a.tags=["{{","}}"];var w=new l;a.clearCache=function(){return w.clearCache()},a.parse=function(a,b){return w.parse(a,b)},a.render=function(a,b,c){return w.render(a,b,c)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=f,a.Scanner=j,a.Context=k,a.Writer=l})},{}],210:[function(a,b,c){b.exports={name:"cartodb.js",version:"4.0.0-alpha.1",description:"CARTO javascript library",repository:{type:"git",url:"git://github.com/CartoDB/cartodb.js.git"},author:{name:"CARTO",email:"wadus@carto.com",url:"https://carto.com/"},contributors:[{name:"Javier Álvarez",email:"jmedina@carto.com"},{name:"Javier Álvarez",email:"xabel@vizzuality.com"},{name:"Javier Arce",email:"javierarce@carto.com"},{name:"Javier Santana",email:"jsantana@carto.com"},{name:"Raul Ochoa",email:"rochoa@carto.com"},{name:"Carlos Matallín",email:"matallo@carto.com"},{name:"Jaime Chapinal",email:"jaime.chapinal@carto.com"},{name:"Nicklas Gummesson",email:"nicklas@carto.com"},{name:"Francisco Dans",email:"francisco@carto.com"},{name:"Emilio García",email:"emilio@carto.com"}],license:"BSD-3-Clause",dependencies:{backbone:"1.2.3","backbone-poller":"^1.1.3","browserify-shim":"3.8.12","camshaft-reference":"<2.0",carto:"github:cartodb/carto#master",d3:"3.5.17","d3.cartodb":"github:cartodb/d3.cartodb#gh-pages",jquery:"2.1.4",leaflet:"0.7.3",mustache:"1.1.0","perfect-scrollbar":"0.6.7","torque.js":"github:cartodb/torque#master",underscore:"1.8.3"},devDependencies:{browserify:"13.0.0",cartoassets:"github:cartodb/CartoAssets#master","findup-sync":"0.1.3",grunt:"0.4.5","grunt-aws":"^0.4.0","grunt-browserify":"5.0.0","grunt-contrib-clean":"~0.5.0","grunt-contrib-concat":"~0.3.0","grunt-contrib-connect":"~0.11.2","grunt-contrib-copy":"~0.7.0","grunt-contrib-cssmin":"~0.7.0","grunt-contrib-imagemin":"~1.0.0","grunt-contrib-jasmine":"0.9.2","grunt-contrib-jshint":"~0.8.0","grunt-contrib-uglify":"0.10.0","grunt-contrib-watch":"git://github.com/gruntjs/grunt-contrib-watch.git#b884948805940c663b1cbb91a3c28ba8afdebf78","grunt-exorcise":"2.1.0","grunt-fastly":"~0.1.3","grunt-gitinfo":"~0.1.7","grunt-prompt":"~1.3.0","grunt-replace":"0.6.2","grunt-sass":"~1.1.0-beta",gulp:"3.8.10","gulp-iconfont":"1.0.0","gulp-iconfont-css":"0.0.9","gulp-install":"0.2.0","gulp-sketch":"0.0.7",jasmine:"2.4.1","jshint-stylish":"~0.1.3",jstify:"0.12.0","load-grunt-tasks":"~0.6.0",semistandard:"7.0.4",semver:"~4.1.0","source-map-support":"github:cartodb/node-source-map-support#0.4.6-cdb1","time-grunt":"~0.3.1",watchify:"3.4.0"},browserify:{transform:["browserify-shim","jstify"]},browser:{cdb:"./src/cdb.js","cdb.config":"./src/cdb.config.js","cdb.core.util":"./src/core/util.js","cdb.core.Profiler":"./src/core/profiler.js","cdb.log":"./src/cdb.log.js","cdb.errors":"./src/cdb.errors.js","cdb.templates":"./src/cdb.templates.js",geojson:"./vendor/GeoJSON.js","html-css-sanitizer":"./vendor/html-css-sanitizer-bundle.js","clip-path":"./vendor/clip-path.js",lzma:"./vendor/lzma.js",mousewheel:"./vendor/mousewheel.js",mwheelIntent:"./vendor/mwheelIntent.js","spin.js":"./vendor/spin.js","wax.cartodb.js":"./vendor/wax.cartodb.js"},"browserify-shim":{geojson:"GeoJSON","html-css-sanitizer":"html",lzma:"LZMA","clip-path":{depends:["underscore:_","jquery:jQuery"]},mousewheel:{depends:["jquery:jQuery"]},mwheelIntent:{depends:["jquery:jQuery"]},"spin.js":"Spinner","wax.cartodb.js":"wax"},files:["dist","node_modules/cdb","src","themes","vendor"],main:"src/index.js",semistandard:{globals:["cartodb","cdb","jasmine","describe","xdescribe","beforeEach","afterEach","spyOn","it","xit","expect"],ignore:["/*.js","/dist","/doc","/examples","/grunt","/styleguide","/themes","/vendor"]},config:{root:"."},scripts:{test:"jasmine JASMINE_CONFIG_PATH=test/support/jasmine.json","test-debug":"node-debug --no-preload ./node_modules/.bin/jasmine JASMINE_CONFIG_PATH=test/support/jasmine.json --","test-watch":"watch 'npm test' $npm_package_config_root"},gitHead:"90d9ee8aab95b6dcab4fe5eac1edf251486b828c",readme:'CartoDB.js (v3.15)\n===========\n\n[![Build Status](http://clinker.cartodb.net/desktop/plugin/public/status/CartoDB-js-develop-testing)]\n(http://clinker.cartodb.net/jenkins/job/CartoDB-js-develop-testing)\n\nThis library allows to embed visualizations created with CartoDB in your map or website in a simple way.\n\n\n## Quick start\n\n  1. Add cartodb.js and css to your site:\n\n    ```html\n\n        <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />\n        <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>\n\n        <!-- use these cartodb.css links if you are using https -->\n        <!--link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" /-->\n\n        <!-- use this cartodb.js link if you are using https -->\n        <!-- script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script -->\n    ```\n\n\n  2. Create the map and add the layer\n\n    ```javascript\n      var map = L.map(\'map\').setView([0, 0], 3);\n\n      // set a base layer\n      L.tileLayer(\'http://a.tile.stamen.com/toner/{z}/{x}/{y}.png\', {\n        attribution: \'stamen http://maps.stamen.com/\'\n      }).addTo(map);\n\n      // add the cartodb layer\n      var layerUrl = \'http://documentation.carto.com/api/v2/viz/2b13c956-e7c1-11e2-806b-5404a6a683d5/viz.json\';\n      cartodb.createLayer(map, layerUrl).addTo(map);\n    ```\n\n### Usage with Bower\n\nYou can install **cartodb.js** with [bower](http://bower.io/) by running\n\n```sh\nbower install cartodb.js\n```\n\n\n## Documentation\nYou can find the documentation online [here](http://docs.carto.com/cartodb-platform/cartodb-js.html) and the [source](https://github.com/CartoDB/cartodb.js/blob/develop/doc/API.md) inside this repository.\n\n## Examples\n\n - [Load a layer with google maps](http://cartodb.github.com/cartodb.js/examples/gmaps_force_basemap.html)\n - [Load a layer with Leaflet](http://cartodb.github.com/cartodb.js/examples/leaflet.html)\n - [Show a complete visualization](http://cartodb.github.com/cartodb.js/examples/easy.html)\n - [A visualization with a layer selector](http://cartodb.github.com/cartodb.js/examples/layer_selector.html)\n - [How to create a custom infowindow](http://cartodb.github.com/cartodb.js/examples/custom_infowindow.html)\n - [The Hobbit filming location paths](http://cartodb.github.com/cartodb.js/examples/TheHobbitLocations/) a full example with some widgets\n\n\n## How to build\nBuild CartoDB.js library:\n\n  - Install [node.js](http://nodejs.org/download/), from 0.10 version\n  - Install grunt & bower: `npm install -g grunt-cli bower`\n  - Install node dependencies: `npm install`\n  - Install bower dependencies: `bower install`\n  - Install [ruby](https://www.ruby-lang.org/en/installation/) and [bundler](https://github.com/bundler/bundler)\n  - Install ruby dependencies: `bundle install` (necessary for compass gem)\n  - Start the server: `grunt build`\n  - Happy mapping!\n  - \n  \n## Submitting Contributions\n\nYou will need to sign a Contributor License Agreement (CLA) before making a submission. [Learn more here.](https://carto.com/contributing)\n\n',readmeFilename:"README.md",bugs:{url:"https://github.com/CartoDB/cartodb.js/issues"},homepage:"https://github.com/CartoDB/cartodb.js#readme",_id:"cartodb.js@4.0.0-alpha.1",_shasum:"55ef74ad171268070655301e3b9fad05a4e68a0e",_from:"git://github.com/cartodb/cartodb.js.git#90d9ee8aab95b6dcab4fe5eac1edf251486b828c",_resolved:"git://github.com/cartodb/cartodb.js.git#90d9ee8aab95b6dcab4fe5eac1edf251486b828c"}},{}],211:[function(a,b,c){var d=a("underscore"),e=a("./analysis-model"),f=a("./camshaft-reference"),g=function(a){if(a=a||{},!a.analysisCollection)throw new Error("analysisCollection option is required");if(!a.vis)throw new Error("vis option is required");this._camshaftReference=a.camshaftReference||f,this._analysisCollection=a.analysisCollection,this._apiKey=a.apiKey,this._authToken=a.authToken,this._vis=a.vis};g.prototype.analyse=function(a){a=d.clone(a);var b=this._analysisCollection.get(a.id),c=this._getAnalysisAttributesFromAnalysisDefinition(a);return b?b.set(c):(this._apiKey&&(c.apiKey=this._apiKey),this._authToken&&(c.authToken=this._authToken),b=new e(c,{camshaftReference:this._camshaftReference,vis:this._vis}),this._addAnalysisToCollection(b),b.bind("destroy",this._onAnalysisRemoved,this)),b},g.prototype._getAnalysisAttributesFromAnalysisDefinition=function(a){var b=a.type,c=this._camshaftReference.getSourceNamesForAnalysisType(b),e={};return d.each(c,function(b){e[b]=this.analyse(a.params[b])},this),d.omit(d.extend(a,a.params,e),"params")},g.prototype._onAnalysisRemoved=function(a){this._removeAnalsyisFromIndex(a),a.unbind("destroy",this._onAnalysisRemoved)},g.prototype.findNodeById=function(a){return this._analysisCollection.get(a)},g.prototype._addAnalysisToCollection=function(a){return this._analysisCollection.add(a)},g.prototype._removeAnalsyisFromIndex=function(a){return this._analysisCollection.remove(a)},b.exports=g},{"./analysis-model":212,"./camshaft-reference":214,underscore:"underscore"}],212:[function(a,b,c){var d=a("underscore"),e=a("../core/model"),f={PENDING:"pending",WAITING:"waiting",RUNNING:"running",FAILED:"failed",READY:"ready"};b.exports=e.extend({initialize:function(a,b){if(b=b||{},!b.camshaftReference)throw new Error("chamshaftReference is required");if(!b.vis)throw new Error("vis is required");this._camshaftReference=b.camshaftReference,this._vis=b.vis,this._initBinds()},url:function(){var a=this.get("url");if(a){if(this.get("apiKey"))a+="?api_key="+this.get("apiKey");else if(this.get("authToken")){var b=this.get("authToken");if(b instanceof Array){var c=d.map(b,function(a){return"auth_token[]="+a});a+="?"+c.join("&")}else a+="?auth_token="+b}return a}},setOk:function(){this.unset("error")},setError:function(a){this.set({error:a,status:f.FAILED})},_initBinds:function(){this.bind("change:type",function(){this.unbind(null,null,this),this._initBinds(),this._reloadVis()},this),d.each(this.getParamNames(),function(a){this.bind("change:"+a,this._reloadVis,this)},this)},_reloadVis:function(a){a=a||{},a.error=this._onMapReloadError.bind(this),this._vis.reload(a)},_onMapReloadError:function(){this.set("status",f.FAILED)},remove:function(){this.trigger("destroy",this),this.stopListening()},findAnalysisById:function(a){if(this.get("id")===a)return this;var b=d.chain(this._getSourceNames()).map(function(b){var c=this.get(b);return c.findAnalysisById(a)},this).compact().value();return b[0]},_getSourceNames:function(){return this._camshaftReference.getSourceNamesForAnalysisType(this.get("type"))},isDone:function(){return this._anyStatus(f.READY,f.FAILED)},isFailed:function(){return this._anyStatus(f.FAILED)},isLoading:function(){return this._anyStatus(f.PENDING,f.WAITING,f.RUNNING)},_anyStatus:function(){var a=Array.prototype.slice.call(arguments,0);return-1!==a.indexOf(this.get("status"))},toJSON:function(){var a=d.pick(this.attributes,"id","type");return a.params=d.pick(this.attributes,this.getParamNames()),d.each(this._getSourceNames(),function(b){var c={};c[b]=this.get(b).toJSON(),d.extend(a.params,c)},this),a},getParamNames:function(){return this._camshaftReference.getParamNamesForAnalysisType(this.get("type"))}},{STATUS:f})},{"../core/model":230,underscore:"underscore"}],213:[function(a,b,c){var d=a("underscore"),e=a("backbone-poller"),f=function(){};f.CONFIG={START_DELAY:1e3,MAX_DELAY:1/0,DELAY_MULTIPLIER:1.5},f.prototype.poll=function(a){this._pollers=[];var b=this._findOrCreatePoller(a);a.hasChanged("url")&&b.active()&&b.stop(),a.isDone()||b.start()},f.prototype._findOrCreatePoller=function(a){var b=this._findPoller(a);return b||(b=this._createPoller(a)),b},f.prototype._findPoller=function(a){return d.find(this._pollers,function(b){return b.model===a})},f.prototype._createPoller=function(a){var b={delay:[f.CONFIG.START_DELAY,f.CONFIG.MAX_DELAY,f.CONFIG.DELAY_MULTIPLIER],condition:function(a){return!a.isDone()}},c=e.get(a,b);return this._pollers.push(c),c},f.prototype.reset=function(){e.reset(),this._pollers=[]},b.exports=f},{"backbone-poller":110,underscore:"underscore"}],214:[function(a,b,c){var d=a("camshaft-reference").getVersion("latest"),e={NODE:"node",NUMBER:"number",STRING:"string",ENUM:"enum"},f="source",g={};g[f]=[];var h={},i=d.analyses;if(!i)throw new Error("Error loading the reference for Camshaft analyses");for(var j in i){var k=i[j].params;for(var l in k){h[j]=h[j]||[],h[j].push(l),g[j]=g[j]||[];var m=k[l].type;m===e.NODE&&g[j].push(l)}}b.exports={getSourceNamesForAnalysisType:function(a){var b=g[a];if(!b)throw new Error("source names for analysis of type "+a+" couldn't be found");return b},getParamNamesForAnalysisType:function(a){var b=h[a];if(!b)throw new Error("param names for analysis of type "+a+" couldn't be found");return b}}},{"camshaft-reference":"camshaft-reference"}],215:[function(a,b,c){var d=a("underscore"),e=a("../vis/vis-view"),f=a("../vis/vis"),g=a("../core/loader"),h=a("./vizjson"),i={tiles_loader:!0,loaderControl:!0,infowindow:!0,tooltip:!0,logo:!0,show_empty_infowindow_fields:!1,interactiveFeatures:!1},j=function(a,b,c){if("string"==typeof a&&(a=document.getElementById(a)),!a)throw new TypeError("a valid DOM element or selector must be provided");if(!b)throw new TypeError("a vizjson URL or object must be provided");c=d.defaults(c||{},i);var e=new f;if("string"==typeof b){var h=b;g.get(h,function(b){if(!b)throw new Error("error fetching viz.json file");k(a,e,b,c)})}else k(a,e,b,c);return e},k=function(a,b,c,f){var g=new h(c);l(g,f);var i=window&&window.location.protocol&&"https:"===window.location.protocol,j=!0;d.isBoolean(f.legends)?j=f.legends:g.options&&d.isBoolean(g.options.legends)&&(j=g.options.legends);var k=!0;d.isBoolean(f.layer_selector)?k=f.layer_selector:g.options&&d.isBoolean(g.options.layer_selector)&&(k=g.options.layer_selector);var m=!0;d.isBoolean(f.layerSelectorEnabled)&&(m=f.layerSelectorEnabled),b.set({title:f.title||g.title,description:f.description||g.description,apiKey:f.apiKey,authToken:f.authToken,showEmptyInfowindowFields:f.show_empty_infowindow_fields===!0,https:i||f.https===!0||g.https===!0,interactiveFeatures:f.interactiveFeatures}),b.setSettings({showLegends:j,showLayerSelector:k,layerSelectorEnabled:m}),new e({el:a,model:b,settingsModel:b.settings}),b.load(g),f.skipMapInstantiation||b.instantiateMap()},l=function(a,b){a.options=a.options||{},a.options.scrollwheel=b.scrollwheel||a.options.scrollwheel,b.tiles_loader&&b.loaderControl||a.removeLoaderOverlay(),b.searchControl===!0?a.addSearchOverlay():b.searchControl===!1&&a.removeSearchOverlay(),(b.title&&a.title||b.description&&a.description)&&a.addHeaderOverlay(b.title,b.description,b.shareable),void 0===b.zoomControl||b.zoomControl||a.removeZoomOverlay(),b.logo===!1&&a.removeLogoOverlay();var c=parseInt(b.zoom,10);isNaN(c)||a.setZoom(c);var d=parseFloat(b.center_lat),e=parseFloat(b.center_lon);isNaN(d)||isNaN(e)||a.setCenter([d,e]),void 0!==b.center&&a.setCenter(b.center);var f=parseFloat(b.sw_lat),g=parseFloat(b.sw_lon),h=parseFloat(b.ne_lat),i=parseFloat(b.ne_lon);isNaN(f)||isNaN(g)||isNaN(h)||isNaN(i)||a.setBounds([[f,g],[h,i]]),b.gmaps_base_type&&a.enforceGMapsBaseLayer(b.gmaps_base_type,b.gmaps_style)};b.exports=j},{"../core/loader":226,"../vis/vis":409,"../vis/vis-view":408,"./vizjson":218,underscore:"underscore"}],216:[function(a,b,c){function d(){}var e=a("underscore"),f=a("backbone");e.extend(d.prototype,f.Events,{done:function(a){return this.bind("done",a)},error:function(a){return this.bind("error",a)}}),b.exports=d},{backbone:"backbone",underscore:"underscore"}],217:[function(a,b,c){function d(a){if(window.cdb===this||window===this)return new d(a);if(!a.user)throw new Error("user should be provided");var b=new String(window.location.protocol);if(b=b.slice(0,b.length-1),"file"==b&&(b="https"),this.options=f.defaults(a,{version:"v2",protocol:b,jsonp:!g.support.cors}),!this.options.sql_api_template){var c=this.options,e=null;if(c&&c.completeDomain)e=c.completeDomain;else{var h=c.host||"carto.com",i=c.protocol||"https";e=i+"://{user}."+h}this.options.sql_api_template=e}}function e(a){return JSON.parse(a.replace(/^{/,"[").replace(/}$/,"]"))}var f=a("underscore"),g=a("jquery"),h=a("mustache"),i=a("./promise"),j="No bounds";d.prototype._host=function(){var a=this.options;return a.sql_api_template.replace("{user}",a.user)+"/api/"+a.version+"/sql"},d.prototype.execute=function(a,b,c,d){var e=1024,j=new i;if(!a)throw new TypeError("sql should not be null");var k=arguments,l=k[k.length-1];f.isFunction(l)&&(d=l),c=f.defaults(c||{},this.options);var m={type:"get",dataType:"json",crossDomain:!0};void 0!==c.cache&&(m.cache=c.cache),c.jsonp&&(delete m.crossDomain,
c.jsonpCallback&&(m.jsonpCallback=c.jsonpCallback),m.dataType="jsonp");var n="156543.03515625",o="ST_MakeEnvelope(-20037508.5,-20037508.5,20037508.5,20037508.5,3857)";a=a.replace("!bbox!",o).replace("!pixel_width!",n).replace("!pixel_height!",n);var p=h.render(a,b),q=p.length<e,r=["format","dp","api_key"];if(c.extra_params&&(r=r.concat(c.extra_params)),m.url=this._host(),q){var s="q="+encodeURIComponent(p);for(var t in r){var u=r[t],v=c[u];null!=v&&(s+="&"+u+"="+v)}m.url+="?"+s}else{var w={q:p};for(var t in r){var u=r[t],v=c[u];null!=v&&(w[u]=v)}m.data=w,m.type="post"}var x=c.success,y=c.error;return x&&delete c.success,y&&delete y.success,m.error=function(a){var b=a.responseText||a.response,c=b&&JSON.parse(b);j.trigger("error",c&&c.error,a),y&&y(a),d&&d(a)},m.success=function(a,b,c){void 0==b&&(b=a.status,c=a,a=JSON.parse(a.response)),setTimeout(function(){j.trigger("done",a,b,c),x&&x(a,b,c),d&&d(null,a)},0)},delete c.jsonp,g.ajax(f.extend(m,c)),j},d.prototype.getBounds=function(a,b,c,d){var e=new i,g=arguments,k=g[g.length-1];f.isFunction(k)&&(d=k);var l="SELECT ST_XMin(ST_Extent(the_geom)) as minx,       ST_YMin(ST_Extent(the_geom)) as miny,       ST_XMax(ST_Extent(the_geom)) as maxx,       ST_YMax(ST_Extent(the_geom)) as maxy from ({{{ sql }}}) as subq";return a=h.render(a,b),this.execute(l,{sql:a},c).done(function(a){if(a.rows&&a.rows.length>0&&null!=a.rows[0].maxx){var b=a.rows[0],c=-85.0511,f=85.0511,g=-179,h=179,i=function(a,b,c){return b>a?b:a>c?c:a},k=i(b.maxx,g,h),l=i(b.minx,g,h),m=i(b.maxy,c,f),n=i(b.miny,c,f),o=[[m,k],[n,l]];e.trigger("done",o),d&&d(null,o)}else{var p=[j];e.trigger("error",p),d&&d(p)}}).error(function(a){e.trigger("error",a),d&&d(a)}),e},d.prototype.table=function(a){function b(){b.fetch.apply(b,arguments)}var c,d,e,g,h=a,i=[],j=this;return b.fetch=function(a){a=a||{};var c=arguments,d=c[c.length-1];f.isFunction(d)&&(callback=d,1===c.length&&(a={})),j.execute(b.sql(),a,callback)},b.sql=function(){var a="select";return a+=i.length?" "+i.join(",")+" ":" * ",a+="from "+h,c&&(a+=" where "+c),d&&(a+=" limit "+d),e&&(a+=" order by "+e),g&&(a+=" "+g),a},b.filter=function(a){return c=a,b},b.order_by=function(a){return e=a,b},b.asc=function(){return g="asc",b},b.desc=function(){return g="desc",b},b.columns=function(a){return i=a,b},b.limit=function(a){return d=a,b},b},d.prototype.describeString=function(a,b,c){var d=["WITH t as (","        SELECT count(*) as total,","               count(DISTINCT {{column}}) as ndist","        FROM ({{sql}}) _wrap","      ), a as (","        SELECT ","          count(*) cnt, ","          {{column}}","        FROM ","          ({{sql}}) _wrap ","        GROUP BY ","          {{column}} ","        ORDER BY ","          cnt DESC","        ), b As (","         SELECT","          row_number() OVER (ORDER BY cnt DESC) rn,","          cnt","         FROM a","        ), c As (","        SELECT ","          sum(cnt) OVER (ORDER BY rn ASC) / t.total cumperc,","          rn,","          cnt ","         FROM b, t","         LIMIT 10","         ),","stats as (","select count(distinct({{column}})) as uniq, ","       count(*) as cnt, ","       sum(case when COALESCE(NULLIF({{column}},'')) is null then 1 else 0 end)::numeric as null_count, ","       sum(case when COALESCE(NULLIF({{column}},'')) is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio, ","       (SELECT max(cumperc) weight FROM c) As skew ","from ({{sql}}) __wrap","),","hist as (","select array_agg(row(d, c)) array_agg from (select distinct({{column}}) d, count(*) as c from ({{sql}}) __wrap, stats group by 1 limit 100) _a",")","select * from stats, hist"],g=h.render(d.join("\n"),{column:b,sql:a}),i=function(a){var b=a.replace(/^"(.+(?="$))?"$/,"$1");return b.replace(/""/g,'"')};this.execute(g,function(a,b){if(a)return void c(a);var d=b.rows[0],g=0,h=[];try{var j=e(d.array_agg),h=f(j).map(function(a){var b=a.match(/\((.*),(\d+)/),c=i(b[1]);return[c,+b[2]]});g=d.skew*(1-d.null_ratio)*(1-d.uniq/d.cnt)*(d.uniq>1?1:0)}catch(k){}c(null,{type:"string",hist:h,distinct:d.uniq,count:d.cnt,null_count:d.null_count,null_ratio:d.null_ratio,skew:d.skew,weight:g})})},d.prototype.describeDate=function(a,b,c){var d=["with minimum as (","SELECT min({{column}}) as start_time FROM ({{sql}}) _wrap), ","maximum as (SELECT max({{column}}) as end_time FROM ({{sql}}) _wrap), ","null_ratio as (SELECT sum(case when {{column}} is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio FROM ({{sql}}) _wrap), ","moments as (SELECT count(DISTINCT {{column}}) as moments FROM ({{sql}}) _wrap)","SELECT * FROM minimum, maximum, moments, null_ratio"],e=h.render(d.join("\n"),{column:b,sql:a});this.execute(e,function(a,b){if(a)return void c(a);var d=b.rows[0],e=new Date(d.end_time),f=new Date(d.start_time),g=(d.moments,Math.min(d.moments,1024));c(null,{type:"date",start_time:f,end_time:e,range:e-f,steps:g,null_ratio:d.null_ratio})})},d.prototype.describeBoolean=function(a,b,c){var d=["with stats as (","select count(distinct({{column}})) as uniq,","count(*) as cnt","from ({{sql}}) _wrap ","),","null_ratio as (","SELECT sum(case when {{column}} is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio FROM ({{sql}}) _wrap), ","true_ratio as (","SELECT sum(case when {{column}} is true then 1 else 0 end)::numeric / count(*)::numeric as true_ratio FROM ({{sql}}) _wrap) ","SELECT * FROM true_ratio, null_ratio, stats"],e=h.render(d.join("\n"),{column:b,sql:a});this.execute(e,function(a,b){if(a)return void c(a);var d=b.rows[0];c(null,{type:"boolean",null_ratio:d.null_ratio,true_ratio:d.true_ratio,distinct:d.uniq,count:d.cnt})})},d.prototype.describeGeom=function(a,b,c){function d(a){return{st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"}[a.toLowerCase()]}var e=["with geotype as (","select st_geometrytype({{column}}) as geometry_type from ({{sql}}) _w where {{column}} is not null limit 1",")","select * from geotype"],f=h.render(e.join("\n"),{column:b,sql:a});this.execute(f,function(a,b){if(a)return void c(a);var e=b.rows[0];c(null,{type:"geom",geometry_type:e.geometry_type,simplified_geometry_type:d(e.geometry_type)})})},d.prototype.columns=function(a,b,c){var d=arguments,e=d[d.length-1];f.isFunction(e)&&(c=e);var g="select * from ("+a+") __wrap limit 0",h=["cartodb_id","latitude","longitude","created_at","updated_at","lat","lon","the_geom_webmercator"];this.execute(g,function(a,b){if(a)return void c(a);var d={};for(var e in b.fields)-1===h.indexOf(e)&&(d[e]=b.fields[e].type);c(null,d)})},d.prototype.describeFloat=function(a,b,c){var d=["with stats as (","select min({{column}}) as min,","max({{column}}) as max,","avg({{column}}) as avg,","count(DISTINCT {{column}}) as cnt,","count(distinct({{column}})) as uniq,","count(*) as cnt,","sum(case when {{column}} is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio,","stddev_pop({{column}}) / count({{column}}) as stddev,","CASE WHEN abs(avg({{column}})) > 1e-7 THEN stddev({{column}}) / abs(avg({{column}})) ELSE 1e12 END as stddevmean,",'CDB_DistType(array_agg("{{column}}"::numeric)) as dist_type ',"from ({{sql}}) _wrap ","),","params as (select min(a) as min, (max(a) - min(a)) / 7 as diff from ( select {{column}} as a from ({{sql}}) _table_sql where {{column}} is not null ) as foo ),","histogram as (","select array_agg(row(bucket, range, freq)) as hist from (","select CASE WHEN uniq > 1 then width_bucket({{column}}, min-0.01*abs(min), max+0.01*abs(max), 100) ELSE 1 END as bucket,","numrange(min({{column}})::numeric, max({{column}})::numeric) as range,","count(*) as freq","from ({{sql}}) _w, stats","group by 1","order by 1",") __wrap","),","hist as (","select array_agg(row(d, c)) cat_hist from (select distinct({{column}}) d, count(*) as c from ({{sql}}) __wrap, stats group by 1 limit 100) _a","),","buckets as (","select CDB_QuantileBins(array_agg(distinct({{column}}::numeric)), 7) as quantiles, ","       (select array_agg(x::numeric) FROM (SELECT (min + n * diff)::numeric as x FROM generate_series(1,7) n, params) p) as equalint,","       CDB_JenksBins(array_agg(distinct({{column}}::numeric)), 7) as jenks, ","       CDB_HeadsTailsBins(array_agg(distinct({{column}}::numeric)), 7) as headtails ","from ({{sql}}) _table_sql where {{column}} is not null",")","select * from histogram, stats, buckets, hist"],g=h.render(d.join("\n"),{column:b,sql:a});this.execute(g,function(a,b){if(a)return void c(a);var d=b.rows[0],g=e(d.hist),h=e(d.cat_hist);c(null,{type:"number",cat_hist:f(h).map(function(a){var b=a.match(/\((.*),(\d+)/);return[+b[1],+b[2]]}),hist:f(g).map(function(a){if(!(a.indexOf("empty")>-1)){var b=a.split('"');return{index:b[0].replace(/\D/g,""),range:b[1].split(",").map(function(a){return a.replace(/\D/g,"")}),freq:b[2].replace(/\D/g,"")}}}),stddev:d.stddev,null_ratio:d.null_ratio,count:d.cnt,distinct:d.uniq,avg:d.avg,max:d.max,min:d.min,stddevmean:d.stddevmean,weight:(d.uniq>1?1:0)*(1-d.null_ratio)*(d.stddev<-1?1:d.stddev<1?.5:d.stddev<3?.25:.1),quantiles:d.quantiles,equalint:d.equalint,jenks:d.jenks,headtails:d.headtails,dist_type:d.dist_type})})},d.prototype.describe=function(a,b,c){var d=this,e=arguments,g=e[e.length-1];if(f.isFunction(g))var h=g;var i=function(a,c){return a?void h(a):(c.column=b,void h(null,c))},j="select * from ("+a+") __wrap limit 0";this.execute(j,function(e,f){if(e)return void i(e);var g=c&&c.type?c.type:f.fields[b].type;return g?void("string"===g?d.describeString(a,b,i):"number"===g?d.describeFloat(a,b,i):"geometry"===g?d.describeGeom(a,b,i):"date"===g?d.describeDate(a,b,i):"boolean"===g?d.describeBoolean(a,b,i):i(new Error("column type is not supported"))):void i(new Error("column does not exist"))})},b.exports=d},{"./promise":216,jquery:"jquery",mustache:209,underscore:"underscore"}],218:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=["roadmap","gray_roadmap","dark_roadmap","hybrid","satellite","terrain"],g=function(a){d.each(Object.keys(a),function(b){this[b]=a[b]},this),this.overlays=this.overlays||[],this.layers=this.layers||[],this._addAttributionOverlay()};g.OVERLAY_TYPES={ZOOM:"zoom",ATTRIBUTION:"attribution",LOADER:"loader",SEARCH:"search",HEADER:"header",LOGO:"logo"},g.MAP_PROVIDER_TYPES={GMAPS:"googlemaps",LEAFLET:"leaflet"},g.prototype.isNamedMap=function(){return!!this.datasource.template_name},g.prototype.hasZoomOverlay=function(){return this.hasOverlay(g.OVERLAY_TYPES.ZOOM)},g.prototype.hasOverlay=function(a){return d.isObject(this.getOverlayByType(a))},g.prototype.getOverlayByType=function(a){return d.find(this.overlays,function(b){return b.type===a})},g.prototype.addHeaderOverlay=function(a,b,c){this.hasOverlay(g.OVERLAY_TYPES.HEADER)||this.overlays.unshift({type:g.OVERLAY_TYPES.HEADER,order:1,shareable:c,url:this.url,options:{extra:{title:this.title,description:this.description,show_title:a,show_description:b}}})},g.prototype.addSearchOverlay=function(){this.hasOverlay(g.OVERLAY_TYPES.SEARCH)||this.overlays.push({type:g.OVERLAY_TYPES.SEARCH,order:3})},g.prototype.removeOverlay=function(a){for(var b=0;b<this.overlays.length;++b)if(this.overlays[b].type===a)return void this.overlays.splice(b,1)},g.prototype.removeLoaderOverlay=function(){this.removeOverlay(g.OVERLAY_TYPES.LOADER)},g.prototype.removeZoomOverlay=function(){this.removeOverlay(g.OVERLAY_TYPES.ZOOM)},g.prototype.removeSearchOverlay=function(){this.removeOverlay(g.OVERLAY_TYPES.SEARCH)},g.prototype.removeLogoOverlay=function(a){this.removeOverlay(g.OVERLAY_TYPES.LOGO)},g.prototype._addAttributionOverlay=function(){this.overlays.push({type:g.OVERLAY_TYPES.ATTRIBUTION})},g.prototype.enforceGMapsBaseLayer=function(a,b){var c=d.contains(f,a);this.map_provider===g.MAP_PROVIDER_TYPES.LEAFLET&&c?this.layers?(this.layers[0].options.type="GMapsBase",this.layers[0].options.base_type=a,this.layers[0].options.name=a,b&&(this.layers[0].options.style="string"==typeof b?JSON.parse(b):b),this.map_provider=g.MAP_PROVIDER_TYPES.GMAPS,this.layers[0].options.attribution=""):e.error("No base map loaded. Using Leaflet."):e.error('GMaps base_type "'+a+" is not supported. Using leaflet.")},g.prototype.setZoom=function(a){this.zoom=a,this.bounds=null},g.prototype.setCenter=function(a){this.center=a,this.bounds=null},g.prototype.setBounds=function(a){this.bounds=a},b.exports=g},{"cdb.log":223,underscore:"underscore"}],219:[function(a,b,c){var d=!!window.L,e=a("underscore"),f=a("leaflet");a("mousewheel"),a("mwheelIntent");var g=a("cdb");window&&(window.cartodb=window.cdb=g),g.Backbone=a("backbone"),g.Mustache=a("mustache"),g.$=a("jquery"),g._=e,g.L=f,d&&f.noConflict(),e.extend(g.geo,a("./geo/leaflet")),g.SQL=a("./api/sql"),g.config=a("cdb.config"),g.log=a("cdb.log"),g.errors=a("cdb.errors"),g.templates=a("cdb.templates"),g.createVis=a("./api/create-vis"),g.LZMA=a("lzma"),g.core.Profiler=a("cdb.core.Profiler"),g.core.util=a("cdb.core.util"),g.core.Loader=g.vis.Loader=a("./core/loader"),g.core.sanitize=a("./core/sanitize"),g.core.Template=a("./core/template"),g.core.TemplateList=a("./core/template-list"),g.core.Model=a("./core/model"),g.core.View=a("./core/view"),g.ui.common.Dialog=a("./ui/common/dialog"),g.ui.common.Dropdown=a("./ui/common/dropdown"),g.ui.common.FullScreen=a("./ui/common/fullscreen/fullscreen-view"),g.ui.common.Notification=a("./ui/common/notification"),g.ui.common.Row=a("./ui/common/table/row"),g.ui.common.TableData=a("./ui/common/table/table-data"),g.ui.common.TableProperties=a("./ui/common/table/table-properties"),g.ui.common.RowView=a("./ui/common/table/row-view"),g.ui.common.Table=a("./ui/common/table"),g.geo.geocoder.NOKIA=a("./geo/geocoder/nokia-geocoder"),g.geo.geocoder.YAHOO=a("./geo/geocoder/yahoo-geocoder"),g.geo.TileLayer=a("./geo/map/tile-layer"),g.geo.GMapsBaseLayer=a("./geo/map/gmaps-base-layer"),g.geo.WMSLayer=a("./geo/map/wms-layer"),g.geo.PlainLayer=a("./geo/map/plain-layer"),g.geo.TorqueLayer=a("./geo/map/torque-layer"),g.geo.CartoDBLayer=a("./geo/map/cartodb-layer"),g.geo.Map=a("./geo/map"),g.geo.MapView=a("./geo/map-view"),e.extend(g.geo,a("./geo/gmaps")),g.Promise=a("./api/promise"),g.geo.ui.Text=a("./geo/ui/text"),g.geo.ui.Annotation=a("./geo/ui/annotation"),g.geo.ui.Image=a("./geo/ui/image"),g.geo.ui.Zoom=a("./geo/ui/zoom/zoom-view"),g.geo.ui.InfowindowModel=a("./geo/ui/infowindow-model"),g.geo.ui.Infowindow=a("./geo/ui/infowindow-view"),g.geo.ui.Search=a("./geo/ui/search/search"),g.geo.ui.LayerView=a("./geo/ui/layer-view"),g.geo.ui.TilesLoader=a("./geo/ui/tiles-loader"),g.geo.ui.InfoBox=a("./geo/ui/infobox"),g.geo.ui.Tooltip=a("./geo/ui/tooltip-view"),g.vis.INFOWINDOW_TEMPLATE=a("./vis/vis/infowindow-template"),g.vis.Vis=a("./vis/vis"),b.exports=g},{"./api/create-vis":215,"./api/promise":216,"./api/sql":217,"./core/loader":226,"./core/model":230,"./core/sanitize":232,"./core/template":234,"./core/template-list":233,"./core/view":236,"./geo/geocoder/nokia-geocoder":259,"./geo/geocoder/yahoo-geocoder":260,"./geo/gmaps":296,"./geo/leaflet":308,"./geo/map":321,"./geo/map-view":320,"./geo/map/cartodb-layer":322,"./geo/map/gmaps-base-layer":323,"./geo/map/plain-layer":335,"./geo/map/tile-layer":337,"./geo/map/torque-layer":339,"./geo/map/wms-layer":340,"./geo/ui/annotation":342,"./geo/ui/image":346,"./geo/ui/infobox":347,"./geo/ui/infowindow-model":348,"./geo/ui/infowindow-view":349,"./geo/ui/layer-view":350,"./geo/ui/search/search":376,"./geo/ui/text":379,"./geo/ui/tiles-loader":380,"./geo/ui/tooltip-view":381,"./geo/ui/zoom/zoom-view":383,"./ui/common/dialog":384,"./ui/common/dropdown":385,"./ui/common/fullscreen/fullscreen-view":387,"./ui/common/notification":388,"./ui/common/table":389,"./ui/common/table/row":391,"./ui/common/table/row-view":390,"./ui/common/table/table-data":392,"./ui/common/table/table-properties":393,"./vis/vis":409,"./vis/vis/infowindow-template":410,backbone:"backbone",cdb:222,"cdb.config":220,"cdb.core.Profiler":231,"cdb.core.util":235,"cdb.errors":221,"cdb.log":223,"cdb.templates":224,jquery:"jquery",leaflet:208,lzma:431,mousewheel:432,mustache:209,mwheelIntent:433,underscore:"underscore"}],220:[function(a,b,c){var d=a("./core/config"),e=new d;e.set({cartodb_attributions:'© <a href="https://carto.com/attributions" target="_blank">CARTO</a>',cartodb_logo_link:"http://www.carto.com"}),b.exports=e},{"./core/config":225}],221:[function(a,b,c){var d=a("./core/log/error-list");b.exports=new d},{"./core/log/error-list":228}],222:[function(a,b,c){var d={};d.VERSION=a("../package.json").version,d.DEBUG=!1,d.CARTOCSS_DEFAULT_VERSION="2.1.1",d.CARTOCSS_VERSIONS={"2.0.0":"","2.1.0":""},d.config={},d.core={},d.decorators={},d.image={},d.geo={},d.geo.common={},d.geo.geocoder={},d.geo.ui={},d.ui={},d.ui.common={},d.vis={},b.exports=d},{"../package.json":210}],223:[function(a,b,c){var d=a("./core/log");b.exports=new d({tag:"cdb"})},{"./core/log":227}],224:[function(a,b,c){var d=a("./core/template-list");b.exports=new d},{"./core/template-list":233}],225:[function(a,b,c){var d=a("backbone"),e=d.Model.extend({VERSION:4,initialize:function(){},REPORT_ERROR_URL:"/api/v0/error",ERROR_TRACK_ENABLED:!1});b.exports=e},{backbone:"backbone"}],226:[function(a,b,c){var d=a("cdb"),e={queue:[],current:void 0,_script:null,head:null,loadScript:function(a){var b=document.createElement("script");return b.type="text/javascript",b.src=a,b.async=!0,e.head||(e.head=document.getElementsByTagName("head")[0]),setTimeout(function(){e.head.appendChild(b)},0),b},get:function(a,b){e._script?e.queue.push([a,b]):(e.current=b,e._script=e.loadScript(a+(~a.indexOf("?")?"&":"?")+"callback=vizjson"))},getPath:function(a){var b=document.getElementsByTagName("script"),c=/\/?cartodb[\-\._]?([\w\-\._]*)\.js\??/;for(i=0,len=b.length;i<len;i++){var d=b[i].src,e=d.match(c);if(e){var f=d.split("/");return delete f[f.length-1],f.join("/")+a}}return null},loadModule:function(a){var b="cartodb.mod."+a+(d.DEBUG?".uncompressed.js":".js"),c=this.getPath(b);if(!c)throw new Error("can't find cartodb.js file (no src path found for '"+b+"')");e.loadScript(c)}};window.vizjson=function(a){e.current&&e.current(a),e.head.removeChild(e._script),e._script=null;var b=e.queue.shift();b&&e.get(b[0],b[1])},b.exports=e},{cdb:222}],227:[function(a,b,c){var d,e=a("backbone"),f=a("../cdb"),g=a("../cdb.errors"),h=a("../cdb.config"),i=function(){};if(i.prototype.error=function(){},i.prototype.log=function(){},"undefined"!=typeof console){d=console;try{d.log.apply(d,["cartodb.js "+f.VERSION])}catch(j){d=new i}}else d=new i;var k=e.Model.extend({error:function(){d.error.apply(d,arguments),h.ERROR_TRACK_ENABLED&&g.create({msg:Array.prototype.slice.call(arguments).join("")})},log:function(){d.log.apply(d,arguments)},info:function(){d.log.apply(d,arguments)},debug:function(){f.DEBUG&&d.log.apply(d,arguments)}});b.exports=k},{"../cdb":222,"../cdb.config":220,"../cdb.errors":221,backbone:"backbone"}],228:[function(a,b,c){var d=a("backbone"),e=a("./error"),f=d.Collection.extend({model:e,enableTrack:function(){var a=this,b=window.onerror;window.onerror=function(c,d,e){a.create({msg:c,url:d,line:e}),b&&b.apply(window,arguments)}}});b.exports=f},{"./error":229,backbone:"backbone"}],229:[function(a,b,c){var d=a("backbone"),e=a("jquery"),f=a("../../cdb.config"),g=d.Model.extend({url:function(){return f.REPORT_ERROR_URL},initialize:function(){this.set({browser:JSON.stringify(e.browser)})}});b.exports=g},{"../../cdb.config":220,backbone:"backbone",jquery:"jquery"}],230:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=f.Model.extend({initialize:function(a){return e.bindAll(this,"fetch","save","retrigger"),f.Model.prototype.initialize.call(this,a)},fetch:function(a){var b=this;this.trigger("loadModelStarted"),d.when(f.Model.prototype.fetch.call(this,a)).done(function(a){b.trigger("loadModelCompleted",a)}).fail(function(a){b.trigger("loadModelFailed",a)})},setIdAttribute:function(a){this.idAttribute=a},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d)},save:function(a,b){var c=this;b&&b.silent||this.trigger("saving");var e=f.Model.prototype.save.apply(this,arguments);return d.when(e).done(function(){b&&b.silent||c.trigger("saved")}).fail(function(){b&&b.silent||c.trigger("errorSaving")}),e}});b.exports=g},{backbone:"backbone",jquery:"jquery",underscore:"underscore"}],231:[function(a,b,c){function d(){}function e(a){this.t0=null,this.name=a,this.count=0}var f=1024;d.metrics={},d._backend=null,d.get=function(a){return d.metrics[a]||{max:0,min:Number.MAX_VALUE,avg:0,total:0,count:0,last:0,history:"undefined"!=typeof Float32Array?new Float32Array(f):[]}},d.backend=function(a){d._backend=a},d.new_value=function(a,b,c,e){c=c||"i";var g=d.metrics[a]=d.get(a);if(g.max=Math.max(g.max,b),g.min=Math.min(g.min,b),g.total+=b,++g.count,g.avg=g.total/g.count,g.history[g.count%f]=b,e){var h=(new Date).getTime();h-g.last>1e3&&(d._backend&&d._backend([c,a,g.avg]),g.last=h)}else d._backend&&d._backend([c,a,b])},d.print_stats=function(){for(k in d.metrics){var a=d.metrics[k];console.log(" === "+k+" === "),console.log(" max: "+a.max),console.log(" min: "+a.min),console.log(" avg: "+a.avg),console.log(" count: "+a.count),console.log(" total: "+a.total)}},e.prototype={start:function(){return this.t0=+new Date,this},_elapsed:function(){return+new Date-this.t0},end:function(a){null!==this.t0&&(d.new_value(this.name,this._elapsed(),"t",a),this.t0=null)},inc:function(a){a=void 0===a?1:a,d.new_value(this.name,a,"i")},dec:function(a){a=void 0===a?1:a,d.new_value(this.name,a,"d")},mark:function(){if(++this.count,null===this.t0)return void this.start();var a=this._elapsed();a>1&&(d.new_value(this.name,this.count),this.count=0,this.start())}},d.metric=function(a){return new e(a)},b.exports=d},{}],232:[function(a,b,c){var d=a("html-css-sanitizer");d.html=function(a,b){return a?void 0===b?d.sanitize(a,function(a){return a}):"function"==typeof b?b(a):a:void 0},b.exports=d},{"html-css-sanitizer":430}],233:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("cdb.log"),g=a("./template"),h=e.Collection.extend({model:g,getTemplate:function(a){this.namespace&&(a=this.namespace+a);var b=this.find(function(b){return b.get("name")===a});return b?d.bind(b.render,b):(f.error(a+" not found"),null)}});b.exports=h},{"./template":234,backbone:"backbone","cdb.log":223,underscore:"underscore"}],234:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("mustache"),g=a("cdb.log"),h=e.Model.extend({initialize:function(){this.bind("change",this._invalidate),this._invalidate()},url:function(){return this.get("template_url")},parse:function(a){return{template:a}},_invalidate:function(){this.compiled=null,this.get("template_url")&&this.fetch()},compile:function(){var a=this.get("type")||"underscore",b=h.compilers[a];return b?b(this.get("template")):(g.error("can't get rendered for "+a),null)},render:function(a){var b=this.compiled=this.compiled||this.get("compiled")||this.compile(),c=b(a);return c},asFunction:function(){return d.bind(this.render,this)}},{compilers:{underscore:d.template,mustache:"undefined"==typeof f?null:function(a){return f.parse(a),function(b,c){return f.render(a,b,c)}}},compile:function(a,b){var c=new h({template:a,type:b||"underscore"});return d.bind(c.render,c)}});b.exports=h},{backbone:"backbone","cdb.log":223,mustache:209,underscore:"underscore"}],235:[function(a,b,c){var d={};d.isCORSSupported=function(){return"withCredentials"in new XMLHttpRequest},d.array2hex=function(a){for(var b=[],c=0;c<a.length;++c)b.push(String.fromCharCode(a[c]+128));return d.btoa(b.join(""))},d.btoa=function(a){return"function"==typeof window.btoa?d.encodeBase64Native(a):d.encodeBase64(a)},d.encodeBase64Native=function(a){return btoa(a)},d.encodeBase64=function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)},d.uniqueCallbackName=function(a){return d._callback_c=d._callback_c||0,++d._callback_c,d.crc32(a)+"_"+d._callback_c},d.crc32=function(a){for(var b=d._crcTable||(d._crcTable=d._makeCRCTable()),c=-1,e=0,f=a.length;f>e;++e)c=c>>>8^b[255&(c^a.charCodeAt(e))];return(-1^c)>>>0},d._makeCRCTable=function(){for(var a,b=[],c=0;256>c;++c){a=c;for(var d=0;8>d;++d)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b},d._inferBrowser=function(a){function b(){var b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return b>-1||c>-1?!0:!1}function c(){return document.compatMode?window.XMLHttpRequest?document.querySelector?document.addEventListener?window.atob?document.all?10:11:9:8:7:6:5}var d={};return a=a||"undefined"!=typeof window&&window.navigator.userAgent||"",b()?d.ie={version:c()}:a.indexOf("Edge/")>-1?d.edge=a:a.indexOf("Chrome")>-1?d.chrome=a:a.indexOf("Firefox")>-1?d.firefox=a:a.indexOf("Opera")>-1?d.opera=a:a.indexOf("Safari")>-1&&(d.safari=a),d},d.browser=d._inferBrowser(),d.isMobileDevice=function(){return/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},b.exports=d},{}],236:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("cdb.core.Profiler"),g=a("cdb.templates"),h=e.View.extend({classLabel:"cdb.core.View",constructor:function(a){this.options=d.defaults(a,this.options),this._models=[],this._subviews={},e.View.call(this,a),h.viewCount++,h.views[this.cid]=this,this._created_at=new Date,f.new_value("total_views",h.viewCount)},add_related_model:function(a){if(!a)throw"added non valid model";this._models.push(a)},addView:function(a){this._subviews[a.cid]=a,a._parent=this},removeView:function(a){delete this._subviews[a.cid]},clearSubViews:function(){d(this._subviews).each(function(a){a.clean()}),this._subviews={}},clean:function(){var a=this;return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.unbind(),this.model&&this.model.unbind&&this.model.unbind(null,null,this),d(this._models).each(function(b){b.unbind(null,null,a)}),this._models=[],h.viewCount--,delete h.views[this.cid],this},getTemplate:function(a){return this.options.template?d.template(this.options.template):g.getTemplate(a)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d),this.add_related_model(b)},killEvent:function(a){a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(a){return function(){return d.extend(a,this.constructor.__super__.events)}},runChecker:function(){d.each(h.views,function(a){d.each(a,function(b,c){"_parent"!==c&&a.hasOwnProperty(c)&&b instanceof h&&void 0===a._subviews[b.cid]&&(console.log("========="),console.log("untracked view: "),console.log(b.el),console.log("parent"),console.log(a.el),console.log(" "))})})}});b.exports=h},{backbone:"backbone","cdb.core.Profiler":231,"cdb.templates":224,underscore:"underscore"}],237:[function(a,b,c){var d=a("underscore"),e=a("./dataview-model-base"),f=a("./category-dataview/search-model"),g=a("./category-dataview/category-model-range"),h=a("./category-dataview/categories-collection");b.exports=e.extend({defaults:d.extend({type:"category",filterEnabled:!1,allCategoryNames:[]},e.prototype.defaults),_getDataviewSpecificURLParams:function(){var a=["own_filter="+(this.get("filterEnabled")?1:0)];return a},initialize:function(a,b){e.prototype.initialize.call(this,a,b),this._rangeModel=new g({apiKey:this.get("apiKey"),authToken:this.get("authToken")}),this._data=new h,this._searchModel=new f({apiKey:this.get("apiKey"),authToken:this.get("authToken")}),this.on("change:column change:aggregation change:aggregation_column",this._reloadVisAndForceFetch,this),this.bind("change:url",function(){this._searchModel.set({url:this.get("url")})},this),this.once("change:url",function(){this._rangeModel.setUrl(this.get("url"))},this),this._rangeModel.bind("change:totalCount change:categoriesCount",function(){this.set({totalCount:this._rangeModel.get("totalCount"),categoriesCount:this._rangeModel.get("categoriesCount")})},this),this._bindSearchModelEvents(),a&&a.acceptedCategories&&this.filter.accept(a.acceptedCategories)},_onMapBoundsChanged:function(){e.prototype._onMapBoundsChanged.apply(this,arguments),this._searchModel.fetchIfSearchIsApplied()},_bindSearchModelEvents:function(){this._searchModel.bind("loading",function(){this.trigger("loading",this)},this),this._searchModel.bind("loaded",function(){this.trigger("loaded",this)},this),this._searchModel.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this.trigger("error",this)},this),this._searchModel.bind("change:data",this._onSearchDataChange,this)},_onSearchDataChange:function(){this.getSearchResult().each(function(a){var b=this.filter.isAccepted(a.get("name"));a.set("selected",b)},this),this.trigger("change:searchData",this)},_shouldFetchOnBoundingBoxChange:function(){return e.prototype._shouldFetchOnBoundingBoxChange.call(this)&&!this.isSearchApplied()},enableFilter:function(){this.set("filterEnabled",!0)},disableFilter:function(){this.set("filterEnabled",!1)},getSearchQuery:function(){return this._searchModel.getSearchQuery()},setSearchQuery:function(a){this._searchModel.set("q",a)},isSearchValid:function(){return this._searchModel.isValid()},getSearchResult:function(){return this._searchModel.getData()},getSearchCount:function(){return this._searchModel.getCount()},applySearch:function(){this._searchModel.fetch()},isSearchApplied:function(){return this._searchModel.isSearchApplied()},cleanSearch:function(){this._searchModel.resetData()},setupSearch:function(){this.isSearchApplied()||this._searchModel.setData(this._data.toJSON())},getData:function(){return this._data},getSize:function(){return this._data.size()},getCount:function(){return this.get("categoriesCount")},isOtherAvailable:function(){return this._data.isOtherAvailable()},numberOfAcceptedCategories:function(){var a=this.filter.acceptedCategories,b=this.numberOfRejectedCategories(),c=this.getData(),d=c.size(),e=c.reduce(function(b,c){var d=a.where({name:c.get("name")}).length>0;return b+(d?1:0)},0);return b?d-b:e},numberOfRejectedCategories:function(){var a=this.filter.rejectedCategories,b=this.getData();return b.reduce(function(b,c){var d=a.where({name:c.get("name")}).length>0;return b+(d?1:0)},0)},refresh:function(){this.isSearchApplied()?this._searchModel.fetch():this.fetch()},parse:function(a){var b=[],c={},e=a.categories,f=[],g=[];return d.each(e,function(a){var d=String(a.category);f.push(d);var e=this.filter.isRejected(d);c[d]=!0,b.push({selected:!e,name:d,agg:a.agg,value:a.value})},this),this.get("filterEnabled")&&this.filter.acceptedCategories.each(function(a){var d=a.get("name");g.push(d),c[d]||b.push({selected:!0,name:d,agg:!1,value:0})},this),this._data.reset(b),{allCategoryNames:d.chain(f).union(g).unique().value(),data:b,nulls:a.nulls,min:a.min,max:a.max,count:a.count}},toJSON:function(){return{type:"aggregation",source:{id:this.getSourceId()},options:{column:this.get("column"),aggregation:this.get("aggregation"),aggregationColumn:this.get("aggregation_column")}}}},{ATTRS_NAMES:e.ATTRS_NAMES.concat(["column","aggregation","aggregation_column","acceptedCategories"])})},{"./category-dataview/categories-collection":238,"./category-dataview/category-model-range":240,"./category-dataview/search-model":241,"./dataview-model-base":242,underscore:"underscore"}],238:[function(a,b,c){var d=a("backbone"),e=a("./category-item-model");b.exports=d.Collection.extend({model:e,comparator:function(a,b){return"Other"===a.get("name")?1:"Other"===b.get("name")?-1:a.get("value")===b.get("value")?a.get("selected")<b.get("selected")?1:-1:a.get("value")<b.get("value")?1:-1},isOtherAvailable:function(){
return this.where({agg:!0,name:"Other"}).length>0}})},{"./category-item-model":239,backbone:"backbone"}],239:[function(a,b,c){var d=a("../../core/model");b.exports=d.extend({defaults:{name:"",agg:!1,value:0}})},{"../../core/model":230}],240:[function(a,b,c){var d=a("underscore"),e=a("../../core/model");b.exports=e.extend({defaults:{url:"",totalCount:0,categoriesCount:0},url:function(){var a=this.get("url"),b=[];if(this.get("apiKey"))a+="?api_key="+this.get("apiKey");else if(this.get("authToken")){var c=this.get("authToken");c instanceof Array?d.each(c,function(a){b.push("auth_token[]="+a)}):b.push("auth_token="+c),a+="?"+b.join("&")}return a},initialize:function(){this.bind("change:url",function(){this.fetch()},this)},setUrl:function(a){this.set("url",a)},parse:function(a){return{categoriesCount:a.categoriesCount,totalCount:d.reduce(d.pluck(a.categories,"value"),function(a,b){return a+b},0)}}})},{"../../core/model":230,underscore:"underscore"}],241:[function(a,b,c){var d=a("underscore"),e=a("../../core/model"),f=a("../../util/backbone-abort-sync"),g=a("./categories-collection");b.exports=e.extend({defaults:{q:"",data:[],url:""},url:function(){var a=this.get("url")+"/search?q="+encodeURIComponent(this.get("q"));if(this.get("apiKey"))a+="&api_key="+this.get("apiKey");else if(this.get("authToken")){var b=this.get("authToken");b instanceof Array?d.each(b,function(b){a+="&auth_token[]="+b}):a+="&auth_token="+b}return a},initialize:function(a,b){this._data=new g,this.sync=f.bind(this)},fetchIfSearchIsApplied:function(){this.isSearchApplied()&&this.fetch()},setData:function(a){var b=this._parseData(a);this._data.reset(b),this.set("data",b)},getData:function(){return this._data},getSize:function(){return this._data.size()},getCount:function(){return this.getSize()},isValid:function(){var a=this.get("q");return!!a},resetData:function(){this.setData([]),this.set("q","")},getSearchQuery:function(){return this.get("q")},isSearchApplied:function(){return this.isValid()&&this.getSize()>0},_parseData:function(a){var b=[];return d.each(a,function(a){a.agg||b.push({selected:!1,name:(a.category||a.name).toString(),agg:a.agg,value:a.value})},this),b},parse:function(a){var b=this._parseData(a.categories);return this._data.reset(b),{data:b}},fetch:function(a){if(a=a||{},this.trigger("loading",this),a.success)var b=a&&a.success;return e.prototype.fetch.call(this,d.extend(a,{success:function(){b&&b(arguments),this.trigger("loaded",this)}.bind(this),error:function(a,b){(!b||b&&"abort"!==b.statusText)&&this.trigger("error",a,b)}.bind(this)}))}})},{"../../core/model":230,"../../util/backbone-abort-sync":394,"./categories-collection":238,underscore:"underscore"}],242:[function(a,b,c){var d=a("underscore"),e=a("../core/model"),f=a("../util/backbone-abort-sync"),g=a("../windshaft/filters/bounding-box"),h=500,i="unfeteched",j="fetching",k="fetched",l="error";b.exports=e.extend({defaults:{url:"",data:[],sync_on_data_change:!0,sync_on_bbox_change:!0,enabled:!0,status:i},url:function(){var a=d.union([this._getBoundingBoxFilterParam()],this._getDataviewSpecificURLParams());if(this.get("apiKey"))a.push("api_key="+this.get("apiKey"));else if(this.get("authToken")){var b=this.get("authToken");b instanceof Array?d.each(b,function(b){a.push("auth_token[]="+b)}):a.push("auth_token="+b)}return this.get("url")+"?"+a.join("&")},_getBoundingBoxFilterParam:function(){var a,b="";return this.get("sync_on_bbox_change")&&(a=new g(this._map.getViewBounds()),b="bbox="+a.toString()),b},_getDataviewSpecificURLParams:function(){return[]},initialize:function(a,b){if(a=a||{},b=b||{},!b.map)throw new Error("map is required");if(!b.vis)throw new Error("vis is required");if(!b.analysisCollection)throw new Error("analysisCollection is required");if(!a.source)throw new Error("source is a required attr");a.id||this.set("id",this.defaults.type+"-"+this.cid),this.layer=b.layer,this._map=b.map,this._vis=b.vis,this._analysisCollection=b.analysisCollection,this.sync=f.bind(this),this.filter=b.filter,this.filter&&this.filter.set("dataviewId",this.id),this._initBinds(),this._setupAnalysisStatusEvents()},_getLayerDataProvider:function(){return this.layer.getDataProvider()},_initBinds:function(){this.listenTo(this.layer,"change:visible",this._onLayerVisibilityChanged),this.listenTo(this.layer,"change:source",this._setupAnalysisStatusEvents),this.on("change:source",this._setupAnalysisStatusEvents,this);var a=this._getLayerDataProvider();a?(this.listenToOnce(a,"dataChanged",this._onChangeBinds,this),this.listenTo(a,"dataChanged",this.fetch)):this.listenToOnce(this,"change:url",function(){this.fetch({success:this._onChangeBinds.bind(this)})}),this.filter&&this.listenTo(this.filter,"change",this._onFilterChanged)},_setupAnalysisStatusEvents:function(){this._removeExistingAnalysisBindings(),this._analysis=this._analysisCollection.get(this.getSourceId()),this._analysis&&this._analysis.on("change:status",this._onAnalysisStatusChange,this)},_removeExistingAnalysisBindings:function(){this._analysis&&this._analysis.off("change:status",this._onAnalysisStatusChange,this)},_onAnalysisStatusChange:function(a,b){a.isLoading()?this._triggerLoading():a.isFailed()&&this._triggerError(a.get("error"))},_triggerLoading:function(){this.trigger("loading",this)},_triggerError:function(a){this.trigger("error",this,a)},_onFilterChanged:function(a){var b=this._getLayerDataProvider();b&&b.canApplyFilterTo(this)?b.applyFilter(this,a):this._reloadVis()},_reloadVis:function(a){a=a||{},this._vis.reload(d.extend(a,{sourceId:this.getSourceId()}))},_reloadVisAndForceFetch:function(){this._reloadVis({forceFetch:!0})},_onLayerVisibilityChanged:function(a,b){this.set({enabled:b})},_onChangeBinds:function(){this.on("change:sync_on_bbox_change",function(){this.refresh()},this),this.listenTo(this._map,"change:center change:zoom",d.debounce(this._onMapBoundsChanged.bind(this),h)),this.on("change:url",function(a,b,c){this.get("sync_on_data_change")&&(this._newDataAvailable=!0),this._shouldFetchOnURLChange(c&&d.pick(c,["forceFetch","sourceId"]))&&this.fetch()},this),this.on("change:enabled",function(a,b){b&&this._newDataAvailable&&(this.fetch(),this._newDataAvailable=!1)},this)},_onMapBoundsChanged:function(){this._shouldFetchOnBoundingBoxChange()&&this.fetch(),this.get("sync_on_bbox_change")&&(this._newDataAvailable=!0)},_shouldFetchOnURLChange:function(a){a=a||{};var b=a.sourceId,c=a.forceFetch;return c?!0:this.get("sync_on_data_change")&&this.get("enabled")&&(!b||b&&this._sourceAffectsMyOwnSource(b))},_sourceAffectsMyOwnSource:function(a){var b=this._analysisCollection.get(this.getSourceId());return b&&b.findAnalysisById(a)},_shouldFetchOnBoundingBoxChange:function(){return this.get("enabled")&&this.get("sync_on_bbox_change")},refresh:function(){this.fetch()},update:function(a){a=d.pick(a,this.constructor.ATTRS_NAMES),this.set(a)},getData:function(){return this.get("data")},getPreviousData:function(){return this.previous("data")},fetch:function(a){a=a||{},this.set("status",j);var b=this._getLayerDataProvider();if(!b||!b.canProvideDataFor(this)){if(this._triggerLoading(),a.success)var c=a&&a.success;return e.prototype.fetch.call(this,d.extend(a,{success:function(){this.set("status",k),c&&c(arguments),this.trigger("loaded",this)}.bind(this),error:function(a,b){this.set("status",l),(!b||b&&"abort"!==b.statusText)&&this._triggerError(b)}.bind(this)}))}this.set(this.parse(b.getDataFor(this)))},toJSON:function(){throw new Error("toJSON should be defined for each dataview")},hasSameSourceAsLayer:function(){return this.getSourceId()===this.layer.get("source")},getSourceId:function(){return this.hasLayerAsSource()&&this.layer.has("source")?this.layer.get("source"):this._ownSourceId()},_ownSourceId:function(){return this.has("source")&&this.get("source").id},hasLayerAsSource:function(){return this._ownSourceId()===this.layer.id},isFiltered:function(){var a=!1;return this.filter&&(a=!this.filter.isEmpty()),a},remove:function(){this._removeExistingAnalysisBindings(),this.trigger("destroy",this),this.stopListening()},isFetched:function(){return this.get("status")===k},isUnavailable:function(){return this.get("status")===l}},{ATTRS_NAMES:["id","sync_on_data_change","sync_on_bbox_change","enabled","source"]})},{"../core/model":230,"../util/backbone-abort-sync":394,"../windshaft/filters/bounding-box":422,underscore:"underscore"}],243:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=e.Collection.extend({isAnalysisLinkedToDataview:function(a){return this.any(function(b){var c=b.getSourceId();return a.get("id")===c})},isAnyDataviewFiltered:function(){return this.any(function(a){var b=a.filter;return b&&!b.isEmpty()})},getFilters:function(){return this.reduce(function(a,b){var c=b.filter;return c&&!c.isEmpty()&&(a.dataviews=a.dataviews||{},d.extend(a.dataviews,c.toJSON())),a},{})}});b.exports=f},{backbone:"backbone",underscore:"underscore"}],244:[function(a,b,c){function d(a,b){e.each(b,function(b){if(void 0===a[b])throw new Error(b+" is required")})}var e=a("underscore"),f=a("../core/model"),g=a("../windshaft/filters/category"),h=a("../windshaft/filters/range"),i=a("./category-dataview-model"),j=a("./formula-dataview-model"),k=a("./histogram-dataview-model"),l=a("./list-dataview-model");b.exports=f.extend({initialize:function(a,b){if(!b.map)throw new Error("map is required");if(!b.vis)throw new Error("vis is required");if(!b.analysisCollection)throw new Error("analysisCollection is required");if(!b.dataviewsCollection)throw new Error("dataviewsCollection is required");if(!b.analysisCollection)throw new Error("analysisCollection is required");this._map=b.map,this._vis=b.vis,this._analysisCollection=b.analysisCollection,this._dataviewsCollection=b.dataviewsCollection,this._analysisCollection=b.analysisCollection},createCategoryModel:function(a,b){d(b,["column"]),b=this._generateAttrsForDataview(a,b,i.ATTRS_NAMES),b.aggregation=b.aggregation||"count",b.aggregation_column=b.aggregation_column||b.column;var c=new g({layer:a});return this._newModel(new i(b,{map:this._map,vis:this._vis,layer:a,filter:c,analysisCollection:this._analysisCollection}))},createFormulaModel:function(a,b){return d(b,["column","operation"]),b=this._generateAttrsForDataview(a,b,j.ATTRS_NAMES),this._newModel(new j(b,{map:this._map,vis:this._vis,layer:a,analysisCollection:this._analysisCollection}))},createHistogramModel:function(a,b){d(b,["column"]),b=this._generateAttrsForDataview(a,b,k.ATTRS_NAMES);var c=new h({layer:a});return this._newModel(new k(b,{map:this._map,vis:this._vis,layer:a,filter:c,analysisCollection:this._analysisCollection}))},createListModel:function(a,b){return d(b,["columns"]),b=this._generateAttrsForDataview(a,b,l.ATTRS_NAMES),this._newModel(new l(b,{map:this._map,vis:this._vis,layer:a,analysisCollection:this._analysisCollection}))},_generateAttrsForDataview:function(a,b,c){return b=e.pick(b,c),b.source=b.source||{id:a.id},this.get("apiKey")&&(b.apiKey=this.get("apiKey")),this.get("authToken")&&(b.authToken=this.get("authToken")),b},_newModel:function(a){return this._dataviewsCollection.add(a),a}})},{"../core/model":230,"../windshaft/filters/category":423,"../windshaft/filters/range":424,"./category-dataview-model":237,"./formula-dataview-model":245,"./histogram-dataview-model":246,"./list-dataview-model":248,underscore:"underscore"}],245:[function(a,b,c){var d=a("underscore"),e=a("./dataview-model-base");b.exports=e.extend({defaults:d.extend({type:"formula",data:""},e.prototype.defaults),initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("change:column change:operation",this._reloadVisAndForceFetch,this)},parse:function(a){return{data:a.result,nulls:a.nulls}},toJSON:function(){return{type:"formula",source:{id:this.getSourceId()},options:{column:this.get("column"),operation:this.get("operation")}}}},{ATTRS_NAMES:e.ATTRS_NAMES.concat(["column","operation"])})},{"./dataview-model-base":242,underscore:"underscore"}],246:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./dataview-model-base"),g=a("./histogram-dataview/histogram-data-model"),h=a("d3");b.exports=f.extend({defaults:d.extend({type:"histogram",bins:10},f.prototype.defaults),_getDataviewSpecificURLParams:function(){var a=[];return this.get("column_type")&&a.push("column_type="+this.get("column_type")),d.isNumber(this.get("own_filter"))?a.push("own_filter="+this.get("own_filter")):(d.isNumber(this.get("start"))&&a.push("start="+this.get("start")),d.isNumber(this.get("end"))&&a.push("end="+this.get("end")),d.isNumber(parseInt(this.get("bins"),10))&&a.push("bins="+this.get("bins"))),a},initialize:function(a,b){f.prototype.initialize.apply(this,arguments),this._data=new e.Collection(this.get("data")),this._unfilteredData=new g({bins:this.get("bins"),apiKey:this.get("apiKey"),authToken:this.get("authToken")}),this._unfilteredData.bind("change:data",function(a,b){this.set({start:a.get("start"),end:a.get("end"),bins:a.get("bins")},{silent:!0}),this._onChangeBinds()},this),this.once("change:url",function(){this._unfilteredData.setUrl(this.get("url"))},this),this.listenTo(this.layer,"change:meta",this._onChangeLayerMeta),this.on("change:column",this._reloadVisAndForceFetch,this),this.on("change:bins change:start change:end",this._fetchAndResetFilter,this),a&&(a.min||a.max)&&this.filter.setRange(this.get("min"),this.get("max"))},_initBinds:function(){f.prototype._initBinds.apply(this),this.stopListening(this,"change:url",null)},enableFilter:function(){this.set("own_filter",1)},disableFilter:function(){this.unset("own_filter")},getData:function(){return this._data.toJSON()},getUnfilteredDataModel:function(){return this._unfilteredData},getSize:function(){return this._data.size()},parse:function(a){var b=a.bins_count,c=a.bin_width,e=a.bins_start,f=new Array(b);d.each(a.bins,function(a){f[a.bin]=a});for(var g=0;b>g;g++)f[g]=d.extend({bin:g,start:e+g*c,end:e+(g+1)*c,freq:0},f[g]);var h=f[b-1];return h&&h.end<h.max&&(h.end=h.max),this._data.reset(f),{data:f,nulls:a.nulls}},getDistributionType:function(a){var b=a||this.get("data"),c=function(a){return a.freq},e=h.max(b,c)-h.min(b,c),f=h.mean(b,c);if(.1*f>e)return"F";var g=h.sum(b,c),i=b.map(function(a){return 100*a.freq/g}),j=i.map(function(a,b){var c=i[b+1];return a>c?-1:Math.abs(a-c)<=.05?0:1});j.pop();var k=h.max(j),l=h.min(j);if(0===l&&0===k)return"F";if(1>k)return"L";if(l>-1)return"J";var m=d.uniq(j),n=[[1,-1],[1,0,-1],[1,-1,0],[0,1,-1]],o=[[-1,1],[-1,0,1],[-1,1,0],[0,-1,1]];return n.some(function(a){return d.isEqual(a,m)})?"A":o.some(function(a){return d.isEqual(a,m)})?"U":"S"},toJSON:function(a){return{type:"histogram",source:{id:this.getSourceId()},options:{column:this.get("column"),bins:this.get("bins")}}},_onChangeLayerMeta:function(){this.filter.set("column_type",this.layer.get("meta").column_type)},_onChangeBinds:function(){f.prototype._onChangeBinds.call(this)},_fetchAndResetFilter:function(){this.fetch(),this.disableFilter(),this.filter.unsetRange()}},{ATTRS_NAMES:f.ATTRS_NAMES.concat(["column","column_type","bins","min","max"])})},{"./dataview-model-base":242,"./histogram-dataview/histogram-data-model":247,backbone:"backbone",d3:207,underscore:"underscore"}],247:[function(a,b,c){var d=a("underscore"),e=a("../../core/model");b.exports=e.extend({defaults:{url:"",data:[]},url:function(){var a=["bins="+this.get("bins")];if(this.get("apiKey"))a.push("api_key="+this.get("apiKey"));else if(this.get("authToken")){var b=this.get("authToken");b instanceof Array?d.each(b,function(b){a.push("auth_token[]="+b)}):a.push("auth_token="+b)}return this.get("url")+"?"+a.join("&")},initialize:function(){this.bind("change:url change:bins",function(){this.fetch()},this)},setUrl:function(a){if(!a)throw new Error("url not specified");this.set("url",a)},setBins:function(a){if(!a)throw new Error("bins not specified");this.set("bins",a)},getData:function(){return this.get("data")},parse:function(a){var b=a.bins_count,c=a.bin_width,e=a.bins_start,f=new Array(b);d.each(a.bins,function(a){f[a.bin]=a});for(var g=0;b>g;g++)f[g]=d.extend({bin:g,start:e+g*c,end:e+(g+1)*c,freq:0},f[g]);return{data:f,start:f[0].start,end:f[f.length-1].end,bins:b}}})},{"../../core/model":230,underscore:"underscore"}],248:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./dataview-model-base");b.exports=f.extend({defaults:d.extend({type:"list",columns:[]},f.prototype.defaults),initialize:function(a,b){f.prototype.initialize.call(this,a,b),this._data=new e.Collection(this.get("data")),this.on("change:columns",this._reloadVisAndForceFetch,this)},getData:function(){return this._data},getSize:function(){return this._data.size()},parse:function(a){var b=a.rows;return this._data.reset(b),{data:b}},toJSON:function(){return{type:"list",source:{id:this.getSourceId()},options:{columns:this.get("columns")}}}},{ATTRS_NAMES:f.ATTRS_NAMES.concat(["columns"])})},{"./dataview-model-base":242,backbone:"backbone",underscore:"underscore"}],249:[function(a,b,c){function d(a){a.on("change:urls",this._reload,this),a.onLayerVisibilityChanged(this._reload.bind(this))}d.prototype={_reload:function(){throw new Error("_reload must be implemented")},_reloadInteraction:function(){this._clearInteraction(),this.model.each(function(a,b){a.isVisible()&&this._enableInteraction(b)},this)},_clearInteraction:function(){for(var a in this.interaction)this.interaction.hasOwnProperty(a)&&this.interaction[a]&&(this.interaction[a].remove(),this.interaction[a]=null)},_enableInteraction:function(a){var b=this,c=this._generateTileJSON(a);if(c){var d=this.interaction[a];d&&d.remove(),this.interaction[a]=this.interactionClass().map(this.options.map).tilejson(c).on("on",function(c){b._interactionDisabled||(c.layer=a,b._manageOnEvents(b.options.map,c))}).on("off",function(c){b._interactionDisabled||(c=c||{},c.layer=a,b._manageOffEvents(b.options.map,c))})}},_generateTileJSON:function(a){return this.model.hasURLs()?{tilejson:"2.0.0",scheme:"xyz",grids:this.model.getGridURLTemplates(a),tiles:this.model.getTileURLTemplates(),formatter:function(a,b){return b}}:void 0},error:function(a){},tilesOk:function(){}},b.exports=d},{}],250:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone"),g=a("../core/util"),h=f.Model.extend({defaults:{visible:!0,type:"layergroup"},initialize:function(a,b){if(b=b||{},!b.layersCollection)throw new Error("layersCollection option is required");this._layersCollection=b.layersCollection},contains:function(a){return this.getIndexOf(a)>=0},each:function(a,b){d.each(this.getLayers(),a.bind(b||this))},getLayers:function(){return this._layersCollection.getCartoDBLayers()},getIndexOf:function(a){return this.getLayers().indexOf(a)},getLayerAt:function(a){return this.getLayers()[a]},isEqual:function(){return!1},hasURLs:function(){return!!this.get("urls")},getTileURLTemplates:function(){if(this._areAllLayersHidden())return[];var a=this.get("urls")&&this.get("urls").tiles||[];return d.chain(a).map(this._replaceLayerIndexesOfVisibleLayers.bind(this)).map(this._appendAuthParamsToURL.bind(this)).value()},_areAllLayersHidden:function(){return d.all(this.getLayers(),function(a){return!a.isVisible()})},_replaceLayerIndexesOfVisibleLayers:function(a){var b=d.reduce(this.getLayers(),function(a,b,c){return b.isVisible()&&a.push(this.get("indexOfLayersInWindshaft")[c]),a}.bind(this),[]);return a.replace("{layerIndexes}",b.join(","))},hasTileURLTemplates:function(){return this.getTileURLTemplates().length>0},getGridURLTemplates:function(a){var b=this.get("urls")&&this.get("urls").grids&&this.get("urls").grids[a]||[];return d.map(b,this._appendAuthParamsToURL,this)},getAttributesBaseURL:function(a){return this.get("urls")&&this.get("urls").attributes&&this.get("urls").attributes[a]},fetchAttributes:function(a,b,c){var d=this.getAttributesBaseURL(a);if(!d)throw new Error("Attributes cannot be fetched until urls are set");var f=this._appendAuthParamsToURL(d+"/"+b);e.ajax({dataType:"jsonp",url:f,jsonpCallback:"_cdbi_layer_attributes_"+g.uniqueCallbackName(this.toJSON()),cache:!0,success:function(a){c(a)},error:function(a){c(null)}})},_appendAuthParamsToURL:function(a){var b=[];if(this.get("apiKey"))b.push("api_key="+this.get("apiKey"));else if(this.get("authToken")){var c=this.get("authToken");c instanceof Array?d.each(c,function(a){b.push("auth_token[]="+a)}):b.push("auth_token="+c)}return this._appendParamsToURL(a,b)},_appendParamsToURL:function(a,b){return b.length?a+"?"+b.join("&"):a},onLayerVisibilityChanged:function(a){this._layersCollection.on("change:visible",function(b){this.contains(b)&&a(b)},this)},onLayerAdded:function(a){this._layersCollection.on("add",function(b){this.contains(b)&&a(b,this.getIndexOf(b))},this)}});b.exports=h},{"../core/util":235,backbone:"backbone",jquery:"jquery",underscore:"underscore"}],251:[function(a,b,c){var d=a("underscore"),e=a("./dataview-data-provider-base"),f=function(a,b){e.apply(this,arguments)};d.extend(f.prototype,e.prototype),f.prototype.getData=function(){var a,b=this._dataview.attributes,c=b.column,e=b.filterEnabled,f=5,g=this._vectorLayerView.getFilter(this._layerIndex);a=e?g.getValues():g.getValues(!1,c);var h={categories:[],categoriesCount:0,count:0,max:0,min:0,nulls:0,type:"aggregation"};if(!a.length)return h;var i=d.groupBy(a,function(a){return a.properties[c]}),j=d.map(Object.keys(i),function(a){return{key:a,value:i[a].length}}),k=d.sortBy(j,function(a){return a.value}).reverse();h.count=a.length,h.categoriesCount=k.length,h.max=k[0].value,h.min=k[k.length-1].value,h.nulls=g.getValues(!1,c).reduce(function(a,b){return a+(null===b.properties[c]?1:0)},0),d.each(k.slice(0,f),function(a){h.categories.push({category:a.key,value:a.value,agg:!1})});var l=k.slice(f);if(!e&&l.length>0){var m={category:"Other",value:l.reduce(function(a,b){return a+b.value},0),agg:!0};h.categories.push(m)}return h},f.prototype.applyFilter=function(a){var b,c,d=this._dataview.get("column");a.isEmpty()?(b="accept",c={column:d,values:"all"}):a.get("rejectAll")?(b="reject",c={column:d,values:"all"}):a.acceptedCategories.size()?(b="accept",c={column:d,values:a.getAcceptedCategoryNames()}):a.rejectedCategories.size()&&(b="reject",c={column:d,values:a.getRejectedCategoryNames()}),this._vectorLayerView.applyFilter(this._layerIndex,b,c)},b.exports=f},{"./dataview-data-provider-base":253,underscore:"underscore"}],252:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./dataview-data-provider-factory"),g=function(a,b){this._vectorLayerView=a,this._layerIndex=b,this._dataProviderFactory=new f(a,b),this._vectorLayerView._on("featuresChanged",function(){this.trigger("dataChanged")}.bind(this))};g.prototype.canProvideDataFor=function(a){return a.hasSameSourceAsLayer()},g.prototype.getDataFor=function(a){if(!this.canProvideDataFor(a))throw new Error("Data provider couldn't get data for dataview");var b=this._createDataProviderForDataview(a);return b.getData()},g.prototype.canApplyFilterTo=function(a){return a.hasSameSourceAsLayer()},g.prototype.applyFilter=function(a,b){if(!this.canApplyFilterTo(a))throw new Error("Data provider couldn't apply filter to dataview");var c=this._createDataProviderForDataview(a);return c.applyFilter(b)},g.prototype._createDataProviderForDataview=function(a){return this._dataProviderFactory.createDataProviderForDataview(a)},d.extend(g.prototype,e.Events),b.exports=g},{"./dataview-data-provider-factory":254,backbone:"backbone",underscore:"underscore"}],253:[function(a,b,c){var d=function(a){this._dataview=a.dataview,this._vectorLayerView=a.vectorLayerView,this._layerIndex=a.layerIndex};d.prototype.getData=function(){throw new Error("Subclasses of DataviewDataProviderBase must implement .getData")},d.prototype.applyFilter=function(){throw new Error("Subclasses of DataviewDataProviderBase must implement .applyFilter")},b.exports=d},{}],254:[function(a,b,c){var d=a("./histogram-dataview-data-provider"),e=a("./category-dataview-data-provider"),f=a("./formula-dataview-data-provider"),g=a("./list-dataview-data-provider"),h=function(a,b){this._vectorLayerView=a,this._layerIndex=b};h.prototype._dataProviderMap={histogram:d,category:e,formula:f,list:g},h.prototype.createDataProviderForDataview=function(a){var b={dataview:a,vectorLayerView:this._vectorLayerView,layerIndex:this._layerIndex},c=this._dataProviderMap[a.get("type")];if(c)return new c(b);throw new Error("Couldn't create data provider for dataview of type "+a.get("type"))},b.exports=h},{"./category-dataview-data-provider":251,"./formula-dataview-data-provider":255,"./histogram-dataview-data-provider":256,"./list-dataview-data-provider":257}],255:[function(a,b,c){var d=a("underscore"),e=a("./dataview-data-provider-base"),f=function(a,b){e.apply(this,arguments)};d.extend(f.prototype,e.prototype),f.prototype.getData=function(){var a,b=this._vectorLayerView.getFilter(this._layerIndex),c=this._dataview.attributes,d=b.getValues(),e=c.operation,f=c.column,g=d.reduce(function(a,b){return a+(null===b.properties[f]?1:0)},0);if("count"===e)a=d.length;else if("avg"===e)a=d.reduce(function(a,b){return a+b.properties[f]},0)/d.length;else if("sum"===e)a=d.reduce(function(a,b){return a+b.properties[f]},0);else if("min"===e)a=d.reduce(function(a,b){return Math.min(a,b.properties[f])},1/0);else{if("max"!==e)throw new Error("Coudn't generate data for formula dataview and '"+e+"' operation.");a=d.reduce(function(a,b){return Math.max(a,b.properties[f])},0)}var h={operation:e,result:a,nulls:g,type:"formula"};return h},f.prototype.applyFilter=function(a){},b.exports=f},{"./dataview-data-provider-base":253,underscore:"underscore"}],256:[function(a,b,c){var d=a("d3"),e=a("underscore"),f=a("./dataview-data-provider-base"),g=function(a,b){f.apply(this,arguments)};e.extend(g.prototype,f.prototype),g.prototype.getData=function(){var a,b,c,e,f,g=this._dataview.attributes,h=this._vectorLayerView.getFilter(this._layerIndex),i=g.column,j=g.bins||g.data.length;1===g.own_filter?(a=h.getMax(i),b=h.getMin(i),f=h.getValues(),c=d.layout.histogram().range([b,a])(f.map(function(a){return a.properties[g.column]})),e=(a-b)/c.length):(a=g.end||h.getMax(i),b="number"==typeof g.start?g.start:h.getMin(i),e=(a-b)/g.bins,f=h.getValues(!1,i),c=d.layout.histogram().range([b,a]).bins(j)(f.map(function(a){return a.properties[g.column]}))),c=c.map(function(a,b){return{bin:b,max:d.max(a),min:d.min(a),avg:d.mean(a),freq:a.length}});var k=f.reduce(function(a,b){return a+(null===b.properties[i]?1:0)},0),l=c.reduce(function(a,b){return a+b.avg},0)/c.reduce(function(a,b){return a+b.freq},0),m={bin_width:e,bins_count:c.length,bins_start:b,nulls:k,avg:l,bins:c,type:"histogram"};return m},g.prototype.applyFilter=function(a){var b,c=this._dataview.get("column");b=a.isEmpty()?{column:c,min:0,max:1/0}:{column:c,min:a.get("min"),max:a.get("max")},this._vectorLayerView.applyFilter(this._layerIndex,"range",b)},b.exports=g},{"./dataview-data-provider-base":253,d3:207,underscore:"underscore"}],257:[function(a,b,c){var d=a("underscore"),e=a("./dataview-data-provider-base"),f=function(a,b){e.apply(this,arguments)};d.extend(f.prototype,e.prototype),f.prototype.getData=function(){},f.prototype.applyFilter=function(a){},b.exports=f},{"./dataview-data-provider-base":253,underscore:"underscore"}],258:[function(a,b,c){var d=a("jquery"),e={keys:{app_id:"search-DH1Lkhw"},geocode:function(a,b){a=a.toLowerCase().replace(/é/g,"e").replace(/á/g,"a").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u");var c="";-1===window.location.protocol.indexOf("http")&&(c="http:"),d.getJSON(c+"//search.mapzen.com/v1/search?text="+encodeURIComponent(a)+"&api_key="+this.keys.app_id,function(a){var c=[];if(a&&a.features&&a.features.length>0){var d=a.features;for(var e in d){var f,g=d[e];f={lat:g.geometry.coordinates[1],lon:g.geometry.coordinates[0]},g.properties.layer&&(f.type=g.properties.layer),g.properties.label&&(f.title=g.properties.label),c.push(f)}}b&&b.call(this,c)})}};b.exports=e},{jquery:"jquery"}],259:[function(a,b,c){var d=a("jquery"),e={keys:{app_id:"KuYppsdXZznpffJsKT24",app_code:"A7tBPacePg9Mj_zghvKt9Q"},geocode:function(a,b){a=a.toLowerCase().replace(/é/g,"e").replace(/á/g,"a").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u");var c="";-1===location.protocol.indexOf("http")&&(c="http:"),d.getJSON(c+"//places.nlp.nokia.com/places/v1/discover/search/?q="+encodeURIComponent(a)+"&app_id="+this.keys.app_id+"&app_code="+this.keys.app_code+"&Accept-Language=en-US&at=0,0&callback=?",function(a){var c=[];if(a&&a.results&&a.results.items&&a.results.items.length>0){var d=a.results.items;for(var e in d){var f,g=d[e];f={lat:g.position[0],lon:g.position[1]},g.bbox&&(f.boundingbox={north:g.bbox[3],south:g.bbox[1],east:g.bbox[2],west:g.bbox[0]}),g.category&&(f.type=g.category.id),g.title&&(f.title=g.title),c.push(f)}}b&&b.call(this,c)})}};b.exports=e},{jquery:"jquery"}],260:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f={keys:{app_id:"nLQPTdTV34FB9L3yK2dCXydWXRv3ZKzyu_BdCSrmCBAM1HgGErsCyCbBbVP2Yg--"},geocode:function(a,b){a=a.toLowerCase().replace(/é/g,"e").replace(/á/g,"a").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ /g,"+");var c="";-1===window.location.protocol.indexOf("http")&&(c="http:"),e.getJSON(c+"//query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('SELECT * FROM json WHERE url="http://where.yahooapis.com/geocode?q='+a+"&appid="+this.keys.app_id+'&flags=JX"')+"&format=json&callback=?",function(a){var c=[];if(a&&a.query&&a.query.results&&a.query.results.json&&a.query.results.json.ResultSet&&"0"!==a.query.results.json.ResultSet.Found){var e;e=d.isArray(a.query.results.json.ResultSet.Results)?a.query.results.json.ResultSet.Results:[a.query.results.json.ResultSet.Results];for(var f in e){var g,h=e[f];g={lat:h.latitude,lon:h.longitude},h.boundingbox&&(g.boundingbox=h.boundingbox),c.push(g)}}b(c)})}};b.exports=f},{jquery:"jquery",underscore:"underscore"}],261:[function(a,b,c){var d=a("underscore"),e=function(a){return a.geometry||a};b.exports={getGeometryType:function(a){return e(a).type},getGeometryCoordinates:function(a){return e(a).coordinates},convertLatlngsToLnglats:function(a){return d.map(a,this.convertLatlngToLngLat)},convertLatlngToLngLat:function(a){return[a[1],a[0]]},convertLngLatsToLatLngs:function(a){return d.map(a,this.convertLngLatToLatLng)},convertLngLatToLatLng:function(a){return[a[1],a[0]]},convertLatLngsToGeoJSONPointCoords:function(a){return this.convertLatlngToLngLat(a)},convertLatLngsToGeoJSONPolylineCoords:function(a){return this.convertLatlngsToLnglats(a)},convertLatLngsToGeoJSONPolygonCoords:function(a){return a=a.concat([a[0]]),this.convertLatlngsToLnglats(a)},getPointLatLngFromGeoJSONCoords:function(a){var b=this.getGeometryCoordinates(a);return this.convertLngLatToLatLng(b)},getPolylineLatLngsFromGeoJSONCoords:function(a){var b=this.getGeometryCoordinates(a);return this.convertLngLatsToLatLngs(b)},getPolygonLatLngsFromGeoJSONCoords:function(a){var b=this.getGeometryCoordinates(a)[0],c=this.convertLngLatsToLatLngs(b);return c=c.slice(0,-1)},getMultiPointLatLngsFromGeoJSONCoords:function(a){var b=this.getGeometryCoordinates(a);return this.convertLngLatsToLatLngs(b)},getMultiPolylineLatLngsFromGeoJSONCoords:function(a){var b=this.getGeometryCoordinates(a);return d.map(b,function(a){return this.convertLngLatsToLatLngs(a)},this)},getMultiPolygonLatLngsFromGeoJSONCoords:function(a){var b=this.getGeometryCoordinates(a);return d.map(b,function(a){var b=this.convertLngLatsToLatLngs(a[0]);return b=b.slice(0,-1)},this)}}},{underscore:"underscore"}],262:[function(a,b,c){var d=a("underscore"),e=a("../../core/model"),f=e.extend({update:function(){throw new Error("subclasses of GeometryBase must implement update")},remove:function(){this.trigger("remove")},isComplete:function(){throw new Error("subclasses of GeometryBase must implement isComplete")},isEditable:function(){return!!this.get("editable")},isExpandable:function(){return!!this.get("expandable")},toGeoJSON:function(){throw new Error("subclasses of GeometryBase must implement toGeoJSON")},setCoordinatesFromGeoJSON:function(a){var b=this.getCoordinatesFromGeoJSONCoords(a);
d.isEqual(b,this.getCoordinates())||this.setCoordinates(b)},getCoordinatesFromGeoJSONCoords:function(a){throw new Error("subclasses of GeometryBase must implement getCoordinatesFromGeoJSONCoords")},_triggerChangeEvent:function(){this.trigger("change",this)}});b.exports=f},{"../../core/model":230,underscore:"underscore"}],263:[function(a,b,c){var d=a("underscore"),e=a("./point"),f=a("./polyline"),g=a("./polygon"),h=a("./multi-point"),i=a("./multi-polygon"),j=a("./multi-polyline"),k=a("./geojson-helper"),l=function(a,b){return new e(a,b)},m=function(a,b){return new f(a,b)},n=function(a,b){return new g(a,b)},o=function(a,b){return new h(a,b)},p=function(a,b){return new i(a,b)},q=function(a,b){return new j(a,b)},r=function(a,b){var c=k.getPointLatLngFromGeoJSONCoords(a);return l(d.extend({},b,{latlng:c}))},s=function(a,b){var c=k.getPolylineLatLngsFromGeoJSONCoords(a);return m(b,{latlngs:c})},t=function(a,b){var c=k.getPolygonLatLngsFromGeoJSONCoords(a);return n(b,{latlngs:c})},u=function(a,b){var c=k.getMultiPointLatLngsFromGeoJSONCoords(a);return o(b,{latlngs:c})},v=function(a,b){var c=k.getMultiPolylineLatLngsFromGeoJSONCoords(a);return q(b,{latlngs:c})},w=function(a,b){var c=k.getMultiPolygonLatLngsFromGeoJSONCoords(a);return p(b,{latlngs:c})},x={Point:r,LineString:s,Polygon:t,MultiPoint:u,MultiPolygon:w,MultiLineString:v},y=function(a,b){var c=k.getGeometryType(a),d=x[c];if(d)return d(a,b);throw new Error("Geometries of type "+c+" are not supported yet")};b.exports={createPoint:l,createPolyline:m,createPolygon:n,createMultiPoint:o,createMultiPolyline:q,createMultiPolygon:p,createGeometryFromGeoJSON:y}},{"./geojson-helper":261,"./multi-point":265,"./multi-polygon":266,"./multi-polyline":267,"./point":269,"./polygon":270,"./polyline":271,underscore:"underscore"}],264:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./geometry-base"),g=f.extend({initialize:function(a,b){f.prototype.initialize.apply(this,arguments),b=b||{},this.geometries=new e.Collection,b.latlngs&&this.geometries.reset(this._createGeometries(b.latlngs)),this.geometries.on("change",this._triggerChangeEvent,this),this.geometries.on("reset",this._onGeometriesReset,this)},_createGeometries:function(a){return d.map(a,this._createGeometry,this)},_createGeometry:function(a){throw new Error("subclasses of MultiGeometryBase must implement _createGeometry")},update:function(a){},remove:function(){f.prototype.remove.apply(this),this._removeGeometries()},isComplete:function(){return this.geometries.all(function(a){return a.isComplete()})},_onGeometriesReset:function(a,b){this._removeGeometries(b.previousModels),this._triggerChangeEvent()},_removeGeometries:function(a){a=a||this.geometries.models,d.each(a,function(a){a.remove()},this)}});b.exports=g},{"./geometry-base":262,backbone:"backbone",underscore:"underscore"}],265:[function(a,b,c){var d=a("./point"),e=a("./geojson-helper"),f=a("./multi-geometry-base"),g=f.extend({defaults:{editable:!1},_createGeometry:function(a){return new d({latlng:a,editable:this.isEditable()})},toGeoJSON:function(){var a=this.geometries.map(function(a){return e.convertLatLngsToGeoJSONPointCoords(a.getCoordinates())});return{type:"MultiPoint",coordinates:a}},setCoordinatesFromGeoJSON:function(a){var b=this.getCoordinatesFromGeoJSONCoords(a);this.geometries.reset(this._createGeometries(b))},getCoordinatesFromGeoJSONCoords:function(a){return e.getMultiPointLatLngsFromGeoJSONCoords(a)}});b.exports=g},{"./geojson-helper":261,"./multi-geometry-base":264,"./point":269}],266:[function(a,b,c){var d=a("./polygon"),e=a("./geojson-helper"),f=a("./multi-geometry-base"),g=f.extend({defaults:{editable:!1,expandable:!1},_createGeometry:function(a){return new d({editable:this.isEditable(),expandable:this.isExpandable()},{latlngs:a})},toGeoJSON:function(){var a=this.geometries.map(function(a){return[e.convertLatLngsToGeoJSONPolygonCoords(a.getCoordinates())]});return{type:"MultiPolygon",coordinates:a}},setCoordinatesFromGeoJSON:function(a){var b=this.getCoordinatesFromGeoJSONCoords(a);this.geometries.reset(this._createGeometries(b))},getCoordinatesFromGeoJSONCoords:function(a){return e.getMultiPolygonLatLngsFromGeoJSONCoords(a)}});b.exports=g},{"./geojson-helper":261,"./multi-geometry-base":264,"./polygon":270}],267:[function(a,b,c){var d=a("./polyline"),e=a("./geojson-helper"),f=a("./multi-geometry-base"),g=f.extend({defaults:{editable:!1,expandable:!1},_createGeometry:function(a){return new d({editable:this.isEditable(),expandable:this.isExpandable()},{latlngs:a})},toGeoJSON:function(){var a=this.geometries.map(function(a){return e.convertLatLngsToGeoJSONPolylineCoords(a.getCoordinates())});return{type:"MultiLineString",coordinates:a}},setCoordinatesFromGeoJSON:function(a){var b=this.getCoordinatesFromGeoJSONCoords(a);this.geometries.reset(this._createGeometries(b))},getCoordinatesFromGeoJSONCoords:function(a){return e.getMultiPolylineLatLngsFromGeoJSONCoords(a)}});b.exports=g},{"./geojson-helper":261,"./multi-geometry-base":264,"./polyline":271}],268:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./point"),g=a("./geometry-base"),h=g.extend({initialize:function(a,b){g.prototype.initialize.apply(this,arguments),b=b||{},this.points=new e.Collection,b.latlngs&&this.points.reset(this._createPoints(b.latlngs)),this.points.on("change",this._triggerChangeEvent,this)},getCoordinates:function(){return this.points.map(function(a){return a.getCoordinates()})},setCoordinates:function(a){this.points.reset(this._createPoints(a)),this._triggerChangeEvent()},getCoordinatesForMiddlePoints:function(){return this.getCoordinates()},update:function(a){var b=this.getCoordinates();b.push(a),this.setCoordinates(b)},_createPoints:function(a){return d.map(a,this._createPoint,this)},_createPoint:function(a){return new f({latlng:a,editable:this.isEditable()})},addPoint:function(a,b){b=b||{};var c=b.at||0;this.points.add(a,{at:c})},removePoint:function(a){this.points.remove(a)}});b.exports=h},{"./geometry-base":262,"./point":269,backbone:"backbone",underscore:"underscore"}],269:[function(a,b,c){var d=a("./geojson-helper"),e=a("./geometry-base"),f="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWBAMAAAA2mnEIAAAAKlBMVEUAAAD////////////////////////////////e6fPO3+5zo85Cg705fbrPhX3RAAAADXRSTlMAADVBRn6fqLO9weP7Sr4MvgAAAHRJREFUGNNjEEQABhQ2AwNLeEepAwOYzZTR0dHRpgBmW3SAQDOIzdTRuefu6RkdikA2W8eau3fvnupIBLI9Os8C2XdmtADZEd13QWBHK5Bd0QNmn2gHsjt6wewbHWhsZDXIepHNRLYL2Q3IbkNxM5JfsPsXACkGXYWXfeLsAAAAAElFTkSuQmCC",g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAP1BMVEUAAAArgNVVqv9OleNMkd1KjuJMj+BMlOBZmudYmORTluJTluZ0qupPlOFtp+hdm+aZwu9HjuDp8vv7/f39//2ENvQ5AAAAFXRSTlMABgYkJTQ5OT9DUFBsbm5wcHNzc3NuwP+LAAAAZ0lEQVR42r2PRw7AIAwETcCQYkL9/1sTgUKLxJE5jlZrL6xgE4hiG63UZC1p2dvD+fjizdlaZUJMBNfkmU7ZlNe1n1MskCgabdUW5/pfMj8Jyn0Pmm7Qdec5bocOlccrGGAckTNYwAMlgQk+DTSqnAAAAABJRU5ErkJggg==",h=e.extend({defaults:{editable:!1,expandable:!1,iconUrl:f,iconAnchor:[11,11]},getCoordinates:function(){return this.get("latlng")},setCoordinates:function(a){this.set("latlng",a)},update:function(a){this.get("latlng")||this.setCoordinates(a)},isComplete:function(){return!!this.get("latlng")},toGeoJSON:function(){var a=d.convertLatLngsToGeoJSONPointCoords(this.getCoordinates());return{type:"Point",coordinates:a}},getCoordinatesFromGeoJSONCoords:function(a){return d.getPointLatLngFromGeoJSONCoords(a)}},{DEFAULT_ICON_URL:f,MIDDLE_POINT_ICON_URL:g});b.exports=h},{"./geojson-helper":261,"./geometry-base":262}],270:[function(a,b,c){var d=a("./geojson-helper"),e=a("./path-base"),f=e.extend({defaults:{editable:!1,expandable:!1,lineColor:"#397dba",lineWeight:"4",lineOpacity:"0.5"},MIN_NUMBER_OF_VERTICES:3,isComplete:function(){return this.points.length>=this.MIN_NUMBER_OF_VERTICES},getCoordinatesForMiddlePoints:function(){var a=this.getCoordinates();return a.push(a[0]),a},toGeoJSON:function(){var a=d.convertLatLngsToGeoJSONPolygonCoords(this.getCoordinates());return{type:"Polygon",coordinates:[a]}},getCoordinatesFromGeoJSONCoords:function(a){return d.getPolygonLatLngsFromGeoJSONCoords(a)}});b.exports=f},{"./geojson-helper":261,"./path-base":268}],271:[function(a,b,c){var d=a("./geojson-helper"),e=a("./path-base"),f=e.extend({defaults:{editable:!1,expandable:!1,lineColor:"#397dba",lineWeight:"4",lineOpacity:"0.5"},MIN_NUMBER_OF_VERTICES:2,isComplete:function(){return this.points.length>=this.MIN_NUMBER_OF_VERTICES},toGeoJSON:function(){var a=d.convertLatLngsToGeoJSONPolylineCoords(this.getCoordinates());return{type:"LineString",coordinates:a}},getCoordinatesFromGeoJSONCoords:function(a){return d.getPolylineLatLngsFromGeoJSONCoords(a)}});b.exports=f},{"./geojson-helper":261,"./path-base":268}],272:[function(a,b,c){var d=a("../../../core/view"),e=d.extend({initialize:function(a){if(!a.model)throw new Error("model is required");if(!a.mapView)throw new Error("mapView is required");this.mapView=a.mapView,this.model.on("remove",this._onGeometryRemoved,this)},_onGeometryRemoved:function(){this.clean()}});b.exports=e},{"../../../core/view":236}],273:[function(a,b,c){var d=function(a){};d.prototype.addToMap=function(a){throw new Error("subclasses of MarkerAdapterBase must implement addToMap")},d.prototype.removeFromMap=function(a){throw new Error("subclasses of MarkerAdapterBase must implement removeFromMap")},d.prototype.isAddedToMap=function(a){throw new Error("subclasses of MarkerAdapterBase must implement isAddedToMap")},d.prototype.getCoordinates=function(){throw new Error("subclasses of MarkerAdapterBase must implement getCoordinates")},d.prototype.setCoordinates=function(a){throw new Error("subclasses of MarkerAdapterBase must implement setCoordinates")},d.prototype.isDraggable=function(){throw new Error("subclasses of MarkerAdapterBase must implement isDraggable")},d.prototype.getIconURL=function(){throw new Error("subclasses of MarkerAdapterBase must implement getIconURL")},d.prototype.setIcon=function(a,b){throw new Error("subclasses of MarkerAdapterBase must implement setIcon")},d.prototype.on=function(){throw new Error("subclasses of MarkerAdapterBase must implement on")},d.prototype.off=function(){throw new Error("subclasses of MarkerAdapterBase must implement off")},d.prototype.trigger=function(){throw new Error("subclasses of MarkerAdapterBase must implement trigger")},b.exports=d},{}],274:[function(a,b,c){var d=a("./geometry-view-base"),e=d.extend({initialize:function(a){if(d.prototype.initialize.apply(this,arguments),!this.GeometryViewClass)throw new Error("subclasses of MultiGeometryViewBase must declare the GeometryViewClass instance variable");this.model.geometries.on("reset",this._renderGeometries,this)},render:function(){this._renderGeometries()},_renderGeometries:function(){this.model.geometries.each(this._renderGeometry,this)},_renderGeometry:function(a){var b=new this.GeometryViewClass({model:a,mapView:this.mapView});b.render()}});b.exports=e},{"./geometry-view-base":272}],275:[function(a,b,c){var d=function(a){};d.prototype.addToMap=function(a){throw new Error("subclasses of PathAdapterBase must implement addToMap")},d.prototype.removeFromMap=function(a){throw new Error("subclasses of PathAdapterBase must implement removeFromMap")},d.prototype.isAddedToMap=function(a){throw new Error("subclasses of PathAdapterBase must implement isAddedToMap")},d.prototype.getCoordinates=function(){throw new Error("subclasses of PathAdapterBase must implement getCoordinates")},d.prototype.setCoordinates=function(a){throw new Error("subclasses of PathAdapterBase must implement setCoordinates")},b.exports=d},{}],276:[function(a,b,c){var d=a("underscore"),e=a("./geometry-view-base"),f=a("../../geometry-models/point.js"),g=function(a,b,c){var d=a.latLngToContainerPoint(b),e=a.latLngToContainerPoint(c),f=(d.y+e.y)/2,g=(d.x+e.x)/2,h=a.containerPointToLatLng({x:g,y:f});return[h.lat,h.lng]},h=e.extend({initialize:function(a){if(e.prototype.initialize.apply(this,arguments),!this.PointViewClass)throw new Error("subclasses of PathViewBase must declare the PointViewClass instance variable");this.model.points.on("change:latlng",this._onPointsChanged,this),this.model.points.on("add",this._onPointAdded,this),this.model.points.on("remove",this._onPointRemoved,this),this.model.points.on("reset",this._onPointsReset,this),this.add_related_model(this.model.points),this._geometry=this._createGeometry(),this._pointViews={},this._middlePointViews={},d.bindAll(this,"_renderMiddlePoints"),this.mapView.on("zoomend",this._renderMiddlePoints)},_createGeometry:function(){throw new Error("Subclasses of MyLeafletPathViewBase must implement _createGeometry")},render:function(){this._renderPoints(),this._renderMiddlePoints(),this.mapView.addPath(this._geometry)},_renderPoints:function(a){a=a||this.model.points.models,d.each(a,this._renderPoint,this)},_renderPoint:function(a){var b=this._tryToReuseMiddlePointView(a);b?delete this._middlePointViews[a.cid]:b=this._createPointView(a),this.addView(b),this._pointViews[a.cid]=b,b.render()},_tryToReuseMiddlePointView:function(a){var b;return this._middlePointViewForNewPoint&&(a.set({iconUrl:f.prototype.defaults.iconUrl}),b=new this.PointViewClass({model:a,mapView:this.mapView,marker:this._middlePointViewForNewPoint.getMarker()}),this._middlePointViewForNewPoint.unsetMarker(),this._middlePointViewForNewPoint.clean(),delete this._middlePointViewForNewPoint),b},_renderMiddlePoints:function(){if(this.model.isExpandable()){this._clearMiddlePoints();var a=this._calculateMiddlePoints();d.each(a,this._renderMiddlePoint,this)}},_calculateMiddlePoints:function(){var a=this.model.getCoordinatesForMiddlePoints(),b=this.mapView;return d.map(a.slice(0,-1),function(c,d){var e=a[d+1];return new f({latlng:g(b,c,e),editable:!0,iconUrl:f.MIDDLE_POINT_ICON_URL})})},_renderMiddlePoint:function(a,b){var c=this._createPointView(a);this._middlePointViews[a.cid]=c,c.render(),c.once("mousedown",function(a){this._middlePointViewForNewPoint=c,this.model.addPoint(a,{at:b+1})}.bind(this)),this.addView(c)},_clearMiddlePoints:function(){d.each(this._middlePointViews,function(a,b){a.clean()})},_createPointView:function(a){var b=new this.PointViewClass({model:a,mapView:this.mapView});return b},_onPointsChanged:function(){this._renderMiddlePoints(),this._updatePathFromModel()},_onPointAdded:function(a){this._renderPoints([a]),this._renderMiddlePoints(),this._updatePathFromModel()},_onPointRemoved:function(a){this._removePoints([a]),this._renderMiddlePoints(),this._updatePathFromModel()},_onPointsReset:function(a,b){var c=b.previousModels,e=this.model.points.models,f=d.difference(c,e),g=d.difference(e,c);this._removePoints(f),this._renderPoints(g),this._renderMiddlePoints(),this._updatePathFromModel()},_removePoints:function(a){a=a||this.model.points.models,d.each(a,function(a){var b=this._pointViews[a.cid];b&&(b.clean(),delete this._pointViews[a.cid])},this)},_updatePathFromModel:function(){this._geometry.setCoordinates(this.model.getCoordinates())},clean:function(){e.prototype.clean.call(this),this.mapView.removePath(this._geometry),this.mapView.off("zoomend",this._renderMiddlePoints)},_getPointKey:function(a){return a.cid}});b.exports=h},{"../../geometry-models/point.js":269,"./geometry-view-base":272,underscore:"underscore"}],277:[function(a,b,c){var d=a("underscore"),e=a("./geometry-view-base"),f=10,g=e.extend({initialize:function(a){e.prototype.initialize.apply(this,arguments),this.model.on("change:latlng",this._onLatlngChanged,this),this.model.on("change:iconUrl change:iconAnchor",this._updateMarkersIcon,this),this._marker=null,a.marker&&(this._marker=a.marker,this._updateMarkersIcon()),this._onDrag=d.debounce(this._updateModelFromMarker.bind(this),f),d.bindAll(this,"_onDragStart","_onDrag","_onDragEnd","_onMouseDown","_onMouseClick")},getMarker:function(){return this._marker},unsetMarker:function(){this._unbindMarkerEvents(),delete this._marker},_onLatlngChanged:function(){this._renderMarkerIfNotRendered(),this.isDragging()||this._updateMarkerFromModel()},render:function(){this.model.get("latlng")&&this._renderMarkerIfNotRendered()},_renderMarkerIfNotRendered:function(){var a=this.model.isEditable();this._isMarkerRendered()?this._unbindMarkerEvents():(this._marker=this._createMarker(),this.mapView.addMarker(this._marker)),a&&this._bindMarkerEvents()},_isMarkerRendered:function(){return this._marker&&this.mapView.hasMarker(this._marker)},_removeMarker:function(){this._marker&&this.mapView.removeMarker(this._marker)},_onDragStart:function(){this._isDragging=!0},_onDragEnd:function(){this._isDragging=!1},_onMouseDown:function(){this._mouseDownClicked=!0,this.trigger("mousedown",this.model)},_onMouseClick:function(){this._mouseDownClicked&&(this.trigger("click",this.model),this._mouseDownClicked=!1)},isDragging:function(){return!!this._isDragging},clean:function(){e.prototype.clean.apply(this),this._removeMarker()},_updateModelFromMarker:function(){if(this._marker){var a=this._marker.getCoordinates();this.model.setCoordinates([a.lat,a.lng])}},_updateMarkerFromModel:function(){this._marker.setCoordinates(this.model.getCoordinates())},_updateMarkersIcon:function(){this._marker&&this._marker.setIconURL(this.model.get("iconUrl"),this.model.get("iconAnchor"))},_createMarker:function(){throw new Error("subclasses of PointViewBase must implement _createMarker")},_unbindMarkerEvents:function(){this._marker.off("mousedown",this._onMouseDown),this._marker.off("dragstart",this._onDragStart),this._marker.off("drag",this._onDrag),this._marker.off("dragend",this._onDragEnd)},_bindMarkerEvents:function(){this._marker.on("mousedown",this._onMouseDown),this._marker.on("dragstart",this._onDragStart),this._marker.on("drag",this._onDrag),this._marker.on("dragend",this._onDragEnd)}});b.exports=g},{"./geometry-view-base":272,underscore:"underscore"}],278:[function(a,b,c){var d=a("../map.js"),e=a("../geometry-models/point"),f=a("../geometry-models/polyline"),g=a("../geometry-models/polygon"),h=a("../geometry-models/multi-point"),i=a("../geometry-models/multi-polygon"),j=a("../geometry-models/multi-polyline"),k=function(a,b){var c;if(a===d.PROVIDERS.GMAPS)c=y(b);else{if(a!==d.PROVIDERS.LEAFLET)throw new Error("unknown provider: '"+a);c=r(b)}return c},l=a("./leaflet/point-view"),m=a("./leaflet/polygon-view"),n=a("./leaflet/polyline-view"),o=a("./leaflet/multi-point-view"),p=a("./leaflet/multi-polygon-view"),q=a("./leaflet/multi-polyline-view"),r=function(a){var b;return a instanceof e?b=l:a instanceof f?b=n:a instanceof g?b=m:a instanceof h?b=o:a instanceof j?b=q:a instanceof i&&(b=p),b},s=a("./gmaps/point-view"),t=a("./gmaps/polygon-view"),u=a("./gmaps/polyline-view"),v=a("./gmaps/multi-point-view"),w=a("./gmaps/multi-polygon-view"),x=a("./gmaps/multi-polyline-view"),y=function(a){var b;return a instanceof e?b=s:a instanceof f?b=u:a instanceof g?b=t:a instanceof h?b=v:a instanceof j?b=x:a instanceof i&&(b=w),b},z={createGeometryView:function(a,b,c){var d=k(a,b);if(d)return new d({model:b,mapView:c});throw new Error(b.get("type")+" is not supported yet")}};b.exports=z},{"../geometry-models/multi-point":265,"../geometry-models/multi-polygon":266,"../geometry-models/multi-polyline":267,"../geometry-models/point":269,"../geometry-models/polygon":270,"../geometry-models/polyline":271,"../map.js":321,"./gmaps/multi-point-view":282,"./gmaps/multi-polygon-view":283,"./gmaps/multi-polyline-view":284,"./gmaps/point-view":285,"./gmaps/polygon-view":286,"./gmaps/polyline-view":287,"./leaflet/multi-point-view":290,"./leaflet/multi-polygon-view":291,"./leaflet/multi-polyline-view":292,"./leaflet/point-view":293,"./leaflet/polygon-view":294,"./leaflet/polyline-view":295}],279:[function(a,b,c){var d=a("underscore");b.exports={convertToGMapsCoordinates:function(a){return d.map(a,function(a){return{lat:a[0],lng:a[1]}})}}},{underscore:"underscore"}],280:[function(a,b,c){var d=a("../base/marker-adapter-base"),e=function(a){this._listeners={},this._nativeMarker=a};e.prototype=new d,e.prototype.constructor=e,e.prototype.addToMap=function(a){this._nativeMarker.setMap(a)},e.prototype.removeFromMap=function(a){this._nativeMarker.setMap(null)},e.prototype.isAddedToMap=function(a){return!!this._nativeMarker.getMap()},e.prototype.getCoordinates=function(){var a=this._nativeMarker.getPosition();return{lat:a.lat(),lng:a.lng()}},e.prototype.setCoordinates=function(a){var b=new google.maps.LatLng(a[0],a[1]);this._nativeMarker.setPosition(b)},e.prototype.isDraggable=function(){return this._nativeMarker.getDraggable()},e.prototype.getIconURL=function(){return this._nativeMarker.getIcon()&&this._nativeMarker.getIcon().url||this._nativeMarker.getIcon()},e.prototype.setIconURL=function(a,b){var c={url:a,origin:new google.maps.Point(0,0),anchor:new google.maps.Point(b[0],b[1])};this._nativeMarker.setIcon(c)},e.prototype.on=function(a,b){var c=this._nativeMarker.addListener(a,b);this._listeners[a]=c},e.prototype.off=function(a){var b=this._listeners[a];google.maps.event.removeListener(b)},e.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);google.maps.event.trigger(this._nativeMarker,a,b)},b.exports=e},{"../base/marker-adapter-base":273}],281:[function(a,b,c){var d=a("underscore"),e=a("../base/path-adapter-base"),f=a("./gmaps-coordinates"),g=function(a){this._nativePath=a};g.prototype=new e,g.prototype.constructor=g,g.prototype.addToMap=function(a){this._nativePath.setMap(a)},g.prototype.removeFromMap=function(a){this._nativePath.setMap(null)},g.prototype.isAddedToMap=function(a){return!!this._nativePath.getMap()},g.prototype.getCoordinates=function(){var a=this._nativePath.getPath();return d.map(a.getArray(),function(a){return{lat:a.lat(),lng:a.lng()}})},g.prototype.setCoordinates=function(a){var b=f.convertToGMapsCoordinates(a);this._nativePath.setPath(b)},b.exports=g},{"../base/path-adapter-base":275,"./gmaps-coordinates":279,underscore:"underscore"}],282:[function(a,b,c){var d=a("../base/multi-geometry-view-base"),e=a("./point-view"),f=d.extend({GeometryViewClass:e});b.exports=f},{"../base/multi-geometry-view-base":274,"./point-view":285}],283:[function(a,b,c){var d=a("../base/multi-geometry-view-base"),e=a("./polygon-view"),f=d.extend({GeometryViewClass:e});b.exports=f},{"../base/multi-geometry-view-base":274,"./polygon-view":286}],284:[function(a,b,c){var d=a("../base/multi-geometry-view-base"),e=a("./polyline-view"),f=d.extend({GeometryViewClass:e});b.exports=f},{"../base/multi-geometry-view-base":274,"./polyline-view":287}],285:[function(a,b,c){var d=a("../base/point-view-base.js"),e=a("./gmaps-marker-adapter"),f=d.extend({_createMarker:function(){var a=new google.maps.LatLng(this.model.getCoordinates()[0],this.model.getCoordinates()[1]),b={url:this.model.get("iconUrl"),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(this.model.get("iconAnchor")[0],this.model.get("iconAnchor")[1])},c=new google.maps.Marker({position:a,icon:b,draggable:this.model.isEditable(),crossOnDrag:!1});return new e(c)}});b.exports=f},{"../base/point-view-base.js":277,"./gmaps-marker-adapter":280}],286:[function(a,b,c){var d=a("../base/path-view-base"),e=a("./point-view"),f=a("./gmaps-path-adapter"),g=a("./gmaps-coordinates"),h=d.extend({PointViewClass:e,_createGeometry:function(){var a=g.convertToGMapsCoordinates(this.model.getCoordinates()),b=new google.maps.Polygon({paths:a,strokeColor:this.model.get("lineColor"),strokeWeight:this.model.get("lineWeight"),strokeOpacity:this.model.get("lineOpacity")});return new f(b)}});b.exports=h},{"../base/path-view-base":276,"./gmaps-coordinates":279,"./gmaps-path-adapter":281,"./point-view":285}],287:[function(a,b,c){var d=a("../base/path-view-base"),e=a("./point-view"),f=a("./gmaps-path-adapter"),g=a("./gmaps-coordinates"),h=d.extend({PointViewClass:e,_createGeometry:function(){var a=g.convertToGMapsCoordinates(this.model.getCoordinates()),b=new google.maps.Polyline({path:a,strokeColor:this.model.get("lineColor"),strokeWeight:this.model.get("lineWeight"),strokeOpacity:this.model.get("lineOpacity")});return new f(b)}});b.exports=h},{"../base/path-view-base":276,"./gmaps-coordinates":279,"./gmaps-path-adapter":281,"./point-view":285}],288:[function(a,b,c){var d=a("leaflet"),e=a("../base/marker-adapter-base"),f=function(a){this._nativeMarker=a};f.prototype=new e,f.prototype.constructor=f,f.prototype.addToMap=function(a){a.addLayer(this._nativeMarker)},f.prototype.removeFromMap=function(a){a.removeLayer(this._nativeMarker)},f.prototype.isAddedToMap=function(a){return a.hasLayer(this._nativeMarker)},f.prototype.getCoordinates=function(){var a=this._nativeMarker.getLatLng();return{lat:a.lat,lng:a.lng}},f.prototype.setCoordinates=function(a){this._nativeMarker.setLatLng(a)},f.prototype.isDraggable=function(){return this._nativeMarker.options.draggable},f.prototype.getIconURL=function(){return this._nativeMarker.options.icon.options.iconUrl},f.prototype.setIconURL=function(a){var b=d.icon({iconUrl:a});this._nativeMarker.setIcon(b)},f.prototype.on=function(){this._nativeMarker.on.apply(this._nativeMarker,arguments)},f.prototype.off=function(){this._nativeMarker.off.apply(this._nativeMarker,arguments)},f.prototype.trigger=function(){this._nativeMarker.fire.apply(this._nativeMarker,arguments)},b.exports=f},{"../base/marker-adapter-base":273,leaflet:208}],289:[function(a,b,c){var d=a("../base/path-adapter-base"),e=function(a){this._nativePath=a};e.prototype=new d,e.prototype.constructor=e,e.prototype.addToMap=function(a){a.addLayer(this._nativePath)},e.prototype.removeFromMap=function(a){a.removeLayer(this._nativePath)},e.prototype.isAddedToMap=function(a){return a.hasLayer(this._nativePath)},e.prototype.getCoordinates=function(){return this._nativePath.getLatLngs()},e.prototype.setCoordinates=function(a){this._nativePath.setLatLngs(a)},b.exports=e},{"../base/path-adapter-base":275}],290:[function(a,b,c){var d=a("../base/multi-geometry-view-base"),e=a("./point-view"),f=d.extend({GeometryViewClass:e});b.exports=f},{"../base/multi-geometry-view-base":274,"./point-view":293}],291:[function(a,b,c){arguments[4][283][0].apply(c,arguments)},{"../base/multi-geometry-view-base":274,"./polygon-view":294,dup:283}],292:[function(a,b,c){arguments[4][284][0].apply(c,arguments)},{"../base/multi-geometry-view-base":274,"./polyline-view":295,dup:284}],293:[function(a,b,c){var d=a("leaflet"),e=a("../base/point-view-base.js"),f=a("./leaflet-marker-adapter"),g=e.extend({_createMarker:function(){var a=this.model.isEditable(),b=d.icon({iconUrl:this.model.get("iconUrl"),iconAnchor:this.model.get("iconAnchor")}),c=d.marker(this.model.get("latlng"),{icon:b,draggable:!!a});return new f(c)}});b.exports=g},{"../base/point-view-base.js":277,"./leaflet-marker-adapter":288,leaflet:208}],294:[function(a,b,c){var d=a("leaflet"),e=a("../base/path-view-base"),f=a("./point-view"),g=a("./leaflet-path-adapter"),h=e.extend({PointViewClass:f,_createGeometry:function(){var a=d.polygon(this.model.getCoordinates(),{color:this.model.get("lineColor"),weight:this.model.get("lineWeight"),opacity:this.model.get("lineOpacity")});return new g(a)}});b.exports=h},{"../base/path-view-base":276,"./leaflet-path-adapter":289,"./point-view":293,leaflet:208}],295:[function(a,b,c){var d=a("leaflet"),e=a("../base/path-view-base"),f=a("./point-view"),g=a("./leaflet-path-adapter"),h=e.extend({PointViewClass:f,_createGeometry:function(){var a=d.polyline(this.model.getCoordinates(),{color:this.model.get("lineColor"),weight:this.model.get("lineWeight"),opacity:this.model.get("lineOpacity")});return new g(a)}});b.exports=h},{"../base/path-view-base":276,"./leaflet-path-adapter":289,"./point-view":293,leaflet:208}],296:[function(a,b,c){var d={};"undefined"!=typeof window.google&&"undefined"!=typeof window.google.maps&&(d={GoogleMapsMapView:a("./gmaps/gmaps-map-view"),GMapsTiledLayerView:a("./gmaps/gmaps-tiled-layer-view"),GMapsLayerView:a("./gmaps/gmaps-layer-view"),GMapsPlainLayerView:a("./gmaps/gmaps-plain-layer-view"),GMapsBaseLayerView:a("./gmaps/gmaps-base-layer-view"),GMapsCartoDBLayerGroupView:a("./gmaps/gmaps-cartodb-layer-group-view")}),b.exports=d},{"./gmaps/gmaps-base-layer-view":298,"./gmaps/gmaps-cartodb-layer-group-view":299,"./gmaps/gmaps-layer-view":302,"./gmaps/gmaps-map-view":303,"./gmaps/gmaps-plain-layer-view":304,"./gmaps/gmaps-tiled-layer-view":305}],297:[function(a,b,c){var d=a("cdb.config"),e={opacity:.99,attribution:d.get("cartodb_attributions"),debug:!1,visible:!0,added:!1,tiler_domain:"carto.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"carto.com",sql_api_port:"80",sql_api_protocol:"http",extra_params:{},cdn_url:null,subdomains:null};b.exports=e},{"cdb.config":220}],298:[function(a,b,c){var d=a("underscore"),e=a("./gmaps-default-map-style"),f=a("./gmaps-layer-view"),g=function(a,b){f.call(this,a,null,b)};d.extend(g.prototype,f.prototype,{_update:function(){var a=this.model,b={roadmap:google.maps.MapTypeId.ROADMAP,gray_roadmap:google.maps.MapTypeId.ROADMAP,dark_roadmap:google.maps.MapTypeId.ROADMAP,hybrid:google.maps.MapTypeId.HYBRID,satellite:google.maps.MapTypeId.SATELLITE,terrain:google.maps.MapTypeId.TERRAIN};this.gmapsMap.setOptions({mapTypeId:b[a.get("base_type")]}),this.gmapsMap.setOptions({styles:a.get("style")||e})},remove:function(){}}),b.exports=g},{"./gmaps-default-map-style":300,"./gmaps-layer-view":302,underscore:"underscore"}],299:[function(a,b,c){function d(a,b){var c=Math.round(100*b);c>=99?a.style.filter=l:a.style.filter="alpha(opacity="+b+");"}var e=a("underscore"),f=a("./gmaps-layer-view");a("leaflet");var g=a("wax.cartodb.js"),h=a("./cartodb-default-options"),i=a("./projector"),j=a("../cartodb-layer-group-view-base"),k=a("cdb.core.Profiler"),l="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00FFFFFF,endColorstr=#00FFFFFF)",m="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",n=function(a,b){var c=this,d=[];e.bindAll(this,"featureOut","featureOver","featureClick");var k=e.clone(a.attributes);k.map=b;var l,m=k.featureOver,n=k.featureOut,o=k.featureClick,p=-1;k.featureOver=function(a,b,e,f,g){d[g]||c.trigger("layerenter",a,b,e,f,g),d[g]=1,m&&m.apply(this,arguments),c.featureOver&&c.featureOver.apply(this,arguments),a.timeStamp===l&&clearTimeout(p),p=setTimeout(function(){c.trigger("mouseover",a,b,e,f,g),c.trigger("layermouseover",a,b,e,f,g)},0),l=a.timeStamp},k.featureOut=function(a,b){d[b]&&c.trigger("layermouseout",b),d[b]=0,e.any(d)||c.trigger("mouseout"),n&&n.apply(this,arguments),c.featureOut&&c.featureOut.apply(this,arguments)},k.featureClick=e.debounce(function(){o&&o.apply(this,arguments),c.featureClick&&c.featureClick.apply(k,arguments)},10),this.options=e.defaults(k,h),this.tiles=0,this.interaction=[],g.g.connector.call(this,k),e.extend(this.options,k),f.call(this,a,this,b),this.projector=new i(k.map),j.call(this,a)};n.prototype=new g.g.connector,n.prototype.interactionClass=g.g.interaction,e.extend(n.prototype,n.prototype,j.prototype,n.prototype,f.prototype,{reload:function(){this.model.invalidate()},remove:function(){f.prototype.remove.call(this),this.clear()},featureOver:function(a,b,c,d,e){this.trigger("featureOver",a,[b.lat(),b.lng()],c,d,e)},featureOut:function(a,b){this.trigger("featureOut",a,b)},featureClick:function(a,b,c,d,e){this.trigger("featureClick",a,[b.lat(),b.lng()],c,d,e)},error:function(a){this.model&&(this.model.trigger("error",a?a.errors:"unknown error"),this.model.trigger("tileError",a?a.errors:"unknown error"))},ok:function(a){this.model.trigger("tileOk")},tilesOk:function(a){this.model.trigger("tileOk")},loading:function(){this.trigger("loading")},finishLoading:function(){this.trigger("load")},setOpacity:function(a){if(isNaN(a)||a>1||0>a)throw new Error(a+" is not a valid value, should be in [0, 1] range");this.opacity=this.options.opacity=a;for(var b in this.cache){var c=this.cache[b];c.style.opacity=a,d(c,a)}},getTile:function(a,b,c){var e=this,f="ActiveXObject"in window,h=f&&!document.addEventListener;if(this.options.added=!0,!this.model.hasTileURLTemplates()){var i=b+"/"+a.x+"/"+a.y,j=this.cache[i]=new Image(256,256);return j.src=m,
j.setAttribute("gTileKey",i),j.style.opacity=this.options.opacity,j}var l=g.g.connector.prototype.getTile.call(this,a,b,c);h&&d(l,this.options.opacity),l.style.opacity=this.options.opacity,0===this.tiles&&this.loading&&this.loading(),this.tiles++;var n=k.metric("cartodb-js.tile.png.load.time").start(),o=function(){n.end(),e.tiles--,0===e.tiles&&e.finishLoading&&e.finishLoading()};return l.onload=o,l.onerror=function(){k.metric("cartodb-js.tile.png.error").inc(),o()},l},onAdd:function(){},clear:function(){this._clearInteraction(),this.finishLoading&&this.finishLoading()},update:function(){this._reload.apply(this,arguments)},_reload:function(){this.loading&&this.loading(),this.model.hasTileURLTemplates()?(this.options.tiles=this.model.getTileURLTemplates(),this.tiles=0,this.cache={},this._reloadInteraction(),this.refreshView(),this.ok&&this.ok()):this.error&&this.error("URLs have not been fetched yet")},refreshView:function(){var a=this,b=this.options.map;b.overlayMapTypes.forEach(function(c,d){return c===a?void b.overlayMapTypes.setAt(d,a):void 0})},_checkLayer:function(){if(!this.options.added)throw new Error("the layer is not still added to the map")},_findPos:function(a,b){var c,d,e=0,f=0,g=a.getDiv();if(b.e.changedTouches&&b.e.changedTouches.length>0?(c=b.e.changedTouches[0].clientX+window.scrollX,d=b.e.changedTouches[0].clientY+window.scrollY):(c=b.e.clientX,d=b.e.clientY),g.offsetParent&&g.offsetTop>0){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);var h=this._newPoint(c-e,d-f)}else var i=g.getBoundingClientRect(),j=window.scrollX||window.pageXOffset,k=window.scrollY||window.pageYOffset,h=this._newPoint((b.e.clientX?b.e.clientX:c)-i.left-g.clientLeft-j,(b.e.clientY?b.e.clientY:d)-i.top-g.clientTop-k);return h},_newPoint:function(a,b){return new google.maps.Point(a,b)},_manageOffEvents:function(a,b){return this.options.featureOut?this.options.featureOut&&this.options.featureOut(b.e,b.layer):void 0},_manageOnEvents:function(a,b){var c=this._findPos(a,b),d=this.projector.pixelToLatLng(c),e=b.e.type.toLowerCase();switch(e){case"mousemove":if(this.options.featureOver)return this.options.featureOver(b.e,d,c,b.data,b.layer);break;case"click":case"touchend":case"touchmove":case"mspointerup":case"pointerup":case"pointermove":this.options.featureClick&&this.options.featureClick(b.e,d,c,b.data,b.layer)}}}),b.exports=n},{"../cartodb-layer-group-view-base":249,"./cartodb-default-options":297,"./gmaps-layer-view":302,"./projector":307,"cdb.core.Profiler":231,leaflet:208,underscore:"underscore","wax.cartodb.js":434}],300:[function(a,b,c){var d=[{stylers:[{saturation:-65},{gamma:1.52}]},{featureType:"administrative",stylers:[{saturation:-95},{gamma:2.26}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"simplified"},{saturation:-99},{gamma:2.22}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{saturation:-55}]}];b.exports=d},{}],301:[function(a,b,c){var d=a("cdb.log"),e=function(){},f={};if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var g=a("./gmaps-base-layer-view"),h=a("./gmaps-tiled-layer-view"),i=a("../leaflet/leaflet-wms-layer-view"),j=a("./gmaps-plain-layer-view"),k=a("./gmaps-cartodb-layer-group-view"),l=a("./gmaps-torque-layer-view");f={tiled:h,wms:i,plain:j,gmapsbase:g,layergroup:k,namedmap:k,torque:l}}e.prototype._constructors=f,e.prototype.createLayerView=function(a,b){var c=a.get("type").toLowerCase(),e=this._constructors[c];if(e)try{return new e(a,b)}catch(f){throw d.error("Error creating an instance of layer view for '"+c+"' layer -> "+f.message),f}else d.error("Error creating an instance of layer view for '"+c+"' layer. Type is not supported")},b.exports=e},{"../leaflet/leaflet-wms-layer-view":318,"./gmaps-base-layer-view":298,"./gmaps-cartodb-layer-group-view":299,"./gmaps-plain-layer-view":304,"./gmaps-tiled-layer-view":305,"./gmaps-torque-layer-view":306,"cdb.log":223}],302:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=function(a,b,c){this.gmapsLayer=b,this.map=this.gmapsMap=c,this.model=a,this.model.bind("change",this._update,this),this.type=a.get("type")||a.get("kind"),this.type=this.type.toLowerCase()};d.extend(f.prototype,e.Events),d.extend(f.prototype,{_searchLayerIndex:function(){var a=this,b=-1;return this.gmapsMap.overlayMapTypes.forEach(function(c,d){c==a&&(b=d)}),b},remove:function(){if(!this.isBase){var a=this._searchLayerIndex();a>=0?this.gmapsMap.overlayMapTypes.removeAt(a):this.gmapsLayer.setMap&&this.gmapsLayer.setMap(null),this.model.unbind(null,null,this),this.unbind()}},refreshView:function(){if(this.isBase){var a="_baseLayer";this.gmapsMap.setMapTypeId(null),this.gmapsMap.mapTypes.set(a,this.gmapsLayer),this.gmapsMap.setMapTypeId(a)}else{var b=this._searchLayerIndex();b>=0&&this.gmapsMap.overlayMapTypes.setAt(b,this)}},reload:function(){this.refreshView()},_update:function(){this.refreshView()}}),b.exports=f},{backbone:"backbone",underscore:"underscore"}],303:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=a("../map-view"),g=a("./projector"),h=a("./gmaps-layer-view-factory"),i=f.extend({initialize:function(){f.prototype.initialize.call(this),d.bindAll(this,"_ready"),this._isReady=!1;var a=this,b=this.map.getViewBounds();b&&this.showBounds(b);var c=this.map.get("center");if(this.isMapAlreadyCreated()){this._gmapsMap=this.options.map_object,this.setElement(this._gmapsMap.getDiv());var e=a._gmapsMap.getCenter();a._setModelProperty({center:[e.lat(),e.lng()]}),a._setModelProperty({zoom:a._gmapsMap.getZoom()}),a.map.unset("view_bounds_sw",{silent:!0}),a.map.unset("view_bounds_ne",{silent:!0})}else this._gmapsMap=new google.maps.Map(this.el,{center:new google.maps.LatLng(c[0],c[1]),zoom:this.map.get("zoom"),minZoom:this.map.get("minZoom"),maxZoom:this.map.get("maxZoom"),disableDefaultUI:!0,scrollwheel:this.map.get("scrollwheel"),draggable:this.map.get("drag"),disableDoubleClickZoom:!this.map.get("drag"),mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,backgroundColor:"white",tilt:0}),this.map.bind("change:maxZoom",function(){a._gmapsMap.setOptions({maxZoom:a.map.get("maxZoom")})},this),this.map.bind("change:minZoom",function(){a._gmapsMap.setOptions({minZoom:a.map.get("minZoom")})},this);google.maps.event.addListener(this._gmapsMap,"center_changed",function(){var b=a._gmapsMap.getCenter();a._setModelProperty({center:[b.lat(),b.lng()]})}),google.maps.event.addListener(this._gmapsMap,"zoom_changed",function(){a._setModelProperty({zoom:a._gmapsMap.getZoom()});var b=a._gmapsMap.getCenter();a.map.trigger("moveend",[b.lat(),b.lng()])}),google.maps.event.addListener(this._gmapsMap,"click",function(b){a.trigger("click",b,[b.latLng.lat(),b.latLng.lng()])}),google.maps.event.addListener(this._gmapsMap,"dragend",function(b){var c=a._gmapsMap.getCenter();a.trigger("dragend",[c.lat(),c.lng()]),a.map.trigger("moveend",[c.lat(),c.lng()])}),google.maps.event.addListener(this._gmapsMap,"dblclick",function(b){a.trigger("dblclick",b)}),this._bindModel(),this.setAttribution(),this.projector=new g(this._gmapsMap),this.projector.draw=this._ready},_getLayerViewFactory:function(){return this._layerViewFactory=this._layerViewFactory||new h({vector:this.map.get("vector")}),this._layerViewFactory},_ready:function(){this.projector.draw=function(){},this.trigger("ready"),this._isReady=!0},_setKeyboard:function(a,b){this._gmapsMap.setOptions({keyboardShortcuts:b})},_setScrollWheel:function(a,b){this._gmapsMap.setOptions({scrollwheel:b})},_setZoom:function(a,b){b=b||0,this._gmapsMap.setZoom(b)},_setCenter:function(a,b){var c=new google.maps.LatLng(b[0],b[1]);this._gmapsMap.setCenter(c)},_getNativeMap:function(){return this._gmapsMap},_addLayerToMap:function(a,b,c){if(a){var f=1===d.keys(this._layerViews).length||c&&0===c.index||0===b.get("order");if(f){var g=a.model;"GMapsBase"!==g.get("type")&&(a.isBase=!0)}else{var h=b.get("order");a.getTile?(a.gmapsLayer||e.error("gmaps layer can't be null"),this._gmapsMap.overlayMapTypes.setAt(h,a.gmapsLayer)):a.gmapsLayer.setMap(this._gmapsMap)}void 0!==c&&c.silent||this.trigger("newLayerView",a,b,this)}else e.error("layer type not supported");return a},getSize:function(){return{x:this.$el.width(),y:this.$el.height()}},panBy:function(a){var b=this.map.get("center"),c=this.latLngToContainerPoint(b);a.x+=c.x,a.y+=c.y;var d=this.containerPointToLatLng(a);this.map.setCenter([d.lat,d.lng])},getBounds:function(){if(this._isReady){var a=this._gmapsMap.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();return[[b.lat(),b.lng()],[c.lat(),c.lng()]]}return[[0,0],[0,0]]},setAttribution:function(){},setCursor:function(a){this._gmapsMap.setOptions({draggableCursor:a})},getNativeMap:function(){return this._gmapsMap},invalidateSize:function(){google.maps.event.trigger(this._gmapsMap,"resize")},addMarker:function(a){a.addToMap(this.getNativeMap())},removeMarker:function(a){a.removeFromMap(this.getNativeMap())},hasMarker:function(a){return a.isAddedToMap(this.getNativeMap())},addPath:function(a){a.addToMap(this.getNativeMap())},removePath:function(a){a.removeFromMap(this.getNativeMap())},latLngToContainerPoint:function(a){var b=this.projector.latLngToPixel(new google.maps.LatLng(a[0],a[1]));return{x:b.x,y:b.y}},containerPointToLatLng:function(a){var b=this.projector.pixelToLatLng(new google.maps.Point(a.x,a.y));return{lat:b.lat(),lng:b.lng()}}});b.exports=i},{"../map-view":320,"./gmaps-layer-view-factory":301,"./projector":307,"cdb.log":223,underscore:"underscore"}],304:[function(a,b,c){var d=a("underscore"),e=a("./gmaps-layer-view"),f=function(a,b){this.color=a.get("color"),e.call(this,a,this,b)};d.extend(f.prototype,e.prototype,{_update:function(){this.color=this.model.get("color"),this.refreshView()},getTile:function(a,b,c){var d=document.createElement("div");return d.style.width=this.tileSize.x,d.style.height=this.tileSize.y,d["background-color"]=this.color,d},tileSize:new google.maps.Size(256,256),maxZoom:100,minZoom:0,name:"plain layer",alt:"plain layer"}),b.exports=f},{"./gmaps-layer-view":302,underscore:"underscore"}],305:[function(a,b,c){var d=a("underscore"),e=a("./gmaps-layer-view"),f=function(a,b){e.call(this,a,this,b),this.tileSize=new google.maps.Size(256,256),this.opacity=1,this.isPng=!0,this.maxZoom=22,this.minZoom=0,this.name="cartodb tiled layer",google.maps.ImageMapType.call(this,this)};d.extend(f.prototype,e.prototype,google.maps.ImageMapType.prototype,{getTileUrl:function(a,b){var c=a.y,d=1<<b;if(0>c||c>=d)return null;var e=a.x;(0>e||e>=d)&&(e=(e%d+d)%d),this.model.get("tms")&&(c=d-c-1);var f=this.model.get("urlTemplate");return f.replace("{x}",e).replace("{y}",c).replace("{z}",b)}}),b.exports=f},{"./gmaps-layer-view":302,underscore:"underscore"}],306:[function(a,b,c){a("torque.js");var d=a("underscore"),e=a("torque.js"),f=a("backbone"),g=a("./gmaps-layer-view"),h=a("../torque-layer-view-base"),i=function(a,b){g.call(this,a,this,b),e.GMapsTorqueLayer.call(this,this._initialAttrs(a)),this._init(a)};d.extend(i.prototype,g.prototype,e.GMapsTorqueLayer.prototype,h,{_update:function(){var a=this.model.changedAttributes();a!==!1&&("visible"in a&&(this.model.get("visible")?this.show():this.hide()),"cartocss"in a&&this.setCartoCSS(this.model.get("cartocss")),"tileURLTemplates"in a&&(this.provider.templateUrl=this.model.getTileURLTemplates()[0],d.extend(this.provider.options,this.model.get("meta")),this.model.set(this.model.get("meta")),setTimeout(function(){this.provider._setReady(!0),this._reloadTiles()}.bind(this),0)))},refreshView:function(){},onAdd:function(){e.GMapsTorqueLayer.prototype.onAdd.apply(this)},onTilesLoaded:function(){f.Events.trigger.call(this,"load")},onTilesLoading:function(){f.Events.trigger.call(this,"loading")}}),b.exports=i},{"../torque-layer-view-base":341,"./gmaps-layer-view":302,backbone:"backbone","torque.js":"torque.js",underscore:"underscore"}],307:[function(a,b,c){var d=function(a){this.setMap(a)};d.prototype=new google.maps.OverlayView,d.prototype.draw=function(){},d.prototype.latLngToPixel=function(a){var b=this.getProjection();return b?b.fromLatLngToContainerPixel(a):[0,0]},d.prototype.pixelToLatLng=function(a){var b=this.getProjection();return b?b.fromContainerPixelToLatLng(a):[0,0]},b.exports=d},{}],308:[function(a,b,c){b.exports={LeafletLayerView:a("./leaflet/leaflet-layer-view"),LeafletPlainLayerView:a("./leaflet/leaflet-plain-layer-view"),LeafletTiledLayerView:a("./leaflet/leaflet-tiled-layer-view"),LeafletGmapsTiledLayerView:a("./leaflet/leaflet-gmaps-tiled-layer-view"),LeafletWMSLayerView:a("./leaflet/leaflet-wms-layer-view"),LeafletCartoDBLayerGroupView:a("./leaflet/leaflet-cartodb-layer-group-view"),LeafletMapView:a("./leaflet/leaflet-map-view")}},{"./leaflet/leaflet-cartodb-layer-group-view":309,"./leaflet/leaflet-gmaps-tiled-layer-view":311,"./leaflet/leaflet-layer-view":313,"./leaflet/leaflet-map-view":314,"./leaflet/leaflet-plain-layer-view":315,"./leaflet/leaflet-tiled-layer-view":316,"./leaflet/leaflet-wms-layer-view":318}],309:[function(a,b,c){var d=a("leaflet"),e=a("wax.cartodb.js"),f=a("cdb.config"),g=a("cdb.core.Profiler"),h=a("./leaflet-layer-view"),i=a("../cartodb-layer-group-view-base"),j=a("underscore"),k=a("backbone"),l="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",m=d.TileLayer.extend({includes:[k.Events,h.prototype,i.prototype],interactionClass:e.leaf.interaction,options:{opacity:.99,attribution:f.get("cartodb_attributions"),debug:!1,visible:!0,added:!1,tiler_domain:"carto.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"carto.com",sql_api_port:"80",sql_api_protocol:"http",maxZoom:30,extra_params:{},cdn_url:null,subdomains:null},initialize:function(a,b){var c=this,e=[];this.interaction=[];var f=j.clone(a.attributes);f.map=b;var g,k=f.featureOver,l=f.featureOut,m=f.featureClick,n=-1;f.featureOver=function(a,b,d,f,h){e[h]||c.trigger("layerenter",a,b,d,f,h),e[h]=1,k&&k.apply(this,arguments),c.featureOver&&c.featureOver.apply(c,arguments),a.timeStamp===g&&clearTimeout(n),n=setTimeout(function(){c.trigger("mouseover",a,b,d,f,h),c.trigger("layermouseover",a,b,d,f,h)},0),g=a.timeStamp},f.featureOut=function(a,b){e[b]&&c.trigger("layermouseout",b),e[b]=0,j.any(e)||c.trigger("mouseout"),l&&l.apply(this,arguments),c.featureOut&&c.featureOut.apply(c,arguments)},f.featureClick=j.debounce(function(){m&&m.apply(c,arguments),c.featureClick&&c.featureClick.apply(c,arguments)},10),d.Util.setOptions(this,f),this.fire=this.trigger,this.addProfiling(),i.call(this,a),d.TileLayer.prototype.initialize.call(this),h.call(this,a,this,b)},featureOver:function(a,b,c,d,e){this.trigger("featureOver",a,[b.lat,b.lng],c,d,e)},featureOut:function(a,b){this.trigger("featureOut",a,b)},featureClick:function(a,b,c,d,e){this.trigger("featureClick",a,[b.lat,b.lng],c,d,e)},error:function(a){this.trigger("error",a?a.errors||a:"unknown error"),this.model.trigger("error",a?a.errors:"unknown error")},ok:function(a){this.model.trigger("tileOk")},addProfiling:function(){this.bind("tileloadstart",function(a){var b=this.tileStats||(this.tileStats={});b[a.tile.src]=g.metric("cartodb-js.tile.png.load.time").start()});var a=function(a){var b=this.tileStats&&this.tileStats[a.tile.src];b&&b.end()};this.bind("tileload",a),this.bind("tileerror",function(b){g.metric("cartodb-js.tile.png.error").inc(),a(b)})},getTileUrl:function(a){if(!this.model.hasTileURLTemplates())return l;this._adjustTilePoint(a);var b=this.model.getTileURLTemplates(),c=(a.x+a.y)%b.length;return d.Util.template(b[c],d.Util.extend({z:this._getZoomForUrl(),x:a.x,y:a.y},this.options))},setOpacity:function(a){if(isNaN(a)||a>1||0>a)throw new Error(a+" is not a valid value");this.options.opacity=Math.min(a,.99),this.options.visible&&(d.TileLayer.prototype.setOpacity.call(this,this.options.opacity),this.fire("updated"))},onAdd:function(a){return this.options.map=a,this.options.added=!0,d.TileLayer.prototype.onAdd.call(this,a)},onRemove:function(a){this.options.added&&(this.options.added=!1,d.TileLayer.prototype.onRemove.call(this,a))},_reload:function(){this.model.hasTileURLTemplates()?(this.setUrl(this.model.getTileURLTemplates()[0]),this._reloadInteraction(),this.ok&&this.ok()):this.setUrl(l)},_manageOnEvents:function(a,b){var c=this._findPos(a,b);if(!c||isNaN(c.x)||isNaN(c.y))return!1;var d=a.layerPointToLatLng(c),e=b.e.type.toLowerCase(),f=a.layerPointToContainerPoint(c);switch(e){case"mousemove":if(this.options.featureOver)return this.options.featureOver(b.e,d,f,b.data,b.layer);break;case"click":case"touchend":case"touchmove":case"mspointerup":case"pointerup":case"pointermove":this.options.featureClick&&this.options.featureClick(b.e,d,f,b.data,b.layer)}},_manageOffEvents:function(a,b){return this.options.featureOut?this.options.featureOut&&this.options.featureOut(b.e,b.layer):void 0},_findPos:function(a,b){var c,d,e=0,f=0,g=a.getContainer();if(b.e.changedTouches&&b.e.changedTouches.length>0?(c=b.e.changedTouches[0].clientX+window.scrollX,d=b.e.changedTouches[0].clientY+window.scrollY):(c=b.e.clientX,d=b.e.clientY),g.offsetParent&&g.offsetTop>0){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);var h=this._newPoint(c-e,d-f)}else var i=g.getBoundingClientRect(),j=window.scrollX||window.pageXOffset,k=window.scrollY||window.pageYOffset,h=this._newPoint((b.e.clientX?b.e.clientX:c)-i.left-g.clientLeft-j,(b.e.clientY?b.e.clientY:d)-i.top-g.clientTop-k);return a.containerPointToLayerPoint(h)},_newPoint:function(a,b){return new d.Point(a,b)},_modelUpdated:function(){}});b.exports=m},{"../cartodb-layer-group-view-base":249,"./leaflet-layer-view":313,backbone:"backbone","cdb.config":220,"cdb.core.Profiler":231,leaflet:208,underscore:"underscore","wax.cartodb.js":434}],310:[function(a,b,c){a("d3.cartodb");var d=window.L.CartoDBd3Layer,e=a("./leaflet-layer-view"),f=a("../data-providers/geojson/data-provider"),g=d.extend({includes:[e.prototype],_on:d.prototype.on,initialize:function(a,b){e.call(this,a,this,b),d.prototype.initialize.call(this),a.bind("change:urls",this._onURLsChanged,this),a.each(this._onLayerAdded,this),a.onLayerAdded(this._onLayerAdded.bind(this)),this._on("featureClick",function(a,b,c,d,e){this.trigger("featureClick",a,b,c,d,e)}.bind(this)),this._on("featureOver",function(a,b,c,d,e){this.trigger("featureOver",a,b,c,d,e),this.trigger("mouseover",a,b,c,d)}.bind(this)),this._on("featureOut",function(a,b,c,d,e){this.trigger("mouseout")}.bind(this))},_onLayerAdded:function(a,b){a.setDataProvider(new f(this,b)),a.bind("change:cartocss",function(a,b){var c=a.get("order")-1;this.setCartoCSS(c,b)},this),a.bind("change:meta",function(a,c){this.options.styles[b]=c.cartocss},this)},_onURLsChanged:function(){this.setUrl(this.model.getTileURLTemplates()[0])},onAdd:function(a){d.prototype.onAdd.call(this,a),this.trigger("added",this),this.added=!0},_modelUpdated:function(){}});b.exports=g},{"../data-providers/geojson/data-provider":252,"./leaflet-layer-view":313,"d3.cartodb":197}],311:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view"),g=function(a){return{url:"http://{s}.basemaps.cartocdn.com/"+a+"_all/{z}/{x}/{y}.png",subdomains:"abcd",minZoom:0,maxZoom:18,attribution:'Map designs by <a href="http://stamen.com/">Stamen</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, Provided by <a href="https://carto.com">CARTO</a>'}},h=function(a){return{url:"https://{s}.maps.nlp.nokia.com/maptile/2.1/maptile/newest/"+a+".day/{z}/{x}/{y}/256/png8?lg=eng&token=A7tBPacePg9Mj_zghvKt9Q&app_id=KuYppsdXZznpffJsKT24",subdomains:"1234",minZoom:0,maxZoom:21,attribution:'©2012 Nokia <a href="http://here.net/services/terms" target="_blank">Terms of use</a>'}},i={roadmap:h("normal"),gray_roadmap:g("light"),dark_roadmap:g("dark"),hybrid:h("hybrid"),terrain:h("terrain"),satellite:h("satellite")},j=e.TileLayer.extend({initialize:function(a,b){var c=i[a.get("base_type")];e.TileLayer.prototype.initialize.call(this,c.url,{tms:!1,attribution:c.attribution,minZoom:c.minZoom,maxZoom:c.maxZoom,subdomains:c.subdomains,errorTileUrl:"",opacity:1}),f.call(this,a,this,b)}});d.extend(j.prototype,f.prototype,{_modelUpdated:function(){}}),b.exports=j},{"./leaflet-layer-view":313,leaflet:208,underscore:"underscore"}],312:[function(a,b,c){var d=a("cdb.log"),e=a("./leaflet-tiled-layer-view"),f=a("./leaflet-wms-layer-view"),g=a("./leaflet-plain-layer-view"),h=a("./leaflet-gmaps-tiled-layer-view"),i=a("./leaflet-cartodb-layer-group-view"),j=a("./leaflet-torque-layer-view"),k=a("./leaflet-cartodb-vector-layer-group-view"),l=function(a,b,c){if(c.vector){var d=new k(a,b);return d}return new i(a,b)},m=function(a){a=a||{},this._vector=a.vector};m.prototype._constructors={tiled:e,wms:f,plain:g,gmapsbase:h,layergroup:l,torque:j},m.prototype.createLayerView=function(a,b){var c=a.get("type").toLowerCase(),e=this._constructors[c];if(e)try{return new e(a,b,{vector:this._vector})}catch(f){throw d.error("Error creating an instance of layer view for '"+c+"' layer -> "+f.message),f}else d.error("Error creating an instance of layer view for '"+c+"' layer. Type is not supported")},b.exports=m},{"./leaflet-cartodb-layer-group-view":309,"./leaflet-cartodb-vector-layer-group-view":310,"./leaflet-gmaps-tiled-layer-view":311,"./leaflet-plain-layer-view":315,"./leaflet-tiled-layer-view":316,"./leaflet-torque-layer-view":317,"./leaflet-wms-layer-view":318,"cdb.log":223}],313:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=function(a,b,c){this.leafletLayer=b,this.leafletMap=c,this.model=a,this.setModel(a);var d=a.get("type")||a.get("kind");this.type=d&&d.toLowerCase()};d.extend(f.prototype,e.Events),d.extend(f.prototype,{setModel:function(a){this.model&&this.model.unbind("change",this._modelUpdated,this),this.model=a,this.model.bind("change",this._modelUpdated,this)},remove:function(){this.leafletMap.removeLayer(this.leafletLayer),this.trigger("remove",this),this.model.unbind(null,null,this),this.unbind()},reload:function(){this.leafletLayer.redraw()}}),b.exports=f},{backbone:"backbone",underscore:"underscore"}],314:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("leaflet"),g=a("../map-view"),h=a("../../core/view"),i=a("../../core/sanitize"),j=a("./leaflet-layer-view-factory"),k=g.extend({initialize:function(){g.prototype.initialize.call(this);var a=this;e.bindAll(this,"_addLayer","_removeLayer","_setZoom","_setCenter","_setView");var b=this.map.get("center"),c={zoomControl:!1,center:new f.LatLng(b[0],b[1]),zoom:this.map.get("zoom"),minZoom:this.map.get("minZoom"),maxZoom:this.map.get("maxZoom"),attributionControl:!1};if(this.isMapAlreadyCreated()){this._leafletMap=this.options.map_object,this.setElement(this._leafletMap.getContainer());var d=a._leafletMap.getCenter();this._setModelProperty({center:[d.lat,d.lng]}),this._setModelProperty({zoom:a._leafletMap.getZoom()}),this.map.unset("view_bounds_sw",{silent:!0}),this.map.unset("view_bounds_ne",{silent:!0})}else this._leafletMap=new f.Map(this.el,c),this.map.get("scrollwheel")===!1&&this._leafletMap.scrollWheelZoom.disable(),this.map.get("keyboard")===!1&&this._leafletMap.keyboard.disable(),this.map.get("drag")===!1&&(this._leafletMap.dragging.disable(),this._leafletMap.doubleClickZoom.disable());this.map.bind("set_view",this._setView,this),this._bindModel(),this.setAttribution(),this._leafletMap.on("layeradd",function(b){this.trigger("layeradd",b,a)},this),this._leafletMap.on("zoomstart",function(){a.trigger("zoomstart")}),this._leafletMap.on("click",function(b){a.trigger("click",b.originalEvent,[b.latlng.lat,b.latlng.lng])}),this._leafletMap.on("dblclick",function(b){a.trigger("dblclick",b.originalEvent)}),this._leafletMap.on("zoomend",function(){a._setModelProperty({zoom:a._leafletMap.getZoom()}),a.trigger("zoomend")},this),this._leafletMap.on("move",function(){var b=a._leafletMap.getCenter();a._setModelProperty({center:[b.lat,b.lng]})}),this._leafletMap.on("dragend",function(){var b=a._leafletMap.getCenter();this.trigger("dragend",[b.lat,b.lng])},this),this._leafletMap.on("moveend",function(){var b=a._leafletMap.getCenter();a.map.trigger("moveend",[b.lat,b.lng])},this),this._leafletMap.on("drag",function(){var b=a._leafletMap.getCenter();a._setModelProperty({center:[b.lat,b.lng]}),a.trigger("drag")},this),this.map.bind("change:maxZoom",function(){f.Util.setOptions(a._leafletMap,{maxZoom:a.map.get("maxZoom")})},this),this.map.bind("change:minZoom",function(){f.Util.setOptions(a._leafletMap,{minZoom:a.map.get("minZoom")})},this),this.trigger("ready");var h=this.map.getViewBounds();h&&this.showBounds(h)},_getLayerViewFactory:function(){return this._layerViewFactory=this._layerViewFactory||new j({vector:this.map.get("vector")}),this._layerViewFactory},_addLayers:function(a,b){function c(a){var b=e.find(g,function(b){var c=b.model;return c.isEqual(a)});return b}function d(a){return f.map.layers.find(function(b){return b.isEqual(a)})}var f=this,g=this._layerViews;this._layerViews={};for(var h in g){var i=g[h];d(i.model)||i.remove()}this.map.layers.each(function(d){var e=c(d);e?(e.setModel(d),f._layerViews[d.cid]=e,f.trigger("newLayerView",e,d,f)):f._addLayer(d,a,{silent:b&&b.silent||!1,index:b&&b.index})})},clean:function(){f.DomEvent.off(window,"resize",this._leafletMap._onResize,this._leafletMap);for(var a in this._layerViews){var b=this._layerViews[a];b.remove(),delete this._layerViews[a]}h.prototype.clean.call(this)},_setKeyboard:function(a,b){b?this._leafletMap.keyboard.enable():this._leafletMap.keyboard.disable()},_setScrollWheel:function(a,b){b?this._leafletMap.scrollWheelZoom.enable():this._leafletMap.scrollWheelZoom.disable()},_setZoom:function(a,b){this._setView()},_setCenter:function(a,b){this._setView()},_setView:function(){this._leafletMap.setView(this.map.get("center"),this.map.get("zoom")||0)},_getNativeMap:function(){return this._leafletMap},_addLayerToMap:function(a,b,c){return this._leafletMap.addLayer(a.leafletLayer),this._reorderLayerViews(),c.silent||this.trigger("newLayerView",a),a},_reorderLayerViews:function(){this.map.layers.each(function(a){var b=this.getLayerViewByLayerCid(a.cid);b&&b.setZIndex(a.get("order"))},this)},getBounds:function(){var a=this._leafletMap.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();return[[b.lat,b.lng],[c.lat,c.lng]]},setAttribution:function(a){var b=this._leafletMap.attributionControl;if(this.isMapAlreadyCreated()&&b){if(a){var c=a.previous("attribution");e.each(c,function(a){b.removeAttribution(i.html(a))})}var d=this.map.get("attribution");e.each(d,function(a){b.addAttribution(i.html(a))})}},getSize:function(){return this._leafletMap.getSize()},panBy:function(a){this._leafletMap.panBy(new f.Point(a.x,a.y))},setCursor:function(a){d(this._leafletMap.getContainer()).css("cursor",a)},getNativeMap:function(){return this._leafletMap},invalidateSize:function(){this._leafletMap.invalidateSize({pan:!1}),this._leafletMap.setView(this.map.get("center"),this.map.get("zoom")||0,{animate:!1})},addMarker:function(a){a.addToMap(this.getNativeMap())},removeMarker:function(a){a.removeFromMap(this.getNativeMap())},hasMarker:function(a){return a.isAddedToMap(this.getNativeMap())},addPath:function(a){a.addToMap(this.getNativeMap())},removePath:function(a){a.removeFromMap(this.getNativeMap())},latLngToContainerPoint:function(a){var b=this.getNativeMap().latLngToContainerPoint(a);return{x:b.x,y:b.y}},containerPointToLatLng:function(a){var b=this.getNativeMap().containerPointToLatLng([a.x,a.y]);return{lat:b.lat,lng:b.lng}}});f.Icon.Default.imagePath=function(){var a,b,c,d,e=document.getElementsByTagName("script"),f=/\/?cartodb[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,b=e.length;b>a;a++)if(c=e[a].src,d=c.match(f)){var g=c.split("/");return delete g[g.length-1],g.join("/")+"themes/css/images"}}(),b.exports=k},{"../../core/sanitize":232,"../../core/view":236,"../map-view":320,"./leaflet-layer-view-factory":312,jquery:"jquery",leaflet:208,underscore:"underscore"}],315:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view"),g=e.Class.extend({includes:e.Mixin.Events,initialize:function(a,b){f.call(this,a,this,b)},onAdd:function(){this.redraw()},onRemove:function(){var a=this.leafletMap.getContainer();a.style.background="none"},_modelUpdated:function(){this.redraw()},redraw:function(){var a=this.leafletMap.getContainer();if(a.style.backgroundColor=this.model.get("color")||"#FFF",this.model.get("image")){var b="transparent url("+this.model.get("image")+") repeat center center";a.style.background=b}},setZIndex:function(){}});d.extend(g.prototype,f.prototype),b.exports=g},{"./leaflet-layer-view":313,leaflet:208,underscore:"underscore"}],316:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view"),g=e.TileLayer.extend({initialize:function(a,b){e.TileLayer.prototype.initialize.call(this,a.get("urlTemplate"),{tms:!!a.get("tms"),attribution:a.get("attribution"),minZoom:a.get("minZoom"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")||"abc",errorTileUrl:a.get("errorTileUrl"),opacity:a.get("opacity")}),f.call(this,a,this,b)},onAdd:function(a){e.TileLayer.prototype.onAdd.call(this,a);var b=this.getContainer();b.style.pointerEvents="none"}});d.extend(g.prototype,f.prototype,{_modelUpdated:function(){d.extend(this.leafletLayer.options,{subdomains:this.model.get("subdomains")||"abc",attribution:this.model.get("attribution"),maxZoom:this.model.get("maxZoom"),minZoom:this.model.get("minZoom"),tms:!!this.model.get("tms")}),this.leafletLayer.setUrl(this.model.get("urlTemplate"))}}),b.exports=g},{"./leaflet-layer-view":313,leaflet:208,underscore:"underscore"}],317:[function(a,b,c){a("torque.js");var d=a("underscore"),e=a("cdb.core.util"),f=a("./leaflet-layer-view"),g=a("../torque-layer-view-base"),h=L.TorqueLayer.extend({initialize:function(a,b){var c=this._getQuery(a),g=this._initialAttrs(a);d.extend(g,{dynamic_cdn:a.get("dynamic_cdn"),instanciateCallback:function(){var b=a.get("cartocss")||a.get("tile_style");return"_cdbct_"+e.uniqueCallbackName(b+c)}}),L.TorqueLayer.prototype.initialize.call(this,g),f.call(this,a,this,b),this.fire=this.trigger,this._init(a)},_modelUpdated:function(a){var b=this.model.changedAttributes();b!==!1&&("visible"in b&&(this.model.get("visible")?this.show():this.hide()),"cartocss"in b&&this.setCartoCSS(this.model.get("cartocss")),"tileURLTemplates"in b&&(this.provider.templateUrl=this.model.getTileURLTemplates()[0],d.extend(this.provider.options,this.model.get("meta")),this.model.set(this.model.get("meta")),setTimeout(function(){this.provider._setReady(!0),this._reloadTiles()}.bind(this),0)))}});d.extend(h.prototype,f.prototype),d.extend(h.prototype,g),b.exports=h},{"../torque-layer-view-base":341,"./leaflet-layer-view":313,"cdb.core.util":235,"torque.js":"torque.js",underscore:"underscore"}],318:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view.js"),g=e.TileLayer.WMS.extend({initialize:function(a,b){e.TileLayer.WMS.prototype.initialize.call(this,a.get("urlTemplate"),{attribution:a.get("attribution"),layers:a.get("layers"),format:a.get("format"),transparent:a.get("transparent"),minZoom:a.get("minZomm"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")||"abc",errorTileUrl:a.get("errorTileUrl"),opacity:a.get("opacity")}),f.call(this,a,this,b)}});d.extend(g.prototype,f.prototype,{_modelUpdated:function(){d.defaults(this.leafletLayer.options,d.clone(this.model.attributes)),this.leafletLayer.setUrl(this.model.get("urlTemplate"))}}),b.exports=g},{"./leaflet-layer-view.js":313,leaflet:208,underscore:"underscore"}],319:[function(a,b,c){var d=a("cdb"),e=function(){};e.prototype.createMapView=function(a,b,c,e){var f;if("leaflet"===a)f=d.geo.LeafletMapView;else{if("googlemaps"!==a)throw new Error(a+" provider is not supported");
if("undefined"==typeof google||"undefined"==typeof google.maps)throw new Error("Google maps library should be included");f=d.geo.GoogleMapsMapView}return new f({el:c,map:b,layerGroupModel:e})},b.exports=e},{cdb:222}],320:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=a("../core/view"),g=a("./ui/overlays-container.tpl"),h=["fullscreen","search","attribution","zoom","logo"],i=a("./geometry-views/geometry-view-factory"),j=f.extend({initialize:function(){if(this.options=this.options||{},void 0===this.options.map)throw new Error("map is required");if(void 0===this.options.layerGroupModel)throw new Error("layerGroupModel is required");this._cartoDBLayerGroup=this.options.layerGroupModel,this.map=this.options.map,this.add_related_model(this.map),this._cartoDBLayerGroupView=null,this.autoSaveBounds=!1,this._layerViews={},this.map.layers.bind("reset",this._addLayers,this),this.map.layers.bind("add",this._addLayer,this),this.map.layers.bind("remove",this._removeLayer,this),this.add_related_model(this.map.layers),this.bind("clean",this._removeLayers,this),this.map.geometries.on("add",this._onGeometryAdded,this),this.add_related_model(this.map.geometries)},_getLayerViewFactory:function(){throw new Error("subclasses of MapView must implement _getLayerViewFactory")},setCursor:function(){throw new Error("subclasses of MapView must implement setCursor")},addMarker:function(a){throw new Error("subclasses of MapView must implement addMarker")},removeMarker:function(a){throw new Error("subclasses of MapView must implement removeMarker")},hasMarker:function(a){throw new Error("subclasses of MapView must implement hasMarker")},addPath:function(a){throw new Error("subclasses of MapView must implement addPath")},removePath:function(a){throw new Error("subclasses of MapView must implement removePath")},latLngToContainerPoint:function(a){throw new Error("subclasses of MapView must implement latLngToContainerPoint")},containerPointToLatLng:function(a){throw new Error("subclasses of MapView must implement containerPointToLatLng")},_onGeometryAdded:function(a){var b=i.createGeometryView(this.map.get("provider"),a,this);b.render()},render:function(){return this.$el.append(g()),this._addLayers(),this},addInfowindow:function(a){this.addOverlay(a)},addOverlay:function(a){var b;a&&(b=a.type,b&&h.indexOf(b)>=0?this._overlayContainer().append(a.render().el):this.$el.append(a.render().el),this.addView(a))},isMapAlreadyCreated:function(){return this.options.map_object},_overlayContainer:function(){return this.$(".CDB-OverlayContainer")},_setModelProperty:function(a){if(this._unbindModel(),this.map.set(a),void 0!==a.center||void 0!==a.zoom){var b=this.getBounds();this.map.set({view_bounds_sw:b[0],view_bounds_ne:b[1]}),this.autoSaveBounds&&this._saveLocation()}this._bindModel()},_bindModel:function(){this._unbindModel(),this.map.bind("change:view_bounds_sw",this._changeBounds,this),this.map.bind("change:view_bounds_ne",this._changeBounds,this),this.map.bind("change:zoom",this._setZoom,this),this.map.bind("change:scrollwheel",this._setScrollWheel,this),this.map.bind("change:keyboard",this._setKeyboard,this),this.map.bind("change:center",this._setCenter,this),this.map.bind("change:attribution",this.setAttribution,this)},_unbindModel:function(){this.map.unbind("change:view_bounds_sw",null,this),this.map.unbind("change:view_bounds_ne",null,this),this.map.unbind("change:zoom",null,this),this.map.unbind("change:scrollwheel",null,this),this.map.unbind("change:keyboard",null,this),this.map.unbind("change:center",null,this),this.map.unbind("change:attribution",null,this)},_changeBounds:function(){var a=this.map.getViewBounds();a&&this.showBounds(a)},showBounds:function(a){this.map.fitBounds(a,this.getSize())},_addLayers:function(a,b){var c=this;this._removeLayers(),this.map.layers.each(function(d){c._addLayer(d,a,{silent:b&&b.silent||!1,index:b&&b.index})})},_addLayer:function(a,b,c){var d;d="CartoDB"===a.get("type")?this._addGroupedLayer(a):this._addIndividualLayer(a),d&&this._addLayerToMap(d,a,{silent:c.silent,index:c.index})},_addGroupedLayer:function(a){if(this._cartoDBLayerGroupView)return void(this._layerViews[a.cid]=this._cartoDBLayerGroupView);var b=this._createLayerView(this._cartoDBLayerGroup);return this._cartoDBLayerGroupView=b,this._layerViews[a.cid]=b,b},_addIndividualLayer:function(a){var b=this._createLayerView(a);return b&&(this._layerViews[a.cid]=b),b},_createLayerView:function(a){return this._getLayerViewFactory().createLayerView(a,this.getNativeMap())},_removeLayers:function(){for(var a in this._layerViews){var b=this._layerViews[a];b.remove(),delete this._layerViews[a]}},_removeLayer:function(a){var b=this._layerViews[a.cid];"CartoDB"===a.get("type")?0===this.map.layers.getCartoDBLayers().length&&(b.remove(),this._cartoDBLayerGroupView=null):b.remove(),delete this._layerViews[a.cid]},getLayerViewByLayerCid:function(a){var b=this._layerViews[a];return b||e.debug("layer with cid "+a+" can't be get"),b},setAttribution:function(){throw new Error("Subclasses of src/geo/map-view.js must implement .setAttribution")},getNativeMap:function(){throw new Error("Subclasses of src/geo/map-view.js must implement .getNativeMap")},_addLayerToMap:function(){throw new Error("Subclasses of src/geo/map-view.js must implement ._addLayerToMap")},_setZoom:function(a,b){throw new Error("Subclasses of src/geo/map-view.js must implement ._setZoom")},_setCenter:function(a,b){throw new Error("Subclasses of src/geo/map-view.js must implement ._setCenter")},_addGeomToMap:function(a){throw new Error("Subclasses of src/geo/map-view.js must implement ._addGeomToMap")},_removeGeomFromMap:function(a){throw new Error("Subclasses of src/geo/map-view.js must implement ._removeGeomFromMap")},setAutoSaveBounds:function(){this.autoSaveBounds=!0},_saveLocation:d.debounce(function(){this.map.save(null,{silent:!0})},1e3)});b.exports=j},{"../core/view":236,"./geometry-views/geometry-view-factory":278,"./ui/overlays-container.tpl":375,"cdb.log":223,underscore:"underscore"}],321:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("backbone"),g=a("cdb.config"),h=a("cdb.log"),i=a("../core/model"),j=a("./map/layers"),k=a("../core/sanitize"),l=a("./geometry-models/geometry-factory"),m=i.extend({defaults:{attribution:[g.get("cartodb_attributions")],center:[0,0],zoom:4,minZoom:0,maxZoom:20,scrollwheel:!0,drag:!0,keyboard:!0,provider:"leaflet",vector:!1,popupsEnabled:!0,isFeatureInteractivityEnabled:!1},initialize:function(a,b){if(b=b||{},!b.layersFactory)throw new Error("layersFactory is required");this._layersFactory=b.layersFactory,a=a||{},this.layers=b.layersCollection||new j,this.geometries=new f.Collection;var c=a.center||this.defaults.center;"string"==typeof c&&(c=JSON.parse(c)),this.set({center:c,original_center:c}),a.bounds?(this.set({view_bounds_sw:a.bounds[0],view_bounds_ne:a.bounds[1],original_view_bounds_sw:a.bounds[0],original_view_bounds_ne:a.bounds[1]}),this.unset("bounds")):this.set({zoom:a.zoom||this.defaults.zoom}),this.layers.bind("reset",this._updateAttributions,this),this.layers.bind("add",this._updateAttributions,this),this.layers.bind("remove",this._updateAttributions,this),this.layers.bind("change:attribution",this._updateAttributions,this),this.layers.bind("reset",this._onLayersResetted,this),this._updateAttributions()},_onLayersResetted:function(){this.layers.size()>=1&&this._adjustZoomtoLayer(this.layers.first())},_updateAttributions:function(){var a=this.defaults.attribution[0],b=d.chain(this.layers.models).map(function(a){return k.html(a.get("attribution"))}).reject(function(b){return b===a}).compact().uniq().value();b.push(a),this.set("attribution",b)},createCartoDBLayer:function(a,b){return this._checkProperties(a,["sql|source","cartocss"]),this._addNewLayerModel("cartodb",a,b)},createTorqueLayer:function(a,b){return this._checkProperties(a,["sql|source","cartocss"]),this._addNewLayerModel("torque",a,b)},createTileLayer:function(a,b){return this._checkProperties(a,["urlTemplate"]),this._addNewLayerModel("tiled",a,b)},createWMSLayer:function(a,b){return this._checkProperties(a,["urlTemplate"]),this._addNewLayerModel("wms",a,b)},createGMapsBaseLayer:function(a,b){return this._checkProperties(a,["base_type"]),this._addNewLayerModel("gmapsbase",a,b)},createPlainLayer:function(a,b){return this._checkProperties(a,["image|color"]),this._addNewLayerModel("plain",a,b)},_checkProperties:function(a,b){var c=d.select(b,function(b){var c=b.split("|");return d.all(c,function(b){return void 0===a[b]})});if(c.length)throw new Error("The following attributes are missing: "+c.join(","))},_addNewLayerModel:function(a,b,c){c=c||{};var d=this._layersFactory.createLayer(a,b);return this.listenTo(d,"destroy",this._removeLayerModelFromCollection),this.layers.add(d,{silent:c.silent,at:c.at}),d},_removeLayerModelFromCollection:function(a){return this.layers.remove(a)},disableInteractivity:function(){this.disablePopups(),this.disableFeatureInteractivity()},enableInteractivity:function(){this.enablePopups(),this.enableFeatureInteractivity()},enableFeatureInteractivity:function(){this.set("isFeatureInteractivityEnabled",!0)},disableFeatureInteractivity:function(){this.set("isFeatureInteractivityEnabled",!1)},isFeatureInteractivityEnabled:function(){return!!this.get("isFeatureInteractivityEnabled")},enablePopups:function(){this.set("popupsEnabled",!0)},disablePopups:function(){this.set("popupsEnabled",!1)},arePopupsEnabled:function(){return!!this.get("popupsEnabled")},arePopupsDisabled:function(){return!this.arePopupsEnabled()},drawPoint:function(){return this._drawGeometry(l.createPoint({editable:!0}))},drawPolyline:function(){return this._drawGeometry(l.createPolyline({editable:!0}))},drawPolygon:function(){return this._drawGeometry(l.createPolygon({editable:!0}))},_drawGeometry:function(a){return this.trigger("enterDrawingMode",a),a},stopDrawingGeometry:function(){this.trigger("exitDrawingMode")},editGeometry:function(a){var b=l.createGeometryFromGeoJSON(a,{editable:!0,expandable:!0});return this.trigger("enterEditMode",b),b},stopEditingGeometry:function(a){this.trigger("exitEditMode")},setView:function(a,b){this.set({center:a,zoom:b},{silent:!0}),this.trigger("set_view")},setZoom:function(a){this.set({zoom:a})},enableKeyboard:function(){this.set({keyboard:!0})},disableKeyboard:function(){this.set({keyboard:!1})},enableScrollWheel:function(){this.set({scrollwheel:!0})},disableScrollWheel:function(){this.set({scrollwheel:!1})},getZoom:function(){return this.get("zoom")},setCenter:function(a){this.set({center:a})},setOptions:function(a){if("object"!=typeof a||a.length){if(this.options.debug)throw a+" options has to be an object"}else d.defaults(this.options,a)},getViewBounds:function(){return this.has("view_bounds_sw")&&this.has("view_bounds_ne")?[this.get("view_bounds_sw"),this.get("view_bounds_ne")]:null},getLayerAt:function(a){return this.layers.at(a)},getLayerById:function(a){return this.layers.get(a)},getLayerViewByLayerCid:function(a){return this.layers.get(a)},_adjustZoomtoLayer:function(a){var b=parseInt(a.get("maxZoom"),10),c=parseInt(a.get("minZoom"),10);d.isNumber(b)&&!d.isNaN(b)&&(this.get("zoom")>b?this.set({zoom:b,maxZoom:b}):this.set("maxZoom",b)),d.isNumber(c)&&!d.isNaN(c)&&(this.get("zoom")<c?this.set({minZoom:c,zoom:c}):this.set("minZoom",c))},addLayer:function(a,b){return 0===this.layers.size()&&this._adjustZoomtoLayer(a),this.layers.add(a,b),this.trigger("layerAdded"),1===this.layers.length&&this.trigger("firstLayerAdded"),a.cid},removeLayer:function(a){this.layers.remove(a)},removeLayerByCid:function(a){var b=this.layers.get(a);b?this.removeLayer(b):h.error("There's no layer with cid = "+a+".")},removeLayerAt:function(a){var b=this.layers.at(a);b?this.removeLayer(b):h.error("There's no layer in that position.")},clearLayers:function(){for(;this.layers.length>0;)this.removeLayer(this.layers.at(0))},getBaseLayer:function(){return this.layers.at(0)},isBaseLayerAdded:function(a){var b=this.getBaseLayer();return b&&a.isEqual(b)},getLayerTemplate:function(){var a=this.getBaseLayer();return a&&a.get("options")?a.get("options").urlTemplate:void 0},addGeometry:function(a){this.geometries.add(a)},removeGeometry:function(a){this.geometries.remove(a)},reCenter:function(){var a=this.get("original_view_bounds_sw"),b=this.get("original_view_bounds_ne"),c=this.get("original_center");a&&b?this.setBounds([a,b]):this.setCenter(c)},setBounds:function(a){this.attributes.view_bounds_sw=[a[0][0],a[0][1]],this.attributes.view_bounds_ne=[a[1][0],a[1][1]],this.trigger("change:view_bounds_ne",this)},fitBounds:function(a,b){var c=this.getBoundsZoom(a,b);if(null!==c){var d=m.latlngToMercator(a[0],c),e=m.latlngToMercator(a[1],c),f=m.mercatorToLatLng({x:.5*(d[0]+e[0]),y:.5*(d[1]+e[1])},c);this.set({center:f,zoom:c})}},getBoundsZoom:function(a,b){if(0===b.x||0===b.y)return null;var c,d,e=[b.x,b.y],f=this.get("minZoom")||0,g=this.get("maxZoom")||24,h=a[1],i=a[0],j=[],k=!0;do f++,c=m.latlngToMercator(h,f),d=m.latlngToMercator(i,f),j[0]=Math.abs(c[0]-d[0]),j[1]=Math.abs(d[1]-c[1]),k=j[0]<=e[0]&&j[1]<=e[1];while(k&&g>=f);return k?g:f-1}},{PROVIDERS:{GMAPS:"googlemaps",LEAFLET:"leaflet"},latlngToMercator:function(a,b){var c=new e.LatLng(a[0],a[1]),d=e.CRS.EPSG3857.latLngToPoint(c,b);return[d.x,d.y]},mercatorToLatLng:function(a,b){var c=e.CRS.EPSG3857.pointToLatLng(a,b);return[c.lat,c.lng]}});b.exports=m},{"../core/model":230,"../core/sanitize":232,"./geometry-models/geometry-factory":263,"./map/layers":326,backbone:"backbone","cdb.config":220,"cdb.log":223,leaflet:208,underscore:"underscore"}],322:[function(a,b,c){var d=a("underscore"),e=a("../../cdb.config"),f=a("./layer-model-base"),g=a("./infowindow-template"),h=a("./tooltip-template"),i=a("./legends/legends"),j=f.extend({defaults:{type:"CartoDB",attribution:e.get("cartodb_attributions"),visible:!0},ATTRIBUTES_THAT_TRIGGER_VIS_RELOAD:["sql","source","sql_wrap","cartocss"],initialize:function(a,b){if(a=a||{},b=b||{},!b.vis)throw new Error("vis is required");this._vis=b.vis,a&&a.cartocss&&this.set("initialStyle",a.cartocss),this.infowindow=new g(a.infowindow),this.tooltip=new h(a.tooltip),this.unset("infowindow"),this.unset("tooltip"),this.legends=new i(a.legends,{visModel:this._vis}),this.unset("legends"),this.bind("change",this._onAttributeChanged,this),f.prototype.initialize.apply(this,arguments)},_onAttributeChanged:function(){var a=d.any(this.ATTRIBUTES_THAT_TRIGGER_VIS_RELOAD,function(a){return this.hasChanged(a)?"cartocss"===a&&this._dataProvider?!1:!0:void 0},this);a&&this._reloadVis()},_reloadVis:function(){this._vis.reload({sourceId:this.get("id")})},restoreCartoCSS:function(){this.set("cartocss",this.get("initialStyle"))},isVisible:function(){return this.get("visible")},_hasInfowindowFields:function(){return this.infowindow.hasFields()},_hasTooltipFields:function(){return this.tooltip.hasFields()},getGeometryType:function(){if(this._dataProvider){var a=this._dataProvider._layerIndex,b=this._dataProvider._vectorLayerView.renderers[a];return b.inferGeometryType()}return null},getInteractiveColumnNames:function(){return d.chain(["cartodb_id"]).union(this.infowindow.getFieldNames()).union(this.tooltip.getFieldNames()).uniq().value()},isInfowindowEnabled:function(){return this.infowindow.hasTemplate()},isTooltipEnabled:function(){return this.tooltip.hasTemplate()},getName:function(){return this.get("layer_name")},setDataProvider:function(a){this._dataProvider=a},getDataProvider:function(){return this._dataProvider}});b.exports=j},{"../../cdb.config":220,"./infowindow-template":324,"./layer-model-base":325,"./legends/legends":333,"./tooltip-template":338,underscore:"underscore"}],323:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({OPTIONS:["roadmap","satellite","terrain","custom"],defaults:{type:"GMapsBase",visible:!0,base_type:"gray_roadmap",style:null}});b.exports=e},{"./layer-model-base":325}],324:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./popup-fields"),g=e.Model.extend({defaults:{offset:[28,0],maxHeight:180,alternative_names:{}},initialize:function(a){a=a||{},this.fields=new f(a.fields||[]),this.unset("fields")},update:function(a){a=d.clone(a),this.fields.equals(a.fields)||this.fields.reset(a.fields),delete a.fields,a.alternative_names&&(a.alternative_names=JSON.parse(JSON.stringify(a.alternative_names))),this.set(a)},getFieldNames:function(){return this.fields.pluck("name")},hasFields:function(){return!this.fields.isEmpty()},hasTemplate:function(){return!!this.get("template")}});b.exports=g},{"./popup-fields":336,backbone:"backbone",underscore:"underscore"}],325:[function(a,b,c){var d=a("underscore"),e=a("../../cdb.log"),f=a("../../cdb"),g=a("../../core/model"),h=g.extend({initialize:function(){this.bind("change:type",function(){e.error("changing layer type is not allowed, remove it and add a new one instead")})},remove:function(){this.trigger("destroy",this)},update:function(a,b){b=b||{},this.set(a,{silent:b.silent})},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},toggle:function(){this.set("visible",!this.get("visible"))},setOk:function(){this.unset("error")},setError:function(a){this.set("error",a)},isEqual:function(a){var b=this.toJSON(),c=a.toJSON(),e=["id","order"];d.each(e,function(a){delete b[a],delete c[a],b.options&&delete b.options[a],c.options&&delete c.options[a]});var g,h,i=b.type?b.type:b.options.type,j=c.type?c.type:c.options.type;if(i&&i===j){if("Tiled"===i){g=b.urlTemplate?b.urlTemplate:b.options.urlTemplate,h=c.urlTemplate?c.urlTemplate:c.options.urlTemplate;var k=b.name?b.name:b.options.name,l=c.name?c.name:c.options.name;return g===h&&k===l}if("WMS"===i){g=b.urlTemplate?b.urlTemplate:b.options.urlTemplate,h=c.urlTemplate?c.urlTemplate:c.options.urlTemplate;var m=b.layers?b.layers:b.options.layers,n=c.layers?c.layers:c.options.layers;return g===h&&m===n}if("torque"===i)return f.geo.TorqueLayer.prototype.isEqual.call(this,a);if("named_map"===i)return f.geo.CartoDBNamedMapLayer.prototype.isEqual.call(this,a);var o=b.base_type?b.base_type:b.options.base_type;return o?d.isEqual(b,c)?!0:!1:!0}return!1}});b.exports=h},{"../../cdb":222,"../../cdb.log":223,"../../core/model":230,underscore:"underscore"}],326:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f="Tiled",g="CartoDB",h="torque",i=e.Collection.extend({initialize:function(){this.comparator=function(a){return parseInt(a.get("order"),10)},this.bind("add",this._assignIndexes),this.bind("remove",this._assignIndexes)},_assignIndexes:function(a,b,c){if(this.size()>0&&(this.at(0).set({order:0}),this.size()>1)){var e=this.reduce(function(a,b,c){var d=b.get("type");return 0===c&&d===f?a:(a[d]=a[d]||[],a[d].push(b),a)},{}),i=1,j=[g,h,f];d.each(j,function(a){var b=e[a]||[];d.each(b,function(a){a.set({order:i}),i+=1})})}this.sort()},getCartoDBLayers:function(){return this._getLayersByType(g)},getTiledLayers:function(){return this._getLayersByType(f)},getTorqueLayers:function(){return this._getLayersByType(h)},_getLayersByType:function(a){return this.select(function(b){return b.get("type")===a})},getLayersWithLegends:function(){return this.select(function(a){return!!a.legends})}});b.exports=i},{backbone:"backbone",underscore:"underscore"}],327:[function(a,b,c){var d=a("underscore"),e=a("./legend-model-base"),f=e.extend({defaults:function(){return d.extend(e.prototype.defaults.apply(this),{type:"bubble",fillColor:"",prefix:"",suffix:"",values:[]})},getNonResettableAttrs:function(){return d.union(e.prototype.getNonResettableAttrs.apply(this),["values"])},isAvailable:function(){return this.get("values")&&this.get("values").length>0}});b.exports=f},{"./legend-model-base":332,underscore:"underscore"}],328:[function(a,b,c){var d=a("underscore"),e=a("./legend-model-base"),f=e.extend({defaults:function(){return d.extend(e.prototype.defaults.apply(this),{type:"category",categories:[]})},getNonResettableAttrs:function(){return d.union(e.prototype.getNonResettableAttrs.apply(this),["categories"])},isAvailable:function(){return this.get("categories")&&this.get("categories").length>0}});b.exports=f},{"./legend-model-base":332,underscore:"underscore"}],329:[function(a,b,c){var d=a("underscore"),e=a("./legend-model-base"),f=e.extend({defaults:function(){return d.extend(e.prototype.defaults.apply(this),{type:"choropleth",prefix:"",suffix:"",leftLabel:"",rightLabel:"",colors:[]})},getNonResettableAttrs:function(){return d.union(e.prototype.getNonResettableAttrs.apply(this),["colors"])},isAvailable:function(){return this.get("colors")&&this.get("colors").length>0}});b.exports=f},{"./legend-model-base":332,underscore:"underscore"}],330:[function(a,b,c){var d=a("underscore"),e=a("./static-legend-model-base"),f=e.extend({defaults:function(){return d.extend(e.prototype.defaults.apply(this),{type:"custom_choropleth",prefix:"",suffix:"",leftLabel:"",rightLabel:"",colors:[]})}});b.exports=f},{"./static-legend-model-base":334,underscore:"underscore"}],331:[function(a,b,c){var d=a("underscore"),e=a("./static-legend-model-base"),f=e.extend({defaults:function(){return d.extend(e.prototype.defaults.apply(this),{type:"custom",items:[],html:""})}});b.exports=f},{"./static-legend-model-base":334,underscore:"underscore"}],332:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=["state","visible"],g=e.Model.extend({defaults:function(){return{visible:!1,title:"",preHTMLSnippet:"",postHTMLSnippet:"",state:this.constructor.STATE_LOADING}},initialize:function(a,b){if(!b.visModel)throw new Error("visModel is required");b.visModel.on("reload",this._onVisReloading,this)},_onVisReloading:function(){this.set("state",this.constructor.STATE_LOADING)},isLoading:function(){return this.get("state")===this.constructor.STATE_LOADING},isError:function(){return this.get("state")===this.constructor.STATE_ERROR},isSuccess:function(){return this.get("state")===this.constructor.STATE_SUCCESS},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},isVisible:function(){return this.get("visible")},update:function(a){this.set(a)},getNonResettableAttrs:function(){return f},reset:function(){var a=d.omit(this.defaults(),this.getNonResettableAttrs());this.set(a)},isAvailable:function(){return!1}},{STATE_LOADING:"loading",STATE_SUCCESS:"success",STATE_ERROR:"error"});b.exports=g},{backbone:"backbone",underscore:"underscore"}],333:[function(a,b,c){var d=a("underscore"),e=a("./category-legend-model"),f=a("./bubble-legend-model"),g=a("./choropleth-legend-model"),h=a("./custom-legend-model"),i=a("./custom-choropleth-legend-model"),j={bubble:{modelClass:f,definitionAttrs:[{fillColor:"color"},{topLabel:"top_label"},{bottomLabel:"bottom_label"}],dynamic:!0},category:{modelClass:e,definitionAttrs:["prefix","suffix"],dynamic:!0},choropleth:{modelClass:g,definitionAttrs:["prefix","suffix",{leftLabel:"left_label"},{rightLabel:"right_label"}],dynamic:!0},custom:{modelClass:h,definitionAttrs:[{items:"categories"},"html"]},html:{modelClass:h,definitionAttrs:[{items:"categories"},"html"]},custom_choropleth:{modelClass:i,definitionAttrs:["prefix","suffix",{leftLabel:"left_label"},{rightLabel:"right_label"},"colors"]}},k=["title",{preHTMLSnippet:"pre_html"},{postHTMLSnippet:"post_html"}],l=function(a,b){if(!b.visModel)throw new Error("visModel is required");this._legendsData=a||[],this._visModel=b.visModel,d.each(j,function(a,b){this[b]=this._createLegendModel(b,a)},this);var c=this._findDataForLegend("html");c&&(this.custom=this.html),delete this.html};l.prototype._createLegendModel=function(a,b){var c=b.modelClass,e=k.concat(b.definitionAttrs),f=this._findDataForLegend(a);f=f&&d.extend({},d.omit(f,"definition"),f.definition);var g={};d.each(e,function(a){var b=a,c=a;d.isObject(a)&&(c=Object.keys(a)[0],b=a[c]),g[c]=f&&f[b]});var h=new c(g,{visModel:this._visModel});return f&&h.show(),h},l.prototype._findDataForLegend=function(a){return d.find(this._legendsData,{type:a})},l.prototype.hasAnyLegend=function(){var a=d.keys(j);return d.some(a,function(a){var b=this[a];return b&&b.isVisible()},this)},b.exports=l},{"./bubble-legend-model":327,"./category-legend-model":328,"./choropleth-legend-model":329,"./custom-choropleth-legend-model":330,"./custom-legend-model":331,underscore:"underscore"}],334:[function(a,b,c){var d=a("underscore"),e=a("./legend-model-base"),f=e.extend({defaults:function(){return d.extend(e.prototype.defaults.apply(this),{state:e.STATE_SUCCESS})},_onVisReloading:function(){},isAvailable:function(){return!0}});b.exports=f},{"./legend-model-base":332,underscore:"underscore"}],335:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({defaults:{type:"Plain",visible:!0,base_type:"plain",className:"plain",color:"#FFFFFF",image:""}});b.exports=e},{"./layer-model-base":325}],336:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=function(a){return d.map(a,"name")},g=e.Collection.extend({equals:function(a){var b=this.toJSON();return d.isEqual(f(b),f(a))}});b.exports=g},{backbone:"backbone",underscore:"underscore"}],337:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({defaults:{type:"Tiled",visible:!0}});b.exports=e},{"./layer-model-base":325}],338:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./popup-fields"),g=e.Model.extend({defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center",template:"",alternative_names:{}},initialize:function(a){a=a||{},this.fields=new f(a.fields||[]),this.unset("fields")},update:function(a){a=d.clone(a),this.fields.equals(a.fields)||this.fields.reset(a.fields),delete a.fields,a.alternative_names&&(a.alternative_names=JSON.parse(JSON.stringify(a.alternative_names))),this.set(a)},getFieldNames:function(){return this.fields.pluck("name")},hasFields:function(){return!this.fields.isEmpty()},hasTemplate:function(){return!!this.get("template")}});b.exports=g},{"./popup-fields":336,backbone:"backbone",underscore:"underscore"}],339:[function(a,b,c){var d=a("underscore"),e=a("./layer-model-base"),f=a("carto"),g=a("./legends/legends"),h=["sql","sql_wrap","source","cartocss"],i=["-torque-frame-count","-torque-time-attribute","-torque-aggregation-function","-torque-data-aggregation","-torque-resolution"],j="Map",k=e.extend({defaults:{type:"torque",visible:!0,isRunning:!1,renderRange:{start:void 0,end:void 0},steps:0,step:0,time:void 0},initialize:function(a,b){if(b=b||{},!b.vis)throw new Error("vis is required");this._vis=b.vis,this.bind("change",this._onAttributeChanged,this),this.legends=new g(a.legends,{visModel:this._vis}),this.unset("legends"),e.prototype.initialize.apply(this,arguments)},_onAttributeChanged:function(){var a=d.any(h,function(a){return this.hasChanged(a)?"cartocss"===a?this.previous("cartocss")&&this._torqueCartoCSSPropsChanged():!0:void 0},this);a&&this._reloadVis()},_torqueCartoCSSPropsChanged:function(){var a=this.get("cartocss"),b=this.previous("cartocss"),c=new f.RendererJS;return!d.isEqual(this._getTorqueLayerCartoCSSProperties(c,a),this._getTorqueLayerCartoCSSProperties(c,b))},_getTorqueLayerCartoCSSProperties:function(a,b){var c=a.render(b),e=c.findLayer({name:j}),f={};return d.each(i,function(a){var b=e&&e.eval(a);b&&(f[a]=b)}),f},_reloadVis:function(){this._vis.reload({sourceId:this.get("id")})},play:function(){this.set("isRunning",!0)},pause:function(){this.set("isRunning",!1)},setStep:function(a){this.set("step",a)},renderRange:function(a,b){this.set("renderRange",{start:a,end:b})},resetRenderRange:function(){this.set("renderRange",{})},isEqual:function(a){var b=["query","query_wrapper","cartocss"],c=this;return this.get("type")===a.get("type")&&d.every(b,function(b){return a.get(b)===c.get(b)})},isVisible:function(){return!0},getName:function(){return this.get("layer_name")},getInteractiveColumnNames:function(){return[]},getInfowindowFieldNames:function(){return[]},fetchAttributes:function(a,b,c){},setDataProvider:function(a){this._dataProvider=a},getDataProvider:function(){return this._dataProvider},timeToStep:function(a){var b=this.get("steps"),c=this.get("start"),d=this.get("end"),e=b*(1e3*a-c)/(d-c);return e},getTileURLTemplates:function(){return this.get("tileURLTemplates")}});b.exports=k},{"./layer-model-base":325,"./legends/legends":333,carto:"carto",underscore:"underscore"}],340:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({defaults:{type:"WMS",visible:!0,service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1}});b.exports=e},{"./layer-model-base":325}],341:[function(a,b,c){var d=a("underscore");b.exports={_initialAttrs:function(a){return{table:a.get("table_name"),user:a.get("user_name"),column:a.get("property"),blendmode:a.get("torque-blend-mode"),resolution:1,countby:"count(cartodb_id)",maps_api_template:a.get("maps_api_template"),stat_tag:a.get("stat_tag"),animationDuration:a.get("torque-duration"),steps:a.get("torque-steps"),sql:this._getQuery(a),visible:a.get("visible"),extra_params:{api_key:a.get("api_key")},attribution:a.get("attribution"),cartocss:a.get("cartocss")||a.get("tile_style"),named_map:a.get("named_map"),auth_token:a.get("auth_token"),no_cdn:a.get("no_cdn"),loop:!(a.get("loop")===!1)}},_init:function(a){a.get("visible")&&this.play(),this.on("tilesLoaded",function(){this.trigger("load")},this),this.on("tilesLoading",function(){this.trigger("loading")},this),this.on("change:time",function(a){this._setModelAttrs({step:a.step,time:a.time,renderRange:{start:a.start,end:a.end}})},this),this.on("change:steps",function(a){this._setModelAttrs({steps:a.steps})},this),this.on("play",function(){this._callModel("play")}),this.on("pause",function(){this._callModel("pause")}),a.set({isRunning:this.isRunning(),time:this.getTime(),step:this.getStep(),steps:a.get("torque-steps")||this.provider&&this.provider.getSteps()||this.options.steps||0}),this._onModel()},_setModelAttrs:function(a){this._unonModel(),this.model.set(a),this._onModel()},_callModel:function(a){this._unonModel();var b=Array.prototype.slice.call(arguments,1);this.model[a].apply(this.model,b),this._onModel()},_onModel:function(){this._unonModel(),this.listenTo(this.model,"change:isRunning",this._isRunningChanged),this.listenTo(this.model,"change:time",this._timeChanged),this.listenTo(this.model,"change:step",this._stepChanged),this.listenTo(this.model,"change:steps",this._stepsChanged),this.listenTo(this.model,"change:renderRange",this._renderRangeChanged)},_unonModel:function(){this.stopListening(this.model,"change:isRunning",this._isRunningChanged),this.stopListening(this.model,"change:time",this._timeChanged),this.stopListening(this.model,"change:step",this._stepChanged),this.stopListening(this.model,"change:steps",this._stepsChanged),this.stopListening(this.model,"change:renderRange",this._renderRangeChanged)},_isRunningChanged:function(a,b){b?this.play():this.pause()},_timeChanged:function(a,b){this.setStep(this.timeToStep(b))},_stepChanged:function(a,b){this.setStep(b)},_stepsChanged:function(a,b){this.setSteps(b)},_renderRangeChanged:function(a,b){d.isObject(b)&&d.isNumber(b.start)&&d.isNumber(b.end)?this.renderRange(b.start,b.end):this.resetRenderRange()},_getQuery:function(a){var b=a.get("query"),c=a.get("query_wrapper");return c&&(b=d.template(c)({sql:b||"select * from "+a.get("table_name")})),b}}},{underscore:"underscore"}],342:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../core/model"),g=a("../../core/template"),h=a("../../core/view"),i=a("../../core/sanitize"),j=h.extend({className:"cartodb-overlay overlay-annotation",defaults:{minZoom:0,maxZoom:40,style:{textAlign:"left",zIndex:5,color:"#ffffff",fontSize:"13",fontFamilyName:"Helvetica",boxColor:"#333333",boxOpacity:.7,boxPadding:10,lineWidth:50,lineColor:"#333333"}},template:g.compile('<div class="content">    <div class="text widget_text">{{{ text }}}</div>    <div class="stick"><div class="ball"></div></div>    </div>',"mustache"),events:{click:"stopPropagation"},stopPropagation:function(a){a.stopPropagation()},initialize:function(){this.template=this.options.template||this.template,this.mapView=this.options.mapView,
this.mobileEnabled=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this._cleanStyleProperties(this.options.style),d.defaults(this.options.style,this.defaults.style),this._setupModels(),this._bindMap()},_setupModels:function(){this.model=new f({display:!0,hidden:!1,text:this.options.text,latlng:this.options.latlng,minZoom:this.options.minZoom||this.defaults.minZoom,maxZoom:this.options.maxZoom||this.defaults.maxZoom}),this.model.on("change:display",this._onChangeDisplay,this),this.model.on("change:text",this._onChangeText,this),this.model.on("change:latlng",this._place,this),this.model.on("change:minZoom",this._applyZoomLevelStyle,this),this.model.on("change:maxZoom",this._applyZoomLevelStyle,this),this.style=new f(this.options.style),this.style.on("change",this._applyStyle,this),this.add_related_model(this.style)},_bindMap:function(){this.mapView.map.bind("change",this._place,this),this.mapView.map.bind("change:zoom",this._applyZoomLevelStyle,this),this.mapView.bind("zoomstart",this.hide,this),this.mapView.bind("zoomend",this.show,this)},_unbindMap:function(){this.mapView.map.unbind("change",this._place,this),this.mapView.map.unbind("change:zoom",this._applyZoomLevelStyle,this),this.mapView.unbind("zoomstart",this.hide,this),this.mapView.unbind("zoomend",this.show,this)},_onChangeDisplay:function(){this.model.get("display")?this.show():this.hide()},_onChangeText:function(){this.$el.find(".text").html(this._sanitizedText())},_sanitizedText:function(){return i.html(this.model.get("text"),this.model.get("sanitizeText"))},_getStandardPropertyName:function(a){if(a){var b=a.split("-");return 1===b.length?a:b[0]+d.map(b.slice(1),function(a){return a.slice(0,1).toUpperCase()+a.slice(1)}).join("")}},_cleanStyleProperties:function(a){var b={};d.each(a,function(a,c){b[this._getStandardPropertyName(c)]=a},this),this.options.style=b},_belongsToCanvas:function(){var a="mobile"===this.options.device?!0:!1;return a===this.mobileEnabled},show:function(a){if(!this.model.get("hidden")&&this._belongsToCanvas()){this.$el.css({opacity:0,display:"inline-table"}),this.$el.stop().animate({opacity:1},{duration:150,complete:function(){a&&a()}})}},hide:function(a){this.$el.stop().fadeOut(150,function(){a&&a()})},_place:function(){var a=this.model.get("latlng"),b=this.style.get("lineWidth"),c=this.style.get("textAlign"),d=this.mapView.latLngToContainerPoint(a);if(d){var e=d.y-this.$el.height()/2,f=d.x+b;"right"===c&&(f=d.x-this.$el.width()-b-this.$el.find(".ball").width()),this.$el.css({top:e,left:f})}},setMinZoom:function(a){this.model.set("minZoom",a)},setMaxZoom:function(a){this.model.set("maxZoom",a)},setPosition:function(a){this.model.set("latlng",a)},setText:function(a){this.model.set("text",a)},setStyle:function(a,b){var c=this._getStandardPropertyName(a);c&&this.style.set(c,b)},_applyStyle:function(){var a=this.style.get("color"),b=this.style.get("textAlign"),c=(this.style.get("boxColor"),this.style.get("boxOpacity"),this.style.get("boxPadding")),d=this.style.get("lineWidth"),e=(this.style.get("lineColor"),this.style.get("fontFamilyName"));this.$text=this.$el.find(".text"),this.$text.css({color:a,textAlign:b}),this.$el.find(".content").css("padding",c),this.$text.css("font-size",this.style.get("fontSize")+"px"),this.$el.css("z-index",this.style.get("zIndex")),this.$el.find(".stick").css({width:d,left:-d});var f="";"Droid Sans"==e?f="droid":"Vollkorn"==e?f="vollkorn":"Open Sans"==e?f="open_sans":"Roboto"==e?f="roboto":"Lato"==e?f="lato":"Graduate"==e?f="graduate":"Gravitas One"==e?f="gravitas_one":"Old Standard TT"==e&&(f="old_standard_tt"),this.$el.removeClass("droid").removeClass("vollkorn").removeClass("roboto").removeClass("open_sans").removeClass("lato").removeClass("graduate").removeClass("gravitas_one").removeClass("old_standard_tt"),this.$el.addClass(f),"right"===b?(this.$el.addClass("align-right"),this.$el.find(".stick").css({left:"auto",right:-d})):this.$el.removeClass("align-right"),this._place(),this._applyZoomLevelStyle()},_getRGBA:function(a,b){return"rgba("+parseInt(a.slice(-6,-4),16)+","+parseInt(a.slice(-4,-2),16)+","+parseInt(a.slice(-2),16)+","+b+" )"},_applyZoomLevelStyle:function(){var a=this.style.get("boxColor"),b=this.style.get("boxOpacity"),c=this.style.get("lineColor"),d=this.model.get("minZoom"),e=this.model.get("maxZoom"),f=this.mapView.map.get("zoom");if(f>=d&&e>=f){var g=this._getRGBA(c,1),h=this._getRGBA(a,b);this.$el.find(".text").animate({opacity:1},150),this.$el.css("background-color",h),this.$el.find(".stick").css("background-color",g),this.$el.find(".ball").css("background-color",g),this.model.set("hidden",!1),this.model.set("display",!0)}else this.model.set("hidden",!0),this.model.set("display",!1)},clean:function(){this._unbindMap(),h.prototype.clean.call(this)},_fixLinks:function(){this.$el.find("a").each(function(a,b){e(this).attr("target","_top")})},render:function(){var a=d.clone(this.model.attributes);a.text=this._sanitizedText(),this.$el.html(this.template(a)),this._fixLinks();var b=this;return setTimeout(function(){b._applyStyle(),b._applyZoomLevelStyle(),b.show()},500),this}});b.exports=j},{"../../core/model":230,"../../core/sanitize":232,"../../core/template":234,"../../core/view":236,jquery:"jquery",underscore:"underscore"}],343:[function(require,module,exports){require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Overlay"> <button type="button" class="CDB-Attribution-button js-button">?</button> <p class="CDB-Attribution-text js-text u-ellipsis">'+(null==(__t=attributions)?"":__t)+"</p> </div>";return __p}},{underscore:"underscore"}],344:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("../../../core/view"),g=a("../../../core/model"),h=a("./attribution-template.tpl"),i=a("../../../core/sanitize");b.exports=f.extend({className:"CDB-Attribution",events:{"click .js-button":"_toggleAttributions",dblclick:"killEvent"},initialize:function(){this.model=new g({visible:!1}),this.map=this.options.map,this._onDocumentClick=this._onDocumentClick.bind(this),this._onDocumentKeyDown=this._onDocumentKeyDown.bind(this),this._initBinds()},render:function(){var a=e.compact(this.map.get("attribution")).join(", "),b="leaflet"!==this.map.get("provider");return this.$el.html(h({attributions:i.html(a)})),this.$el.toggleClass("CDB-Attribution--gmaps",!!b),this},_initBinds:function(){this.model.bind("change:visible",function(a,b){this[b?"_showAttributions":"_hideAttributions"]()},this),this.map.bind("change:attribution",this.render,this),this.add_related_model(this.map)},_enableDocumentBinds:function(){d(document).bind("keydown",this._onDocumentKeyDown),d(document).bind("click",this._onDocumentClick)},_disableDocumentBinds:function(){d(document).unbind("keydown",this._onDocumentKeyDown),d(document).unbind("click",this._onDocumentClick)},_onDocumentKeyDown:function(a){a&&27===a.keyCode&&this._toggleAttributions()},_showAttributions:function(){this.$el.addClass("is-active"),this._enableDocumentBinds()},_hideAttributions:function(){this.$el.removeClass("is-active"),this._disableDocumentBinds()},_toggleAttributions:function(){this.model.set("visible",!this.model.get("visible"))},_onDocumentClick:function(a){d(a.target).closest(this.el).length||this._toggleAttributions()},clean:function(){this._disableDocumentBinds(),f.prototype.clean.call(this)}})},{"../../../core/model":230,"../../../core/sanitize":232,"../../../core/view":236,"./attribution-template.tpl":343,jquery:"jquery",underscore:"underscore"}],345:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-infowindow CDB-infowindow--light js-infowindow"> <div class="CDB-infowindow-close js-close"></div> <div class="CDB-infowindow-container"> ',"undefined"!=typeof loading&&loading&&(__p+=' <div class="CDB-Loader js-loader is-visible"></div> '),__p+=' <div class="CDB-infowindow-bg"> <div class="CDB-infowindow-inner"> <ul class="CDB-infowindow-list js-content"> ',content.fields&&(__p+=" ",_.each(content.fields,function(a){__p+=' <li class="CDB-infowindow-listItem"> ',a.title&&(__p+='<h5 class="CDB-infowindow-subtitle">'+(null==(__t=a.title)?"":_.escape(__t))+"</h5>"),__p+=" ",a.value&&(__p+='<h4 class="CDB-infowindow-title">'+(null==(__t=a.value)?"":_.escape(__t))+"</h4>"),__p+=" </li> "}),__p+=" "),__p+=' </ul> </div> </div> <div class="CDB-hook"> <div class="CDB-hook-inner"></div> </div> </div> </div>';return __p}},{underscore:"underscore"}],346:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../core/sanitize"),g=a("./text");b.exports=g.extend({className:"cartodb-overlay image-overlay",events:{click:"stopPropagation"},default_options:{},stopPropagation:function(a){a.stopPropagation()},initialize:function(){d.defaults(this.options,this.default_options),this.template=this.options.template;var a=this;e(window).on("map_resized",function(){a._place()}),e(window).on("resize",function(){a._place()})},_applyStyle:function(){var a=this.model.get("style"),b=a["box-color"],c=a["box-opacity"],d=a["box-width"];this.$el.find(".text").css(a),this.$el.css("z-index",a["z-index"]);var e="rgba("+parseInt(b.slice(-6,-4),16)+","+parseInt(b.slice(-4,-2),16)+","+parseInt(b.slice(-2),16)+", "+c+" )";this.$el.css({backgroundColor:e}),this.$el.find("img").css({width:d})},render:function(){var a;a=this.model.get("extra").has_default_image?d.template('<img src="<%- url %>" />')({url:this.model.get("extra").public_default_image_url}):f.html(this.model.get("extra").rendered_text,this.model.get("sanitizeContent"));var b=d.chain(this.model.attributes).clone().extend({content:a}).value();this.$el.html(this.template(b));var c=this;return setTimeout(function(){c._applyStyle(),c._place(),c.show()},900),this}})},{"../../core/sanitize":232,"./text":379,jquery:"jquery",underscore:"underscore"}],347:[function(a,b,c){var d=a("underscore"),e=a("../../core/view"),f=a("../../core/template"),g=e.extend({className:"cartodb-infobox",defaults:{pos_margin:20,position:"bottom|right",width:200},initialize:function(){d.defaults(this.options,this.defaults),this.options.layer&&this.enable(),this.setTemplate(this.options.template||this.defaultTemplate,"mustache")},setTemplate:function(a){this.template=f.compile(a,"mustache")},enable:function(){this.options.layer&&this.options.layer.on("featureOver",function(a,b,c,d){this.render(d).show()},this).on("featureOut",function(){this.hide()},this)},disable:function(){this.options.layer&&this.options.layer.off(null,null,this)},setPosition:function(a){var b={};-1!==a.indexOf("top")?b.top=this.options.pos_margin:-1!==a.indexOf("bottom")&&(b.bottom=this.options.pos_margin),-1!==a.indexOf("left")?b.left=this.options.pos_margin:-1!==a.indexOf("right")&&(b.right=this.options.pos_margin),this.$el.css(b)},render:function(a){return this.$el.html(this.template(a)),this.options.width&&this.$el.css("width",this.options.width),this.options.position&&this.setPosition(this.options.position),this}});b.exports=g},{"../../core/template":234,"../../core/view":236,underscore:"underscore"}],348:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./default-infowindow-template.tpl"),g=e.Model.extend({defaults:{offset:[28,0],maxHeight:180,autoPan:!0,template_type:"mustache",content:"",alternative_names:{},visibility:!1},DEFAULT_TEMPLATE:f,TEMPLATE_ATTRIBUTES:["template","template_type","alternative_names","width","maxHeight","offset"],initialize:function(a){this._fields=new e.Collection(a.fields||[]),this.unset("fields",{silent:!0}),this._hasTemplate()||this.set({template:this.DEFAULT_TEMPLATE,template_type:"underscore"})},_hasTemplate:function(){return this.get("template")&&this.get("template").trim&&this.get("template").trim()},updateContent:function(a,b){b=b||{},b=d.pick(b,"showEmptyFields");var c=this._fields.toJSON();this.set("content",g.contentForFields(a,c,b))},setLoading:function(){return this.set({content:{fields:[{type:"loading",title:"loading",value:"…"}]}}),this},setError:function(){return this.set({content:{fields:[{title:null,alternative_name:null,value:"There has been an error...",index:null,type:"error"}],data:{}}}),this},getAlternativeName:function(a){return this.get("alternative_names")&&this.get("alternative_names")[a]},setInfowindowTemplate:function(a){var b=d.pick(a.toJSON(),this.TEMPLATE_ATTRIBUTES);b=d.pick(b,d.identity),this.set(d.clone(b)),this._fields.reset(a.fields.toJSON()),this._infowindowTemplateModel=a},hasInfowindowTemplate:function(a){return this._infowindowTemplateModel&&this._infowindowTemplateModel===a}},{contentForFields:function(a,b,c){c=c||{};for(var d=[],e=0;e<b.length;++e){var f=b[e],g=a[f.name];(c.showEmptyFields||void 0!==g&&null!==g)&&d.push({name:f.name,title:f.title?f.name:null,value:void 0!==g&&null!==g?g:"null",index:e})}return 0===d.length&&d.push({title:null,value:"No data available",index:0,type:"empty"}),{fields:d,data:a}}});b.exports=g},{"./default-infowindow-template.tpl":345,backbone:"backbone",underscore:"underscore"}],349:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("perfect-scrollbar");a("clip-path");var g=a("../../core/sanitize"),h=a("../../core/template"),i=a("../../core/view"),j=a("../../core/util"),k=i.extend({options:{imageTransitionSpeed:300,hookMargin:24,hookHeight:16},className:"CDB-infowindow-wrapper",events:{"click .js-close":"_closeInfowindow","click .close":"_closeInfowindow","touchstart .js-close":"_closeInfowindow","MSPointerDown .js-close":"_closeInfowindow",dragstart:"_checkOrigin",mousedown:"_checkOrigin",touchstart:"_checkOrigin",MSPointerDown:"_checkOrigin",dblclick:"_stopPropagation",DOMMouseScroll:"_stopBubbling",MozMousePixelScroll:"_stopBubbling",mousewheel:"_stopBubbling",dbclick:"_stopPropagation",click:"_stopPropagation"},initialize:function(){this.mapView=this.options.mapView,this._compileTemplate(),this._initBinds(),this.$el.hide()},adjustPan:function(){var a=this.model.get("offset");if(this.model.get("autoPan")&&!this.isHidden()){var b=this.$el.outerHeight(!0)+15,c=this.$el.width(),d=this.mapView.latLngToContainerPoint(this.model.get("latlng")),e={x:0,y:0},f=this.mapView.getSize(),g=0;return d.x-a[0]<0&&(e.x=d.x-a[0]-10),d.x-a[0]+c>f.x&&(e.x=d.x+c-f.x-a[0]+10),d.y-b<0&&(e.y=d.y-b-10),d.y-b>f.y&&(e.y=d.y+b-f.y),(e.x||e.y)&&(this.mapView.panBy(e),g=300),g}},render:function(){if(this.template){var a=d.map(this.model.attributes.content.fields,function(a){return d.clone(a)}),b=this.model.get("content")?this.model.get("content").data:{};a=d.map(a,this._sanitizeField,this);var c={};d.each(a,function(a){c[a.name]=a.value});var e=d.extend({content:{fields:a,data:b}},c);this.$el.html(g.html(this.template(e),this.model.get("sanitizeTemplate"))),this.model.get("width")&&this.$(".js-infowindow").css("width",this.model.get("width")+"px"),this.model.get("maxHeight")&&this._getContent().css("max-height",this.model.get("maxHeight")+"px"),this._containsCover()&&this._loadCover(),this._setupClasses(),this._renderScroll()}return this},_initBinds:function(){d.bindAll(this,"_onKeyUp","_onLoadImage","_onLoadImageError"),this.model.bind("change:content change:alternative_names change:width change:maxHeight",this.render,this),this.model.bind("change:latlng",this._updateAndAdjustPan,this),this.model.bind("change:visibility",this.toggle,this),this.model.bind("change:template change:sanitizeTemplate",this._compileTemplate,this),this.mapView.map.bind("change",this._updatePosition,this),this.mapView.bind("zoomstart",function(){this.hide(!0)},this),this.mapView.bind("zoomend",function(){this.show()},this),this.add_related_model(this.mapView.map),this.add_related_model(this.mapView)},_getContent:function(){var a=this.$(".js-content");return 0===a.length&&(a=this.$(".cartodb-popup-content")),a},_onKeyUp:function(a){a&&27===a.keyCode&&this._closeInfowindow()},_setupClasses:function(){var a=this.$(".js-infowindow"),b=this.$(".js-header").length,c=this.$(".js-cover").length,d=this._getContent().length,e=this.$(".CDB-infowindow-title").length;c&&a.addClass("has-header-image"),b&&a.addClass("has-header"),d&&a.addClass("has-fields"),e&&a.addClass("has-title")},_renderScroll:function(){0!==this._getContent().length&&(this.$(".js-infowindow").addClass("has-scroll"),f.initialize(this._getContent().get(0),{wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20}))},_compileTemplate:function(){var a=this.model.get("template");"function"!=typeof a?this.template=new h({template:a,type:this.model.get("template_type")||"mustache"}).asFunction():this.template=a,this.render()},_checkOrigin:function(a){var b=e(a.target).closest(".jspVerticalBar").length>0&&"touchstart"!==a.type;b||a.stopPropagation()},_sanitizeValue:function(a,b){return d.isObject(b)?b:String(b)},_sanitizeField:function(a){(null===a.value||void 0===a.value)&&(a.value="");var b=this.model.getAlternativeName(a.name);return a.title=a.title&&b?b:a.title,a.value=JSON.parse(JSON.stringify(a.value),this._sanitizeValue),a},_containsCover:function(){return!!this.$(".js-infowindow").attr("data-cover")},_containsTemplateCover:function(){return this.$(".js-cover img").length>0},_getCoverURL:function(){var a=this.model.get("content"),b=this.$(".js-cover img").attr("src");return b?b:a&&a.fields&&a.fields.length>0?(a.fields[0].value||"").toString():!1},_loadImageHook:function(a,b,c){var d=this.$(".js-hook");if(d){var f=e("<img />").attr("src",c);d.append(f),f.attr("data-clipPath","M0,0 L0,16 L24,0 L0,0 Z"),f.clipPath(a.width,a.height,-this.options.hookMargin,a.height-this.options.hookHeight),f.load(function(){d.parent().addClass("has-image"),f.css({marginTop:-b.height,width:b.width})})}},_loadCoverFromTemplate:function(a){this.$(".js-cover img").remove(),this._loadCoverFromUrl(a)},_loadCoverFromUrl:function(a){var b=this.$(".js-cover");this._startCoverLoader();var c=e("<img class='CDB-infowindow-media-item' />").attr("src",a);b.append(c),c.load(this._onLoadImage).error(this._onLoadImageError)},_onLoadImageError:function(){this._stopCoverLoader(),this._showInfowindowImageError()},_onLoadImage:function(){var a=this.$(".js-cover"),b=this.$(".CDB-infowindow-media-item"),c=b.attr("src"),d={width:b.width(),height:b.height()},e={width:a.width(),height:a.height()},f=this._calcImageStyle(d,e);b.css(f),a.css({height:d.height-this.options.hookHeight}),this._stopCoverLoader(),b.fadeIn(150),this._loadImageHook(d,e,c)},_calcImageStyle:function(a,b){var c={},d=a.height/a.width,e=b.height/b.width;return a.width>b.width&&a.height>b.height?e>d&&(c={height:b.height}):c={width:a.width},c},_loadCover:function(){this._renderCoverLoader(),this._startCoverLoader();var a=this._getCoverURL();return this._isValidURL(a)?(this._clearInfowindowImageError(),void(this._containsTemplateCover()?this._loadCoverFromTemplate(a):this._loadCoverFromUrl(a))):void this._showInfowindowImageError()},_renderCoverLoader:function(){var a=e("<div>").addClass("CDB-Loader js-loader");this.$(".js-cover").length>0&&this.$(".js-cover").append(a)},_startCoverLoader:function(){this.$(".js-infowindow").addClass("is-loading"),this.$(".js-loader").addClass("is-visible")},_clearInfowindowImageError:function(){this.$(".js-infowindow").removeClass("is-fail")},_showInfowindowImageError:function(){this.$(".js-infowindow").addClass("is-fail"),this.$(".js-cover").append('<p class="CDB-infowindow-fail">Non-valid picture URL</p>')},_stopCoverLoader:function(){this.$(".js-infowindow").removeClass("is-loading"),this.$(".js-loader").removeClass("is-visible")},_isValidURL:function(a){if(a){var b=/^(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-|]*[\w@?^=%&amp;\/~+#-])?$/;return null!==String(a).match(b)}return!1},toggle:function(){this.model.get("visibility")?this.show(!0):this.hide()},_stopBubbling:function(a){a.preventDefault(),a.stopPropagation()},_stopPropagation:function(a){a.stopPropagation()},_closeInfowindow:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.model.get("visibility")&&this.model.set("visibility",!1)},show:function(a){e(document).off("keyup",this._onKeyUp).on("keyup",this._onKeyUp),this.model.get("visibility")&&(this.$el.css({left:-5e3}),this._update(a))},isHidden:function(){return!this.model.get("visibility")},hide:function(a){e(document).off("keyup",this._onKeyUp),(a||!this.model.get("visibility"))&&this._animateOut()},_updateAndAdjustPan:function(){this._update(!0)},_update:function(a){if(!this.isHidden()){var b=0;a&&(b=this.adjustPan()),this._updatePosition(),this._animateIn(b)}},_animateIn:function(a){!j.ie||j.browser.ie&&j.browser.ie.version>8?(this.$el.css({marginBottom:"-10px",display:"block",visibility:"visible",opacity:0}),this.$el.delay(a).animate({opacity:1,marginBottom:0},300)):this.$el.show()},_animateOut:function(){if(!j.ie||j.browser.ie&&j.browser.ie.version>8){var a=this;this.$el.animate({marginBottom:"-10px",opacity:"0",display:"block"},180,function(){a.$el.css({visibility:"hidden"})})}else this.$el.hide()},_updatePosition:function(){if(!this.isHidden()){var a=this.model.get("offset"),b=this.mapView.latLngToContainerPoint(this.model.get("latlng")),c=b.x-a[0],d=this.mapView.getSize(),e=-1*(b.y-a[1]-d.y);this.$el.css({bottom:e,left:c})}},showInfowindow:function(){this.model.set("visibility",!0)}});b.exports=k},{"../../core/sanitize":232,"../../core/template":234,"../../core/util":235,"../../core/view":236,"clip-path":429,jquery:"jquery","perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],350:[function(a,b,c){var d=a("underscore"),e=a("cdb.templates"),f=a("../../core/view"),g=f.extend({tagName:"li",defaults:{template:'      <a class="layer" href="#/change-layer"><%- layerName %></a>      <a href="#switch" class="right <%- visible ? "enabled" : "disabled" %> switch"><span class="handle"></span></a>    '},events:{click:"_onSwitchClick"},initialize:function(){this.model.has("visible")||this.model.set("visible",!1),this.model.bind("change:visible",this._onSwitchSelected,this),this.add_related_model(this.model),this._onSwitchSelected(),this.template=this.options.template?e.getTemplate(this.options.template):d.template(this.defaults.template)},render:function(){var a={layerName:this.model.getName(),visible:this.model.isVisible()};return this.$el.append(this.template(a)),this},_onSwitchSelected:function(){var a=this.model.get("visible");this.$el.find(".switch").removeClass(a?"disabled":"enabled").addClass(a?"enabled":"disabled"),this.trigger("switchChanged")},_onSwitchClick:function(a){this.killEvent(a),this.model.set("visible",!this.model.get("visible"))}});b.exports=g},{"../../core/view":236,"cdb.templates":224,underscore:"underscore"}],351:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-small is-semibold u-upperCase u-errorTextColor">Sorry, something went wrong.</h2>';return __p}},{underscore:"underscore"}],352:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<h3 class="CDB-Text CDB-Size-small u-upperCase u-bSpace u-altTextColor">'+(null==(__t=title)?"":_.escape(__t))+"</h3>";return __p}},{underscore:"underscore"}],353:[function(a,b,c){var d=a("./error-title.tpl"),e=a("./no-data-available-title.tpl"),f=a("backbone"),g=a("../../../../core/sanitize"),h=a("./legend-title.tpl"),i=f.View.extend({className:"CDB-Legend-item",initialize:function(a){this._placeholderTemplate=a.placeholderTemplate,this.model.on("change",this.render,this)},render:function(){return this.$el.html(this._generateHTML()),this.model.isVisible()?this.$el.show():this.$el.hide(),this._toggleLoadingClass(),this},_generateHTML:function(){var a=[];return this.model.isSuccess()?this.model.isAvailable()?a.push(this._getLegendHTML()):(a.push(this._getNoDataAvailableHTML()),a.push(this._getPlaceholderHTML())):this.model.isError()?(a.push(this._getErrorHeaderHTML()),a.push(this._getPlaceholderHTML())):this.model.isLoading()&&a.push(this._getPlaceholderHTML()),a.join("\n")},_getLegendHTML:function(){var a=[];return this.model.get("title")&&a.push(h({title:this.model.get("title")})),this.model.get("preHTMLSnippet")&&a.push(this._sanitize(this.model.get("preHTMLSnippet"))),a.push(this._sanitize(this._getCompiledTemplate())),this.model.get("postHTMLSnippet")&&a.push(this._sanitize(this.model.get("postHTMLSnippet"))),a.join("\n")},_getPlaceholderHTML:function(){return this._placeholderTemplate&&this._placeholderTemplate()||""},_getErrorHeaderHTML:function(){return d()},_getNoDataAvailableHTML:function(){return e()},_getCompiledTemplate:function(){throw new Error("Subclasses of LegendViewBase must implement _getCompiledTemplate")},_afterRender:function(){},_sanitize:function(a){return g.html(a)},_toggleLoadingClass:function(){this.$el.toggleClass("is-loading",this.model.isLoading())}});b.exports=i},{"../../../../core/sanitize":232,"./error-title.tpl":351,"./legend-title.tpl":352,"./no-data-available-title.tpl":354,backbone:"backbone"}],354:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-medium is-semibold u-bSpace--xl">No data available</h2>';return __p}},{underscore:"underscore"}],355:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+='<div class="Bubble-container u-flex u-justifySpace"> <ul class="Bubble-numbers u-flex u-justifySpace"> ',hasCustomLabels)__p+=' <li class="Bubble-numbersItem CDB-Text CDB-Size-small" style="bottom: 0%">'+(null==(__t=labels[1])?"":_.escape(__t))+'</li> <li class="Bubble-numbersItem CDB-Text CDB-Size-small" style="bottom: 100%">'+(null==(__t=labels[0])?"":_.escape(__t))+"</li> ";else{__p+=" ";for(var i=0;i<labels.length;i++)__p+=' <li class="Bubble-numbersItem CDB-Text CDB-Size-small" style="bottom: '+(null==(__t=labelPositions[i])?"":_.escape(__t))+'%">'+(null==(__t=formatter.formatNumber(labels[i]))?"":__t)+"</li> ";__p+=" "}__p+=' </ul> <div class="Bubble-inner"> <ul class="Bubble-list ',hasCustomLabels&&""===labels[1]&&(__p+="Bubble-list--custom"),__p+='"> ';for(var i in bubbleSizes){__p+=" ";var customCssClass="",index=+i;hasCustomLabels&&(customCssClass=""!==labels[0]&&0===index?"":"Bubble-item--custom"),__p+=' <li class="js-bubbleItem Bubble-item '+(null==(__t=customCssClass)?"":_.escape(__t))+'" style="height: '+(null==(__t=bubbleSizes[i])?"":_.escape(__t))+"%; width: "+(null==(__t=bubbleSizes[i])?"":_.escape(__t))+'%"> <span class="Bubble-itemCircle" style=" '+(null==(__t=fillColor?"opacity:1; background-color:"+fillColor+";":"")?"":_.escape(__t))+'"></span> </li> '}__p+=' </ul> <p class="Bubble-average CDB-Text CDB-Size-small u-altTextColor ',hasCustomLabels&&(__p+="Bubble-average--custom"),__p+='" style="bottom: '+(null==(__t=avgSize)?"":_.escape(__t))+'%"> ',hasCustomLabels||(__p+=" AVG: "+(null==(__t=formatter.formatNumber(avgLabel))?"":__t)+" "),__p+=" </p> </div> </div>"}return __p}},{underscore:"underscore"}],356:[function(a,b,c){var d=a("underscore"),e=a("../base/legend-view-base"),f=a("./legend-template.tpl"),g=a("../../../../util/formatter"),h=e.extend({_getCompiledTemplate:function(){return f({hasCustomLabels:this._hasCustomLabels(),labels:this._calculateLabels(),bubbleSizes:this._calculateBubbleSizes(),labelPositions:this._calculateLabelPositions(),avgSize:this._calculateAverageSize(),avgLabel:this.model.get("avg"),fillColor:this.model.get("fillColor"),formatter:g})},_hasCustomLabels:function(){var a=this.model.get("topLabel"),b=this.model.get("bottomLabel");return null!=a&&""!==a||null!=b&&""!==b},_calculateLabelPositions:function(){var a;return this._hasCustomLabels()?a=[0,100]:(a=this._calculateBubbleSizes(),a.push(0)),a},_calculateLabels:function(){var a;return this._hasCustomLabels()?(a=[],a.push(this.model.get("bottomLabel")),a.push(this.model.get("topLabel")),a=a.reverse()):(a=this.model.get("values").slice(0),this._areSizesInAscendingOrder()&&(a=a.reverse())),a},_calculateValues:function(){var a=this.model.get("sizes").slice(0);return this._areSizesInAscendingOrder()&&(a=a.reverse()),a},_areSizesInAscendingOrder:function(){var a=this.model.get("sizes").slice(0);return d.first(a)<d.last(a)},_calculateBubbleSizes:function(){var a=this._calculateValues(),b=d.max(a);return d.map(a,function(a,c){return 100*a/b})},_calculateAverageSize:function(){var a=this._calculateBubbleSizes().reverse();a.unshift(0);var b=this.model.get("values").slice(0),c=this.model.get("avg"),e=d.reduce(b,function(a,b,d){return b>c?a:d+1},0);if(e===b.length)return 100;var f=a[e-1],g=a[e],h=(c-b[e-1])/(b[e]-b[e-1]);return f+(g-f)*h}});b.exports=h},{"../../../../util/formatter":395,"../base/legend-view-base":353,"./legend-template.tpl":355,underscore:"underscore"}],357:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="Legend-placeholder"> <div class="CDB-Loader is-visible Legend-loading"></div> <div class="Legend-placeholderInner"> <svg width="191px" height="55px" viewBox="0 3 191 55" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g id="Graph" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 3.000000)"> <g id="Group-2" fill="#F9F9F9"> <g id="Group-3"> <rect id="Rectangle-3147" x="0" y="45" width="72" height="9"></rect> <rect id="Rectangle-Copy-2" x="0" y="2" width="78" height="9"></rect> <rect id="Rectangle-Copy-3" x="0" y="24" width="48" height="9"></rect> <ellipse id="Oval-1585" cx="164" cy="27" rx="27" ry="27"></ellipse> <ellipse id="Oval-1585" stroke="#FFFFFF" cx="164" cy="33" rx="21" ry="21"></ellipse> <circle id="Oval-1585" stroke="#FFFFFF" cx="164" cy="45" r="9"></circle> </g> </g> <g id="Group" transform="translate(137.000000, 0.000000)"></g> </g> </svg> </div> </div>';return __p}},{underscore:"underscore"}],358:[function(require,module,exports){require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+="",categories&&categories.length>0){__p+=" <ul> ";for(var i in categories)__p+=' <li class="Legend-categoryListItem u-flex u-justifySpace u-alignCenter"> <p class="Legend-categoryTitle CDB-Text CDB-Size-small u-upperCase u-ellipsis" title="'+(null==(__t=categories[i].label)?"":__t)+'">'+(null==(__t=categories[i].label)?"":__t)+'</p> <span class="Legend-categoryCircle" style="opacity:1; background: '+(null==(__t=categories[i].value)?"":__t)+'"></span> </li> ';__p+=" </ul> "}__p+=""}return __p}},{underscore:"underscore"}],359:[function(a,b,c){var d=a("../base/legend-view-base"),e=a("./legend-template.tpl"),f=d.extend({_getCompiledTemplate:function(){return e({categories:this._getCategories()})},_getCategories:function(){var a=this.model.get("categories").slice(0);return this.model.get("defaultValue")&&a.push({label:"Others",value:this.model.get("defaultValue")}),a}});b.exports=f},{"../base/legend-view-base":353,"./legend-template.tpl":358}],360:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="Legend-placeholder"> <div class="CDB-Loader is-visible Legend-loading"></div> <div class="Legend-placeholderInner"> <svg width="191px" height="57px" viewBox="0 0 191 57" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g id="Group-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <rect id="Rectangle-3147" fill="#F9F9F9" x="0" y="48" width="72" height="9"></rect> <rect id="Rectangle" fill="#F9F9F9" x="0" y="29" width="78" height="9"></rect> <rect id="Rectangle" fill="#F9F9F9" x="0" y="0" width="117" height="9"></rect> <rect id="Rectangle" fill="#F9F9F9" x="182" y="29" width="9" height="9" rx="4.5"></rect> <rect id="Rectangle-Copy" fill="#F9F9F9" x="182" y="48" width="9" height="9" rx="4.5"></rect> </g> </svg> </div> </div>';
return __p}},{underscore:"underscore"}],361:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="u-flex u-justifySpace u-bSpace"> ',__p+=hasCustomLabels?' <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=labels.left)?"":__t)+" "+(null==(__t=suffix)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=labels.right)?"":__t)+" "+(null==(__t=suffix)?"":_.escape(__t))+"</p> ":' <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=labels.left)?"":__t)+" "+(null==(__t=suffix)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=labels.right)?"":__t)+" "+(null==(__t=suffix)?"":_.escape(__t))+"</p> ",__p+=' </div> <div class="Legend-choropleth" style="opacity:1; background: linear-gradient(90deg ';for(var i in colors)__p+=","+(null==(__t=colors[i].value)?"":__t);__p+=')"> ',hasCustomLabels||(__p+=' <span class="Legend-choroplethAverage CDB-Text CDB-Size-small u-altTextColor" style="opacity:1; left: '+(null==(__t=avgPercentage)?"":_.escape(__t))+'%"> <span class="Legend-choroplethAverageText">'+(null==(__t=formatter.formatNumber(avg))?"":__t)+" AVG</span> </span> "),__p+=" </div>"}return __p}},{underscore:"underscore"}],362:[function(a,b,c){var d=a("../base/legend-view-base"),e=a("./legend-template.tpl"),f=a("../../../../util/formatter"),g=a("../../../../core/sanitize"),h=d.extend({_getCompiledTemplate:function(){return e({colors:this.model.get("colors"),avg:this.model.get("avg"),hasCustomLabels:this._hasCustomLabels(),avgPercentage:this._calculateAVGPercentage(),prefix:this.model.get("prefix"),suffix:this.model.get("suffix"),labels:this._getLabels(),formatter:f})},_hasCustomLabels:function(){var a=this.model.get("leftLabel"),b=this.model.get("rightLabel");return null!=a&&""!==a||null!=b&&""!==b},_getLabels:function(){var a=this.model.get("colors"),b=this.model.get("leftLabel"),c=this.model.get("rightLabel"),d={};return d.left=g.html(f.formatNumber(a[0].label)),d.right=g.html(f.formatNumber(a[a.length-1].label)),null!=b&&""!==b&&(d.left=b),null!=c&&""!==c&&(d.right=c),d},_calculateAVGPercentage:function(){return 100*(this.model.get("avg")-this.model.get("min"))/(this.model.get("max")-this.model.get("min"))}});b.exports=h},{"../../../../core/sanitize":232,"../../../../util/formatter":395,"../base/legend-view-base":353,"./legend-template.tpl":361}],363:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="Legend-placeholder"> <div class="CDB-Loader is-visible Legend-loading"></div> <div class="Legend-placeholderInner"> <svg width="192px" height="57px" viewBox="0 0 192 57" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g id="Graph" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(0.000000, 48.000000)"> <rect id="Rectangle-3147" fill="#F9F9F9" x="0" y="0" width="192" height="9" rx="4"></rect> </g> <rect id="Rectangle" stroke="none" fill="#F9F9F9" fill-rule="evenodd" x="0" y="29" width="18" height="9"></rect> <rect id="Rectangle" stroke="none" fill="#F9F9F9" fill-rule="evenodd" x="0" y="0" width="117" height="9"></rect> <rect id="Rectangle" stroke="none" fill="#F9F9F9" fill-rule="evenodd" x="169" y="29" width="23" height="9"></rect> </svg> </div> </div>';return __p}},{underscore:"underscore"}],364:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="u-flex u-justifySpace u-bSpace--m"> ',__p+=hasCustomLabels?' <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=leftLabel)?"":__t)+" "+(null==(__t=suffix)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=rightLabel)?"":__t)+" "+(null==(__t=suffix)?"":_.escape(__t))+"</p> ":' <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=suffix)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small">'+(null==(__t=prefix)?"":_.escape(__t))+" "+(null==(__t=suffix)?"":_.escape(__t))+"</p> ",__p+=' </div> <div class="Legend-choropleth" style="opacity:1; background: linear-gradient(90deg ';for(var i in colors)__p+=","+(null==(__t=colors[i].color)?"":__t);__p+=')"></div>'}return __p}},{underscore:"underscore"}],365:[function(a,b,c){var d=a("../base/legend-view-base"),e=a("./legend-template.tpl"),f=d.extend({_getCompiledTemplate:function(){return e({colors:this.model.get("colors"),prefix:this.model.get("prefix"),suffix:this.model.get("suffix"),hasCustomLabels:this._hasCustomLabels(),leftLabel:this.model.get("leftLabel"),rightLabel:this.model.get("rightLabel")})},_hasCustomLabels:function(){var a=this.model.get("leftLabel"),b=this.model.get("rightLabel");return null!=a&&""!==a||null!=b&&""!==b}});b.exports=f},{"../base/legend-view-base":353,"./legend-template.tpl":364}],366:[function(require,module,exports){require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+="<ul> ";for(var i in items)__p+=' <li class="Legend-categoryListItem u-flex u-justifySpace u-alignCenter"> <p class="Legend-categoryTitle CDB-Text CDB-Size-small u-upperCase u-ellipsis" title="'+(null==(__t=items[i].title)?"":__t)+'">'+(null==(__t=items[i].title)?"":__t)+"</p> ",items[i].color?__p+=' <span class="Legend-categoryCircle" style="opacity:1; background: '+(null==(__t=items[i].color)?"":__t)+'"></span> ':items[i].icon&&(__p+=' <span class="Legend-categoryIcon" style="opacity:1; background-image: '+(null==(__t=items[i].icon)?"":__t)+'"></span> '),__p+=" </li> ";__p+=" </ul>"}return __p}},{underscore:"underscore"}],367:[function(a,b,c){var d=a("../base/legend-view-base"),e=a("./legend-template.tpl"),f=d.extend({_getCompiledTemplate:function(){var a=this.model.get("html");return a=""===a?e({items:this.model.get("items")}):this._patchStylesForIE(a)},_patchStylesForIE:function(a){var b=/\bstyle=(['"])/g,c='style="opacity:1; ';return a.replace(b,c)}});b.exports=f},{"../base/legend-view-base":353,"./legend-template.tpl":366}],368:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<h2 class="CDB-Text CDB-Size-medium is-semibold u-bSpace--xl u-flex u-alignCenter"> ',showLayerSelector&&(__p+=' <span class="u-iBlock u-rSpace--m"> ',__p+=isLayerVisible?' <input class="CDB-Checkbox js-toggle-layer" type="checkbox" checked="checked"> ':' <input class="CDB-Checkbox js-toggle-layer" type="checkbox"> ',__p+=' <span class="u-iBlock CDB-Checkbox-face"></span> </span> '),__p+=' <span class="u-ellipsis">'+(null==(__t=layerName)?"":_.escape(__t))+"</span> </h2> ",showLegends&&(__p+=' <div class="Legends js-legends"></div> '),__p+="";return __p}},{underscore:"underscore"}],369:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./layer-legends-template.tpl"),g=a("./legend-view-factory"),h=e.View.extend({className:"CDB-LayerLegends js-layer-legends",events:{"click .js-toggle-layer":"_onToggleLayerCheckboxClicked"},initialize:function(a){this._legendViews=[],this.settingsModel=a.settingsModel,this.tryContainerVisibility=a.tryContainerVisibility,this.model.on("change:visible",this.render,this),this.model.on("change:layer_name",this.render,this),this._getLegendModels().forEach(function(a){a.on("change:state",d.debounce(this.render,150),this),a.on("change:visible",d.debounce(this.render,150),this)},this),this.settingsModel.on("change",this.render,this)},render:function(){var a=this._shouldLegendsBeVisible(),b=this._shouldLayerSelectorBeVisible(),c=this._shouldLayerLegendsBeVisible();return c?(this.$el.html(f({shouldVisible:c,layerName:this.model.getName(),isLayerVisible:this._isLayerVisible(),showLegends:a,showLayerSelector:b})),this._renderLegends()):this.$el.html(""),this.tryContainerVisibility(),this},_shouldLegendsBeVisible:function(){var a=this.settingsModel.get("showLegends");return a&&this._isLayerVisible()},_shouldLayerLegendsBeVisible:function(){var a=this.settingsModel.get("showLegends"),b=this.model.legends.hasAnyLegend();return this._shouldLayerSelectorBeVisible()||this._isLayerVisible()&&a&&b},_shouldLayerSelectorBeVisible:function(){var a=this.settingsModel.get("layerSelectorEnabled"),b=this.settingsModel.get("showLayerSelector"),c=b&&a;return c},_renderLegends:function(){d.each(this._getLegendModels(),this._renderLegend,this)},_renderLegend:function(a){var b=g.createLegendView(a);this._legendViews.push(b),this._legendsContainer().append(b.render().$el)},_legendsContainer:function(){return this.$(".js-legends")},_onToggleLayerCheckboxClicked:function(a){var b=a.target.checked;b?this.model.show():this.model.hide()},_getLegendViews:function(){return this._legendViews||[]},_getLegendModels:function(){return[this.model.legends.custom,this.model.legends.choropleth,this.model.legends.custom_choropleth,this.model.legends.category,this.model.legends.bubble]},_isLayerVisible:function(){return this.model.isVisible()}});b.exports=h},{"./layer-legends-template.tpl":368,"./legend-view-factory":370,backbone:"backbone",underscore:"underscore"}],370:[function(a,b,c){var d=a("./bubble/legend-view"),e=a("./categories/legend-view"),f=a("./choropleth/legend-view"),g=a("./custom/legend-view"),h=a("./custom-choropleth/legend-view"),i={bubble:d,category:e,choropleth:f,custom_choropleth:h,custom:g},j={bubble:a("./bubble/placeholder-template.tpl"),category:a("./categories/placeholder-template.tpl"),choropleth:a("./choropleth/placeholder-template.tpl")};b.exports={createLegendView:function(a){var b=a.get("type"),c=i[b],d=j[b];if(c)return new c({model:a,placeholderTemplate:d});throw new Error('Legends of type "'+b+'" are not supported')}}},{"./bubble/legend-view":356,"./bubble/placeholder-template.tpl":357,"./categories/legend-view":359,"./categories/placeholder-template.tpl":360,"./choropleth/legend-view":362,"./choropleth/placeholder-template.tpl":363,"./custom-choropleth/legend-view":365,"./custom/legend-view":367}],371:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=a("perfect-scrollbar"),h=a("./legends-view.tpl"),i=a("./layer-legends-view"),j=f.View.extend({className:"CDB-Legends-canvas",initialize:function(a){if(!a.layersCollection)throw new Error("layersCollection is required");this._layersCollection=a.layersCollection,this._isRendered=!1,this.settingsModel=a.settingsModel,this._initBinds()},_initBinds:function(){this._layersCollection.on("add remove",this._onLayerAddedOrRemoved,this),this.settingsModel.on("change",this._onSettingsModelChanged,this)},render:function(){this.$el.html(h());var a=this._layersCollection.getLayersWithLegends();return e.each(a.reverse(),this._renderLayerLegends,this),this._isRendered=!0,this._renderScroll(),this._renderShadows(),this._bindScroll(),this},_renderScroll:function(){g.initialize(this._container(),{wheelSpeed:1,wheelPropagation:!1,swipePropagation:!0,stopPropagationOnClick:!1,minScrollbarLength:20})},_renderShadows:function(){this.$shadowTop=d("<div>").addClass("CDB-Legends-canvasShadow CDB-Legends-canvasShadow--top"),this.$shadowBottom=d("<div>").addClass("CDB-Legends-canvasShadow CDB-Legends-canvasShadow--bottom"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom),e.defer(function(){this._showOrHideShadows()}.bind(this))},_bindScroll:function(){this.$(this._container()).on("ps-y-reach-start",e.bind(this._onScrollTop,this)).on("ps-y-reach-end",e.bind(this._onScrollBottom,this)).on("ps-scroll-y",e.bind(this._onScroll,this))},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){this._showOrHideShadows()},_showOrHideShadows:function(){var a=d(this._container()),b=a.scrollTop(),c=a.get(0).scrollHeight,e=a.outerHeight(),f=c-e;this.$shadowTop.toggleClass("is-visible",b>0),this.$shadowBottom.toggleClass("is-visible",f>b)},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_container:function(){return this.el.querySelector(".js-container")},_renderLayerLegends:function(a){var b=new i({model:a,settingsModel:this.settingsModel,tryContainerVisibility:this._tryVisibility.bind(this)});this.$(this._container()).append(b.render().$el)},_onLayerAddedOrRemoved:function(a){this._isRendered&&this._hasLegends(a)&&(this._clear(),this.render())},_tryVisibility:function(){var a=!e.every(this.$(".js-layer-legends"),function(a){return d(a).is(":empty")});this.$el.toggle(a)},_hasLegends:function(a){return!!a.legends},_clear:function(){this.$el.html("")},show:function(){this.$el.show()},hide:function(){this.$el.hide()}});b.exports=j},{"./layer-legends-view":369,"./legends-view.tpl":372,backbone:"backbone",jquery:"jquery","perfect-scrollbar":"perfect-scrollbar",underscore:"underscore"}],372:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Legends-canvasInner js-container"></div>';return __p}},{underscore:"underscore"}],373:[function(a,b,c){var d=a("../../core/view"),e=a("./logo.tpl"),f="https://carto.com";b.exports=d.extend({className:"CDB-Logo",tagName:"a",render:function(){return this.$el.html(e()),this.$el.attr("href",f),this.$el.attr("target","_blank"),this}})},{"../../core/view":236,"./logo.tpl":374}],374:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<svg width="68px" height="28px" viewBox="2 33 68 27" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <defs> <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="cartoLogo-Blur"> <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset> <feGaussianBlur stdDeviation="0.5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur> <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.25 0" type="matrix" in="shadowBlurOuter1" result="shadowMatrixOuter1"></feColorMatrix> <feMerge> <feMergeNode in="shadowMatrixOuter1"></feMergeNode> <feMergeNode in="SourceGraphic"></feMergeNode> </feMerge> </filter> </defs> <g filter="url(#cartoLogo-Blur)" fill="none" fill-rule="evenodd" transform="translate(3, 33)"> <circle cx="52.5" cy="12.5" r="12.5" id="halo" fill-opacity="0.3" fill="#FFFFFF"/> <path d="M4.56199178,16.7836993 C6.33902821,16.7836993 7.36601679,15.9967983 8.12760383,14.9280222 L6.44288099,13.7065639 C5.95823469,14.3055483 5.46204919,14.7048712 4.61968777,14.7048712 C3.48884641,14.7048712 2.69264178,13.7417983 2.69264178,12.5085951 L2.69264178,12.4851056 C2.69264178,11.2871368 3.48884641,10.3005743 4.61968777,10.3005743 C5.39281401,10.3005743 5.9236171,10.6881524 6.385185,11.2636472 L8.06990784,9.93648577 C7.35447759,8.93817848 6.29287142,8.23349098 4.64276617,8.23349098 C2.19645628,8.23349098 0.396341463,10.1126576 0.396341463,12.5085951 L0.396341463,12.5320847 C0.396341463,14.9867462 2.25415227,16.7836993 4.56199178,16.7836993 L4.56199178,16.7836993 Z M11.9673421,16.6192722 L14.3097992,16.6192722 L14.8867591,15.1394285 L18.0138817,15.1394285 L18.5908415,16.6192722 L20.9909946,16.6192722 L17.5523137,8.33919411 L15.3944838,8.33919411 L11.9673421,16.6192722 Z M15.5444934,13.3659649 L16.45609,11.0404962 L17.3561474,13.3659649 L15.5444934,13.3659649 Z M25.3499968,16.6192722 L27.5886011,16.6192722 L27.5886011,14.1293764 L28.5809721,14.1293764 L30.207999,16.6192722 L32.78124,16.6192722 L30.854194,13.7535431 C31.8581042,13.3189858 32.5158385,12.4851056 32.5158385,11.2166681 L32.5158385,11.1931785 C32.5158385,10.3827879 32.2735154,9.7603139 31.8004082,9.27877744 C31.258066,8.72677223 30.4041653,8.39791807 29.1694712,8.39791807 L25.3499968,8.39791807 L25.3499968,16.6192722 Z M27.5886011,12.3441681 L27.5886011,10.3592983 L29.0656184,10.3592983 C29.8041271,10.3592983 30.2772342,10.6881524 30.2772342,11.3458608 L30.2772342,11.3693504 C30.2772342,11.9683347 29.8272055,12.3441681 29.0771576,12.3441681 L27.5886011,12.3441681 Z M39.1942194,16.6192722 L41.4328237,16.6192722 L41.4328237,10.3945326 L43.8560552,10.3945326 L43.8560552,8.39791807 L36.7825271,8.39791807 L36.7825271,10.3945326 L39.1942194,10.3945326 L39.1942194,16.6192722 Z M52.4193803,16.7708268 C54.7933139,16.7708268 56.7177673,14.8587096 56.7177673,12.4999935 C56.7177673,10.1412775 54.7933139,8.22916031 52.4193803,8.22916031 C50.0454467,8.22916031 48.1209933,10.1412775 48.1209933,12.4999935 C48.1209933,14.8587096 50.0454467,16.7708268 52.4193803,16.7708268 Z" fill="#FFFFFF"></path> </g> </svg>';return __p}},{underscore:"underscore"}],375:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-OverlayContainer"></div>';return __p}},{underscore:"underscore"}],376:[function(a,b,c){var d=a("underscore"),e=a("../../../core/view"),f=a("../../../geo/geocoder/mapzen-geocoder"),g=a("../../../geo/ui/infowindow-model"),h=a("../../../geo/ui/infowindow-view"),i=a("../../../geo/geometry-models/point.js"),j=a("./search_template.tpl"),k=a("./search_infowindow_template.tpl"),l=e.extend({className:"CDB-Search CDB-Overlay",_ZOOM_BY_CATEGORY:{building:18,"postal-area":15,venue:18,region:8,address:18,country:5,county:8,locality:12,localadmin:11,neighbourhood:15,"default":12},events:{"click .js-toggle":"_onToggleClick","submit .js-form":"_onSubmit",click:"_stopPropagation",dblclick:"_stopPropagation",mousedown:"_stopPropagation"},options:{searchPin:!0,infowindowWidth:186,infowindowOffset:[30,30],iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAfCAYAAADXwvzvAAACuklEQVR4Ae3PQ+AsNxzA8e8vo/Xus237vVN9qW3b7qW2bdu2caxt29bu/meSmaTpqW63Pfc7wemTZPh9K/Xv3zhzxIgVrho0aMsLGo2N9o+iuYDwV02E5NJpM7d5fMGC515dMP/7l6dNMc+OGJY9Uq99cVMc33I4LOJXCQBQuXPBglNnDRm0Xa1RAWewP3yL/vJLul99Q/pNm0/b+qsnbLHngXAVgAI4b9KkXWc1m9vV58ykst56lKdMptyokdTKRJUIV1MMTGTgbOTknWABgFo2SSbOjuN9wlgIBrSIJ0yiVG9QUgGxUigRRAlpCQYrBs+A/QClliuXV6ppPVibDPPqi5irL8G+/QY2S3FZhityrLNYBWkAI2G5WTA2nGTthKDTJfP/FH1sCb76nNBa7I8/knba6Eyj8wJjLbk4qlCdAFNClWXKiiL72kGRUkSRhwUuTUm7XTqZ3z3KnMM7QhAFUfiKMZ9OQci+ydFFH32BIsDh8hxjDF2T0y0KtHHUczCg34P3wgesfWhZozstW1R/cJpuohA8dI7cWrSfxqM4gwEOnoJnn4HXBVDHwHnriNr2W3G0I8FEkKufMbjcIw1DC+iCuRw2OBduEYAKDD8drlkGlk6BHwAtIEDioD/QBnsnnHAI7A9YAAAGenwEnPuAd8+DewHcS+CeB3szvL0b7ADE/FWzYf5BCxa9dMvqa7oLll7WbTlsxKkDYRi9dPqhRz743L0PuKtOPMXtutHmm/InKf5Y6Co15Upl8qSCqVajXiEeUTRb6GqNIojoGaLEDwEA6B0KIKL8lH8JBeS/3AgK73qAPfc/tCLiAACUCmyvsJHnphwEAYFStNs/NoHgn2ATWPmlF54b/9GHH/Khn88/+9SywJx/+q0SsKTZbB45d/6CO0aNHnutv3kbYDQg9JAAIRDwF/0EjlkjUi3fkAMAAAAASUVORK5CYII=",iconAnchor:[7,31]},initialize:function(){this.map=this.model,this.mapView=this.options.mapView,this.template=this.options.template||j},render:function(){return this.$el.html(this.template(this.options)),this},_stopPropagation:function(a){a&&a.stopPropagation()},_onSubmit:function(a){a.preventDefault();var b=this,c=this.$(".js-textInput").val();c&&(this._destroySearchPin(0),f.geocode(c,function(a){b._onResult(a)}))},_onResult:function(a){var b="",c=this.$(".js-textInput").val();if(a&&a.length>0){var d=a[0],e=this._isBBoxValid(d);if(e){var f=parseFloat(d.boundingbox.south),g=parseFloat(d.boundingbox.west),h=parseFloat(d.boundingbox.north),i=parseFloat(d.boundingbox.east),j=(g+i)/2,k=(f+h)/2;b=[k,j],this.model.setBounds([[f,g],[h,i]])}d.lat&&d.lon&&(b=[d.lat,d.lon]),e||(this.model.setCenter(b),this.model.setZoom(this._getZoomByCategory(d.type))),this.options.searchPin&&this._createSearchPin(b,c)}},_onToggleClick:function(){this.$(".CDB-Search-inner").toggleClass("is-active"),this.$(".js-textInput").focus()},_getZoomByCategory:function(a){return a&&this._ZOOM_BY_CATEGORY[a]?this._ZOOM_BY_CATEGORY[a]:this._ZOOM_BY_CATEGORY["default"]},_isBBoxValid:function(a){return a.boundingbox&&a.boundingbox.south!==a.boundingbox.north&&a.boundingbox.east!==a.boundingbox.west?!0:!1},_createSearchPin:function(a,b){this._destroySearchPin(),this._createPin(a,b),this._createInfowindow(a,b),this._bindEvents()},_destroySearchPin:function(a){this._unbindEvents(),this._destroyPin(),this._destroyInfowindow(a)},_createInfowindow:function(a,b){var c=new g({template:k,latlng:a,width:this.options.infowindowWidth,offset:this.options.infowindowOffset,content:{fields:[{title:"address",value:b}]}});this._searchInfowindow=new h({model:c,mapView:this.mapView}),this.mapView.$el.append(this._searchInfowindow.el),c.set("visibility",!0)},_destroyInfowindow:function(a){if(this._searchInfowindow){a=!d.isUndefined(a)&&d.isNumber(a)?a:500,this._searchInfowindow.hide(!0);var b=this;setTimeout(function(){b._searchInfowindow&&(b._searchInfowindow.clean(),delete b._searchInfowindow)},a)}},_createPin:function(a,b){this._searchPin=new i({latlng:[a[0],a[1]],iconUrl:this.options.iconUrl,iconAnchor:this.options.iconAnchor}),this.map.addGeometry(this._searchPin)},_toggleSearchInfowindow:function(){var a=this._searchInfowindow.model.get("visibility");this._searchInfowindow.model.set("visibility",!a)},_destroyPin:function(){this._searchPin&&(this.map.removeGeometry(this._searchPin),delete this._searchPin)},_bindEvents:function(){this._searchPin&&this._searchPin.bind("click",this._toggleSearchInfowindow,this),this.mapView.bind("click",this._destroySearchPin,this)},_unbindEvents:function(){this._searchPin&&this._searchPin.unbind("click",this._toggleSearchInfowindow,this),this.mapView.unbind("click",this._destroySearchPin,this)},clean:function(){this._unbindEvents(),this._destroySearchPin(),e.prototype.clean.call(this)},updatePosition:function(a){this.$el.toggleClass("has-zoom",a)}});b.exports=l},{"../../../core/view":236,"../../../geo/geocoder/mapzen-geocoder":258,"../../../geo/geometry-models/point.js":269,"../../../geo/ui/infowindow-model":348,"../../../geo/ui/infowindow-view":349,"./search_infowindow_template.tpl":377,"./search_template.tpl":378,underscore:"underscore"}],377:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-infowindow CDB-infowindow--light js-infowindow"> <div class="CDB-infowindow-container"> <div class="CDB-infowindow-inner"> <div class="CDB-infowindow-list"> <div class="CDB-infowindow-listItem"> <h4 class="CDB-infowindow-title">'+(null==(__t=address)?"":_.escape(__t))+'</h4> </div> </div> </div> <div class="CDB-hook"> <div class="CDB-hook-inner"> </div> </div> </div> </div>';return __p}},{underscore:"underscore"}],378:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<form class="js-form CDB-Search-inner"> <button type="button" class="CDB-Shape CDB-Search-actionButton js-toggle"> <span class="CDB-Shape-magnify is-small"></span> </button> <input type="text" placeholder="Search Location" class="CDB-Search-text js-textInput" value=""> </form>';return __p}},{underscore:"underscore"}],379:[function(a,b,c){var d=a("underscore"),e=a("../../core/view"),f=a("../../core/sanitize"),g=a("jquery"),h=e.extend({className:"cartodb-overlay overlay-text",events:{click:"stopPropagation"},default_options:{},stopPropagation:function(a){a.stopPropagation()},initialize:function(){d.defaults(this.options,this.default_options),this.template=this.options.template;var a=this;g(window).on("map_resized",function(){a._place()}),g(window).on("resize",function(){a._place()})},_applyStyle:function(){var a=this.model.get("style"),b=a["box-color"],c=a["box-opacity"],d=a["box-width"],e=a["font-family-name"];this.$text=this.$el.find(".text"),this.$text.css(a),this.$text.css("font-size",a["font-size"]+"px"),this.$el.css("z-index",a["z-index"]);var f="";"Droid Sans"==e?f="droid":"Vollkorn"==e?f="vollkorn":"Open Sans"==e?f="open_sans":"Roboto"==e?f="roboto":"Lato"==e?f="lato":"Graduate"==e?f="graduate":"Gravitas One"==e?f="gravitas_one":"Old Standard TT"==e&&(f="old_standard_tt");var g="rgba("+parseInt(b.slice(-6,-4),16)+","+parseInt(b.slice(-4,-2),16)+","+parseInt(b.slice(-2),16)+", "+c+" )";this.$el.removeClass("droid").removeClass("vollkorn").removeClass("roboto").removeClass("open_sans").removeClass("lato").removeClass("graduate").removeClass("gravitas_one").removeClass("old_standard_tt"),this.$el.addClass(f),this.$el.css({backgroundColor:g,maxWidth:d})},_place:function(a){var b=a||this.model.get("extra"),c=this.model.get("y"),d=this.model.get("x"),e=b.bottom-this.$el.height(),f=b.right-this.$el.width(),g=b.top_percentage,h=b.left_percentage,i="auto",j="auto",k=0,l=0,m=b.width,n=b.height,o=b.portrait_dominant_side,p=b.landscape_dominant_side;"bottom"===o&&250>=e?(c="auto",j=e):g>45&&55>g&&(c="50%",k=-n/2),"right"===p&&250>=f?(d="auto",i=f):h>45&&55>h&&(d="50%",l=-m/2),this.$el.css({marginLeft:l,marginTop:k,top:c,left:d,right:i,bottom:j})},show:function(a){this.$el.fadeIn(150,function(){a&&a()})},hide:function(a){this.$el.fadeOut(150,function(){a&&a()})},_fixLinks:function(){this.$el.find("a").each(function(a,b){g(this).attr("target","_top")})},render:function(){var a=f.html(this.model.get("extra").rendered_text,this.model.get("sanitizeText")),b=d.chain(this.model.attributes).clone().extend({text:a}).value();this.$el.html(this.template(b)),this._fixLinks();var c=this;return setTimeout(function(){c._applyStyle(),c._place(),c.show()},900),this}});b.exports=h},{"../../core/sanitize":232,"../../core/view":236,jquery:"jquery",underscore:"underscore"}],380:[function(a,b,c){var d=(a("underscore"),a("../../core/view")),e=d.extend({className:"CDB-Loader",options:{animationSpeed:500},initialize:function(){this.isVisible=0},render:function(){return this},show:function(a){this.isVisible||(this.$el.addClass("is-visible"),this.isVisible++)},hide:function(a){this.isVisible--,this.isVisible>0||(this.isVisible=0,this.$el.removeClass("is-visible"))},visible:function(){return this.isVisible>0}});b.exports=e},{"../../core/view":236,underscore:"underscore"}],381:[function(a,b,c){var d=a("underscore"),e=a("./infobox"),f=a("../../core/sanitize"),g=a("./infowindow-model"),h=e.extend({defaultTemplate:"<p>{{text}}</p>",className:"CDB-Tooltip-wrapper",defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center"},initialize:function(){if(!this.options.mapView)throw new Error("mapView should be present");this.options.template=this.options.template||this.defaultTemplate,e.prototype.initialize.call(this),this._filter=null,this.showing=!1,this.showhideTimeout=null},render:function(a){var b=f.html(this.template(a));return this.$el.html(b),this},setFilter:function(a){return this._filter=a,this},setFields:function(a){return this.options.fields=a,this},setAlternativeNames:function(a){this.options.alternative_names=a},enable:function(){this.options.layer&&(this.options.layer.unbind(null,null,this),this.options.layer.on("mouseover",function(a,b,c,e){if(this.options.fields&&this.options.fields.length>0){var f=["fields","content"];this.options.omit_columns&&(f=f.concat(this.options.omit_columns));var h=g.contentForFields(e,this.options.fields,{show_empty_fields:!1});e.content=d.omit(e,f),e.fields=h.fields;var i=this.options.alternative_names;if(i)for(var j=0;j<e.fields.length;++j){var k=e.fields[j];k.title=i[k.title]||k.title}this.show(c,e),this.showing=!0}else this.showing&&(this.hide(),this.showing=!1)},this).on("mouseout",function(){this.showing&&(this.hide(),this.showing=!1)},this),this.add_related_model(this.options.layer))},disable:function(){this.options.layer&&this.options.layer.unbind(null,null,this),this.hide(),this.showing=!1},_visibility:function(){var a=this;clearTimeout(this.showhideTimeout);var b=function(){a.$el.fadeIn(100)},c=function(){a.$el.fadeOut(200)};this.showhideTimeout=setTimeout(a._showing?b:c,50)},hide:function(){this._showing&&(this._showing=!1,this._visibility())},show:function(a,b){return this._filter&&!this._filter(b)?this:(this.render(b),this.setPosition(a),this._showing||(this._showing=!0,this._visibility()),this)},setPosition:function(a){var b=this.options.position,c=this.$el.innerHeight(),d=this.$el.innerWidth(),e=this.options.mapView.getSize(),f=0,g=0,h="CDB-Tooltip-wrapper--";this._removePositionModifiers(),f=-1!==b.indexOf("top")?a.y-c:-1!==b.indexOf("middle")?a.y-c/2:a.y,0>f?(f=a.y,h+="top"):f+c>e.y?(f=a.y-c,h+="bottom"):h+="top",g=-1!==b.indexOf("left")?a.x-d:-1!==b.indexOf("center")?a.x-d/2:a.x,0>g?(g=a.x,h+="Left"):g+d>e.x?(g=a.x-d,h+="Right"):h+="Left",f+=this.options.vertical_offset,g+=this.options.horizontal_offset,this.$el.css({top:f,left:g}).addClass(h)},_removePositionModifiers:function(){var a=["topLeft","topRight","bottomRight","bottomLeft"],b=d.map(a,function(a){return this._modifierClassName(a)},this);this.$el.removeClass(b.join(" "))},_modifierClassName:function(a){return this.className+"--"+a}});b.exports=h},{"../../core/sanitize":232,"./infobox":347,"./infowindow-model":348,underscore:"underscore"}],382:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Overlay"> <button class="CDB-Zoom-action CDB-Zoom-action--out js-zoomOut"></button> <div class="CDB-Zoom-info js-zoomInfo">-</div> <button class="CDB-Zoom-action CDB-Zoom-action--in js-zoomIn"></button> </div>';return __p}},{underscore:"underscore"}],383:[function(a,b,c){var d=a("../../../core/view"),e=a("./zoom-template.tpl");b.exports=d.extend({className:"CDB-Zoom",events:{"click .js-zoomIn":"_onZoomIn","click .js-zoomOut":"_onZoomOut",dblclick:"killEvent"},options:{timeout:0,msg:""},initialize:function(){this.map=this.model,this.template=this.options.template||e,this.map.bind("change:zoom change:minZoom change:maxZoom",this._checkZoom,this)},render:function(){return this.$el.html(this.template(this.options)),this._checkZoom(),this},_checkZoom:function(){var a=this.map.get("zoom");this.$(".js-zoomIn")[a<this.map.get("maxZoom")?"removeClass":"addClass"]("is-disabled"),this.$(".js-zoomOut")[a>this.map.get("minZoom")?"removeClass":"addClass"]("is-disabled"),this.$(".js-zoomInfo").text(a)},_onZoomIn:function(a){this.killEvent(a),this.map.get("maxZoom")>this.map.getZoom()&&this.map.setZoom(this.map.getZoom()+1)},_onZoomOut:function(a){this.killEvent(a),this.map.get("minZoom")<this.map.getZoom()&&this.map.setZoom(this.map.getZoom()-1)}})},{"../../../core/view":236,"./zoom-template.tpl":382}],384:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cdb.templates"),g=a("../../core/view");b.exports=g.extend({tagName:"div",className:"dialog",events:{"click .ok":"_ok","click .cancel":"_cancel","click .close":"_cancel"},default_options:{title:"title",description:"",ok_title:"Ok",cancel_title:"Cancel",width:300,height:200,clean_on_hide:!1,enter_to_confirm:!1,template_name:"old_common/views/dialog_base",ok_button_classes:"button green",cancel_button_classes:"",modal_type:"",modal_class:"",include_footer:!0,additionalButtons:[]},initialize:function(){d.defaults(this.options,this.default_options),d.bindAll(this,"render","_keydown"),e(document).bind("keydown",this._keydown),this.bind("clean",this._reClean),this.template_base=this.options.template_base?d.template(this.options.template_base):f.getTemplate(this.options.template_name)},render:function(){var a=this.$el;return a.html(this.template_base(this.options)),a.find(".modal").css({width:this.options.width}),this.render_content&&this.$(".content").append(this.render_content()),this.options.modal_class&&this.$el.addClass(this.options.modal_class),this},_keydown:function(a){27===a.keyCode?this._cancel():13===a.keyCode&&this.options.enter_to_confirm&&this._ok()},appendToBody:function(){return e("body").append(this.render().el),this},_ok:function(a){a&&a.preventDefault(),this.ok&&this.ok(this.result),this.hide()},_cancel:function(a){
a&&(a.preventDefault(),a.stopPropagation()),this.cancel&&this.cancel(),this.hide()},hide:function(){this.$el.hide(),this.options.clean_on_hide&&this.clean()},open:function(){this.$el.show()},_reClean:function(){e(document).unbind("keydown",this._keydown)}})},{"../../core/view":236,"cdb.templates":224,jquery:"jquery",underscore:"underscore"}],385:[function(a,b,c){var d=a("jquery"),e=(a("cdb"),a("underscore")),f=a("cdb.templates"),g=a("../../core/view"),h=g.extend({tagName:"div",className:"dropdown",events:{"click ul li a":"_fireClick"},default_options:{width:160,speedIn:150,speedOut:300,vertical_position:"down",horizontal_position:"right",tick:"right",vertical_offset:0,horizontal_offset:0},initialize:function(){e.bindAll(this,"open","hide","_handleClick","_keydown"),e.defaults(this.options,this.default_options),this.options.template_base?this.template_base=f.getTemplate(this.options.template_base):this.options.template&&(this.template_base=this.options.template),d(this.options.target).bind({click:this._handleClick}),d(document).bind("keydown",this._keydown),this.isOpen=!1},render:function(){var a=this.$el;return a.html(this.template_base(this.options)).css({width:this.options.width}),this},_handleClick:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.isOpen?this.hide():this.open()},_keydown:function(a){27===a.keyCode&&this.hide()},hide:function(){this.isOpen=!1,this.$el.hide()},show:function(){this.$el.css({display:"block",opacity:1}),this.isOpen=!0},open:function(a,b){var c=b&&d(b)||this.options.target;this.options.target=c;var e=c[this.options.position||"offset"](),f=c.outerWidth(),g=c.outerHeight(),h=this.$el.outerWidth(),i=this.$el.outerHeight(),j=this;this.$el.css({top:e.top+parseInt("up"==j.options.vertical_position?-i-10-j.options.vertical_offset:g+10-j.options.vertical_offset),left:e.left+parseInt("left"==j.options.horizontal_position?j.options.horizontal_offset-15:f-h+15-j.options.horizontal_offset)}).addClass(("up"==this.options.vertical_position?"vertical_top":"vertical_bottom")+" "+("right"==this.options.horizontal_position?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.show(),this.isOpen=!0},clean:function(){d(this.options.target).unbind({click:this._handleClick}),d(document).unbind("keydown",this._keydown),g.prototype.clean.apply(this,arguments)},_fireClick:function(a){this.trigger("optionClicked",a,this.el)}});b.exports=h},{"../../core/view":236,cdb:222,"cdb.templates":224,jquery:"jquery",underscore:"underscore"}],386:[function(require,module,exports){require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Overlay"> <a href="'+(null==(__t=mapUrl)?"":__t)+'" target="_blank" class="CDB-Fullscreen-link"> <div class="CDB-Shape-Arrow is-up"></div> <div class="CDB-Shape-Arrow is-down"></div> </a> </div>';return __p}},{underscore:"underscore"}],387:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cdb.log"),g=a("../../../core/view"),h=a("./fullscreen-template.tpl"),i=g.extend({tagName:"div",className:"CDB-Fullscreen",events:{click:"_toggleFullScreen"},initialize:function(){e.bindAll(this,"render"),this.template=this.options.template||h,this._addWheelEvent()},render:function(){var a=e.extend(this.options,{mapUrl:window.location.href||""});return this.$el.html(this.template(a)),this._canFullScreenBeEnabled()||(this.undelegateEvents(),f.info("FullScreen API is deprecated on insecure origins. See https://goo.gl/rStTGz for more details.")),this},_addWheelEvent:function(){var a=this,b=this.options.mapView;d(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||a.options.allowWheelOnFullscreen&&b.options.map.set("scrollwheel",!1),b.invalidateSize()})},_toggleFullScreen:function(a){a&&this.killEvent(a);var b=window.document,c=b.documentElement;this.options.doc&&(c=this.options.doc);var d=c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen||c.msRequestFullscreen,e=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen||b.msExitFullscreen,f=this.options.mapView;b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement||b.msFullscreenElement?e.call(b):(c.webkitRequestFullScreen?d.call(c,void 0):d&&d.call(c),f&&this.options.allowWheelOnFullscreen&&f.map.set("scrollwheel",!0))},_canFullScreenBeEnabled:function(){if(this._isInIframe()){var a=document.referrer;if(0!==a.search("https:"))return!1}return!0},_isInIframe:function(){try{return window.self!==window.top}catch(a){return!0}}});b.exports=i},{"../../../core/view":236,"./fullscreen-template.tpl":386,"cdb.log":223,jquery:"jquery",underscore:"underscore"}],388:[function(a,b,c){var d=a("underscore"),e=a("cdb.templates"),f=a("../../core/view"),g=f.extend({tagName:"div",className:"dialog",events:{"click .close":"hide"},default_options:{timeout:0,msg:"",hideMethod:"",duration:"normal"},initialize:function(){this.closeTimeout=-1,d.defaults(this.options,this.default_options),this.template=this.options.template?d.template(this.options.template):e.getTemplate("common/notification"),this.$el.hide()},render:function(){var a=this.$el;return a.html(this.template(this.options)),this.render_content&&this.$(".content").append(this.render_content()),this},hide:function(a){var b=this;a&&a.preventDefault(),clearTimeout(this.closeTimeout),""!=this.options.hideMethod&&this.$el.is(":visible")?this.$el[this.options.hideMethod](this.options.duration,"swing",function(){b.$el.html(""),b.trigger("notificationDeleted"),b.remove()}):(this.$el.hide(),b.$el.html(""),b.trigger("notificationDeleted"),b.remove())},open:function(a,b){this.render(),this.$el.show(a,b),this.options.timeout&&(this.closeTimeout=setTimeout(d.bind(this.hide,this),this.options.timeout))}});b.exports=g},{"../../core/view":236,"cdb.templates":224,underscore:"underscore"}],389:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../core/view"),g=a("./table/row-view"),h=f.extend({tagName:"table",rowView:g,events:{"click td":"_cellClick","dblclick td":"_cellDblClick"},default_options:{},initialize:function(){var a=this;d.defaults(this.options,this.default_options),this.dataModel=this.options.dataModel,this.rowViews=[],this.setDataSource(this.dataModel),this.model.bind("change",this.render,this),this.model.bind("change:dataSource",this.setDataSource,this),this.bind("clean",this.clear_rows,this),this.add_related_model(this.dataModel),this.add_related_model(this.model),this.model.bind("removing:row",function(){a.rowsBeingDeleted=a.rowsBeingDeleted?a.rowsBeingDeleted+1:1,a.rowDestroying()}),this.model.bind("remove:row",function(){a.rowsBeingDeleted>0&&(a.rowsBeingDeleted--,a.rowDestroyed(),0==a.dataModel.length&&a.emptyTable())})},headerView:function(a){return a[0]},setDataSource:function(a){this.dataModel&&this.dataModel.unbind(null,null,this),this.dataModel=a,this.dataModel.bind("reset",this._renderRows,this),this.dataModel.bind("error",this._renderRows,this),this.dataModel.bind("add",this.addRow,this)},_renderHeader:function(){var a=this,b=e("<thead>"),c=e("<tr>");return this.options.row_header?c.append(e("<th>").append(a.headerView(["","header"]))):c.append(e("<th>").append(a.headerView(["","header"]))),d(this.model.get("schema")).each(function(b){c.append(e("<th>").append(a.headerView(b)))}),b.append(c),b},clear_rows:function(){this.$("tfoot").remove(),this.$("tr.noRows").remove();for(var a=null;a=this.rowViews.pop();)a.unbind(null,null,this),a.clean();this.rowViews=[]},addRow:function(a,b,c){var e=this,f=new e.rowView({model:a,order:this.model.columnNames(),row_header:this.options.row_header});if(f.tableView=this,f.bind("clean",function(){var a=d.indexOf(e.rowViews,f);e.rowViews.splice(a,1);for(var b=a;b<e.rowViews.length;++b)e.rowViews[b].$el.attr("data-y",b)},this),f.bind("changeRow",this.rowChanged,this),f.bind("saved",this.rowSynched,this),f.bind("errorSaving",this.rowFailed,this),f.bind("saving",this.rowSaving,this),this.retrigger("saving",f),f.render(),c&&void 0!==c.index&&c.index!=e.rowViews.length){f.$el.insertBefore(e.rowViews[c.index].$el),e.rowViews.splice(c.index,0,f);for(var g=c.index;g<e.rowViews.length;++g)e.rowViews[g].$el.attr("data-y",g)}else f.$el.attr("data-y",e.rowViews.length),e.$el.append(f.el),e.rowViews.push(f);this.trigger("createRow")},rowChanged:function(){},rowSynched:function(){},rowFailed:function(){},rowSaving:function(){},rowDestroying:function(){},rowDestroyed:function(){},emptyTable:function(){},isEmptyTable:function(){return 0===this.dataModel.length&&this.dataModel.fetched},_renderRows:function(){if(this.clear_rows(),this.isEmptyTable())this._renderEmpty();else if(this.dataModel.fetched){var a=this;this.dataModel.each(function(b){a.addRow(b)})}else this._renderLoading()},_renderLoading:function(){},_renderEmpty:function(){},addEmptyTableInfo:function(){},render:function(){var a=this;return a.$el.html(a._renderHeader()),a._renderRows(),this},getCell:function(a,b){return this.options.row_header&&++b,this.rowViews[b].getCell(a)},_cellClick:function(a,b){b=b||"cellClick",a.preventDefault();var c=e(a.currentTarget||a.target),d=parseInt(c.attr("data-x"),10),f=parseInt(c.parent().attr("data-y"),10);this.trigger(b,a,c,d,f)},_cellDblClick:function(a){this._cellClick(a,"cellDblClick")}});b.exports=h},{"../../core/view":236,"./table/row-view":390,jquery:"jquery",underscore:"underscore"}],390:[function(a,b,c){var d=a("underscore"),e=a("../../../core/view"),f=e.extend({tagName:"tr",initialize:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.clean,this),this.model.bind("remove",this.clean,this),this.model.bind("change",this.triggerChange,this),this.model.bind("sync",this.triggerSync,this),this.model.bind("error",this.triggerError,this),this.add_related_model(this.model),this.order=this.options.order},triggerChange:function(){this.trigger("changeRow")},triggerSync:function(){this.trigger("syncRow")},triggerError:function(){this.trigger("errorRow")},valueView:function(a,b){return b},render:function(){var a,b=this,c=this.model,e="",f=0;a=this.options.row_header?'<td class="rowHeader" data-x="'+f+'">':'<td class="EmptyRowHeader" data-x="'+f+'">';var g=b.valueView("","");g.html&&(g=g[0].outerHTML),a+=g,a+="</td>",f++,e+=a;for(var h=this.order||d.keys(c.attributes),i="",j=c.attributes,k=0,l=h.length;l>k;++k){var m=h[k],n=j[m];if(void 0!==n){var a='<td id="cell_'+c.id+"_"+m+'" data-x="'+f+'">',g=b.valueView(m,n);g.html&&(g=g[0].outerHTML),a+=g,a+="</td>",f++,i+=a}}return e+=i,this.$el.html(e).attr("id","row_"+c.id),this},getCell:function(a){return this.options.row_header&&++a,this.$("td:eq("+a+")")},getTableView:function(){return this.tableView}});b.exports=f},{"../../../core/view":236,underscore:"underscore"}],391:[function(a,b,c){var d=a("../../../core/model"),e=d.extend({});b.exports=e},{"../../../core/model":230}],392:[function(a,b,c){var d=a("backbone"),e=a("./row"),f=d.Collection.extend({model:e,fetched:!1,initialize:function(){var a=this;this.bind("reset",function(){a.fetched=!0})},getCell:function(a,b){var c=this.at(a);return c?c.get(b):null},isEmpty:function(){return 0===this.length}});b.exports=f},{"./row":391,backbone:"backbone"}],393:[function(a,b,c){var d=a("underscore"),e=a("../../../core/model"),f=e.extend({columnNames:function(){return d.map(this.get("schema"),function(a){return a[0]})},columnName:function(a){return this.columnNames()[a]}});b.exports=f},{"../../../core/model":230,underscore:"underscore"}],394:[function(a,b,c){var d=a("backbone");b.exports=function(a,b,c){var e=arguments[1];return this._xhr&&this._xhr.abort(),this._xhr=d.sync.apply(this,arguments),this._xhr.always(function(){e._xhr=null}),this._xhr}},{backbone:"backbone"}],395:[function(a,b,c){var d=a("underscore"),e=a("d3"),f={},g=function(a){var b=d.template('<%= mantissa %><span class="Legend-exponential">x</span>10<sup class="Legend-exponential"><%= decimals %></sup>'),c=a.toExponential(10),e=c.split("e");return b({mantissa:(1*e[0]).toFixed(1),decimals:e[1]||0})};f.formatNumber=function(a,b){var c=+a;if(isNaN(c)||0===c)return a;a=c;var d=e.format(".2s"),f=0,h=Math.abs(a);if(a>1e3)return a=d(a)+(b?" "+b:"");if(.01>h)return a=g(a)+(b?" "+b:"");h>100?f=0:h>10?f=1:h>.01&&(f=Math.min(Math.ceil(Math.abs(Math.log(h)/Math.log(10)))+2,2)),a=a.toFixed(f);var i=a.match(/(\.0+)$/);return i&&(a=a.replace(i[0],"")),a},f.formatDate=function(a){return e.time.format("%Y-%m-%d")(a)},f.formatValue=function(a){return d.isNumber(a)?f.formatNumber(a):d.isDate(a)?f.formatDate(a):a},b.exports=f},{d3:207,underscore:"underscore"}],396:[function(a,b,c){var d=function(a){return a.length>0&&a.all(function(a){return a.isUnavailable()||a.isFetched()})},e=function(a,b){var c=function(){d(a)&&b()};a.on("change:status",c),c()};b.exports=e},{}],397:[function(a,b,c){var d=function(a,b){this._map=b,this._mapView=a};d.prototype.enableDrawing=function(a){this.disableDrawing(),this._geometry=a,this._map.addGeometry(this._geometry),this._map.disableInteractivity(),this._mapView.on("click",this._onMapClicked,this)},d.prototype.disableDrawing=function(){this._isDrawingEnabled()&&(this._geometry.remove(),this._map.removeGeometry(this._geometry),delete this._geometry,this._map.enableInteractivity(),this._mapView.off("click",this._onMapClicked,this))},d.prototype._isDrawingEnabled=function(){return!!this._geometry},d.prototype._onMapClicked=function(a,b){this._geometry.update(b)},b.exports=d},{}],398:[function(a,b,c){var d=function(a,b){this._map=b,this._mapView=a};d.prototype.enableEdition=function(a){this.disableEdition(),this._geometry=a,this._map.addGeometry(this._geometry),this._werePopupsEnabled=this._map.arePopupsEnabled(),this._map.disablePopups()},d.prototype.disableEdition=function(){this._isEditionEnabled()&&(this._geometry.remove(),this._map.removeGeometry(this._geometry),delete this._geometry,this._reEnableOrDisablePopups())},d.prototype._isEditionEnabled=function(){return!!this._geometry},d.prototype._reEnableOrDisablePopups=function(){this._werePopupsEnabled?this._map.enablePopups():this._map.disablePopups()},b.exports=d},{}],399:[function(a,b,c){var d=a("backbone"),e=function(a){if(a=a||{},!a.mapView)throw new Error("mapView is required");if(!a.layersCollection)throw new Error("layersCollection is required");this._mapView=a.mapView,this._layersCollection=a.layersCollection,this._layersCollection.on("add",this._setLayerView,this),this._layersCollection.on("reset",this._setLayerView,this),this._setLayerView()};e.prototype=Object.create(d.Events),e.prototype.constructor=e,e.prototype._setLayerView=function(){this._layerView&&(this._unbindCartoDBFeatureEvents(),delete this._layerView);var a=this._layersCollection.getCartoDBLayers();a.length>0&&(this._layerView=this._mapView.getLayerViewByLayerCid(a[0].cid),this._bindCartoDBFeatureEvents())},e.prototype._unbindCartoDBFeatureEvents=function(){this._layerView.off("featureOver",this._onFeatureOver,this),this._layerView.off("featureClick",this._onFeatureClick,this),this._layerView.off("featureOut",this._onFeatureOut,this)},e.prototype._bindCartoDBFeatureEvents=function(){this._layerView.on("featureOver",this._onFeatureOver,this),this._layerView.on("featureClick",this._onFeatureClick,this),this._layerView.on("featureOut",this._onFeatureOut,this)},e.prototype._onFeatureOver=function(a,b,c,d,e){var f=this._getCartoDBLayerByLayerIndex(e);f&&this.trigger("featureOver",{layer:f,latlng:b,position:c,feature:d})},e.prototype._onFeatureClick=function(a,b,c,d,e){var f=this._getCartoDBLayerByLayerIndex(e);f&&this.trigger("featureClick",{layer:f,latlng:b,position:c,feature:d})},e.prototype._onFeatureOut=function(a,b){var c=this._getCartoDBLayerByLayerIndex(b);c&&this.trigger("featureOut",{layer:c})},e.prototype._getCartoDBLayerByLayerIndex=function(a){return this._layersCollection.getCartoDBLayers()[a]},b.exports=e},{backbone:"backbone"}],400:[function(a,b,c){var d=a("./drawing-controller"),e=a("./edition-controller"),f=function(a,b){this._drawingController=new d(a,b),this._editionController=new e(a,b),b.on("enterDrawingMode",this._enterDrawingMode,this),b.on("exitDrawingMode",this._exitDrawingMode,this),b.on("enterEditMode",this._enterEditMode,this),b.on("exitEditMode",this._exitEditMode,this)};f.prototype._enterDrawingMode=function(a){this._exitDrawingMode(),this._exitEditMode(),this._drawingController.enableDrawing(a)},f.prototype._exitDrawingMode=function(){this._drawingController.disableDrawing()},f.prototype._enterEditMode=function(a){this._exitDrawingMode(),this._exitEditMode(),this._editionController.enableEdition(a)},f.prototype._exitEditMode=function(){this._editionController.disableEdition()},b.exports=f},{"./drawing-controller":397,"./edition-controller":398}],401:[function(a,b,c){var d=a("underscore"),e=a("../geo/ui/infowindow-view"),f=a("../geo/ui/infowindow-model"),g=function(a,b){if(b=b||{},!a)throw new Error("vis is required");this._vis=a,this._showEmptyFields=b.showEmptyFields};g.prototype.manage=function(a,b){this._mapView=a,this._map=b,this._map.layers.bind("reset",function(a){a.each(this._addInfowindowForLayer,this)},this),this._map.layers.each(this._addInfowindowForLayer,this),this._map.layers.bind("add",this._addInfowindowForLayer,this),this._map.on("change:popupsEnabled",this._onPopupsEnabledChanged,this)},g.prototype._addInfowindowForLayer=function(a){if(a.infowindow){var b=this._mapView.getLayerViewByLayerCid(a.cid);this._infowindowView||(this._addInfowindowOverlay(b,a),this._bindFeatureClickEvent(b)),this._bindInfowindowModel(b,a)}},g.prototype._addInfowindowOverlay=function(a,b){var c=d.pick(b.infowindow.toJSON(),["template","fields","template_name","template_type"]);this._infowindowModel=new f(c),this._infowindowView=new e({model:this._infowindowModel,mapView:this._mapView}),this._mapView.addInfowindow(this._infowindowView)},g.prototype._bindFeatureClickEvent=function(a){a.bind("featureClick",function(b,c,d,e,f){var g=a.model.getLayerAt(f);if(!g)throw new Error("featureClick event for layer "+f+" was captured but layerModel coudn't be retrieved");if(this._map.arePopupsEnabled()&&g.infowindow.hasTemplate()){this._updateInfowindowModel(g.infowindow),this._infowindowModel.set({latlng:c,visibility:!0}),this._fetchAttributes(a,g,e.cartodb_id,c),a.tooltipView&&a.tooltipView.setFilter(function(a){return a.cartodb_id!==e.cartodb_id}).hide();var h=function(b){b.get("visibility")||a.tooltipView&&a.tooltipView.setFilter(null)};this._infowindowModel.unbind("change:visibility",h),this._infowindowModel.once("change:visibility",h)}},this)},g.prototype._updateInfowindowModel=function(a){this._infowindowModel.setInfowindowTemplate(a)},g.prototype._fetchAttributes=function(a,b,c){this._currentFeatureId=c||this._currentFeatureId,this._infowindowModel.setLoading();var d=a.model.getIndexOf(b);a.model.fetchAttributes(d,this._currentFeatureId,function(a){a?this._infowindowModel.updateContent(a,{showEmptyFields:this._showEmptyFields}):this._infowindowModel.setError()}.bind(this))},g.prototype._bindInfowindowModel=function(a,b){b.infowindow.bind("change",function(){this._updateInfowindowModel(b.infowindow)},this),b.infowindow.fields.bind("reset",function(){if(b.infowindow.hasFields()){if(this._updateInfowindowModel(b.infowindow),this._infowindowModel.get("visibility"))return void this._reloadVisAndFetchAttributes(a,b);this._reloadVis()}else this._isLayerInfowindowActiveAndVisible(b)&&this._hideInfowindow()},this),b.bind("change:visible",function(){this._isLayerInfowindowActiveAndVisible(b)&&this._hideInfowindow()},this)},g.prototype._isLayerInfowindowActiveAndVisible=function(a){return this._infowindowModel.hasInfowindowTemplate(a.infowindow)&&this._infowindowModel.get("visibility")},g.prototype._reloadVis=function(a){a=a||{},this._vis.reload(a)},g.prototype._reloadVisAndFetchAttributes=function(a,b){this._reloadVis({success:function(){this._fetchAttributes(a,b)}.bind(this)})},g.prototype._onPopupsEnabledChanged=function(){this._map.arePopupsDisabled()&&this._hideInfowindow()},g.prototype._hideInfowindow=function(){this._infowindowModel&&this._infowindowModel.set("visibility",!1)},b.exports=g},{"../geo/ui/infowindow-model":348,"../geo/ui/infowindow-view":349,underscore:"underscore"}],402:[function(a,b,c){function d(a){for(var b in n)if(-1!==a.indexOf(b))return a.replace(b,n[b]);return a}function e(a){for(var b in n){var c=n[b];if(-1!==a.indexOf(c))return a.replace(c,b)}return a}var f=a("underscore"),g=a("cdb.log"),h=a("../geo/map/tile-layer"),i=a("../geo/map/wms-layer"),j=a("../geo/map/gmaps-base-layer"),k=a("../geo/map/plain-layer"),l=a("../geo/map/cartodb-layer"),m=a("../geo/map/torque-layer"),n={"https://dnv9my2eseobd.cloudfront.net/":"http://a.tiles.mapbox.com/","https://maps.nlp.nokia.com/":"http://maps.nlp.nokia.com/","https://tile.stamen.com/":"http://tile.stamen.com/","https://{s}.maps.nlp.nokia.com/":"http://{s}.maps.nlp.nokia.com/","https://cartocdn_{s}.global.ssl.fastly.net/":"http://{s}.api.cartocdn.com/","https://cartodb-basemaps-{s}.global.ssl.fastly.net/":"http://{s}.basemaps.cartocdn.com/"},o={tiled:function(a,b){var c=b.vis,f=a.urlTemplate;return c.get("https")===!0?f=e(f):c.get("https")===!1&&(f=d(f)),a.urlTemplate=f,new h(a)},wms:function(a,b){return new i(a)},gmapsbase:function(a,b){return new j(a)},plain:function(a,b){return new k(a)},background:function(a,b){return new k(a)},cartodb:function(a,b){return new l(a,{vis:b.vis})},torque:function(a,b){var c=b.windshaftSettings;return a=f.extend(a,{user_name:c.userName,maps_api_template:c.urlTemplate,stat_tag:c.statTag,api_key:c.apiKey,auth_token:c.authToken}),c.templateName&&(a=f.extend(a,{named_map:{name:c.templateName}})),new m(a,{vis:b.vis})}},p=function(a){if(!a.visModel)throw new Error("visModel is required");if(!a.windshaftSettings)throw new Error("windshaftSettings is required");this._visModel=a.visModel,this._windshaftSettings=a.windshaftSettings};p.prototype.createLayer=function(a,b){var c=o[a.toLowerCase()];if(!c)return g.error("error creating layer of type '"+a+"'"),null;var d=f.extend({},f.omit(b,"options"),b.options);return c(d,{windshaftSettings:this._windshaftSettings,vis:this._visModel})},b.exports=p},{"../geo/map/cartodb-layer":322,"../geo/map/gmaps-base-layer":323,"../geo/map/plain-layer":335,"../geo/map/tile-layer":337,"../geo/map/torque-layer":339,"../geo/map/wms-layer":340,"cdb.log":223,underscore:"underscore"}],403:[function(a,b,c){var d=a("underscore"),e=function(a){if(!a.mapView)throw new Error("mapView is required");if(!a.mapModel)throw new Error("mapModel is required");if(!a.featureEvents)throw new Error("featureEvents is required");this._mapView=a.mapView,this._mapModel=a.mapModel,this._featureEvents=a.featureEvents,this._featureEvents.on("featureOver",this._onFeatureOver,this),this._featureEvents.on("featureOut",this._onFeatureOut,this),this._clickableLayersBeingFeatureOvered={}};e.prototype._onFeatureOver=function(a){this._isLayerClickable(a.layer)&&!this._isLayerBeingFeatureOvered(a.layer)&&(this._markLayerAsFeatureOvered(a.layer),this._updateMousePointer())},e.prototype._onFeatureOut=function(a){this._isLayerBeingFeatureOvered(a.layer)&&(this._unmarkLayerAsFeatureOvered(a.layer),this._updateMousePointer())},e.prototype._onLayerVisibilityChanged=function(a){a.isVisible()||(this._unmarkLayerAsFeatureOvered(a),this._updateMousePointer())},e.prototype._updateMousePointer=function(){this._isAnyClickableLayerBeingFeatureOvered()?this._mapView.setCursor("pointer"):this._mapView.setCursor("auto")},e.prototype._markLayerAsFeatureOvered=function(a){this._clickableLayersBeingFeatureOvered[a.cid]=a,a.once("change:visible",this._onLayerVisibilityChanged,this)},e.prototype._unmarkLayerAsFeatureOvered=function(a){delete this._clickableLayersBeingFeatureOvered[a.cid],a.off("change:visible",this._onLayerVisibilityChanged,this)},e.prototype._isLayerClickable=function(a){return this._mapModel.isFeatureInteractivityEnabled()||this._mapModel.arePopupsEnabled()&&a.isInfowindowEnabled()},e.prototype._isLayerBeingFeatureOvered=function(a){return!!this._clickableLayersBeingFeatureOvered[a.cid]},e.prototype._isAnyClickableLayerBeingFeatureOvered=function(){return!d.isEmpty(this._clickableLayersBeingFeatureOvered)},b.exports=e},{underscore:"underscore"}],404:[function(a,b,c){var d=function(a){if(!a.mapModel)throw new Error("mapModel is required");if(!a.featureEvents)throw new Error("featureEvents is required");this._mapModel=a.mapModel,this._featureEvents=a.featureEvents,this._featureEvents.on("featureOver",this._onFeatureOver,this),this._featureEvents.on("featureClick",this._onFeatureClick,this),this._featureEvents.on("featureOut",this._onFeatureOut,this)};d.prototype._onFeatureClick=function(a){this._mapModel.isFeatureInteractivityEnabled()&&this._mapModel.trigger("featureClick",a)},d.prototype._onFeatureOver=function(a){this._mapModel.isFeatureInteractivityEnabled()&&this._mapModel.trigger("featureOver",a)},b.exports=d},{}],405:[function(a,b,c){var d=a("underscore"),e=a("../core/model"),f=a("../core/template"),g=a("../geo/ui/annotation"),h=a("../geo/ui/search/search"),i=a("../geo/ui/text"),j=a("../geo/ui/tiles-loader"),k=a("../geo/ui/zoom/zoom-view"),l=a("../ui/common/fullscreen/fullscreen-view"),m=a("../geo/ui/attribution/attribution-view"),n=a("../geo/ui/logo-view"),o=a("cdb.log"),p={_types:{},register:function(a,b){p._types[a]=b},create:function(a,b,c){if(c=c||{},!c.visView)throw new Error("visView is required");if(!c.map)throw new Error("map is required");var d=c.visView,e=c.map,f=p._types[a];if(!f)return void o.log("Overlays of type '"+a+"' are not supported anymore");b.options="string"==typeof b.options?JSON.parse(b.options):b.options,b.options=b.options||{};var g=f(b,d,e);return g?(g.type=a,g):!1}};p.register("logo",function(a,b,c){var d=new n;return d.render()}),p.register("attribution",function(a,b,c){var d=new m({map:c});return d.render()}),p.register("text",function(a,b,c){var d=a.options,g=f.compile(a.template||['<div class="content">','<div class="text widget_text">{{{ text }}}</div>',"</div>"].join("\n"),a.templateType||"mustache"),h=new i({model:new e(d),template:g,className:"cartodb-overlay overlay-text "+d.device});return h.render()}),p.register("annotation",function(a,b,c){var d=a.options,e=f.compile(a.template||['<div class="content">','<div class="text widget_text">{{{ text }}}</div>','<div class="stick"><div class="ball"></div></div>',"</div>"].join("\n"),a.templateType||"mustache"),h=new g({className:"cartodb-overlay overlay-annotation "+d.device,template:e,mapView:b.mapView,device:d.device,text:d.extra.rendered_text,minZoom:d.style["min-zoom"],maxZoom:d.style["max-zoom"],latlng:d.extra.latlng,style:d.style});return h.render()}),p.register("zoom",function(a,b,c){var d={model:c},e=new k(d);return e.render()}),p.register("loader",function(a){var b=new j;return b.render()}),p.register("layer_selector",function(a,b,c){}),p.register("fullscreen",function(a,b,c){var e=d.extend(a,{doc:b.$el.find("> div").get(0),allowWheelOnFullscreen:!1,mapView:b.mapView});a.template&&(e.template=f.compile(a.template,a.templateType||"mustache"));var g=new l(e);return g.render()}),p.register("share",function(a,b,c){}),p.register("search",function(a,b,c){var e=d.extend(a,{mapView:b.mapView,model:c});a.template&&(e.template=f.compile(a.template,a.templateType||"mustache"));var g=new h(e);return g.render()}),p.register("custom",function(a,b,c){var d=a;return d.render()}),b.exports=p},{"../core/model":230,"../core/template":234,"../geo/ui/annotation":342,"../geo/ui/attribution/attribution-view":344,"../geo/ui/logo-view":373,"../geo/ui/search/search":376,"../geo/ui/text":379,"../geo/ui/tiles-loader":380,"../geo/ui/zoom/zoom-view":383,"../ui/common/fullscreen/fullscreen-view":387,"cdb.log":223,underscore:"underscore"}],406:[function(a,b,c){var d=a("backbone"),e=d.Model.extend({defaults:{showLegends:!0,showLayerSelector:!1}});b.exports=e},{backbone:"backbone"}],407:[function(a,b,c){var d=a("../geo/ui/tooltip-view"),e=function(a){this._vis=a};e.prototype.manage=function(a,b){this._mapView=a,this._map=b,this._map.layers.bind("reset",this._addTooltipForLayers,this),this._map.layers.bind("add",this._addTooltipForLayer,this),this._addTooltipForLayers()},e.prototype._addTooltipForLayers=function(){this._map.layers.each(this._addTooltipForLayer,this)},e.prototype._addTooltipForLayer=function(a){if(a.tooltip){var b=this._mapView.getLayerViewByLayerCid(a.cid);a.tooltip.fields.bind("reset",function(){this._reloadVis()},this),b.tooltipView||(this._addTooltipOverlay(b,a),this._bindFeatureOverEvent(b))}},e.prototype._reloadVis=function(a){a=a||{},this._vis.reload(a)},e.prototype._addTooltipOverlay=function(a,b){a.tooltipView||(a.tooltipView=new d({mapView:this._mapView,layer:a,position:"bottom|right",vertical_offset:10,horizontal_offset:4,omit_columns:["cartodb_id"]}),this._mapView.addOverlay(a.tooltipView),a.bind("remove",function(){a.tooltipView.clean()},this))},e.prototype._bindFeatureOverEvent=function(a){a.bind("featureOver",function(b,c,d,e,f){var g=a.model.getLayerAt(f);if(!g)throw new Error("featureOver event for layer "+f+" was captured but layerModel coudn't be retrieved");this._map.arePopupsEnabled()&&g.tooltip.hasTemplate()?(a.tooltipView.setTemplate(g.tooltip.get("template")),a.tooltipView.setFields(g.tooltip.fields.toJSON()),a.tooltipView.setAlternativeNames(g.tooltip.get("alternative_names")),a.tooltipView.enable()):a.tooltipView.disable()},this)},b.exports=e},{"../geo/ui/tooltip-view":381}],408:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cdb.core.util"),g=a("../core/view"),h=a("../geo/map-view-factory"),i=a("./overlays-factory"),j=a("./infowindow-manager"),k=a("./tooltip-manager"),l=a("./feature-events"),m=a("./map-cursor-manager"),n=a("./map-events-manager"),o=a("./geometry-management-controller"),p=a("../geo/ui/legends/legends-view.js"),q=g.extend({initialize:function(a){this.model.once("load",this.render,this),this.model.on("invalidateSize",this._invalidateSize,this),this.model.on("change:loading",this._toggleLoader,this),this.model.overlaysCollection.on("add remove change",this._resetOverlays,this),this.settingsModel=a.settingsModel,this.overlays=[],d.bindAll(this,"_onResize")},render:function(){var a=e("<div>").css({position:"relative",width:"100%",height:"100%"});this.container=a;var b=e("<div>").addClass("cartodb-map-wrapper").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%"});a.append(b),this.$el.html(a);var c=new h;this.mapView=c.createMapView(this.model.map.get("provider"),this.model.map,b,this.model.layerGroupModel),this.mapView.bind("newLayerView",this._bindLayerViewToLoader,this),this.mapView.render(),new o(this.mapView,this.model.map);var d=new j(this.model,{showEmptyFields:this.model.get("showEmptyInfowindowFields")});d.manage(this.mapView,this.model.map);var f=new k(this.model);f.manage(this.mapView,this.model.map);var g=new l({mapView:this.mapView,layersCollection:this.model.map.layers});new m({mapView:this.mapView,mapModel:this.model.map,featureEvents:g}),new n({mapModel:this.model.map,featureEvents:g}),this._renderLegends(),this._resetOverlays({});var i=this.$el.outerHeight();0===i&&e(window).bind("resize",this._onResize)},_renderLegends:function(){this._legendsView=new p({layersCollection:this.model.map.layers,settingsModel:this.settingsModel}),this.$el.append(this._legendsView.render().$el)},_bindLayerViewToLoader:function(a){a.bind("load",function(){this.model.untrackLoadingObject(a)},this),a.bind("loading",function(){this.model.trackLoadingObject(a)},this)},_resetOverlays:function(a){var b=this.model.overlaysCollection.toJSON();for(b=d.sortBy(b,function(a){return null===a.order?Number.MAX_VALUE:a.order});0!==this.overlays.length;)this.overlays.pop().clean();this._createOverlays(b,a)},_createOverlays:function(a,b){d(a).each(function(a){var c=a.type,d=this.addOverlay(a),e=a.options;if(!("fullscreen"===c&&f.browser.ie&&f.browser.ie.version<=10)){
if("image"===c||"text"===c||"annotation"===c){var g="mobile"===a.options.device;if(this.mobile!==g)return;if(!b[c]&&void 0!==b[c])return}d&&c in b&&b[c]===!1&&d.hide(),("fullscreen"===c&&b[c]||"fullscreen"===c&&e.display&&void 0===b[c])&&d.show(),("search"===c&&b[c]||"search"===c&&e.display&&void 0===b[c])&&d.show(),"search"===c&&d.updatePosition(this._hasZoomOverlay())}},this)},_hasZoomOverlay:function(){var a=this.model.overlaysCollection.pluck("type");return a.indexOf("zoom")>-1},_setupSublayers:function(a,b){b.sublayer_options=[],d.each(a.slice(1),function(a){"layergroup"===a.type?d.each(a.options.layer_definition.layers,function(a){b.sublayer_options.push({visible:void 0!==a.visible?a.visible:!0})}):"namedmap"===a.type?d.each(a.options.named_map.layers,function(a){b.sublayer_options.push({visible:void 0!==a.visible?a.visible:!0})}):"torque"===a.type&&b.sublayer_options.push({visible:void 0!==a.options.visible?a.options.visible:!0})})},_invalidateSize:function(){this.mapView.invalidateSize()},addOverlay:function(a){var b=i.create(a.type,a,{visView:this,map:this.model.map});return b&&(this.mapView.addOverlay(b),this.overlays.push(b),b.bind("clean",function(){for(var a in this.overlays){var c=this.overlays[a];if(b.cid===c.cid)return void this.overlays.splice(a,1)}},this)),b},getLayerViews:function(){var a=this;return d.compact(this.model.map.layers.map(function(b){return a.mapView.getLayerViewByLayerCid(b.cid)}))},getOverlays:function(){return this.overlays},getOverlay:function(a){return d(this.overlays).find(function(b){return b.type===a})},getOverlaysByType:function(a){return d(this.overlays).filter(function(b){return b.type===a})},_toggleLoader:function(){var a=this._getLoaderOverlay();a&&(this.model.get("loading")?a.show():a.hide())},_getLoaderOverlay:function(){return this.getOverlay("loader")},_onResize:function(){e(window).unbind("resize",this._onResize);var a=this;setTimeout(function(){a.model.centerMapToOrigin()},150)}});b.exports=q},{"../core/view":236,"../geo/map-view-factory":319,"../geo/ui/legends/legends-view.js":371,"./feature-events":399,"./geometry-management-controller":400,"./infowindow-manager":401,"./map-cursor-manager":403,"./map-events-manager":404,"./overlays-factory":405,"./tooltip-manager":407,"cdb.core.util":235,jquery:"jquery",underscore:"underscore"}],409:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("../core/util"),g=a("../geo/map"),h=a("../dataviews/dataviews-factory"),i=a("../dataviews/dataviews-collection"),j=a("../windshaft/client"),k=a("../windshaft/named-map"),l=a("../windshaft/anonymous-map"),m=a("../analysis/analysis-factory"),n=a("../geo/cartodb-layer-group"),o=a("../windshaft-integration/model-updater"),p=a("../geo/map/layers"),q=a("../analysis/analysis-poller"),r=a("./layers-factory"),s=a("./settings"),t=a("./dataviews-tracker"),u="init",v="ok",w="error",x=e.Model.extend({defaults:{loading:!1,showEmptyInfowindowFields:!1,state:u},initialize:function(){this._loadingObjects=[],this._analysisPoller=new q,this._layersCollection=new p,this._analysisCollection=new e.Collection,this._dataviewsCollection=new i,this.overlaysCollection=new e.Collection,this.settings=new s,this._instantiateMapWasCalled=!1},done:function(a){return this._doneCallback=a,this},setOk:function(){this.get("state")===u&&this._doneCallback&&this._doneCallback(this),this.set("state",v),this.unset("error")},error:function(a){return this._errorCallback=a,this},setError:function(a){this.get("state")===u&&this._errorCallback&&this._errorCallback(a),this.set({state:w,error:a})},getLayers:function(){return d.clone(this.map.layers.models)},getLayer:function(a){return this.map.layers.at(a)},load:function(a){var b=a.datasource,c={urlTemplate:a.datasource.maps_api_template,userName:a.datasource.user_name,statTag:a.datasource.stat_tag,apiKey:this.get("apiKey"),authToken:this.get("authToken")},e=l;a.isNamedMap()&&(c.templateName=a.datasource.template_name,e=k);var i=new j(c),p=this.layerGroupModel=new n({apiKey:this.get("apiKey"),authToken:this.get("authToken")},{layersCollection:this._layersCollection}),q=new o({visModel:this,layerGroupModel:p,dataviewsCollection:this._dataviewsCollection,layersCollection:this._layersCollection,analysisCollection:this._analysisCollection});this._windshaftMap=new e({apiKey:this.get("apiKey"),authToken:this.get("authToken"),statTag:b.stat_tag},{client:i,modelUpdater:q,windshaftSettings:c,dataviewsCollection:this._dataviewsCollection,layersCollection:this._layersCollection,analysisCollection:this._analysisCollection});var s=new r({visModel:this,windshaftSettings:c}),t=f.isMobileDevice()||a.hasZoomOverlay()||a.scrollwheel;this.map=new g({title:a.title,description:a.description,bounds:a.bounds,center:a.center,zoom:a.zoom,scrollwheel:!!this.scrollwheel,drag:t,provider:a.map_provider,vector:a.vector,isFeatureInteractivityEnabled:this.get("interactiveFeatures")},{layersCollection:this._layersCollection,layersFactory:s}),this.overlaysCollection.reset(a.overlays),this.dataviews=new h({apiKey:this.get("apiKey"),authToken:this.get("authToken")},{map:this.map,vis:this,dataviewsCollection:this._dataviewsCollection,analysisCollection:this._analysisCollection}),this.analysis=new m({apiKey:this.get("apiKey"),authToken:this.get("authToken"),analysisCollection:this._analysisCollection,vis:this}),this._windshaftMap.bind("instanceCreated",this._onMapInstanceCreated,this);var u=this._flattenLayers(a.layers),v=d.map(u,function(a){return s.createLayer(a.type,a)});this.map.layers.reset(v),a.analyses&&d.each(a.analyses,function(a){this.analysis.analyse(a)},this),window.vis=this,d.defer(function(){this.trigger("load",this)}.bind(this))},setSettings:function(a){this.settings.set(a)},_onMapInstanceCreated:function(){this._analysisPoller.reset(),this._analysisCollection.each(function(a){a.unbind("change:status",this._onAnalysisStatusChanged,this),a.url()&&!a.isDone()&&(this._analysisPoller.poll(a),this.trackLoadingObject(a),a.bind("change:status",this._onAnalysisStatusChanged,this))},this)},_onAnalysisStatusChanged:function(a){a.isDone()&&(this.untrackLoadingObject(a),this._isAnalysisSourceOfLayerOrDataview(a)&&this.reload())},_isAnalysisSourceOfLayerOrDataview:function(a){var b=this._layersCollection.any(function(b){return b.get("source")===a.get("id")}),c=this._dataviewsCollection.isAnalysisLinkedToDataview(a);return b||c},trackLoadingObject:function(a){-1===this._loadingObjects.indexOf(a)&&this._loadingObjects.push(a),this.set("loading",!0)},untrackLoadingObject:function(a){var b=this._loadingObjects.indexOf(a);b>=0&&(this._loadingObjects.splice(b,1),0===this._loadingObjects.length&&this.set("loading",!1))},instantiateMap:function(a){a=a||{},this._instantiateMapWasCalled||(this._instantiateMapWasCalled=!0,this.reload({success:function(){a.success&&a.success(),this._onMapInstantiatedForTheFirstTime()}.bind(this),error:function(){a.error&&a.error()},includeFilters:!1}))},_onMapInstantiatedForTheFirstTime:function(){var a=this._isAnyDataviewFiltered();t(this._dataviewsCollection,this._onDataviewFetched.bind(this)),this._initBindsAfterFirstMapInstantiation(),a&&this.reload({includeFilters:a})},_isAnyDataviewFiltered:function(){return this._dataviewsCollection.isAnyDataviewFiltered()},_onDataviewFetched:function(){this.trigger("dataviewsFetched")},reload:function(a){a=d.extend({includeFilters:!0},a),a=d.pick(a,"sourceId","forceFetch","success","error","includeFilters"),this._instantiateMapWasCalled&&(this.trigger("reload"),this._windshaftMap.createInstance(a))},_initBindsAfterFirstMapInstantiation:function(){this._layersCollection.bind("reset",this._onLayersResetted,this),this._layersCollection.bind("add",this._onLayerAdded,this),this._layersCollection.bind("remove",this._onLayerRemoved,this),this._dataviewsCollection&&(this._dataviewsCollection.on("add reset remove",d.debounce(this.invalidateSize,10),this),this.listenTo(this._dataviewsCollection,"add",d.debounce(this._onDataviewAdded.bind(this),10)),this.listenTo(this._dataviewsCollection,"remove",this._onDataviewRemoved))},_onDataviewRemoved:function(a){a.isFiltered()&&this.reload({sourceId:a.getSourceId()})},_onLayersResetted:function(){this.reload()},_onLayerAdded:function(a){this.reload({sourceId:a.get("id")})},_onLayerRemoved:function(a){this.reload({sourceId:a.get("id")})},_onDataviewAdded:function(){this.reload()},invalidateSize:function(){this.trigger("invalidateSize")},centerMapToOrigin:function(){this.invalidateSize(),this.map.reCenter()},_flattenLayers:function(a){return d.chain(a).map(function(a){return"layergroup"===a.type?a.options.layer_definition.layers:"namedmap"===a.type?d.map(a.options.named_map.layers,function(a){return a.type="CartoDB",a}):a}).flatten().value()},addCustomOverlay:function(a){return a.type="custom",this.overlaysCollection.add(a),a}});b.exports=x},{"../analysis/analysis-factory":211,"../analysis/analysis-poller":213,"../core/util":235,"../dataviews/dataviews-collection":243,"../dataviews/dataviews-factory":244,"../geo/cartodb-layer-group":250,"../geo/map":321,"../geo/map/layers":326,"../windshaft-integration/model-updater":416,"../windshaft/anonymous-map":417,"../windshaft/client":418,"../windshaft/named-map":426,"./dataviews-tracker":396,"./layers-factory":402,"./settings":406,backbone:"backbone",underscore:"underscore"}],410:[function(a,b,c){var d={light:['<div class="cartodb-popup v2">','<a href="#close" class="cartodb-popup-close-button close">x</a>','<div class="cartodb-popup-content-wrapper">','<div class="cartodb-popup-content">',"{{#content.fields}}","{{#title}}<h4>{{title}}</h4>{{/title}}","{{#value}}",'<p {{#type}}class="{{ type }}"{{/type}}>{{{ value }}}</p>',"{{/value}}","{{^value}}",'<p class="empty">null</p>',"{{/value}}","{{/content.fields}}","</div>","</div>",'<div class="cartodb-popup-tip-container"></div>',"</div>"].join("")};b.exports=d},{}],411:[function(a,b,c){var d=a("underscore"),e=a("./rule"),f=["marker-width","line-width"],g=function(a){var b=a.getBucketsWithRangeFilter();return d.every(b,function(a){return null!=a.filter.start&&null!=a.filter.end})},h=function(a){var b=d.last(a);return d.chain(a).map("filter").map("start").concat(b.filter.end).value()};b.exports={canAdapt:function(a){return a=new e(a),a.matchesAnyProperty(f)&&g(a)},adapt:function(a){a=new e(a);var b=a.getBucketsWithRangeFilter();return{values:h(b),sizes:d.map(b,"value"),avg:a.getFilterAvg()}}}},{"./rule":415,underscore:"underscore"}],412:[function(a,b,c){var d=a("underscore"),e=a("./rule"),f=["line-color","marker-fill","polygon-fill"],g=["="],h=function(a){var b=a.getBucketsWithCategoryFilter();return d.every(b,function(a){return null!=a.filter.name&&null!=a.value})},i=function(a){return d.map(a,function(a){return{label:a.filter.name,value:a.value}})};b.exports={canAdapt:function(a){return a=new e(a),a.matchesAnyProperty(f)&&a.matchesAnyMapping(g)&&h(a)},adapt:function(a){a=new e(a);var b=a.getBucketsWithCategoryFilter(),c=a.getBucketsWithDefaultFilter();return{categories:i(b),defaultValue:d.isEmpty(c)?void 0:c[0].value}}}},{"./rule":415,underscore:"underscore"}],413:[function(a,b,c){var d=a("underscore"),e=a("./rule"),f=["line-color","marker-fill","polygon-fill"],g=[">",">=","<","<="],h=function(a){var b=a.getBucketsWithRangeFilter();return d.every(b,function(a){return null!=a.filter.start&&null!=a.filter.end})},i=function(a){return d.map(a,function(b,c){var d="";return 0===c?d=b.filter.start:c===a.length-1&&(d=b.filter.end),{value:b.value,label:d.toString()}})};b.exports={canAdapt:function(a){return a=new e(a),a.matchesAnyProperty(f)&&a.matchesAnyMapping(g)&&h(a)},adapt:function(a){a=new e(a);var b=a.getBucketsWithRangeFilter(),c=d.last(b),f=d.first(b);return{colors:i(b),avg:a.getFilterAvg(),max:c.filter.end,min:f.filter.start}}}},{"./rule":415,underscore:"underscore"}],414:[function(a,b,c){var d={bubble:a("./rule-to-bubble-legend-adapter"),choropleth:a("./rule-to-choropleth-legend-adapter"),category:a("./rule-to-category-legend-adapter")};b.exports={getAdapterForLegend:function(a){return d[a.get("type")]}}},{"./rule-to-bubble-legend-adapter":411,"./rule-to-category-legend-adapter":412,"./rule-to-choropleth-legend-adapter":413}],415:[function(a,b,c){var d=a("underscore"),e="prop",f="mapping",g="range",h="category",i="default",j=function(a){this._rule=a};j.prototype.matchesAnyProperty=function(a){return this._matches(this._rule[e],a)},j.prototype.matchesAnyMapping=function(a){return this._matches(this._rule[f],a)},j.prototype._matches=function(a,b){return d.isString(b)&&(b=[b]),d.contains(b,a)},j.prototype.getBucketsWithRangeFilter=function(){return this._getBucketsByFilterType(g)},j.prototype.getBucketsWithCategoryFilter=function(){return this._getBucketsByFilterType(h)},j.prototype.getBucketsWithDefaultFilter=function(){return this._getBucketsByFilterType(i)},j.prototype._getBucketsByFilterType=function(a){return d.select(this._rule.buckets,function(b){return b.filter.type===a})},j.prototype.getFilterAvg=function(){return this._rule.stats.filter_avg},b.exports=j},{underscore:"underscore"}],416:[function(a,b,c){var d=a("underscore"),e=a("../cdb.log"),f=a("./legends/rule-to-legend-model-adapters"),g=function(a){if(!a.visModel)throw new Error("visModel is required");if(!a.layerGroupModel)throw new Error("layerGroupModel is required");if(!a.layersCollection)throw new Error("layersCollection is required");if(!a.dataviewsCollection)throw new Error("dataviewsCollection is required");if(!a.analysisCollection)throw new Error("analysisCollection is required");this._visModel=a.visModel,this._layerGroupModel=a.layerGroupModel,this._layersCollection=a.layersCollection,this._dataviewsCollection=a.dataviewsCollection,this._analysisCollection=a.analysisCollection};g.prototype.updateModels=function(a,b,c){this._updateLayerGroupModel(a),this._updateLayerModels(a),this._updateDataviewModels(a,b,c),this._updateAnalysisModels(a),this._visModel.setOk()},g.prototype._updateLayerGroupModel=function(a){var b={tiles:this._calculateTileURLTemplatesForCartoDBLayers(a),grids:this._calculateGridURLTemplatesForCartoDBLayers(a),attributes:this._calculateAttributesBaseURLsForCartoDBLayers(a)};this._layerGroupModel.set({indexOfLayersInWindshaft:a.getLayerIndexesByType("mapnik"),urls:b})},g.prototype._calculateTileURLTemplatesForCartoDBLayers=function(a){var b=[];return d.each(a.getSupportedSubdomains(),function(c){b.push(this._generatePNGTileURLTemplate(a,c))},this),b},g.prototype._generatePNGTileURLTemplate=function(a,b){return a.getBaseURL(b)+"/{layerIndexes}/{z}/{x}/{y}.png"},g.prototype._calculateGridURLTemplatesForCartoDBLayers=function(a){var b=[],c=a.getLayerIndexesByType("mapnik");return c.length>0&&d.each(c,function(c){var e=[];d.each(a.getSupportedSubdomains(),function(b){e.push(this._generateGridURLTemplate(a,b,c))},this),b.push(e)},this),b},g.prototype._generateGridURLTemplate=function(a,b,c){return a.getBaseURL(b)+"/"+c+"/{z}/{x}/{y}.grid.json"},g.prototype._calculateAttributesBaseURLsForCartoDBLayers=function(a){var b=[],c=a.getLayerIndexesByType("mapnik");return c.length>0&&d.each(c,function(c){b.push(this._generateAttributesBaseURL(a,c))},this),b},g.prototype._generateAttributesBaseURL=function(a,b){return a.getBaseURL()+"/"+b+"/attributes"},g.prototype._updateLayerModels=function(a){var b=a.getLayerIndexesByType("mapnik");d.each(this._layersCollection.getCartoDBLayers(),function(c,d){var e=b[d];c.set("meta",a.getLayerMetadata(e)),this._updateLegendModels(c,e,a),c.setOk()},this);var c=a.getLayerIndexesByType("torque");d.each(this._layersCollection.getTorqueLayers(),function(b,d){var e=c[d];b.set("meta",a.getLayerMetadata(e)),b.set("tileURLTemplates",this._calculateTileURLTemplatesForTorqueLayers(a)),this._updateLegendModels(b,e,a),b.setOk()},this)},g.prototype._calculateTileURLTemplatesForTorqueLayers=function(a){var b=[],c=a.getLayerIndexesByType("torque");return c.length>0&&b.push(this._generateTorqueTileURLTemplate(a,c)),b},g.prototype._generateTorqueTileURLTemplate=function(a,b){return a.getBaseURL()+"/"+b.join(",")+"/{z}/{x}/{y}.json.torque"},g.prototype._updateLegendModels=function(a,b,c){var e=c.getLayerMetadata(b);d.each(this._getLayerLegends(a),function(a){this._updateLegendModel(a,e)},this)},g.prototype._updateLegendModel=function(a,b){var c=b&&b.cartocss_meta&&b.cartocss_meta.rules;try{var g={state:"success"};if(c){var h=f.getAdapterForLegend(a),i=d.find(c,h.canAdapt);i&&(g=d.extend(g,h.adapt(i)))}a.set(g)}catch(j){a.set({state:"error"}),e.error("legend of type '"+a.get("type")+"' couldn't be updated: "+j.message)}},g.prototype._updateDataviewModels=function(a,b,c){this._dataviewsCollection.each(function(d){var e=a.getDataviewMetadata(d.get("id"));e&&d.set({url:e.url[this._getProtocol()]},{sourceId:b,forceFetch:c})},this)},g.prototype._updateAnalysisModels=function(a){this._analysisCollection.each(function(b){var c,e=a.getAnalysisNodeMetadata(b.get("id"));e&&(c={status:e.status,url:e.url[this._getProtocol()],query:e.query},c=d.omit(c,b.getParamNames()),e.error_message?(c=d.extend(c,{error:{message:e.error_message}}),b.set(c)):(b.set(c),b.setOk()))},this)},g.prototype._getProtocol=function(){return"file:"===window.location.protocol?"http":window.location.protocol.replace(":","")},g.prototype.setErrors=function(a){d.each(a,this._setError,this),this._setLegendErrors()},g.prototype._setError=function(a){if(a.isLayerError()){var b=this._layersCollection.get(a.layerId);b&&b.setError(a)}else if(a.isAnalysisError()){var c=this._analysisCollection.get(a.analysisId);c&&c.setError(a)}else this._visModel.setError(a)},g.prototype._setLegendErrors=function(){var a=this._layersCollection.chain().map(this._getLayerLegends).compact().flatten().value();d.each(a,function(a){a.set("state","error")})},g.prototype._getLayerLegends=function(a){return a.legends&&[a.legends.bubble,a.legends.category,a.legends.choropleth]},b.exports=g},{"../cdb.log":223,"./legends/rule-to-legend-model-adapters":414,underscore:"underscore"}],417:[function(a,b,c){var d=a("underscore"),e=a("./map-base"),f="2.1.0",g=["CartoDB","torque"],h=e.extend({toJSON:function(){return{layers:this._calculateLayersSection(),dataviews:this._calculateDataviewsSection(),analyses:this._calculateAnalysesSection()}},_calculateLayersSection:function(){return d.chain(this._getCartoDBAndTorqueLayers()).map(this._calculateLayerJSON,this).compact().value()},_calculateLayerJSON:function(a){return{id:a.get("id"),type:a.get("type").toLowerCase(),options:this._calculateLayerOptions(a)}},_calculateLayerOptions:function(a){var b={cartocss:a.get("cartocss"),cartocss_version:a.get("cartocss_version")||f,interactivity:a.getInteractiveColumnNames()},c=a.get("source");return c?b.source={id:c}:a.get("sql")&&(b.sql=a.get("sql")),a.get("sql_wrap")&&(b.sql_wrap=a.get("sql_wrap")),a.infowindow&&a.infowindow.hasFields()&&(b.attributes={id:"cartodb_id",columns:a.infowindow.getFieldNames()}),b},_calculateDataviewsSection:function(){return this._dataviewsCollection.reduce(function(a,b){return a[b.get("id")]=b.toJSON(),a},{})},_calculateAnalysesSection:function(){var a=[],b=d.chain(this._getCartoDBAndTorqueLayers()).map(function(a){return a.get("source")}).compact().value(),c=this._dataviewsCollection.chain().map(function(a){return a.getSourceId()}).compact().value(),e=d.uniq(b.concat(c));return d.each(e,function(b){var c=this._analysisCollection.findWhere({id:b});if(c)this._isAnalysisPartOfOtherAnalyses(c)||a.push(c.toJSON());else{var d=this._getLayerById(b);if(!d)throw new Error("sourceId '"+b+"' doesn't exist");d.get("sql")&&a.push(this._getSourceAnalysisForLayer(this._getLayerById(b)))}},this),a},_getLayerById:function(a){return d.find(this._getCartoDBAndTorqueLayers(),function(b){return b.id===a})},_getSourceAnalysisForLayer:function(a){return{id:a.id,type:"source",params:{query:a.get("sql")}}},_isAnalysisPartOfOtherAnalyses:function(a){return this._analysisCollection.any(function(b){return a!==b?b.findAnalysisById(a.get("id")):!1})},_isAnyDataviewLinkedTo:function(a){return this._dataviewsCollection.any(function(b){return b.layer===a})},_getCartoDBAndTorqueLayers:function(){return this._layersCollection.select(function(a){return g.indexOf(a.get("type"))>=0})}});b.exports=h},{"./map-base":425,underscore:"underscore"}],418:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("lzma"),g=a("../core/util"),h=a("./config"),i=function(a,b){var c=e.filter(b,function(b){return!a[b]});if(c.length)throw new Error("WindshaftClient could not be initialized. The following options are missing: "+c.join(", "))},j=2033,k=3,l=function(a){i(a,["urlTemplate","userName"]),a.templateName?this.endpoints={get:[h.MAPS_API_BASE_URL,"named",a.templateName,"jsonp"].join("/"),post:[h.MAPS_API_BASE_URL,"named",a.templateName].join("/")}:this.endpoints={get:h.MAPS_API_BASE_URL,post:h.MAPS_API_BASE_URL},this.url=a.urlTemplate.replace("{user}",a.userName)};l.prototype.instantiateMap=function(a){if(!a.mapDefinition)throw new Error("mapDefinition option is required");var b=a.mapDefinition,c=a.params||{},d=a.success,e=a.error,f={success:function(a){a.errors?e(a):d(a)},error:function(a,b){if("abort"!==b){var c={};try{c=JSON.parse(a.responseText)}catch(d){}e(c)}}},g=this._generateEncodedURL(b,c);this._isURLValid(g)?this._get(g,f):this._generateCompressedURL(b,c,function(a){if(this._isURLValid(a))this._get(a,f);else{var d=this._getURL(c,"post");this._post(d,b,f)}}.bind(this))},l.prototype._generateEncodedURL=function(a,b){return b=e.extend({config:JSON.stringify(a)},b),this._getURL(b)},l.prototype._generateCompressedURL=function(a,b,c){var d=JSON.stringify({config:JSON.stringify(a)});f.compress(d,k,function(a){b=e.extend({lzma:g.array2hex(a)},b),c(this._getURL(b))}.bind(this))},l.prototype._isURLValid=function(a){return a.length<j},l.prototype._post=function(a,b,c){this._abortPreviousRequest(),this._previousRequest=d.ajax({url:a,crossOrigin:!0,method:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(b),success:c.success,error:c.error})},l.prototype._get=function(a,b){this._abortPreviousRequest(),this._previousRequest=d.ajax({url:a,method:"GET",dataType:"jsonp",jsonpCallback:this._jsonpCallbackName(a),cache:!0,success:b.success,error:b.error})},l.prototype._abortPreviousRequest=function(){this._previousRequest&&this._previousRequest.abort()},l.prototype._getURL=function(a,b){b=b||"get";var c=this._convertParamsToQueryString(a),d=this.endpoints[b];return[this.url,d].join("/")+c},l.prototype._convertParamsToQueryString=function(a){var b=[];return e.each(a,function(a,c){a instanceof Array?e.each(a,function(a){b.push(c+"[]="+a)}):a instanceof Object?b.push(c+"="+encodeURIComponent(JSON.stringify(a))):b.push(c+"="+encodeURIComponent(a))}),b.length>0?"?"+b.join("&"):""},l.prototype._jsonpCallbackName=function(a){return"_cdbc_"+g.uniqueCallbackName(a)},b.exports=l},{"../core/util":235,"./config":419,jquery:"jquery",lzma:431,underscore:"underscore"}],419:[function(a,b,c){b.exports={MAPS_API_BASE_URL:"api/v1/map"}},{}],420:[function(a,b,c){var d="layer",e="analysis",f=function(a){this._error=a,this.type=a.subtype,this.message=a.message,this.context=a.context,this.isLayerError(a.type)&&(this.context=a.layer&&a.layer.context,this.layerId=a.layer&&a.layer.id),this.isAnalysisError(a.type)&&(this.context=a.analysis&&a.analysis.context,this.analysisId=a.analysis&&a.analysis.node_id)};f.prototype.isLayerError=function(a){return a=a||this._error.type,a===d},f.prototype.isAnalysisError=function(a){return a=a||this._error.type,a===e},b.exports=f},{}],421:[function(a,b,c){var d=a("../../core/model");b.exports=d.extend({isEmpty:function(){throw new Error("Filters must implement the .isEmpty method")},toJSON:function(){throw new Error("Filters must implement the .toJSON method")},remove:function(){this.trigger("destroy",this),this.stopListening()}})},{"../../core/model":230}],422:[function(a,b,c){var d=a("../../core/model");b.exports=d.extend({initialize:function(a){this.setBounds(a)},setBounds:function(a){this.set({west:a[0][1],south:a[0][0],east:a[1][1],north:a[1][0]})},toString:function(){return[this.get("west"),this.get("south"),this.get("east"),this.get("north")].join(",")}})},{"../../core/model":230}],423:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./base");b.exports=f.extend({defaults:{rejectAll:!1},initialize:function(){this.rejectedCategories=new e.Collection,this.acceptedCategories=new e.Collection,this._initBinds()},_initBinds:function(){this.listenTo(this.rejectedCategories,"add remove",function(){this.set("rejectAll",!1)}),this.listenTo(this.acceptedCategories,"add remove",function(){this.set("rejectAll",!1)})},isEmpty:function(){return 0===this.rejectedCategories.size()&&0===this.acceptedCategories.size()&&!this.get("rejectAll")},accept:function(a,b){a=d.isArray(a)?a:[a],d.each(a,function(a){var b={name:a},c=this.rejectedCategories.where(b),d=this.acceptedCategories.where(b);c.length>0?this.rejectedCategories.remove(c):d.length||this.acceptedCategories.add(b)},this),b!==!1&&this.applyFilter()},acceptAll:function(){this.set("rejectAll",!1),this.cleanFilter()},isAccepted:function(a){return this.acceptedCategories.where({name:a}).length>0},reject:function(a,b){a=d.isArray(a)?a:[a],d.each(a,function(a){var b={name:a},c=this.acceptedCategories.where(b),d=this.rejectedCategories.where(b);c.length>0?this.acceptedCategories.remove(c):d.length||this.rejectedCategories.add(b)},this),b!==!1&&this.applyFilter()},isRejected:function(a){var b=this.acceptedCategories.size();return this.rejectedCategories.where({name:a}).length>0?!0:b>0&&0===this.acceptedCategories.where({name:a}).length?!0:this.get("rejectAll")?!0:!1},rejectAll:function(){this.set("rejectAll",!0),this.cleanFilter()},cleanFilter:function(a){this.acceptedCategories.reset(),this.rejectedCategories.reset(),a!==!1&&this.applyFilter()},applyFilter:function(){this.trigger("change",this)},areAllRejected:function(){return this.get("rejectAll")},toJSON:function(){var a={},b=this.rejectedCategories.size(),c=this.acceptedCategories.size(),e={accept:d.pluck(this.acceptedCategories.toJSON(),"name")},f={reject:d.pluck(this.rejectedCategories.toJSON(),"name")};this.get("rejectAll")?a={accept:[]}:c>0?a=e:b>0&&0===c&&(a=f);var g={};return g[this.get("dataviewId")]=a,g},getAcceptedCategoryNames:function(){return this.acceptedCategories.map(function(a){return a.get("name")})},getRejectedCategoryNames:function(){return this.rejectedCategories.map(function(a){return a.get("name")})}})},{"./base":421,backbone:"backbone",underscore:"underscore"}],424:[function(a,b,c){var d=a("underscore"),e=a("./base");b.exports=e.extend({isEmpty:function(){return d.isUndefined(this.get("min"))&&d.isUndefined(this.get("max"))},setRange:function(a,b){this.set({min:a,max:b})},unsetRange:function(){this.setRange(void 0,void 0)},toJSON:function(){var a={};return a[this.get("dataviewId")]={min:this.get("min"),max:this.get("max"),column_type:this.get("column_type")},a}})},{"./base":421,underscore:"underscore"}],425:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./config"),g=a("../cdb.log"),h=a("./request"),i=a("./request-tracker"),j=a("./error"),k=3,l=e.Model.extend({initialize:function(a,b){if(!b.client)throw new Error("client option is required");if(!b.layersCollection)throw new Error("layersCollection option is required");if(!b.dataviewsCollection)throw new Error("dataviewsCollection option is required");if(!b.analysisCollection)throw new Error("analysisCollection option is required");if(!b.modelUpdater)throw new Error("modelUpdater option is required");if(!b.windshaftSettings)throw new Error("windshaftSettings option is required");this.client=b.client,this._layersCollection=b.layersCollection,this._dataviewsCollection=b.dataviewsCollection,this._analysisCollection=b.analysisCollection,this._modelUpdater=b.modelUpdater,this._windshaftSettings=b.windshaftSettings,this._requestTracker=new i(k)},toJSON:function(){throw new Error("Subclasses of windshaft/map-base must implement .toJSON")},createInstance:function(a){var b;a=a||{};try{var c=this.toJSON(),e=this._getParams();a.includeFilters===!0&&(b=this._dataviewsCollection.getFilters(),d.isEmpty(b)||(e.filters=b));var f=new h(c,e,a);this._canPerformRequest(f)?this._performRequest(f):(g.error("Maximum number of subsequent equal requests to the Maps API reached ("+k+"):",c,e),a.error&&a.error())}catch(i){var l=new j({message:i.message});this._modelUpdater.setErrors([l]),g.error(i.message),a.error&&a.error()}},_canPerformRequest:function(a){return this._requestTracker.canRequestBePerformed(a)},_trackRequest:function(a,b){this._requestTracker.track(a,b)},_performRequest:function(a){var b=a.payload,c=a.params,d=a.options;this.client.instantiateMap({mapDefinition:b,params:c,success:function(b){this._trackRequest(a,b),this.set(b),this._modelUpdater.updateModels(this,d.sourceId,d.forceFetch),this.trigger("instanceCreated"),d.success&&d.success(this)}.bind(this),error:function(b){this._trackRequest(a,b);var c=this._getErrorsFromResponse(b);this._modelUpdater.setErrors(c),d.error&&d.error()}.bind(this)})},_getErrorsFromResponse:function(a){return a.errors_with_context?d.map(a.errors_with_context,function(a){return new j(a)}):a.errors?[new j({message:a.errors[0]})]:[]},_getParams:function(){var a={stat_tag:this.get("statTag")};return this.get("apiKey")?a.api_key=this.get("apiKey"):this.get("authToken")&&(a.auth_token=this.get("authToken")),a},getBaseURL:function(a){return[this._getHost(a),f.MAPS_API_BASE_URL,this.get("layergroupid")].join("/")},_getHost:function(a){var b=this._windshaftSettings.urlTemplate,c=this._windshaftSettings.userName,d=b.replace("{user}",c),e=this._useHTTPS()?"https":"http";a=a?a+".":"";var f=this.get("cdn_url")&&this.get("cdn_url")[e];return f&&(d=[e,"://",a,f,"/",c].join("")),d},_useHTTPS:function(){return 0===this._windshaftSettings.urlTemplate.indexOf("https")},getLayerIndexesByType:function(a){return d.reduce(this._getLayers(),function(b,c,d){return c.type===a&&b.push(d),b},[])},getDataviewMetadata:function(a){var b=this._getDataviews();if(b&&b[a])return b[a];b={};var c=d.compact(d.map(this._getLayers(),function(a){return a.widgets}));return d.each(c,function(a){d.extend(b,a)}),b&&b[a]?b[a]:void 0},getAnalysisNodeMetadata:function(a){var b={},c=d.map(this._getAnalyses(),function(a){return a.nodes});return d.each(c,function(a){d.extend(b,a)}),b[a]},getSupportedSubdomains:function(){return this._useHTTPS()?[""]:["0","1","2","3"]},getLayerMetadata:function(a){var b={},c=this._getLayers();return c&&c[a]&&(b=c[a].meta||{}),b},_getLayers:function(){return this.get("metadata")&&this.get("metadata").layers||[]},_getDataviews:function(){return this.get("metadata")&&this.get("metadata").dataviews||[]},_getAnalyses:function(){return this.get("metadata")&&this.get("metadata").analyses||[]}});b.exports=l},{"../cdb.log":223,"./config":419,"./error":420,"./request":428,"./request-tracker":427,backbone:"backbone",underscore:"underscore"}],426:[function(a,b,c){var d=a("./map-base.js"),e=d.extend({toJSON:function(){var a={};return a.styles=this._layersCollection.reduce(function(a,b,c){var d=b.get("cartocss");return d&&(a[c]=d),a},{}),a}});b.exports=e},{"./map-base.js":425}],427:[function(a,b,c){var d=a("underscore"),e=function(a){this._maxNumberOfRequests=a||3,this.reset()};e.prototype.track=function(a,b){this.lastRequestEquals(a)&&this.lastResponseEquals(b)||this.reset(),this.maxNumberOfRequestsReached()||(this._lastRequest=a,this._lastResponse=b,this._numberOfRequests+=1)},e.prototype.reset=function(){this._lastRequest=void 0,this._lastResponse=void 0,this._numberOfRequests=0},e.prototype.canRequestBePerformed=function(a){return!this.maxNumberOfRequestsReached()||this.maxNumberOfRequestsReached()&&!this.lastRequestEquals(a)},e.prototype.maxNumberOfRequestsReached=function(){return this._numberOfRequests===this._maxNumberOfRequests},e.prototype.lastRequestEquals=function(a){return this._lastRequest&&this._lastRequest.equals(a)},e.prototype.lastResponseEquals=function(a){return d.isEqual(this._lastResponse,a)},b.exports=e;
},{underscore:"underscore"}],428:[function(a,b,c){var d=function(a,b,c){this.payload=a,this.params=b,this.options=c};d.prototype.toHashCode=function(){return JSON.stringify(this.payload)+JSON.stringify(this.params)+JSON.stringify(this.options)},d.prototype.equals=function(a){return this.toHashCode()===a.toHashCode()},b.exports=d},{}],429:[function(a,b,c){(function(c){_=c._=a("underscore"),jQuery=c.jQuery=a("jquery");(function(a,b,c){!function(a){a.fn.clipPath=function(b,c,d,e){return this.filter("[data-clipPath]").each(function(f){var g=a(this).attr("data-clipPath"),h=a(this).attr("src"),i='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="CDB-infowindow-mask" width="<%- w %>" height="<%- h %>" viewBox="0 0 <%- w %> <%- h %>">';i+='<defs><clipPath id="maskID<%-id %>"><path d="<%-path %>"/></clipPath></defs>',i+='<image clip-path="url(#maskID<%-id %>)" x="<%- x %>" y="<%- y %>" width="<%-w %>" height="<%-h %>" xlink:href="<%-src %>" />',i+="</svg>";var j=a(_.template(i)({id:f,x:d,y:-e,w:b,h:c,src:h,path:g}));a(this).replaceWith(j)}),this}}(jQuery)}).call(c,b,void 0,void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:"jquery",underscore:"underscore"}],430:[function(a,b,c){(function(a){(function(a,b,c,d,e){var f=1,g=2,h=4,i=8,j=16,k=64,l=512,m=1024,n=function(){var a=[["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],["all-scroll","col-resize","crosshair","default","e-resize","hand","help","move","n-resize","ne-resize","no-drop","not-allowed","nw-resize","pointer","progress","row-resize","s-resize","se-resize","sw-resize","text","vertical-text","w-resize","wait"],["armenian","decimal","decimal-leading-zero","disc","georgian","lower-alpha","lower-greek","lower-latin","lower-roman","square","upper-alpha","upper-latin","upper-roman"],["100","200","300","400","500","600","700","800","900","bold","bolder","lighter"],["block-level","inline-level","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],["condensed","expanded","extra-condensed","extra-expanded","narrower","semi-condensed","semi-expanded","ultra-condensed","ultra-expanded","wider"],["inherit","inline","inline-block","inline-box","inline-flex","inline-grid","inline-list-item","inline-stack","inline-table","run-in"],["behind","center-left","center-right","far-left","far-right","left-side","leftwards","right-side","rightwards"],["large","larger","small","smaller","x-large","x-small","xx-large","xx-small"],["dashed","dotted","double","groove","outset","ridge","solid"],["ease","ease-in","ease-in-out","ease-out","linear","step-end","step-start"],["at","closest-corner","closest-side","ellipse","farthest-corner","farthest-side"],["baseline","middle","sub","super","text-bottom","text-top"],["caption","icon","menu","message-box","small-caption","status-bar"],["fast","faster","slow","slower","x-fast","x-slow"],["above","below","higher","level","lower"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["block","flex","grid","table"],["high","low","x-high","x-low"],["nowrap","pre","pre-line","pre-wrap"],["absolute","relative","static"],["alternate","alternate-reverse","reverse"],["border-box","content-box","padding-box"],["capitalize","lowercase","uppercase"],["child","female","male"],["=","opacity"],["backwards","forwards"],["bidi-override","embed"],["bottom","top"],["break-all","keep-all"],["clip","ellipsis"],["contain","cover"],["continuous","digits"],["end","start"],["flat","preserve-3d"],["hide","show"],["horizontal","vertical"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["paused","running"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["all"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["circle"],["code"],["collapse"],["contents"],["fixed"],["hidden"],["infinite"],["inset"],["invert"],["justify"],["list-item"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["to"],["visible"]],b={animation:{cssPropBits:517,cssLitGroup:[a[10],a[24],a[29],a[45],a[48],a[54],a[63],a[71],a[72]],cssFns:["cubic-bezier()","steps()"]},"animation-delay":{cssPropBits:5,cssLitGroup:[a[48]],cssFns:[]},"animation-direction":{cssPropBits:0,cssLitGroup:[a[24],a[48],a[72]],cssFns:[]},"animation-duration":"animation-delay","animation-fill-mode":{cssPropBits:0,cssLitGroup:[a[29],a[48],a[54],a[71]],cssFns:[]},"animation-iteration-count":{cssPropBits:5,cssLitGroup:[a[48],a[63]],cssFns:[]},"animation-name":{cssPropBits:512,cssLitGroup:[a[48],a[71]],cssFns:[]},"animation-play-state":{cssPropBits:0,cssLitGroup:[a[45],a[48]],cssFns:[]},"animation-timing-function":{cssPropBits:0,cssLitGroup:[a[10],a[48]],cssFns:["cubic-bezier()","steps()"]},appearance:{cssPropBits:0,cssLitGroup:[a[71]],cssFns:[]},azimuth:{cssPropBits:5,cssLitGroup:[a[7],a[42],a[56]],cssFns:[]},"backface-visibility":{cssPropBits:0,cssLitGroup:[a[59],a[62],a[80]],cssFns:[]},background:{cssPropBits:23,cssLitGroup:[a[0],a[18],a[25],a[31],a[34],a[42],a[48],a[49],a[52],a[56],a[61],a[68],a[71],a[74],a[75]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()","rgb()","rgba()"]},"background-attachment":{cssPropBits:0,cssLitGroup:[a[48],a[61],a[68],a[75]],cssFns:[]},"background-color":{cssPropBits:2,cssLitGroup:[a[0]],cssFns:["rgb()","rgba()"]},"background-image":{cssPropBits:16,cssLitGroup:[a[48],a[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"background-position":{cssPropBits:5,cssLitGroup:[a[31],a[42],a[48],a[56]],cssFns:[]},"background-repeat":{cssPropBits:0,cssLitGroup:[a[18],a[48],a[74]],cssFns:[]},"background-size":{cssPropBits:5,cssLitGroup:[a[34],a[48],a[52]],cssFns:[]},border:{cssPropBits:7,cssLitGroup:[a[0],a[9],a[47],a[62],a[64],a[69],a[71]],cssFns:["rgb()","rgba()"]},"border-bottom":"border","border-bottom-color":"background-color","border-bottom-left-radius":{cssPropBits:5,cssFns:[]},"border-bottom-right-radius":"border-bottom-left-radius","border-bottom-style":{cssPropBits:0,cssLitGroup:[a[9],a[62],a[64],a[71]],cssFns:[]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[a[47],a[69]],cssFns:[]},"border-collapse":{cssPropBits:0,cssLitGroup:[a[59],a[76]],cssFns:[]},"border-color":"background-color","border-left":"border","border-left-color":"background-color","border-left-style":"border-bottom-style","border-left-width":"border-bottom-width","border-radius":{cssPropBits:5,cssLitGroup:[a[49]],cssFns:[]},"border-right":"border","border-right-color":"background-color","border-right-style":"border-bottom-style","border-right-width":"border-bottom-width","border-spacing":"border-bottom-left-radius","border-style":"border-bottom-style","border-top":"border","border-top-color":"background-color","border-top-left-radius":"border-bottom-left-radius","border-top-right-radius":"border-bottom-left-radius","border-top-style":"border-bottom-style","border-top-width":"border-bottom-width","border-width":"border-bottom-width",bottom:{cssPropBits:5,cssLitGroup:[a[52]],cssFns:[]},box:{cssPropBits:0,cssLitGroup:[a[60],a[71],a[72]],cssFns:[]},"box-shadow":{cssPropBits:7,cssLitGroup:[a[0],a[48],a[64],a[71]],cssFns:["rgb()","rgba()"]},"box-sizing":{cssPropBits:0,cssLitGroup:[a[25]],cssFns:[]},"caption-side":{cssPropBits:0,cssLitGroup:[a[31]],cssFns:[]},clear:{cssPropBits:0,cssLitGroup:[a[42],a[54],a[71]],cssFns:[]},clip:{cssPropBits:0,cssLitGroup:[a[52]],cssFns:["rect()"]},color:"background-color",content:{cssPropBits:8,cssLitGroup:[a[71],a[72]],cssFns:[]},cue:{cssPropBits:16,cssLitGroup:[a[71]],cssFns:[]},"cue-after":"cue","cue-before":"cue",cursor:{cssPropBits:16,cssLitGroup:[a[1],a[48],a[52]],cssFns:[]},direction:{cssPropBits:0,cssLitGroup:[a[43]],cssFns:[]},display:{cssPropBits:0,cssLitGroup:[a[4],a[6],a[20],a[52],a[67],a[71]],cssFns:[]},"display-extras":{cssPropBits:0,cssLitGroup:[a[67],a[71]],cssFns:[]},"display-inside":{cssPropBits:0,cssLitGroup:[a[20],a[52]],cssFns:[]},"display-outside":{cssPropBits:0,cssLitGroup:[a[4],a[71]],cssFns:[]},elevation:{cssPropBits:5,cssLitGroup:[a[15]],cssFns:[]},"empty-cells":{cssPropBits:0,cssLitGroup:[a[38]],cssFns:[]},filter:{cssPropBits:0,cssFns:["alpha()"]},"float":{cssPropBits:0,cssLitGroup:[a[42],a[71]],cssFns:[]},font:{cssPropBits:73,cssLitGroup:[a[3],a[8],a[13],a[16],a[41],a[48],a[49],a[69],a[72],a[77]],cssFns:[]},"font-family":{cssPropBits:72,cssLitGroup:[a[16],a[48]],cssFns:[]},"font-size":{cssPropBits:1,cssLitGroup:[a[8],a[69]],cssFns:[]},"font-stretch":{cssPropBits:0,cssLitGroup:[a[5],a[72]],cssFns:[]},"font-style":{cssPropBits:0,cssLitGroup:[a[41],a[72]],cssFns:[]},"font-variant":{cssPropBits:0,cssLitGroup:[a[72],a[77]],cssFns:[]},"font-weight":{cssPropBits:0,cssLitGroup:[a[3],a[72]],cssFns:[]},height:"bottom",left:"bottom","letter-spacing":{cssPropBits:5,cssLitGroup:[a[72]],cssFns:[]},"line-height":{cssPropBits:1,cssLitGroup:[a[72]],cssFns:[]},"list-style":{cssPropBits:16,cssLitGroup:[a[2],a[40],a[57],a[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-image":{cssPropBits:16,cssLitGroup:[a[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-position":{cssPropBits:0,cssLitGroup:[a[40]],cssFns:[]},"list-style-type":{cssPropBits:0,cssLitGroup:[a[2],a[57],a[71]],cssFns:[]},margin:"bottom","margin-bottom":"bottom","margin-left":"bottom","margin-right":"bottom","margin-top":"bottom","max-height":{cssPropBits:1,cssLitGroup:[a[52],a[71]],cssFns:[]},"max-width":"max-height","min-height":{cssPropBits:1,cssLitGroup:[a[52]],cssFns:[]},"min-width":"min-height",opacity:{cssPropBits:1,cssFns:[]},outline:{cssPropBits:7,cssLitGroup:[a[0],a[9],a[47],a[62],a[64],a[65],a[69],a[71]],cssFns:["rgb()","rgba()"]},"outline-color":{cssPropBits:2,cssLitGroup:[a[0],a[65]],cssFns:["rgb()","rgba()"]},"outline-style":"border-bottom-style","outline-width":"border-bottom-width",overflow:{cssPropBits:0,cssLitGroup:[a[52],a[62],a[75],a[80]],cssFns:[]},"overflow-wrap":{cssPropBits:0,cssLitGroup:[a[55],a[72]],cssFns:[]},"overflow-x":{cssPropBits:0,cssLitGroup:[a[44],a[52],a[62],a[75],a[80]],cssFns:[]},"overflow-y":"overflow-x",padding:"opacity","padding-bottom":"opacity","padding-left":"opacity","padding-right":"opacity","padding-top":"opacity","page-break-after":{cssPropBits:0,cssLitGroup:[a[42],a[51],a[52],a[53]],cssFns:[]},"page-break-before":"page-break-after","page-break-inside":{cssPropBits:0,cssLitGroup:[a[52],a[53]],cssFns:[]},pause:"border-bottom-left-radius","pause-after":"border-bottom-left-radius","pause-before":"border-bottom-left-radius",perspective:{cssPropBits:5,cssLitGroup:[a[71]],cssFns:[]},"perspective-origin":{cssPropBits:5,cssLitGroup:[a[31],a[42],a[56]],cssFns:[]},pitch:{cssPropBits:5,cssLitGroup:[a[21],a[69]],cssFns:[]},"pitch-range":"border-bottom-left-radius","play-during":{cssPropBits:16,cssLitGroup:[a[52],a[70],a[71],a[74]],cssFns:[]},position:{cssPropBits:0,cssLitGroup:[a[23]],cssFns:[]},quotes:{cssPropBits:8,cssLitGroup:[a[71]],cssFns:[]},resize:{cssPropBits:0,cssLitGroup:[a[39],a[54],a[71]],cssFns:[]},richness:"border-bottom-left-radius",right:"bottom",speak:{cssPropBits:0,cssLitGroup:[a[71],a[72],a[78]],cssFns:[]},"speak-header":{cssPropBits:0,cssLitGroup:[a[51],a[73]],cssFns:[]},"speak-numeral":{cssPropBits:0,cssLitGroup:[a[35]],cssFns:[]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[a[58],a[71]],cssFns:[]},"speech-rate":{cssPropBits:5,cssLitGroup:[a[14],a[69]],cssFns:[]},stress:"border-bottom-left-radius","table-layout":{cssPropBits:0,cssLitGroup:[a[52],a[61]],cssFns:[]},"text-align":{cssPropBits:0,cssLitGroup:[a[42],a[56],a[66]],cssFns:[]},"text-decoration":{cssPropBits:0,cssLitGroup:[a[19],a[71]],cssFns:[]},"text-indent":"border-bottom-left-radius","text-overflow":{cssPropBits:8,cssLitGroup:[a[33]],cssFns:[]},"text-shadow":"box-shadow","text-transform":{cssPropBits:0,cssLitGroup:[a[26],a[71]],cssFns:[]},"text-wrap":{cssPropBits:0,cssLitGroup:[a[46],a[71],a[72]],cssFns:[]},top:"bottom",transform:{cssPropBits:0,cssLitGroup:[a[71]],cssFns:["matrix()","perspective()","rotate()","rotate3d()","rotatex()","rotatey()","rotatez()","scale()","scale3d()","scalex()","scaley()","scalez()","skew()","skewx()","skewy()","translate()","translate3d()","translatex()","translatey()","translatez()"]},"transform-origin":"perspective-origin","transform-style":{cssPropBits:0,cssLitGroup:[a[37]],cssFns:[]},transition:{cssPropBits:1029,cssLitGroup:[a[10],a[48],a[50],a[71]],cssFns:["cubic-bezier()","steps()"]},"transition-delay":"animation-delay","transition-duration":"animation-delay","transition-property":{cssPropBits:1024,cssLitGroup:[a[48],a[50]],cssFns:[]},"transition-timing-function":"animation-timing-function","unicode-bidi":{cssPropBits:0,cssLitGroup:[a[30],a[72]],cssFns:[]},"vertical-align":{cssPropBits:5,cssLitGroup:[a[12],a[31]],cssFns:[]},visibility:"backface-visibility","voice-family":{cssPropBits:8,cssLitGroup:[a[27],a[48]],cssFns:[]},volume:{cssPropBits:1,cssLitGroup:[a[17],a[69]],cssFns:[]},"white-space":{cssPropBits:0,cssLitGroup:[a[22],a[72]],cssFns:[]},width:"min-height","word-break":{cssPropBits:0,cssLitGroup:[a[32],a[72]],cssFns:[]},"word-spacing":"letter-spacing","word-wrap":"overflow-wrap","z-index":"bottom",zoom:"line-height","cubic-bezier()":"animation-delay","steps()":{cssPropBits:5,cssLitGroup:[a[36],a[48]],cssFns:[]},"image()":{cssPropBits:18,cssLitGroup:[a[0],a[48]],cssFns:["rgb()","rgba()"]},"linear-gradient()":{cssPropBits:7,cssLitGroup:[a[0],a[31],a[42],a[48],a[79]],cssFns:["rgb()","rgba()"]},"radial-gradient()":{cssPropBits:7,cssLitGroup:[a[0],a[11],a[31],a[42],a[48],a[56],a[57]],cssFns:["rgb()","rgba()"]},"repeating-linear-gradient()":"linear-gradient()","repeating-radial-gradient()":"radial-gradient()","rgb()":{cssPropBits:1,cssLitGroup:[a[48]],cssFns:[]},"rgba()":"rgb()","rect()":{cssPropBits:5,cssLitGroup:[a[48],a[52]],cssFns:[]},"alpha()":{cssPropBits:1,cssLitGroup:[a[28]],cssFns:[]},"matrix()":"animation-delay","perspective()":"border-bottom-left-radius","rotate()":"border-bottom-left-radius","rotate3d()":"animation-delay","rotatex()":"border-bottom-left-radius","rotatey()":"border-bottom-left-radius","rotatez()":"border-bottom-left-radius","scale()":"animation-delay","scale3d()":"animation-delay","scalex()":"border-bottom-left-radius","scaley()":"border-bottom-left-radius","scalez()":"border-bottom-left-radius","skew()":"animation-delay","skewx()":"border-bottom-left-radius","skewy()":"border-bottom-left-radius","translate()":"animation-delay","translate3d()":"animation-delay","translatex()":"border-bottom-left-radius","translatey()":"border-bottom-left-radius","translatez()":"border-bottom-left-radius"};for(var c in b)"string"==typeof b[c]&&Object.hasOwnProperty.call(b,c)&&(b[c]=b[b[c]]);return b}();"undefined"!=typeof window&&(window.cssSchema=n);var o,p;!function(){function a(a){var b=parseInt(a.substring(1),16);return b>65535?(b-=65536,String.fromCharCode(55296+(b>>10),56320+(1023&b))):b==b?String.fromCharCode(b):a[1]<" "?"":a[1]}function b(a,b){return'"'+a.replace(/[\u0000-\u001f\\\"<>]/g,b)+'"'}function c(a){return e[a]||(e[a]="\\"+a.charCodeAt(0).toString(16)+" ")}function d(a){return f[a]||(f[a]=("">a?"%0":"%")+a.charCodeAt(0).toString(16))}var e={"\\":"\\\\"},f={"\\":"%5c"},g="[\\t\\n\\f ]",h=g+"*",i="[\\n\\f]",j="[\\ud800-\\udbff][\\udc00-\\udfff]",k="[\\u0080-\\ud7ff\\ue000-\\ufffd]|"+j,l="[0-9a-fA-F]{1,6}"+g+"?",m="(?:"+l+"|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|"+j+")",n="\\\\"+m,q="(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|"+k+"|"+n+")",r="[^'\"\\n\\f\\\\]|\\\\[\\s\\S]",s="\"(?:'|"+r+')*"|\'(?:"|'+r+")*'",t="[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)",u="(?:[a-zA-Z_]|"+k+"|"+n+")",v="(?:[a-zA-Z0-9_-]|"+k+"|"+n+")",w="-?"+u+v+"*",x="(?:@?-?"+u+"|#)"+v+"*",y=t+"(?:%|"+w+")?",z="url[(]"+h+"(?:"+s+"|"+q+"*)"+h+"[)]",A="U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?",B="<!--",C="-->",D=g+"+",E="/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)",F="(?!url[(])"+w+"[(]",G="[~|^$*]=",H="[^\"'\\\\/]|/(?![/*])",I="\\uFEFF",J=new RegExp([I,A,z,F,x,s,y,B,C,D,E,G,H].join("|"),"gi"),K=new RegExp("\\\\(?:"+m+"|"+i+")","g"),L=new RegExp("^url\\("+h+"[\"']?|[\"']?"+h+"\\)$","gi");p=function(b){return b.replace(K,a)},o=function(a){a=("￿"+a).replace(/^\uffff/,""),a=a.replace(/\r\n?/g,"\n");for(var e=a.match(J)||[],f=0,g=" ",h=0,i=e.length;i>h;++h){var j=p(e[h]),k=j.length,l=j.charCodeAt(0);j=l=='"'.charCodeAt(0)||l=="'".charCodeAt(0)?b(j.substring(1,k-1),c):l=="/".charCodeAt(0)&&k>1||"\\"==j||j==C||j==B||"\ufeff"==j||l<=" ".charCodeAt(0)?" ":/url\(/i.test(j)?"url("+b(j.replace(L,""),d)+")":j,(g!=j||" "!=j)&&(e[f++]=g=j)}return e.length=f,e}}(),"undefined"!=typeof window&&(window.lexCss=o,window.decodeCss=p);var q=function(){function a(a){var b=(""+a).match(n);return b?new i(j(b[1]),j(b[2]),j(b[3]),j(b[4]),j(b[5]),j(b[6]),j(b[7])):null}function b(a,b,f,g,h,j,k){var l=new i(d(a,o),d(b,o),c(f),g>0?g.toString():null,d(h,p),null,c(k));return j&&("string"==typeof j?l.setRawQuery(j.replace(/[^?&=0-9A-Za-z_\-~.%]/g,e)):l.setAllParameters(j)),l}function c(a){return"string"==typeof a?encodeURIComponent(a):null}function d(a,b){return"string"==typeof a?encodeURI(a).replace(b,e):null}function e(a){var b=a.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(b>>4&15)+"0123456789ABCDEF".charAt(15&b)}function f(a){return a.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function g(a){if(null===a)return null;for(var b,c=f(a),d=l;(b=c.replace(d,"$1"))!=c;c=b);return c}function h(a,b){var c=a.clone(),d=b.hasScheme();d?c.setRawScheme(b.getRawScheme()):d=b.hasCredentials(),d?c.setRawCredentials(b.getRawCredentials()):d=b.hasDomain(),d?c.setRawDomain(b.getRawDomain()):d=b.hasPort();var e=b.getRawPath(),f=g(e);if(d)c.setPort(b.getPort()),f=f&&f.replace(m,"");else if(d=!!e){if(47!==f.charCodeAt(0)){var h=g(c.getRawPath()||"").replace(m,""),i=h.lastIndexOf("/")+1;f=g((i?h.substring(0,i):"")+g(e)).replace(m,"")}}else f=f&&f.replace(m,""),f!==e&&c.setRawPath(f);return d?c.setRawPath(f):d=b.hasQuery(),d?c.setRawQuery(b.getRawQuery()):d=b.hasFragment(),d&&c.setRawFragment(b.getRawFragment()),c}function i(a,b,c,d,e,f,g){this.scheme_=a,this.credentials_=b,this.domain_=c,this.port_=d,this.path_=e,this.query_=f,this.fragment_=g,this.paramCache_=null}function j(a){return"string"==typeof a&&a.length>0?a:null}var k=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),l=new RegExp(k),m=/^(?:\.\.\/)*(?:\.\.$)?/;i.prototype.toString=function(){var a=[];return null!==this.scheme_&&a.push(this.scheme_,":"),null!==this.domain_&&(a.push("//"),null!==this.credentials_&&a.push(this.credentials_,"@"),a.push(this.domain_),null!==this.port_&&a.push(":",this.port_.toString())),null!==this.path_&&a.push(this.path_),null!==this.query_&&a.push("?",this.query_),null!==this.fragment_&&a.push("#",this.fragment_),a.join("")},i.prototype.clone=function(){return new i(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},i.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},i.prototype.getRawScheme=function(){return this.scheme_},i.prototype.setScheme=function(a){return this.scheme_=d(a,o),this},i.prototype.setRawScheme=function(a){return this.scheme_=a?a:null,this},i.prototype.hasScheme=function(){return null!==this.scheme_},i.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},i.prototype.getRawCredentials=function(){return this.credentials_},i.prototype.setCredentials=function(a){return this.credentials_=d(a,o),this},i.prototype.setRawCredentials=function(a){return this.credentials_=a?a:null,this},i.prototype.hasCredentials=function(){return null!==this.credentials_},i.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},i.prototype.getRawDomain=function(){return this.domain_},i.prototype.setDomain=function(a){return this.setRawDomain(a&&encodeURIComponent(a))},i.prototype.setRawDomain=function(a){return this.domain_=a?a:null,this.setRawPath(this.path_)},i.prototype.hasDomain=function(){return null!==this.domain_},i.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},i.prototype.setPort=function(a){if(a){if(a=Number(a),a!==(65535&a))throw new Error("Bad port number "+a);this.port_=""+a}else this.port_=null;return this},i.prototype.hasPort=function(){return null!==this.port_},i.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},i.prototype.getRawPath=function(){return this.path_},i.prototype.setPath=function(a){return this.setRawPath(d(a,p))},i.prototype.setRawPath=function(a){return a?(a=String(a),this.path_=!this.domain_||/^\//.test(a)?a:"/"+a):this.path_=null,this},i.prototype.hasPath=function(){return null!==this.path_},i.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},i.prototype.getRawQuery=function(){return this.query_},i.prototype.setQuery=function(a){return this.paramCache_=null,this.query_=c(a),this},i.prototype.setRawQuery=function(a){return this.paramCache_=null,this.query_=a?a:null,this},i.prototype.hasQuery=function(){return null!==this.query_},i.prototype.setAllParameters=function(a){if("object"==typeof a&&!(a instanceof Array)&&(a instanceof Object||"[object Array]"!==Object.prototype.toString.call(a))){var b=[],c=-1;for(var d in a){var e=a[d];"string"==typeof e&&(b[++c]=d,b[++c]=e)}a=b}this.paramCache_=null;for(var f=[],g="",h=0;h<a.length;){var d=a[h++],e=a[h++];f.push(g,encodeURIComponent(d.toString())),g="&",e&&f.push("=",encodeURIComponent(e.toString()))}return this.query_=f.join(""),this},i.prototype.checkParameterCache_=function(){if(!this.paramCache_){var a=this.query_;if(a){for(var b=a.split(/[&\?]/),c=[],d=-1,e=0;e<b.length;++e){var f=b[e].match(/^([^=]*)(?:=(.*))?$/);c[++d]=decodeURIComponent(f[1]).replace(/\+/g," "),c[++d]=decodeURIComponent(f[2]||"").replace(/\+/g," ")}this.paramCache_=c}else this.paramCache_=[]}},i.prototype.setParameterValues=function(a,b){"string"==typeof b&&(b=[b]),this.checkParameterCache_();for(var c=0,d=this.paramCache_,e=[],f=0;f<d.length;f+=2)a===d[f]?c<b.length&&e.push(a,b[c++]):e.push(d[f],d[f+1]);for(;c<b.length;)e.push(a,b[c++]);return this.setAllParameters(e),this},i.prototype.removeParameter=function(a){return this.setParameterValues(a,[])},i.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},i.prototype.getParameterValues=function(a){this.checkParameterCache_();for(var b=[],c=0;c<this.paramCache_.length;c+=2)a===this.paramCache_[c]&&b.push(this.paramCache_[c+1]);return b},i.prototype.getParameterMap=function(a){this.checkParameterCache_();for(var b={},c=0;c<this.paramCache_.length;c+=2){var d=this.paramCache_[c++],e=this.paramCache_[c++];d in b?b[d].push(e):b[d]=[e]}return b},i.prototype.getParameterValue=function(a){this.checkParameterCache_();for(var b=0;b<this.paramCache_.length;b+=2)if(a===this.paramCache_[b])return this.paramCache_[b+1];return null},i.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},i.prototype.getRawFragment=function(){return this.fragment_},i.prototype.setFragment=function(a){return this.fragment_=a?encodeURIComponent(a):null,this},i.prototype.setRawFragment=function(a){return this.fragment_=a?a:null,this},i.prototype.hasFragment=function(){return null!==this.fragment_};var n=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),o=/[#\/\?@]/g,p=/[\#\?]/g;return i.parse=a,i.create=b,i.resolve=h,i.collapse_dots=g,i.utils={mimeTypeOf:function(b){var c=a(b);return/\.html$/.test(c.getPath())?"text/html":"application/javascript"},resolve:function(b,c){return b?h(a(b),a(c)).toString():""+c}},i}();"undefined"!=typeof window&&(window.URI=q);var r=void 0,s=void 0,t=void 0,u=void 0,v=void 0;if(function(){function a(a){return"string"==typeof a?'url("'+a.replace(x,b)+'")':o}function b(a){return z[a]}function c(a,b){return a?q.utils.resolve(a,b):b}function d(a,b,c){if(!c)return null;var d=(""+a).match(A);return!d||d[1]&&!B.test(d[1])?null:c(a,b)}function e(a){return a.replace(/^-(?:apple|css|epub|khtml|moz|mso?|o|rim|wap|webkit|xv)-(?=[a-z])/,"")}var o='url("about:blank")',x=/[\n\f\r\"\'()*<>]/g,z={"\n":"%0a","\f":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},A=new RegExp("^(?:([^:/?# ]+):)?"),B=/^(?:https?|mailto)$/i;r=function(){function b(a){for(var b={},c=a.length;--c>=0;)for(var d=a[c],e=d.length;--e>=0;)b[d[e]]=q;return b}var q={};return function r(s,t,u,v,w){function x(a,b){for(var c=1,d=b+1,f=a.length;f>d&&c;){var g=a[d++];c+=")"===g?-1:/^[^"']*\($/.test(g)}if(!c)for(var h=a[b].toLowerCase(),i=e(h),j=a.splice(b,d-b,""),k=z.cssFns,l=0,m=k.length;m>l;++l)if(k[l].substring(0,i.length)==i)return j[0]=j[j.length-1]="",r(k[l],j,u,v),h+j.join(" ")+")";return""}var y=e(s),z=n[y];if(!z||"object"!=typeof z)return void(t.length=0);for(var A=z.cssPropBits,B=A&(j|k),C=A&(l|m),D=NaN,E=0,F=0;E<t.length;++E){var G,H,I,J,K,L,M=t[E].toLowerCase(),N=M.charCodeAt(0);M=N===" ".charCodeAt(0)?"":N==='"'.charCodeAt(0)?B===j?u?a(d(c(v,p(t[E].substring(1,M.length-1))),y,u)):"":A&i&&!(B&B-1)?M:"":"inherit"===M?M:(K=z.cssLitGroup,L=K?z.cssLitMap||(z.cssLitMap=b(K)):q,L[e(M)]===q?M:N==="#".charCodeAt(0)&&/^#(?:[0-9a-f]{3}){1,2}$/.test(M)?A&g?M:"":"0".charCodeAt(0)<=N&&N<="9".charCodeAt(0)?A&f?M:"":(G=M.charCodeAt(1),H=M.charCodeAt(2),I="0".charCodeAt(0)<=G&&G<="9".charCodeAt(0),J="0".charCodeAt(0)<=H&&H<="9".charCodeAt(0),N==="+".charCodeAt(0)&&(I||G===".".charCodeAt(0)&&J)?A&f?(I?"":"0")+M.substring(1):"":N==="-".charCodeAt(0)&&(I||G===".".charCodeAt(0)&&J)?A&h?(I?"-":"-0")+M.substring(1):A&f?"0":"":N===".".charCodeAt(0)&&I?A&f?"0"+M:"":'url("'===M.substring(0,5)?u&&A&j?a(d(c(v,t[E].substring(5,M.length-2)),y,u)):"":"("===M.charAt(M.length-1)?x(t,E):C&&/^-?[a-z_][\w\-]*$/.test(M)&&!/__$/.test(M)?w&&C===l?t[E]+w:C===m&&n[M]&&"number"==typeof n[M].cssPropBits?M:"":/^\w+$/.test(M)&&B===k&&A&i?D+1===F?(t[D]=t[D].substring(0,t[D].length-1)+" "+M+'"',M=""):(D=F,'"'+M+'"'):"")),M&&(t[F++]=M)}1===F&&t[0]===o&&(F=0),t.length=F}}();var C=new RegExp("^(active|after|before|blank|checked|default|disabled|drop|empty|enabled|first|first-child|first-letter|first-line|first-of-type|fullscreen|focus|hover|in-range|indeterminate|invalid|last-child|last-of-type|left|link|only-child|only-of-type|optional|out-of-range|placeholder-shown|read-only|read-write|required|right|root|scope|user-error|valid|visited)$"),D={};D[">"]=D["+"]=D["~"]=D,s=function(a,b,c){function d(d,e){function f(c,d,e){var f,g,j,l,m,n=!0;if(f="",d>c)if(m=a[c],"*"===m)++c,f=m;else if(/^[a-zA-Z]/.test(m)){var o=i(m.toLowerCase(),[]);o&&("tagName"in o&&(m=o.tagName),++c,f=m)}for(g="",j="",l="";n&&d>c;++c)if(m=a[c],"#"===m.charAt(0))/^#_|__$|[^\w#:\-]/.test(m)?n=!1:g+=m+h;else if("."===m)++c<d&&/^[0-9A-Za-z:_\-]+$/.test(m=a[c])&&!/^_|__$/.test(m)?g+="."+m:n=!1;else if(d>c+1&&"["===a[c]){++c;var p=a[c++].toLowerCase(),q=y.ATTRIBS[f+"::"+p];q!==+q&&(q=y.ATTRIBS["*::"+p]);var r;b.virtualizeAttrName?(r=b.virtualizeAttrName(f,p),"string"!=typeof r&&(n=!1,r=p),n&&q!==+q&&(q=y.atype.NONE)):(r=p,q!==+q&&(n=!1));var s="",t="",u=!1;switch(/^[~^$*|]?=$/.test(a[c])&&(s=a[c++],t=a[c++],/^[0-9A-Za-z:_\-]+$/.test(t)?t='"'+t+'"':"]"===t&&(t='""',--c),/^"([^\"\\]|\\.)*"$/.test(t)||(n=!1),u="i"===a[c],u&&++c),"]"!==a[c]&&(++c,n=!1),q){case y.atype.CLASSES:case y.atype.LOCAL_NAME:case y.atype.NONE:break;case y.atype.GLOBAL_NAME:case y.atype.ID:case y.atype.IDREF:"="!==s&&"~="!==s&&"$="!==s||'""'==t||u?"|="===s||""===s||(n=!1):t='"'+t.substring(1,t.length-1)+h+'"';break;case y.atype.URI:case y.atype.URI_FRAGMENT:""!==s&&(n=!1);break;default:n=!1}n&&(j+="["+r.replace(/[^\w-]/g,"\\$&")+s+t+(u?" i]":"]"))}else{if(!(d>c&&":"===a[c]))break;if(m=a[++c],!C.test(m))break;l+=":"+m}if(c!==d&&(n=!1),n){var v=(f+g).replace(/[^ .*#\w-]/g,"\\$&")+j+l+e;v&&k.push(v)}return n}" "===a[d]&&++d,e-1!==d&&" "===a[e]&&--e;for(var k=[],l=d,m=!0,n=d;m&&e>n;++n){var o=a[n];(D[o]===D||" "===o)&&(f(l,n,o)?l=n+1:m=!1)}if(f(l,e,"")||(m=!1),m){if(k.length){var p=k.join("");null!==g&&(p="."+g+" "+p),j.push(p)}return!0}return!c||c(a.slice(d,e))}var e,f,g=b.containerClass,h=b.idSuffix,i=b.tagPolicy,j=[],k=0,l=0;for(e=0;e<a.length;++e)f=a[e],("("==f||"["==f?(++l,0):")"==f||"]"==f?(l&&--l,0):" "==a[e]&&(l||D[a[e-1]]===D||D[a[e+1]]===D))||(a[k++]=a[e]);a.length=k;var m=a.length,n=0;for(e=0;m>e;++e)if(","===a[e]){if(!d(n,e))return null;n=e+1}return d(n,m)?j:null},function(){var a="(?:all|aural|braille|embossed|handheld|print|projection|screen|speech|tty|tv)",b="(?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script)",c="(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)",d="-?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?"+c+"?))",e="\\( "+b+" (?:: "+d+" )?\\)",f="(?:(?:(?:(?:only|not) )?"+a+"|"+e+")(?: and ?"+e+")*)",g=/^\w/,h=new RegExp("^"+f+"(?: , "+f+")*$","i");v=function(a){a=a.slice();for(var b=a.length,c=0,d=0;b>d;++d){var e=a[d];" "!=e&&(a[c++]=e)}a.length=c;var f=a.join(" ");return f=f.length?h.test(f)?g.test(f)?f:"not all , "+f:"not all":""}}(),function(){function a(a){var b,c=/^\s*["]([^"]*)["]\s*$/,d=/^\s*[']([^']*)[']\s*$/,e=/^\s*url\s*[(]["]([^"]*)["][)]\s*$/,f=/^\s*url\s*[(][']([^']*)['][)]\s*$/,g=/^\s*url\s*[(]([^)]*)[)]\s*$/;return(b=c.exec(a))?b[1]:(b=d.exec(a))?b[1]:(b=e.exec(a))?b[1]:(b=f.exec(a))?b[1]:(b=g.exec(a))?b[1]:null}function b(e,f,g,h,i,j,k){function l(){p=o.length&&null===o[o.length-1]}var m=void 0,n=k||[0],o=[],p=!1;return w(f,{startStylesheet:function(){m=[]},endStylesheet:function(){},startAtrule:function(f,k){if(p)f=null;else if("@media"===f)m.push("@media"," ",v(k));else if("@keyframes"===f||"@-webkit-keyframes"===f){var l=k[0];1!==k.length||/__$|[^\w\-]/.test(l)?f=null:(m.push(f," ",l+g.idSuffix),
f="@keyframes")}else if("@import"===f&&k.length>0)if(f=null,"function"==typeof j){var q=v(k.slice(1));if("not all"!==q){++n[0];var r=[];m.push(r);var s=d(c(e,a(k[0])),function(a){var c=b(s,a.html,g,h,i,j,n);--n[0];var d=q?{toString:function(){return"@media "+q+" {"+c.result+"}"}}:c.result;r[0]=d,j(d,!!n[0])},i)}}else window.console&&window.console.log("@import "+k.join(" ")+" elided");p=!f,o.push(f)},endAtrule:function(){o.pop(),p||m.push(";"),l()},startBlock:function(){p||m.push("{")},endBlock:function(){p||(m.push("}"),p=!0)},startRuleset:function(a){if(!p){var b=void 0;if("@keyframes"===o[o.length-1])b=a.join(" ").match(/^ *(?:from|to|\d+(?:\.\d+)?%) *(?:, *(?:from|to|\d+(?:\.\d+)?%) *)*$/i),p=!b,b&&(b=b[0].replace(/ +/g,""));else{var c=s(a,g);c&&c.length?b=c.join(", "):p=!0}p||m.push(b,"{")}o.push(null)},endRuleset:function(){o.pop(),p||m.push("}"),l()},declaration:function(a,b){if(!p){var c=!1,d=b.length;d>=2&&"!"===b[d-2]&&"important"===b[d-1].toLowerCase()&&(c=!0,b.length-=2),r(a,b,h,e,g.idSuffix),b.length&&m.push(a,":",b.join(" "),c?" !important;":";")}}}),{result:{toString:function(){return m.join("")}},moreToCome:!!n[0]}}t=function(a,c,d,e){return b(a,c,d,e,void 0,void 0).result.toString()},u=function(a,c,d,e,f,g){return b(a,c,d,e,f,g)}}()}(),"undefined"!=typeof window&&(window.sanitizeCssProperty=r,window.sanitizeCssSelectorList=s,window.sanitizeStylesheet=t,window.sanitizeMediaQuery=v),"i"!=="I".toLowerCase())throw"I/i problem";var w,x;!function(){function a(a,c,e,f){if(e>c){var g=a[c];return"@"===g.charAt(0)?b(a,c,e,f,!0):d(a,c,e,f)}return c}function b(a,b,d,e,f){for(var g=b++;d>b&&"{"!==a[b]&&";"!==a[b];)++b;if(d>b&&(f||";"===a[b])){var h=g+1,i=b;d>h&&" "===a[h]&&++h,i>h&&" "===a[i-1]&&--i,e.startAtrule&&e.startAtrule(a[g].toLowerCase(),a.slice(h,i)),b="{"===a[b]?c(a,b,d,e):b+1,e.endAtrule&&e.endAtrule()}return b}function c(a,e,f,g){for(++e,g.startBlock&&g.startBlock();f>e;){var h=a[e].charAt(0);if("}"==h){++e;break}" "===h||";"===h?e+=1:e="@"===h?b(a,e,f,g,!1):"{"===h?c(a,e,f,g):d(a,e,f,g)}return g.endBlock&&g.endBlock(),e}function d(a,b,c,d){var f=b,h=e(a,b,c,!0);if(0>h)return h=~h,h===f?h+1:h;var i=a[h];if("{"!==i)return h===f?h+1:h;for(b=h+1,h>f&&" "===a[h-1]&&--h,d.startRuleset&&d.startRuleset(a.slice(f,h));c>b;){if(i=a[b],"}"===i){++b;break}" "===i?b+=1:b=g(a,b,c,d)}return d.endRuleset&&d.endRuleset(),b}function e(a,b,c,d){for(var e,f=[],g=-1;c>b;++b)if(e=a[b].charAt(0),"["===e||"("===e)f[++g]=e;else if("]"===e&&"["===f[g]||")"===e&&"("===f[g])--g;else if("{"===e||"}"===e||";"===e||"@"===e||":"===e&&!d)break;return g>=0&&(b=~(b+1)),b}function f(a,b,c){for(;c>b&&";"!==a[b]&&"}"!==a[b];)++b;return c>b&&";"===a[b]?b+1:b}function g(a,b,c,d){var g=a[b++];if(!h.test(g))return f(a,b,c);var i;if(c>b&&" "===a[b]&&++b,b==c||":"!==a[b])return f(a,b,c);++b,c>b&&" "===a[b]&&++b;var j=b,k=e(a,b,c,!1);if(0>k)k=~k;else{for(var l=[],m=0,n=j;k>n;++n)i=a[n]," "!==i&&(l[m++]=i);if(c>k){do{if(i=a[k],";"===i||"}"===i)break;m=0}while(++k<c);";"===i&&++k}m&&d.declaration&&d.declaration(g.toLowerCase(),l)}return k}w=function(b,c){var d=o(b);c.startStylesheet&&c.startStylesheet();for(var e=0,f=d.length;f>e;)e=" "===d[e]?e+1:a(d,e,f,c);c.endStylesheet&&c.endStylesheet()};var h=/^-?[a-z]/i;x=function(a,b){for(var c=o(a),d=0,e=c.length;e>d;)d=" "!==c[d]?g(c,d,e,b):d+1}}(),"undefined"!=typeof window&&(window.parseCssStylesheet=w,window.parseCssDeclarations=x);var y={};if(y.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},y.atype=y.atype,y.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":0,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0},y.ATTRIBS=y.ATTRIBS,y.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},y.eflags=y.eflags,y.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:16,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2},y.ELEMENTS=y.ELEMENTS,y.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},y.ELEMENT_DOM_INTERFACES=y.ELEMENT_DOM_INTERFACES,y.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},y.ueffects=y.ueffects,y.URIEFFECTS={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1},y.URIEFFECTS=y.URIEFFECTS,y.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},y.ltypes=y.ltypes,y.LOADERTYPES={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2},y.LOADERTYPES=y.LOADERTYPES,"undefined"!=typeof window&&(window.html4=y),"i"!=="I".toLowerCase())throw"I/i problem";var z=function(a){function b(a){if(F.hasOwnProperty(a))return F[a];var b=a.match(G);if(b)return String.fromCharCode(parseInt(b[1],10));if(b=a.match(H))return String.fromCharCode(parseInt(b[1],16));if(J&&I.test(a)){J.innerHTML="&"+a+";";var c=J.textContent;return F[a]=c,c}return"&"+a+";"}function c(a,c){return b(c)}function d(a){return a.replace(K,"")}function e(a){return a.replace(L,c)}function f(a){return(""+a).replace(N,"&amp;").replace(P,"&lt;").replace(Q,"&gt;").replace(R,"&#34;")}function g(a){return a.replace(O,"&amp;$1").replace(P,"&lt;").replace(Q,"&gt;")}function h(a){var b={cdata:a.cdata||a.cdata,comment:a.comment||a.comment,endDoc:a.endDoc||a.endDoc,endTag:a.endTag||a.endTag,pcdata:a.pcdata||a.pcdata,rcdata:a.rcdata||a.rcdata,startDoc:a.startDoc||a.startDoc,startTag:a.startTag||a.startTag};return function(a,c){return i(a,b,c)}}function i(a,b,c){var d=l(a),e={noMoreGT:!1,noMoreEndComments:!1};k(b,d,0,e,c)}function j(a,b,c,d,e){return function(){k(a,b,c,d,e)}}function k(b,c,d,e,f){try{b.startDoc&&0==d&&b.startDoc(f);for(var g,h,i,k=d,l=c.length;l>k;){var p=c[k++],q=c[k];switch(p){case"&":M.test(q)?(b.pcdata&&b.pcdata("&"+q,f,V,j(b,c,k,e,f)),k++):b.pcdata&&b.pcdata("&amp;",f,V,j(b,c,k,e,f));break;case"</":(g=/^([-\w:]+)[^\'\"]*/.exec(q))?g[0].length===q.length&&">"===c[k+1]?(k+=2,i=g[1].toLowerCase(),b.endTag&&b.endTag(i,f,V,j(b,c,k,e,f))):k=m(c,k,b,f,V,e):b.pcdata&&b.pcdata("&lt;/",f,V,j(b,c,k,e,f));break;case"<":if(g=/^([-\w:]+)\s*\/?/.exec(q))if(g[0].length===q.length&&">"===c[k+1]){k+=2,i=g[1].toLowerCase(),b.startTag&&b.startTag(i,[],f,V,j(b,c,k,e,f));var r=a.ELEMENTS[i];if(r&U){var s={name:i,next:k,eflags:r};k=o(c,s,b,f,V,e)}}else k=n(c,k,b,f,V,e);else b.pcdata&&b.pcdata("&lt;",f,V,j(b,c,k,e,f));break;case"<!--":if(!e.noMoreEndComments){for(h=k+1;l>h&&(">"!==c[h]||!/--$/.test(c[h-1]));h++);if(l>h){if(b.comment){var t=c.slice(k,h).join("");b.comment(t.substr(0,t.length-2),f,V,j(b,c,h+1,e,f))}k=h+1}else e.noMoreEndComments=!0}e.noMoreEndComments&&b.pcdata&&b.pcdata("&lt;!--",f,V,j(b,c,k,e,f));break;case"<!":if(/^\w/.test(q)){if(!e.noMoreGT){for(h=k+1;l>h&&">"!==c[h];h++);l>h?k=h+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;!",f,V,j(b,c,k,e,f))}else b.pcdata&&b.pcdata("&lt;!",f,V,j(b,c,k,e,f));break;case"<?":if(!e.noMoreGT){for(h=k+1;l>h&&">"!==c[h];h++);l>h?k=h+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;?",f,V,j(b,c,k,e,f));break;case">":b.pcdata&&b.pcdata("&gt;",f,V,j(b,c,k,e,f));break;case"":break;default:b.pcdata&&b.pcdata(p,f,V,j(b,c,k,e,f))}}b.endDoc&&b.endDoc(f)}catch(u){if(u!==V)throw u}}function l(a){var b=/(<\/|<\!--|<[!?]|[&<>])/g;if(a+="",T)return a.split(b);for(var c,d=[],e=0;null!==(c=b.exec(a));)d.push(a.substring(e,c.index)),d.push(c[0]),e=c.index+c[0].length;return d.push(a.substring(e)),d}function m(a,b,c,d,e,f){var g=p(a,b);return g?(c.endTag&&c.endTag(g.name,d,e,j(c,a,b,f,d)),g.next):a.length}function n(a,b,c,d,e,f){var g=p(a,b);return g?(c.startTag&&c.startTag(g.name,g.attrs,d,e,j(c,a,g.next,f,d)),g.eflags&U?o(a,g,c,d,e,f):g.next):a.length}function o(b,c,d,e,f,h){var i=b.length;W.hasOwnProperty(c.name)||(W[c.name]=new RegExp("^"+c.name+"(?:[\\s\\/]|$)","i"));for(var k=W[c.name],l=c.next,m=c.next+1;i>m&&("</"!==b[m-1]||!k.test(b[m]));m++);i>m&&(m-=1);var n=b.slice(l,m).join("");if(c.eflags&a.eflags.CDATA)d.cdata&&d.cdata(n,e,f,j(d,b,m,h,e));else{if(!(c.eflags&a.eflags.RCDATA))throw new Error("bug");d.rcdata&&d.rcdata(g(n),e,f,j(d,b,m,h,e))}return m}function p(b,c){var d=/^([-\w:]+)/.exec(b[c]),e={};e.name=d[1].toLowerCase(),e.eflags=a.ELEMENTS[e.name];for(var f=b[c].substr(d[0].length),g=c+1,h=b.length;h>g&&">"!==b[g];g++)f+=b[g];if(g>=h)return void 0;for(var i=[];""!==f;)if(d=S.exec(f)){if(d[4]&&!d[5]||d[6]&&!d[7]){for(var j=d[4]||d[6],k=!1,l=[f,b[g++]];h>g;g++){if(k){if(">"===b[g])break}else 0<=b[g].indexOf(j)&&(k=!0);l.push(b[g])}if(g>=h)break;f=l.join("");continue}var m=d[1].toLowerCase(),n=d[2]?r(d[3]):"";i.push(m,n),f=f.substr(d[0].length)}else f=f.replace(/^[\s\S][^a-z\s]*/,"");return e.attrs=i,e.next=g+1,e}function r(a){var b=a.charCodeAt(0);return(34===b||39===b)&&(a=a.substr(1,a.length-2)),e(d(a))}function s(b){var c,d,e=function(a,b){d||b.push(a)};return h({startDoc:function(a){c=[],d=!1},startTag:function(e,g,h){if(!d&&a.ELEMENTS.hasOwnProperty(e)){var i=a.ELEMENTS[e];if(!(i&a.eflags.FOLDABLE)){var j=b(e,g);if(!j)return void(d=!(i&a.eflags.EMPTY));if("object"!=typeof j)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in j))throw new Error("tagPolicy gave no attribs");g=j.attribs;var k,l;if("tagName"in j?(l=j.tagName,k=a.ELEMENTS[l]):(l=e,k=i),i&a.eflags.OPTIONAL_ENDTAG){var m=c[c.length-1];!m||m.orig!==e||m.rep===l&&e===l||h.push("</",m.rep,">")}i&a.eflags.EMPTY||c.push({orig:e,rep:l}),h.push("<",l);for(var n=0,o=g.length;o>n;n+=2){var p=g[n],q=g[n+1];null!==q&&void 0!==q&&h.push(" ",p,'="',f(q),'"')}h.push(">"),i&a.eflags.EMPTY&&!(k&a.eflags.EMPTY)&&h.push("</",l,">")}}},endTag:function(b,e){if(d)return void(d=!1);if(a.ELEMENTS.hasOwnProperty(b)){var f=a.ELEMENTS[b];if(!(f&(a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g].orig;if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0&&c[g].orig!==b;);if(0>g)return;for(var i=c.length;--i>g;){var j=c[i].rep;a.ELEMENTS[j]&a.eflags.OPTIONAL_ENDTAG||e.push("</",j,">")}g<c.length&&(b=c[g].rep),c.length=g,e.push("</",b,">")}}},pcdata:e,rcdata:e,cdata:e,endDoc:function(a){for(;c.length;c.length--)a.push("</",c[c.length-1].rep,">")}})}function t(a,b,c,d,e){if(!e)return null;try{var f=q.parse(""+a);if(f&&(!f.hasScheme()||X.test(f.getScheme()))){var g=e(f,b,c,d);return g?g.toString():null}}catch(h){return null}return null}function u(a,b,c,d,e){if(c||a(b+" removed",{change:"removed",tagName:b}),d!==e){var f="changed";d&&!e?f="removed":!d&&e&&(f="added"),a(b+"."+c+" "+f,{change:f,tagName:b,attribName:c,oldValue:d,newValue:e})}}function v(a,b,c){var d;return d=b+"::"+c,a.hasOwnProperty(d)?a[d]:(d="*::"+c,a.hasOwnProperty(d)?a[d]:void 0)}function w(b,c){return v(a.LOADERTYPES,b,c)}function x(b,c){return v(a.URIEFFECTS,b,c)}function y(b,c,d,e,f){for(var g=0;g<c.length;g+=2){var h,i=c[g],j=c[g+1],k=j,l=null;if(h=b+"::"+i,(a.ATTRIBS.hasOwnProperty(h)||(h="*::"+i,a.ATTRIBS.hasOwnProperty(h)))&&(l=a.ATTRIBS[h]),null!==l)switch(l){case a.atype.NONE:break;case a.atype.SCRIPT:j=null,f&&u(f,b,i,k,j);break;case a.atype.STYLE:if("undefined"==typeof C){j=null,f&&u(f,b,i,k,j);break}var m=[];C(j,{declaration:function(b,c){var e=b.toLowerCase();D(e,c,d?function(b){return t(b,a.ueffects.SAME_DOCUMENT,a.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:e},d)}:null),c.length&&m.push(e+": "+c.join(" "))}}),j=m.length>0?m.join(" ; "):null,f&&u(f,b,i,k,j);break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:j=e?e(j):j,f&&u(f,b,i,k,j);break;case a.atype.URI:j=t(j,x(b,i),w(b,i),{TYPE:"MARKUP",XML_ATTR:i,XML_TAG:b},d),f&&u(f,b,i,k,j);break;case a.atype.URI_FRAGMENT:j&&"#"===j.charAt(0)?(j=j.substring(1),j=e?e(j):j,null!==j&&void 0!==j&&(j="#"+j)):j=null,f&&u(f,b,i,k,j);break;default:j=null,f&&u(f,b,i,k,j)}else j=/data-[\w-]+/.test(i)?e?e(j):j:null,f&&u(f,b,i,k,j);c[g+1]=j}return c}function z(b,c,d){return function(e,f){return a.ELEMENTS[e]&a.eflags.UNSAFE?void(d&&u(d,e,void 0,void 0,void 0)):{attribs:y(e,f,b,c,d)}}}function A(a,b){var c=[];return s(b)(a,c),c.join("")}function B(a,b,c,d){var e=z(b,c,d);return A(a,e)}var C,D,E;"undefined"!=typeof window&&(C=window.parseCssDeclarations,D=window.sanitizeCssProperty,E=window.cssSchema);var F={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:" "},G=/^#(\d+)$/,H=/^#x([0-9A-Fa-f]+)$/,I=/^[A-Za-z][A-za-z0-9]+$/,J="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,K=/\0/g,L=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,M=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,N=/&/g,O=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,P=/[<]/g,Q=/>/g,R=/\"/g,S=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),T=3==="a,b".split(/(,)/).length,U=a.eflags.CDATA|a.eflags.RCDATA,V={},W={},X=/^(?:https?|mailto)$/i,Y={};return Y.escapeAttrib=Y.escapeAttrib=f,Y.makeHtmlSanitizer=Y.makeHtmlSanitizer=s,Y.makeSaxParser=Y.makeSaxParser=h,Y.makeTagPolicy=Y.makeTagPolicy=z,Y.normalizeRCData=Y.normalizeRCData=g,Y.sanitize=Y.sanitize=B,Y.sanitizeAttribs=Y.sanitizeAttribs=y,Y.sanitizeWithPolicy=Y.sanitizeWithPolicy=A,Y.unescapeEntities=Y.unescapeEntities=e,Y}(y),A=z.sanitize;"undefined"!=typeof window&&(window.html=z,window.html_sanitize=A),e("undefined"!=typeof z?z:window.html)}).call(a,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],431:[function(a,b,c){(function(a){(function(a,b,c,d,e){var f=function(){function a(a,b){postMessage({action:3,callback_num:b,result:a})}function b(){return Ye}function c(){}function d(){return Ze}function e(){}function f(){return $e}function g(){}function h(a,b){return a.detailMessage=b,a}function i(){return _e}function j(){}function k(a,b){return a}function l(){return af}function m(){}function n(a,b){a[a.explicitLength++]=b}function o(a,b){a[a.explicitLength++]=b}function p(a){var b,c;return c=a.join(""),a.length=a.explicitLength=0,b=c,a[a.explicitLength++]=b,b}function q(a,b){var c=new Array(b);if(a>0)for(var d=[null,0,!1,[0,0]][a],e=0;b>e;++e)c[e]=d;return c}function r(){return this.arrayClass$}function s(a,b,c,d,e){var f;return f=q(e,d),w(),y(f,Je,Ke),f.arrayClass$=a,f.typeId$=b,f.queryId$=c,f}function t(a,b,c,d){return w(),y(d,Je,Ke),d.arrayClass$=a,d.typeId$=b,d.queryId$=c,d}function u(a,b,c){if(null!=c){if(a.queryId$>0&&!A(c.typeId$,a.queryId$))throw new Ba;if(a.queryId$<0&&(c.typeMarker$==se||2==c.typeId$))throw new Ba}return a[b]=c}function v(){}function w(){w=se,Je=[],Ke=[],x(new v,Je,Ke)}function x(a,b,c){var d,e=0;for(var f in a)(d=a[f])&&(b[e]=f,c[e]=d,++e)}function y(a,b,c){w();for(var d=0,e=b.length;e>d;++d)a[b[d]]=c[d]}function z(a,b){return a&&!!Ue[a][b]}function A(a,b){return a&&Ue[a][b]}function B(a,b){if(null!=a&&!A(a.typeId$,b))throw new Ia;return a}function C(a,b){return null!=a&&z(a.typeId$,b)}function D(a){return~~Math.max(Math.min(a,2147483647),-2147483648)}function E(a){return null!=a&&z(a.typeId$,2)?a:k(new m,a)}function F(a,b){var c,d;return c=a[1]+b[1],d=a[0]+b[0],J(d,c)}function G(a,b,c){return 0==b?a:0==c?a:F(a,J(b*c,0))}function H(a,b){return Q(~~Math.max(Math.min(a[1]/4294967296,2147483647),-2147483648)&~~Math.max(Math.min(b[1]/4294967296,2147483647),-2147483648),P(a)&P(b))}function I(a,b){var c,d;return a[0]==b[0]&&a[1]==b[1]?0:(c=a[1]<0,d=b[1]<0,c&&!d?-1:!c&&d?1:Y(a,b)[1]<0?-1:1)}function J(a,b){var c,d;for(b%=0x10000000000000000,a%=0x10000000000000000,c=b%4294967296,d=4294967296*Math.floor(a/4294967296),b=b-c+d,a=a-d+c;0>a;)a+=4294967296,b-=4294967296;for(;a>4294967295;)a-=4294967296,b+=4294967296;for(b%=0x10000000000000000;b>0x7fffffff00000000;)b-=0x10000000000000000;for(;-0x8000000000000000>b;)b+=0x10000000000000000;return[a,b]}function K(a,b){var c,d,e,f,g,h;if(0==b[0]&&0==b[1])throw wa(new ya,"/ by zero");if(0==a[0]&&0==a[1])return ba(),Te;if(L(a,(ba(),Oe)))return L(b,Qe)||L(b,Pe)?Oe:(f=W(a,1),c=V(K(f,b),1),g=Y(a,R(b,c)),F(c,K(g,b)));if(L(b,Oe))return Te;if(a[1]<0)return b[1]<0?K(T(a),T(b)):T(K(T(a),b));if(b[1]<0)return T(K(a,T(b)));for(h=Te,g=a;I(g,b)>=0;)e=M(Math.floor(Z(g)/$(b))),0==e[0]&&0==e[1]&&(e=Qe),d=R(e,b),h=F(h,e),g=Y(g,d);return h}function L(a,b){return a[0]==b[0]&&a[1]==b[1]}function M(a){return isNaN(a)?(ba(),Te):-0x8000000000000000>a?(ba(),Oe):a>=0x8000000000000000?(ba(),Ne):a>0?J(Math.floor(a),0):J(Math.ceil(a),0)}function N(a){var b,c;return a>-129&&128>a?(b=a+128,c=(aa(),Le)[b],null==c&&(c=Le[b]=O(a)),c):O(a)}function O(a){return a>=0?[a,0]:[a+4294967296,-4294967296]}function P(a){return a[0]>=2147483648?~~Math.max(Math.min(a[0]-4294967296,2147483647),-2147483648):~~Math.max(Math.min(a[0],2147483647),-2147483648)}function Q(a,b){var c,d;return c=4294967296*a,d=b,0>b&&(d+=4294967296),[d,c]}function R(a,b){var c,d,e,f,g,h,i,j,k;return 0==a[0]&&0==a[1]?(ba(),Te):0==b[0]&&0==b[1]?(ba(),Te):L(a,(ba(),Oe))?S(b):L(b,Oe)?S(a):a[1]<0?b[1]<0?R(T(a),T(b)):T(R(T(a),b)):b[1]<0?T(R(a,T(b))):I(a,Se)<0&&I(b,Se)<0?J((a[1]+a[0])*(b[1]+b[0]),0):(e=a[1]%281474976710656,f=a[1]-e,c=a[0]%65536,d=a[0]-c,i=b[1]%281474976710656,j=b[1]-i,g=b[0]%65536,h=b[0]-g,k=Te,k=G(k,f,g),k=G(k,e,h),k=G(k,e,g),k=G(k,d,i),k=G(k,d,h),k=G(k,d,g),k=G(k,c,j),k=G(k,c,i),k=G(k,c,h),k=G(k,c,g))}function S(a){return 1==(1&P(a))?(ba(),Oe):(ba(),Te)}function T(a){var b,c;return L(a,(ba(),Oe))?Oe:(b=-a[1],c=-a[0],c>4294967295&&(c-=4294967296,b+=4294967296),0>c&&(c+=4294967296,b-=4294967296),[c,b])}function U(a){return 30>=a?1<<a:U(30)*U(a-30)}function V(a,b){var c,d,e,f;return b&=63,L(a,(ba(),Oe))?0==b?a:Te:a[1]<0?T(V(T(a),b)):(f=U(b),d=a[1]*f%0x10000000000000000,e=a[0]*f,c=e-e%4294967296,d+=c,e-=c,d>=0x8000000000000000&&(d-=0x10000000000000000),[e,d])}function W(a,b){var c,d,e;return b&=63,e=U(b),c=a[1]/e,d=Math.floor(a[0]/e),J(d,c)}function X(a,b){var c;return b&=63,c=W(a,b),a[1]<0&&(c=F(c,V((ba(),Re),63-b))),c}function Y(a,b){var c,d;return c=a[1]-b[1],d=a[0]-b[0],J(d,c)}function Z(a){var b,c,d;return c=D(Math.log(a[1])/(ba(),Me)),48>=c?a[1]+a[0]:(b=c-48,d=(1<<b)-1,a[1]+(a[0]-d))}function $(a){var b,c,d;return c=D(Math.log(a[1])/(ba(),Me)),48>=c?a[1]+a[0]:(b=c-48,d=(1<<b)-1,a[1]+(a[0]+d))}function _(a){var b,c,d,e,f,g;if(0==a[0]&&0==a[1])return"0";if(L(a,(ba(),Oe)))return"-9223372036854775808";if(a[1]<0)return"-"+_(T(a));for(c=a,e="";0!=c[0]||0!=c[1];){if(f=N(1e9),d=K(c,f),b=""+P(Y(c,R(d,f))),c=d,0!=c[0]||0!=c[1])for(g=9-b.length;g>0;--g)b="0"+b;e=b+e}return e}function aa(){aa=se,Le=s(cf,0,9,256,0)}function ba(){ba=se,Me=Math.log(2),Ne=Ie,Oe=ye,Pe=N(-1),Qe=N(1),Re=N(2),Se=Fe,Te=N(0)}function ca(){return df}function da(){}function ea(a,b){return fa(a,b,0,b.length),a}function fa(a,b,c,d){return a.buf=b,a.pos=c,a.count=c+d,a.count>b.length&&(a.count=b.length),a}function ga(a){return a.pos>=a.count?-1:255&a.buf[a.pos++]}function ha(a,b,c,d){return a.pos>=a.count?-1:(d=Ta(d,a.count-a.pos),ab(a.buf,a.pos,b,c,d),a.pos+=d,d)}function ia(){return ef}function ja(){}function ka(){return gf}function la(){}function ma(a){return a.buf=s(ff,0,-1,32,1),a}function na(a,b){var c;b<=a.buf.length||(b=Sa(b,2*a.buf.length),c=s(ff,0,-1,b,1),ab(a.buf,0,c,0,a.buf.length),a.buf=c)}function oa(a){var b;return b=s(ff,0,-1,a.count,1),ab(a.buf,0,b,0,a.count),b}function pa(a,b){na(a,a.count+1),a.buf[a.count++]=b<<24>>24}function qa(a,b,c,d){na(a,a.count+d),ab(b,c,a.buf,a.count,d),a.count+=d}function ra(){return hf}function sa(){}function ta(a,b){return a.detailMessage=b,a}function ua(){return jf}function va(){}function wa(a,b){return a.detailMessage=b,a}function xa(){return lf}function ya(){}function za(a,b){return a.detailMessage=b,a}function Aa(){return mf}function Ba(){}function Ca(a,b){var c;return c=new Ga,c.typeName=a+b,c}function Da(a,b){var c;return c=new Ga,c.typeName=a+b,c}function Ea(a,b){var c;return c=new Ga,c.typeName=a+b,c}function Fa(){return of}function Ga(){}function Ha(){return pf}function Ia(){}function Ja(){return kf}function Ka(){}function La(a,b){return a.detailMessage=b,a}function Ma(){return qf}function Na(){}function Oa(){return rf}function Pa(){}function Qa(){return sf}function Ra(){}function Sa(a,b){return a>b?a:b}function Ta(a,b){return b>a?a:b}function Ua(){return uf}function Va(){}function Wa(a,b){return null==b?!1:String(a)==b}function Xa(a,b,c,d,e){var f;for(f=b;c>f;++f)d[e++]=a.charCodeAt(f)}function Ya(){return vf}function Za(a){var b;return a.data=(b=[],b.explicitLength=0,b),a}function $a(){return wf}function _a(){}function ab(a,b,c,d,e){var f,g,h,i,j,k,l,m;if(null==a||null==c)throw new Va;if(l=(a.typeMarker$==se||2==a.typeId$?a.getClass$():bf).typeName,h=(c.typeMarker$==se||2==c.typeId$?c.getClass$():bf).typeName,91!=l.charCodeAt(0)||91!=h.charCodeAt(0))throw za(new Ba,"Must be array types");if(l.charCodeAt(1)!=h.charCodeAt(1))throw za(new Ba,"Array types must match");if(m=a.length,i=c.length,0>b||0>d||0>e||b+e>m||d+e>i)throw new Ra;if(76!=l.charCodeAt(1)&&91!=l.charCodeAt(1)||Wa(l,h))for(j=0;e>j;++j)c[d+j]=a[b+j];else if(k=B(a,3),f=B(c,3),(null==a?null:a)===(null==c?null:c)&&d>b)for(b+=e,g=d+e;g-->d;)u(f,g,k[--b]);else for(g=d+e;g>d;)u(f,d++,k[b++])}function bb(a,b){if(!Vc(b,1<<a.dictionarySize))throw h(new j,"unexpected failure");if(!Yc(b,a.fb))throw h(new j,"unexpected failure");if(!Xc(b,a.matchFinder))throw h(new j,"unexpected failure");if(!Wc(b,a.lc,a.lp,a.pb))throw h(new j,"unexpected failure")}function cb(){return Xf}function db(){}function eb(a){var b;try{return $b(a.chunker)}catch(b){if(b=E(b),C(b,10))return!1;throw b}}function fb(a,b,c,d,e){var f,g;if(!e)throw La(new Na,"null mode");if(I(d,ze)<0)throw La(new Na,"invalid length "+_(d));for(a.length_0=d,f=Ic(new cd),bb(e,f),f._writeEndMark=!0,Zc(f,c),g=0;64>g;g+=8)pa(c,255&P(W(d,g)));a.chunker=(f._needReleaseMFStream=!1,f._inStream=b,f._finished=!1,Hc(f),f._rangeEncoder.Stream=c,Qc(f),Kc(f),Jc(f),f._lenEncoder._tableSize=f._numFastBytes+1-2,md(f._lenEncoder,1<<f._posStateBits),f._repMatchLenEncoder._tableSize=f._numFastBytes+1-2,md(f._repMatchLenEncoder,1<<f._posStateBits),void(f.nowPos64=Ae),Yb(new cc,f))}function gb(){return Yf}function hb(){}function ib(a,b,c){var d;a.output=ma(new sa);try{fb(a,ea(new ja,b),a.output,N(b.length),c)}catch(d){throw d=E(d),C(d,10)?h(new j,"impossible exception"):d}return a}function jb(){return Zf}function kb(){}function lb(a){var b,c;try{return $b(a.chunker)}catch(b){if(b=E(b),C(b,10))return c=b,a.exception=c,!1;throw b}}function mb(a,b,c){var d,e,f,g,h,i="";for(f=s(ff,0,-1,5,1),e=0;e<f.length;++e){if(g=ga(b),-1==g)throw ta(new va,"truncated input");f[e]=g<<24>>24}if(d=gc(new mc),!ic(d,f))throw ta(new va,"corrupted input");for(e=0;64>e;e+=8){if(g=ga(b),-1==g)throw ta(new va,"truncated input");g=g.toString(16),1==g.length&&(g="0"+g),i=g+""+i}"ffffffffffffffffff"==i.toLowerCase()||0==i?a.length_0=ze:(h=parseInt(i,16),h>4294967295?a.length_0=ze:a.length_0=M(h)),a.chunker=ec(d,b,c,a.length_0)}function nb(){return $f}function ob(){}function pb(a,b){return a.output=ma(new sa),
mb(a,ea(new ja,b),a.output),a}function qb(){return _f}function rb(){}function sb(a,b,c,d){var e;a._keepSizeBefore=b,a._keepSizeAfter=c,e=b+c+d,(null==a._bufferBase||a._blockSize!=e)&&(a._bufferBase=null,a._blockSize=e,a._bufferBase=s(ff,0,-1,a._blockSize,1)),a._pointerToLastSafePosition=a._blockSize-c}function tb(a,b){return a._bufferBase[a._bufferOffset+a._pos+b]}function ub(a,b,c,d){var e,f;for(a._streamEndWasReached&&a._pos+b+d>a._streamPos&&(d=a._streamPos-(a._pos+b)),++c,f=a._bufferOffset+a._pos+b,e=0;d>e&&a._bufferBase[f+e]==a._bufferBase[f+e-c];++e);return e}function vb(a){return a._streamPos-a._pos}function wb(a){var b,c,d;for(d=a._bufferOffset+a._pos-a._keepSizeBefore,d>0&&--d,c=a._bufferOffset+a._streamPos-d,b=0;c>b;++b)a._bufferBase[b]=a._bufferBase[d+b];a._bufferOffset-=d}function xb(a){var b;++a._pos,a._pos>a._posLimit&&(b=a._bufferOffset+a._pos,b>a._pointerToLastSafePosition&&wb(a),yb(a))}function yb(a){var b,c,d;if(!a._streamEndWasReached)for(;;){if(d=-a._bufferOffset+a._blockSize-a._streamPos,0==d)return;if(b=ha(a._stream,a._bufferBase,a._bufferOffset+a._streamPos,d),-1==b)return a._posLimit=a._streamPos,c=a._bufferOffset+a._posLimit,c>a._pointerToLastSafePosition&&(a._posLimit=a._pointerToLastSafePosition-a._bufferOffset),void(a._streamEndWasReached=!0);a._streamPos+=b,a._streamPos>=a._pos+a._keepSizeAfter&&(a._posLimit=a._streamPos-a._keepSizeAfter)}}function zb(a,b){a._bufferOffset+=b,a._posLimit-=b,a._pos-=b,a._streamPos-=b}function Ab(){return xf}function Bb(){}function Cb(){Cb=se;var a,b,c;for(Ve=s(tf,0,-1,256,1),a=0;256>a;++a){for(c=a,b=0;8>b;++b)0!=(1&c)?c=c>>>1^-306674912:c>>>=1;Ve[a]=c}}function Db(a,b,c,d,e){var f,g,h;return b>1073741567?!1:(a._cutValue=16+(d>>1),h=~~((b+c+d+e)/2)+256,sb(a,b+c,d+e,h),a._matchMaxLen=d,f=b+1,a._cyclicBufferSize!=f&&(a._son=s(tf,0,-1,2*(a._cyclicBufferSize=f),1)),g=65536,a.HASH_ARRAY&&(g=b-1,g|=g>>1,g|=g>>2,g|=g>>4,g|=g>>8,g>>=1,g|=65535,g>16777216&&(g>>=1),a._hashMask=g,++g,g+=a.kFixHashSize),g!=a._hashSizeSum&&(a._hash=s(tf,0,-1,a._hashSizeSum=g,1)),!0)}function Eb(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(a._pos+a._matchMaxLen<=a._streamPos)p=a._matchMaxLen;else if(p=a._streamPos-a._pos,p<a.kMinMatchCheck)return Gb(a),0;for(s=0,q=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,d=a._bufferOffset+a._pos,r=1,j=0,k=0,a.HASH_ARRAY?(w=Ve[255&a._bufferBase[d]]^255&a._bufferBase[d+1],j=1023&w,w^=(255&a._bufferBase[d+2])<<8,k=65535&w,l=(w^Ve[255&a._bufferBase[d+3]]<<5)&a._hashMask):l=255&a._bufferBase[d]^(255&a._bufferBase[d+1])<<8,e=a._hash[a.kFixHashSize+l],a.HASH_ARRAY&&(f=a._hash[j],g=a._hash[1024+k],a._hash[j]=a._pos,a._hash[1024+k]=a._pos,f>q&&a._bufferBase[a._bufferOffset+f]==a._bufferBase[d]&&(b[s++]=r=2,b[s++]=a._pos-f-1),g>q&&a._bufferBase[a._bufferOffset+g]==a._bufferBase[d]&&(g==f&&(s-=2),b[s++]=r=3,b[s++]=a._pos-g-1,f=g),0!=s&&f==e&&(s-=2,r=1)),a._hash[a.kFixHashSize+l]=a._pos,u=(a._cyclicBufferPos<<1)+1,v=a._cyclicBufferPos<<1,n=o=a.kNumHashDirectBytes,0!=a.kNumHashDirectBytes&&e>q&&a._bufferBase[a._bufferOffset+e+a.kNumHashDirectBytes]!=a._bufferBase[d+a.kNumHashDirectBytes]&&(b[s++]=r=a.kNumHashDirectBytes,b[s++]=a._pos-e-1),c=a._cutValue;;){if(q>=e||0==c--){a._son[u]=a._son[v]=0;break}if(i=a._pos-e,h=(i<=a._cyclicBufferPos?a._cyclicBufferPos-i:a._cyclicBufferPos-i+a._cyclicBufferSize)<<1,t=a._bufferOffset+e,m=o>n?n:o,a._bufferBase[t+m]==a._bufferBase[d+m]){for(;++m!=p&&a._bufferBase[t+m]==a._bufferBase[d+m];);if(m>r&&(b[s++]=r=m,b[s++]=i-1,m==p)){a._son[v]=a._son[h],a._son[u]=a._son[h+1];break}}(255&a._bufferBase[t+m])<(255&a._bufferBase[d+m])?(a._son[v]=e,v=h+1,e=a._son[v],o=m):(a._son[u]=e,u=h,e=a._son[u],n=m)}return Gb(a),s}function Fb(a){var b;for(a._bufferOffset=0,a._pos=0,a._streamPos=0,a._streamEndWasReached=!1,yb(a),b=0;b<a._hashSizeSum;++b)a._hash[b]=0;a._cyclicBufferPos=0,zb(a,-1)}function Gb(a){var b;++a._cyclicBufferPos>=a._cyclicBufferSize&&(a._cyclicBufferPos=0),xb(a),1073741823==a._pos&&(b=a._pos-a._cyclicBufferSize,Hb(a._son,2*a._cyclicBufferSize,b),Hb(a._hash,a._hashSizeSum,b),zb(a,b))}function Hb(a,b,c){var d,e;for(d=0;b>d;++d)e=a[d],c>=e?e=0:e-=c,a[d]=e}function Ib(a,b){a.HASH_ARRAY=b>2,a.HASH_ARRAY?(a.kNumHashDirectBytes=0,a.kMinMatchCheck=4,a.kFixHashSize=66560):(a.kNumHashDirectBytes=2,a.kMinMatchCheck=3,a.kFixHashSize=0)}function Jb(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;do{if(a._pos+a._matchMaxLen<=a._streamPos)n=a._matchMaxLen;else if(n=a._streamPos-a._pos,n<a.kMinMatchCheck){Gb(a);continue}for(o=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,d=a._bufferOffset+a._pos,a.HASH_ARRAY?(s=Ve[255&a._bufferBase[d]]^255&a._bufferBase[d+1],h=1023&s,a._hash[h]=a._pos,s^=(255&a._bufferBase[d+2])<<8,i=65535&s,a._hash[1024+i]=a._pos,j=(s^Ve[255&a._bufferBase[d+3]]<<5)&a._hashMask):j=255&a._bufferBase[d]^(255&a._bufferBase[d+1])<<8,e=a._hash[a.kFixHashSize+j],a._hash[a.kFixHashSize+j]=a._pos,q=(a._cyclicBufferPos<<1)+1,r=a._cyclicBufferPos<<1,l=m=a.kNumHashDirectBytes,c=a._cutValue;;){if(o>=e||0==c--){a._son[q]=a._son[r]=0;break}if(g=a._pos-e,f=(g<=a._cyclicBufferPos?a._cyclicBufferPos-g:a._cyclicBufferPos-g+a._cyclicBufferSize)<<1,p=a._bufferOffset+e,k=m>l?l:m,a._bufferBase[p+k]==a._bufferBase[d+k]){for(;++k!=n&&a._bufferBase[p+k]==a._bufferBase[d+k];);if(k==n){a._son[r]=a._son[f],a._son[q]=a._son[f+1];break}}(255&a._bufferBase[p+k])<(255&a._bufferBase[d+k])?(a._son[r]=e,r=f+1,e=a._son[r],m=k):(a._son[q]=e,q=f,e=a._son[q],l=k)}Gb(a)}while(0!=--b)}function Kb(){return yf}function Lb(){}function Mb(a,b,c){var d;for(d=a._pos-b-1,0>d&&(d+=a._windowSize);0!=c;--c)d>=a._windowSize&&(d=0),a._buffer[a._pos++]=a._buffer[d++],a._pos>=a._windowSize&&Ob(a)}function Nb(a,b){(null==a._buffer||a._windowSize!=b)&&(a._buffer=s(ff,0,-1,b,1)),a._windowSize=b,a._pos=0,a._streamPos=0}function Ob(a){var b;b=a._pos-a._streamPos,0!=b&&(qa(a._stream,a._buffer,a._streamPos,b),a._pos>=a._windowSize&&(a._pos=0),a._streamPos=a._pos)}function Pb(a,b){var c;return c=a._pos-b-1,0>c&&(c+=a._windowSize),a._buffer[c]}function Qb(a,b){b||(a._streamPos=0,a._pos=0)}function Rb(a,b){a._buffer[a._pos++]=b,a._pos>=a._windowSize&&Ob(a)}function Sb(a){Ob(a),a._stream=null}function Tb(a,b){Ob(a),a._stream=null,a._stream=b}function Ub(){return zf}function Vb(){}function Wb(a){return a-=2,4>a?a:3}function Xb(a){return 4>a?0:10>a?a-3:a-6}function Yb(a,b){return a.encoder=b,a.decoder=null,a.alive=!0,a}function Zb(a,b){return a.decoder=b,a.encoder=null,a.alive=!0,a}function $b(a){var b;if(!a.alive)throw new Pa;b=!0;try{return a.encoder?ac(a):_b(a),b=!1,a.alive}finally{b&&(a.alive=!1)}}function _b(a){var b;if(b=fc(a.decoder),-1==b)throw ta(new va,"corrupted input");a.inBytesProcessed=ze,a.outBytesProcessed=a.decoder.nowPos64,(1==b||I(a.decoder.outSize,Ae)>=0&&I(a.decoder.nowPos64,a.decoder.outSize)>=0)&&(dc(a.decoder),a.alive=!1)}function ac(a){Gc(a.encoder,a.encoder.processedInSize,a.encoder.processedOutSize,a.encoder.finished),a.inBytesProcessed=a.encoder.processedInSize[0],a.encoder.finished[0]&&(Uc(a.encoder),a.alive=!1)}function bc(){return Af}function cc(){}function dc(a){Ob(a.m_OutWindow),Sb(a.m_OutWindow),a.m_RangeDecoder.Stream=null}function ec(a,b,c,d){return a.m_RangeDecoder.Stream=b,Tb(a.m_OutWindow,c),hc(a),a.state=0,a.rep0=0,a.rep1=0,a.rep2=0,a.rep3=0,a.outSize=d,a.nowPos64=Ae,a.prevByte=0,Zb(new cc,a)}function fc(a){var b,c,d,e,f,g;if(g=P(a.nowPos64)&a.m_PosStateMask,0==Td(a.m_RangeDecoder,a.m_IsMatchDecoders,(a.state<<4)+g))b=uc(a.m_LiteralDecoder,P(a.nowPos64),a.prevByte),a.state<7?a.prevByte=yc(b,a.m_RangeDecoder):a.prevByte=zc(b,a.m_RangeDecoder,Pb(a.m_OutWindow,a.rep0)),Rb(a.m_OutWindow,a.prevByte),a.state=Xb(a.state),a.nowPos64=F(a.nowPos64,Be);else{if(1==Td(a.m_RangeDecoder,a.m_IsRepDecoders,a.state))d=0,0==Td(a.m_RangeDecoder,a.m_IsRepG0Decoders,a.state)?0==Td(a.m_RangeDecoder,a.m_IsRep0LongDecoders,(a.state<<4)+g)&&(a.state=a.state<7?9:11,d=1):(0==Td(a.m_RangeDecoder,a.m_IsRepG1Decoders,a.state)?c=a.rep1:(0==Td(a.m_RangeDecoder,a.m_IsRepG2Decoders,a.state)?c=a.rep2:(c=a.rep3,a.rep3=a.rep2),a.rep2=a.rep1),a.rep1=a.rep0,a.rep0=c),0==d&&(d=oc(a.m_RepLenDecoder,a.m_RangeDecoder,g)+2,a.state=a.state<7?8:11);else if(a.rep3=a.rep2,a.rep2=a.rep1,a.rep1=a.rep0,d=2+oc(a.m_LenDecoder,a.m_RangeDecoder,g),a.state=a.state<7?7:10,f=Fd(a.m_PosSlotDecoder[Wb(d)],a.m_RangeDecoder),f>=4){if(e=(f>>1)-1,a.rep0=(2|1&f)<<e,14>f)a.rep0+=Hd(a.m_PosDecoders,a.rep0-f-1,a.m_RangeDecoder,e);else if(a.rep0+=Ud(a.m_RangeDecoder,e-4)<<4,a.rep0+=Gd(a.m_PosAlignDecoder,a.m_RangeDecoder),a.rep0<0)return-1==a.rep0?1:-1}else a.rep0=f;if(I(N(a.rep0),a.nowPos64)>=0||a.rep0>=a.m_DictionarySizeCheck)return-1;Mb(a.m_OutWindow,a.rep0,d),a.nowPos64=F(a.nowPos64,N(d)),a.prevByte=Pb(a.m_OutWindow,0)}return 0}function gc(a){var b;for(a.m_OutWindow=new Vb,a.m_RangeDecoder=new Yd,a.m_IsMatchDecoders=s(Bf,0,-1,192,1),a.m_IsRepDecoders=s(Bf,0,-1,12,1),a.m_IsRepG0Decoders=s(Bf,0,-1,12,1),a.m_IsRepG1Decoders=s(Bf,0,-1,12,1),a.m_IsRepG2Decoders=s(Bf,0,-1,12,1),a.m_IsRep0LongDecoders=s(Bf,0,-1,192,1),a.m_PosSlotDecoder=s(Cf,0,7,4,0),a.m_PosDecoders=s(Bf,0,-1,114,1),a.m_PosAlignDecoder=Ed(new Jd,4),a.m_LenDecoder=pc(new sc),a.m_RepLenDecoder=pc(new sc),a.m_LiteralDecoder=new xc,b=0;4>b;++b)a.m_PosSlotDecoder[b]=Ed(new Jd,6);return a}function hc(a){var b;for(Qb(a.m_OutWindow,!1),Wd(a.m_IsMatchDecoders),Wd(a.m_IsRep0LongDecoders),Wd(a.m_IsRepDecoders),Wd(a.m_IsRepG0Decoders),Wd(a.m_IsRepG1Decoders),Wd(a.m_IsRepG2Decoders),Wd(a.m_PosDecoders),vc(a.m_LiteralDecoder),b=0;4>b;++b)Wd(a.m_PosSlotDecoder[b].Models);qc(a.m_LenDecoder),qc(a.m_RepLenDecoder),Wd(a.m_PosAlignDecoder.Models),Vd(a.m_RangeDecoder)}function ic(a,b){var c,d,e,f,g,h,i;if(b.length<5)return!1;for(i=255&b[0],e=i%9,h=~~(i/9),f=h%5,g=~~(h/5),c=0,d=0;4>d;++d)c+=(255&b[1+d])<<8*d;return kc(a,e,f,g)?jc(a,c):!1}function jc(a,b){return 0>b?!1:(a.m_DictionarySize!=b&&(a.m_DictionarySize=b,a.m_DictionarySizeCheck=Sa(a.m_DictionarySize,1),Nb(a.m_OutWindow,Sa(a.m_DictionarySizeCheck,4096))),!0)}function kc(a,b,c,d){var e;return b>8||c>4||d>4?!1:(tc(a.m_LiteralDecoder,c,b),e=1<<d,nc(a.m_LenDecoder,e),nc(a.m_RepLenDecoder,e),a.m_PosStateMask=e-1,!0)}function lc(){return Df}function mc(){}function nc(a,b){for(;a.m_NumPosStates<b;++a.m_NumPosStates)a.m_LowCoder[a.m_NumPosStates]=Ed(new Jd,3),a.m_MidCoder[a.m_NumPosStates]=Ed(new Jd,3)}function oc(a,b,c){var d;return 0==Td(b,a.m_Choice,0)?Fd(a.m_LowCoder[c],b):(d=8,d+=0==Td(b,a.m_Choice,1)?Fd(a.m_MidCoder[c],b):8+Fd(a.m_HighCoder,b))}function pc(a){return a.m_Choice=s(Bf,0,-1,2,1),a.m_LowCoder=s(Cf,0,7,16,0),a.m_MidCoder=s(Cf,0,7,16,0),a.m_HighCoder=Ed(new Jd,8),a}function qc(a){var b;for(Wd(a.m_Choice),b=0;b<a.m_NumPosStates;++b)Wd(a.m_LowCoder[b].Models),Wd(a.m_MidCoder[b].Models);Wd(a.m_HighCoder.Models)}function rc(){return Ef}function sc(){}function tc(a,b,c){var d,e;if(null==a.m_Coders||a.m_NumPrevBits!=c||a.m_NumPosBits!=b)for(a.m_NumPosBits=b,a.m_PosMask=(1<<b)-1,a.m_NumPrevBits=c,e=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=s(Ff,0,4,e,0),d=0;e>d;++d)a.m_Coders[d]=Ac(new Cc)}function uc(a,b,c){return a.m_Coders[((b&a.m_PosMask)<<a.m_NumPrevBits)+((255&c)>>>8-a.m_NumPrevBits)]}function vc(a){var b,c;for(c=1<<a.m_NumPrevBits+a.m_NumPosBits,b=0;c>b;++b)Wd(a.m_Coders[b].m_Decoders)}function wc(){return Gf}function xc(){}function yc(a,b){var c;c=1;do c=c<<1|Td(b,a.m_Decoders,c);while(256>c);return c<<24>>24}function zc(a,b,c){var d,e,f;f=1;do if(e=c>>7&1,c<<=1,d=Td(b,a.m_Decoders,(1+e<<8)+f),f=f<<1|d,e!=d){for(;256>f;)f=f<<1|Td(b,a.m_Decoders,f);break}while(256>f);return f<<24>>24}function Ac(a){return a.m_Decoders=s(Bf,0,-1,768,1),a}function Bc(){return Hf}function Cc(){}function Dc(){Dc=se;var a,b,c,d;for(We=s(ff,0,-1,2048,1),a=2,We[0]=0,We[1]=1,d=2;22>d;++d)for(c=1<<(d>>1)-1,b=0;c>b;++b,++a)We[a]=d<<24>>24}function Ec(a,b){var c,d,e,f;a._optimumEndIndex=b,e=a._optimum[b].PosPrev,d=a._optimum[b].BackPrev;do a._optimum[b].Prev1IsChar&&(Ad(a._optimum[e]),a._optimum[e].PosPrev=e-1,a._optimum[b].Prev2&&(a._optimum[e-1].Prev1IsChar=!1,a._optimum[e-1].PosPrev=a._optimum[b].PosPrev2,a._optimum[e-1].BackPrev=a._optimum[b].BackPrev2)),f=e,c=d,d=a._optimum[f].BackPrev,e=a._optimum[f].PosPrev,a._optimum[f].BackPrev=c,a._optimum[f].PosPrev=b,b=f;while(b>0);return a.backRes=a._optimum[0].BackPrev,a._optimumCurrentIndex=a._optimum[0].PosPrev,a._optimumCurrentIndex}function Fc(a){var b;for(a._state=0,a._previousByte=0,b=0;4>b;++b)a._repDistances[b]=0}function Gc(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(b[0]=Ae,c[0]=Ae,d[0]=!0,a._inStream&&(a._matchFinder._stream=a._inStream,Fb(a._matchFinder),a._needReleaseMFStream=!0,a._inStream=null),!a._finished){if(a._finished=!0,r=a.nowPos64,L(a.nowPos64,Ae)){if(0==vb(a._matchFinder))return void Lc(a,P(a.nowPos64));Sc(a),q=P(a.nowPos64)&a._posStateMask,$d(a._rangeEncoder,a._isMatch,(a._state<<4)+q,0),a._state=Xb(a._state),g=tb(a._matchFinder,-a._additionalOffset),ud(qd(a._literalEncoder,P(a.nowPos64),a._previousByte),a._rangeEncoder,g),a._previousByte=g,--a._additionalOffset,a.nowPos64=F(a.nowPos64,Be)}if(0==vb(a._matchFinder))return void Lc(a,P(a.nowPos64));for(;;){if(k=Mc(a,P(a.nowPos64)),n=a.backRes,q=P(a.nowPos64)&a._posStateMask,f=(a._state<<4)+q,1==k&&-1==n)$d(a._rangeEncoder,a._isMatch,f,0),g=tb(a._matchFinder,-a._additionalOffset),s=qd(a._literalEncoder,P(a.nowPos64),a._previousByte),a._state<7?ud(s,a._rangeEncoder,g):(m=tb(a._matchFinder,-a._repDistances[0]-1-a._additionalOffset),vd(s,a._rangeEncoder,m,g)),a._previousByte=g,a._state=Xb(a._state);else{if($d(a._rangeEncoder,a._isMatch,f,1),4>n){if($d(a._rangeEncoder,a._isRep,a._state,1),0==n?($d(a._rangeEncoder,a._isRepG0,a._state,0),1==k?$d(a._rangeEncoder,a._isRep0Long,f,0):$d(a._rangeEncoder,a._isRep0Long,f,1)):($d(a._rangeEncoder,a._isRepG0,a._state,1),1==n?$d(a._rangeEncoder,a._isRepG1,a._state,0):($d(a._rangeEncoder,a._isRepG1,a._state,1),$d(a._rangeEncoder,a._isRepG2,a._state,n-2))),1==k?a._state=a._state<7?9:11:(jd(a._repMatchLenEncoder,a._rangeEncoder,k-2,q),a._state=a._state<7?8:11),h=a._repDistances[n],0!=n){for(j=n;j>=1;--j)a._repDistances[j]=a._repDistances[j-1];a._repDistances[0]=h}}else{for($d(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,jd(a._lenEncoder,a._rangeEncoder,k-2,q),n-=4,p=_c(n),l=Wb(k),Ld(a._posSlotEncoder[l],a._rangeEncoder,p),p>=4&&(i=(p>>1)-1,e=(2|1&p)<<i,o=n-e,14>p?Pd(a._posEncoders,e-p-1,a._rangeEncoder,i,o):(_d(a._rangeEncoder,o>>4,i-4),Nd(a._posAlignEncoder,a._rangeEncoder,15&o),++a._alignPriceCount)),h=n,j=3;j>=1;--j)a._repDistances[j]=a._repDistances[j-1];a._repDistances[0]=h,++a._matchPriceCount}a._previousByte=tb(a._matchFinder,k-1-a._additionalOffset)}if(a._additionalOffset-=k,a.nowPos64=F(a.nowPos64,N(k)),0==a._additionalOffset){if(a._matchPriceCount>=128&&Kc(a),a._alignPriceCount>=16&&Jc(a),b[0]=a.nowPos64,c[0]=be(a._rangeEncoder),0==vb(a._matchFinder))return void Lc(a,P(a.nowPos64));if(I(Y(a.nowPos64,r),De)>=0)return a._finished=!1,void(d[0]=!1)}}}}function Hc(a){var b,c;a._matchFinder||(Cb(),b=new Lb,c=4,0==a._matchFinderType&&(c=2),Ib(b,c),a._matchFinder=b),pd(a._literalEncoder,a._numLiteralPosStateBits,a._numLiteralContextBits),(a._dictionarySize!=a._dictionarySizePrev||a._numFastBytesPrev!=a._numFastBytes)&&(Db(a._matchFinder,a._dictionarySize,4096,a._numFastBytes,274),a._dictionarySizePrev=a._dictionarySize,a._numFastBytesPrev=a._numFastBytes)}function Ic(a){var b;for(Dc(),a._repDistances=s(tf,0,-1,4,1),a._optimum=s(If,0,6,4096,0),a._rangeEncoder=(Zd(),new he),a._isMatch=s(Bf,0,-1,192,1),a._isRep=s(Bf,0,-1,12,1),a._isRepG0=s(Bf,0,-1,12,1),a._isRepG1=s(Bf,0,-1,12,1),a._isRepG2=s(Bf,0,-1,12,1),a._isRep0Long=s(Bf,0,-1,192,1),a._posSlotEncoder=s(Jf,0,8,4,0),a._posEncoders=s(Bf,0,-1,114,1),a._posAlignEncoder=Kd(new Sd,4),a._lenEncoder=kd(new od),a._repMatchLenEncoder=kd(new od),a._literalEncoder=new td,a._matchDistances=s(tf,0,-1,548,1),a._posSlotPrices=s(tf,0,-1,256,1),a._distancesPrices=s(tf,0,-1,512,1),a._alignPrices=s(tf,0,-1,16,1),a.reps=s(tf,0,-1,4,1),a.repLens=s(tf,0,-1,4,1),a.processedInSize=s(Kf,0,-1,1,3),a.processedOutSize=s(Kf,0,-1,1,3),a.finished=s(Lf,0,-1,1,2),a.properties=s(ff,0,-1,5,1),a.tempPrices=s(tf,0,-1,128,1),b=0;4096>b;++b)a._optimum[b]=new Dd;for(b=0;4>b;++b)a._posSlotEncoder[b]=Kd(new Sd,6);return a}function Jc(a){var b;for(b=0;16>b;++b)a._alignPrices[b]=Od(a._posAlignEncoder,b);a._alignPriceCount=0}function Kc(a){var b,c,d,e,f,g,h,i;for(e=4;128>e;++e)g=_c(e),d=(g>>1)-1,b=(2|1&g)<<d,a.tempPrices[e]=Qd(a._posEncoders,b-g-1,d,e-b);for(f=0;4>f;++f){for(c=a._posSlotEncoder[f],h=f<<6,g=0;g<a._distTableSize;++g)a._posSlotPrices[h+g]=Md(c,g);for(g=14;g<a._distTableSize;++g)a._posSlotPrices[h+g]+=(g>>1)-1-4<<6;for(i=128*f,e=0;4>e;++e)a._distancesPrices[i+e]=a._posSlotPrices[h+e];for(;128>e;++e)a._distancesPrices[i+e]=a._posSlotPrices[h+_c(e)]+a.tempPrices[e]}a._matchPriceCount=0}function Lc(a,b){Tc(a),$c(a,b&a._posStateMask),ae(a._rangeEncoder)}function Mc(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;if(a._optimumEndIndex!=a._optimumCurrentIndex)return o=a._optimum[a._optimumCurrentIndex].PosPrev-a._optimumCurrentIndex,a.backRes=a._optimum[a._optimumCurrentIndex].BackPrev,a._optimumCurrentIndex=a._optimum[a._optimumCurrentIndex].PosPrev,o;if(a._optimumCurrentIndex=a._optimumEndIndex=0,a._longestMatchWasFound?(n=a._longestMatchLength,a._longestMatchWasFound=!1):n=Sc(a),C=a._numDistancePairs,A=vb(a._matchFinder)+1,2>A)return a.backRes=-1,1;for(A>273&&(A=273),P=0,k=0;4>k;++k)a.reps[k]=a._repDistances[k],a.repLens[k]=ub(a._matchFinder,-1,a.reps[k],273),a.repLens[k]>a.repLens[P]&&(P=k);if(a.repLens[P]>=a._numFastBytes)return a.backRes=P,o=a.repLens[P],Rc(a,o-1),o;if(n>=a._numFastBytes)return a.backRes=a._matchDistances[C-1]+4,Rc(a,n-1),n;if(i=tb(a._matchFinder,-1),s=tb(a._matchFinder,-a._repDistances[0]-1-1),2>n&&i!=s&&a.repLens[P]<2)return a.backRes=-1,1;if(a._optimum[0].State=a._state,J=b&a._posStateMask,a._optimum[1].Price=(Zd(),Xe[a._isMatch[(a._state<<4)+J]>>>2]+xd(qd(a._literalEncoder,b,a._previousByte),a._state>=7,s,i)),Ad(a._optimum[1]),t=Xe[2048-a._isMatch[(a._state<<4)+J]>>>2],O=t+Xe[2048-a._isRep[a._state]>>>2],s==i&&(Q=O+Pc(a,a._state,J),Q<a._optimum[1].Price&&(a._optimum[1].Price=Q,Bd(a._optimum[1]))),m=n>=a.repLens[P]?n:a.repLens[P],2>m)return a.backRes=a._optimum[1].BackPrev,1;a._optimum[1].PosPrev=0,a._optimum[0].Backs0=a.reps[0],a._optimum[0].Backs1=a.reps[1],a._optimum[0].Backs2=a.reps[2],a._optimum[0].Backs3=a.reps[3],l=m;do a._optimum[l--].Price=268435455;while(l>=2);for(k=0;4>k;++k)if(N=a.repLens[k],!(2>N)){L=O+Oc(a,k,a._state,J);do f=L+ld(a._repMatchLenEncoder,N-2,J),G=a._optimum[N],f<G.Price&&(G.Price=f,G.PosPrev=0,G.BackPrev=k,G.Prev1IsChar=!1);while(--N>=2)}if(z=t+Xe[a._isRep[a._state]>>>2],l=a.repLens[0]>=2?a.repLens[0]+1:2,n>=l){for(D=0;l>a._matchDistances[D];)D+=2;for(;j=a._matchDistances[D+1],f=z+Nc(a,j,l,J),G=a._optimum[l],f<G.Price&&(G.Price=f,G.PosPrev=0,G.BackPrev=j+4,G.Prev1IsChar=!1),l!=a._matchDistances[D]||(D+=2,D!=C);++l);}for(c=0;;){if(++c,c==m)return Ec(a,c);if(u=Sc(a),C=a._numDistancePairs,u>=a._numFastBytes)return a._longestMatchLength=u,a._longestMatchWasFound=!0,Ec(a,c);if(++b,I=a._optimum[c].PosPrev,a._optimum[c].Prev1IsChar?(--I,a._optimum[c].Prev2?(S=a._optimum[a._optimum[c].PosPrev2].State,S=a._optimum[c].BackPrev2<4?7>S?8:11:7>S?7:10):S=a._optimum[I].State,S=Xb(S)):S=a._optimum[I].State,I==c-1?S=0==a._optimum[c].BackPrev?7>S?9:11:Xb(S):(a._optimum[c].Prev1IsChar&&a._optimum[c].Prev2?(I=a._optimum[c].PosPrev2,H=a._optimum[c].BackPrev2,S=7>S?8:11):(H=a._optimum[c].BackPrev,S=4>H?7>S?8:11:7>S?7:10),F=a._optimum[I],4>H?0==H?(a.reps[0]=F.Backs0,a.reps[1]=F.Backs1,a.reps[2]=F.Backs2,a.reps[3]=F.Backs3):1==H?(a.reps[0]=F.Backs1,a.reps[1]=F.Backs0,a.reps[2]=F.Backs2,a.reps[3]=F.Backs3):2==H?(a.reps[0]=F.Backs2,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs3):(a.reps[0]=F.Backs3,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs2):(a.reps[0]=H-4,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs2)),a._optimum[c].State=S,a._optimum[c].Backs0=a.reps[0],a._optimum[c].Backs1=a.reps[1],a._optimum[c].Backs2=a.reps[2],a._optimum[c].Backs3=a.reps[3],h=a._optimum[c].Price,i=tb(a._matchFinder,-1),s=tb(a._matchFinder,-a.reps[0]-1-1),J=b&a._posStateMask,d=h+Xe[a._isMatch[(S<<4)+J]>>>2]+xd(qd(a._literalEncoder,b,tb(a._matchFinder,-2)),S>=7,s,i),x=a._optimum[c+1],v=!1,d<x.Price&&(x.Price=d,x.PosPrev=c,x.BackPrev=-1,x.Prev1IsChar=!1,v=!0),t=h+Xe[2048-a._isMatch[(S<<4)+J]>>>2],O=t+Xe[2048-a._isRep[S]>>>2],s!=i||x.PosPrev<c&&0==x.BackPrev||(Q=O+(Xe[a._isRepG0[S]>>>2]+Xe[a._isRep0Long[(S<<4)+J]>>>2]),Q<=x.Price&&(x.Price=Q,x.PosPrev=c,x.BackPrev=0,x.Prev1IsChar=!1,v=!0)),B=vb(a._matchFinder)+1,B=B>4095-c?4095-c:B,A=B,!(2>A)){if(A>a._numFastBytes&&(A=a._numFastBytes),!v&&s!=i&&(U=Ta(B-1,a._numFastBytes),q=ub(a._matchFinder,0,a.reps[0],U),q>=2)){for(T=Xb(S),K=b+1&a._posStateMask,y=d+Xe[2048-a._isMatch[(T<<4)+K]>>>2]+Xe[2048-a._isRep[T]>>>2],E=c+1+q;E>m;)a._optimum[++m].Price=268435455;f=y+(V=ld(a._repMatchLenEncoder,q-2,K),V+Oc(a,0,T,K)),G=a._optimum[E],f<G.Price&&(G.Price=f,G.PosPrev=c+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!1)}for(R=2,M=0;4>M;++M)if(p=ub(a._matchFinder,-1,a.reps[M],A),!(2>p)){r=p;do{for(;c+p>m;)a._optimum[++m].Price=268435455;f=O+(W=ld(a._repMatchLenEncoder,p-2,J),W+Oc(a,M,S,J)),G=a._optimum[c+p],f<G.Price&&(G.Price=f,G.PosPrev=c,G.BackPrev=M,G.Prev1IsChar=!1)}while(--p>=2);if(p=r,0==M&&(R=p+1),B>p&&(U=Ta(B-1-p,a._numFastBytes),q=ub(a._matchFinder,p,a.reps[M],U),q>=2)){for(T=7>S?8:11,K=b+p&a._posStateMask,e=O+(X=ld(a._repMatchLenEncoder,p-2,J),X+Oc(a,M,S,J))+Xe[a._isMatch[(T<<4)+K]>>>2]+xd(qd(a._literalEncoder,b+p,tb(a._matchFinder,p-1-1)),!0,tb(a._matchFinder,p-1-(a.reps[M]+1)),tb(a._matchFinder,p-1)),T=Xb(T),K=b+p+1&a._posStateMask,w=e+Xe[2048-a._isMatch[(T<<4)+K]>>>2],y=w+Xe[2048-a._isRep[T]>>>2],E=p+1+q;c+E>m;)a._optimum[++m].Price=268435455;f=y+(Y=ld(a._repMatchLenEncoder,q-2,K),Y+Oc(a,0,T,K)),G=a._optimum[c+E],f<G.Price&&(G.Price=f,G.PosPrev=c+p+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!0,G.PosPrev2=c,G.BackPrev2=M)}}if(u>A){for(u=A,C=0;u>a._matchDistances[C];C+=2);a._matchDistances[C]=u,C+=2}if(u>=R){for(z=t+Xe[a._isRep[S]>>>2];c+u>m;)a._optimum[++m].Price=268435455;for(D=0;R>a._matchDistances[D];)D+=2;for(p=R;;++p)if(g=a._matchDistances[D+1],f=z+Nc(a,g,p,J),G=a._optimum[c+p],f<G.Price&&(G.Price=f,G.PosPrev=c,G.BackPrev=g+4,G.Prev1IsChar=!1),p==a._matchDistances[D]){if(B>p&&(U=Ta(B-1-p,a._numFastBytes),q=ub(a._matchFinder,p,g,U),q>=2)){for(T=7>S?7:10,K=b+p&a._posStateMask,e=f+Xe[a._isMatch[(T<<4)+K]>>>2]+xd(qd(a._literalEncoder,b+p,tb(a._matchFinder,p-1-1)),!0,tb(a._matchFinder,p-(g+1)-1),tb(a._matchFinder,p-1)),T=Xb(T),K=b+p+1&a._posStateMask,w=e+Xe[2048-a._isMatch[(T<<4)+K]>>>2],y=w+Xe[2048-a._isRep[T]>>>2],E=p+1+q;c+E>m;)a._optimum[++m].Price=268435455;f=y+(Z=ld(a._repMatchLenEncoder,q-2,K),Z+Oc(a,0,T,K)),G=a._optimum[c+E],f<G.Price&&(G.Price=f,G.PosPrev=c+p+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!0,G.PosPrev2=c,G.BackPrev2=g+4)}if(D+=2,D==C)break}}}}}function Nc(a,b,c,d){var e,f;return e=Wb(c),f=128>b?a._distancesPrices[128*e+b]:a._posSlotPrices[(e<<6)+ad(b)]+a._alignPrices[15&b],f+ld(a._lenEncoder,c-2,d)}function Oc(a,b,c,d){var e;return 0==b?(Zd(),e=Xe[a._isRepG0[c]>>>2],e+=Xe[2048-a._isRep0Long[(c<<4)+d]>>>2]):(Zd(),e=Xe[2048-a._isRepG0[c]>>>2],1==b?e+=Xe[a._isRepG1[c]>>>2]:(e+=Xe[2048-a._isRepG1[c]>>>2],e+=ee(a._isRepG2[c],b-2))),e}function Pc(a,b,c){return Zd(),Xe[a._isRepG0[b]>>>2]+Xe[a._isRep0Long[(b<<4)+c]>>>2]}function Qc(a){var b;for(Fc(a),ce(a._rangeEncoder),fe(a._isMatch),fe(a._isRep0Long),fe(a._isRep),fe(a._isRepG0),fe(a._isRepG1),fe(a._isRepG2),fe(a._posEncoders),rd(a._literalEncoder),b=0;4>b;++b)Wd(a._posSlotEncoder[b].Models);fd(a._lenEncoder,1<<a._posStateBits),fd(a._repMatchLenEncoder,1<<a._posStateBits),Wd(a._posAlignEncoder.Models),a._longestMatchWasFound=!1,a._optimumEndIndex=0,a._optimumCurrentIndex=0,a._additionalOffset=0}function Rc(a,b){b>0&&(Jb(a._matchFinder,b),a._additionalOffset+=b)}function Sc(a){var b;return b=0,a._numDistancePairs=Eb(a._matchFinder,a._matchDistances),a._numDistancePairs>0&&(b=a._matchDistances[a._numDistancePairs-2],b==a._numFastBytes&&(b+=ub(a._matchFinder,b-1,a._matchDistances[a._numDistancePairs-1],273-b))),++a._additionalOffset,b}function Tc(a){a._matchFinder&&a._needReleaseMFStream&&(a._matchFinder._stream=null,a._needReleaseMFStream=!1)}function Uc(a){Tc(a),a._rangeEncoder.Stream=null}function Vc(a,b){var c;if(1>b||b>536870912)return!1;for(a._dictionarySize=b,c=0;b>1<<c;++c);return a._distTableSize=2*c,!0}function Wc(a,b,c,d){return 0>c||c>4||0>b||b>8||0>d||d>4?!1:(a._numLiteralPosStateBits=c,a._numLiteralContextBits=b,a._posStateBits=d,a._posStateMask=(1<<a._posStateBits)-1,!0)}function Xc(a,b){var c;return 0>b||b>2?!1:(c=a._matchFinderType,a._matchFinderType=b,a._matchFinder&&c!=a._matchFinderType&&(a._dictionarySizePrev=-1,a._matchFinder=null),!0)}function Yc(a,b){return 5>b||b>273?!1:(a._numFastBytes=b,!0)}function Zc(a,b){var c;for(a.properties[0]=9*(5*a._posStateBits+a._numLiteralPosStateBits)+a._numLiteralContextBits<<24>>24,c=0;4>c;++c)a.properties[1+c]=a._dictionarySize>>8*c<<24>>24;qa(b,a.properties,0,5)}function $c(a,b){var c;a._writeEndMark&&($d(a._rangeEncoder,a._isMatch,(a._state<<4)+b,1),$d(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,jd(a._lenEncoder,a._rangeEncoder,0,b),c=Wb(2),Ld(a._posSlotEncoder[c],a._rangeEncoder,63),_d(a._rangeEncoder,67108863,26),Nd(a._posAlignEncoder,a._rangeEncoder,15))}function _c(a){return 2048>a?We[a]:2097152>a?We[a>>10]+20:We[a>>20]+40}function ad(a){return 131072>a?We[a>>6]+12:134217728>a?We[a>>16]+32:We[a>>26]+52}function bd(){return Mf}function cd(){}function dd(a,b,c,d){8>c?($d(b,a._choice,0,0),Ld(a._lowCoder[d],b,c)):(c-=8,$d(b,a._choice,0,1),8>c?($d(b,a._choice,1,0),Ld(a._midCoder[d],b,c)):($d(b,a._choice,1,1),Ld(a._highCoder,b,c-8)))}function ed(a){var b;for(a._choice=s(Bf,0,-1,2,1),a._lowCoder=s(Jf,0,8,16,0),a._midCoder=s(Jf,0,8,16,0),a._highCoder=Kd(new Sd,8),b=0;16>b;++b)a._lowCoder[b]=Kd(new Sd,3),a._midCoder[b]=Kd(new Sd,3);return a}function fd(a,b){var c;for(fe(a._choice),c=0;b>c;++c)Wd(a._lowCoder[c].Models),Wd(a._midCoder[c].Models);Wd(a._highCoder.Models)}function gd(a,b,c,d,e){var f,g,h,i,j;for(Zd(),f=Xe[a._choice[0]>>>2],g=Xe[2048-a._choice[0]>>>2],h=g+Xe[a._choice[1]>>>2],i=g+Xe[2048-a._choice[1]>>>2],j=0,j=0;8>j;++j){if(j>=c)return;d[e+j]=f+Md(a._lowCoder[b],j)}for(;16>j;++j){if(j>=c)return;d[e+j]=h+Md(a._midCoder[b],j-8)}for(;c>j;++j)d[e+j]=i+Md(a._highCoder,j-8-8)}function hd(){return Qf}function id(){}function jd(a,b,c,d){dd(a,b,c,d),0==--a._counters[d]&&(gd(a,d,a._tableSize,a._prices,272*d),a._counters[d]=a._tableSize)}function kd(a){return ed(a),a._prices=s(tf,0,-1,4352,1),a._counters=s(tf,0,-1,16,1),a}function ld(a,b,c){return a._prices[272*c+b]}function md(a,b){var c;for(c=0;b>c;++c)gd(a,c,a._tableSize,a._prices,272*c),a._counters[c]=a._tableSize}function nd(){return Rf}function od(){}function pd(a,b,c){var d,e;if(null==a.m_Coders||a.m_NumPrevBits!=c||a.m_NumPosBits!=b)for(a.m_NumPosBits=b,a.m_PosMask=(1<<b)-1,a.m_NumPrevBits=c,e=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=s(Nf,0,5,e,0),d=0;e>d;++d)a.m_Coders[d]=wd(new zd)}function qd(a,b,c){return a.m_Coders[((b&a.m_PosMask)<<a.m_NumPrevBits)+((255&c)>>>8-a.m_NumPrevBits)]}function rd(a){var b,c;for(c=1<<a.m_NumPrevBits+a.m_NumPosBits,b=0;c>b;++b)fe(a.m_Coders[b].m_Encoders)}function sd(){return Of}function td(){}function ud(a,b,c){var d,e,f;for(e=1,f=7;f>=0;--f)d=c>>f&1,$d(b,a.m_Encoders,e,d),e=e<<1|d}function vd(a,b,c,d){var e,f,g,h,i,j;for(f=1,i=!0,g=7;g>=0;--g)e=d>>g&1,j=f,i&&(h=c>>g&1,j+=1+h<<8,i=h==e),$d(b,a.m_Encoders,j,e),f=f<<1|e}function wd(a){return a.m_Encoders=s(Bf,0,-1,768,1),a}function xd(a,b,c,d){var e,f,g,h,i;if(i=0,f=1,g=7,b)for(;g>=0;--g)if(h=c>>g&1,e=d>>g&1,i+=ee(a.m_Encoders[(1+h<<8)+f],e),f=f<<1|e,h!=e){--g;break}for(;g>=0;--g)e=d>>g&1,i+=ee(a.m_Encoders[f],e),f=f<<1|e;return i}function yd(){return Pf}function zd(){}function Ad(a){a.BackPrev=-1,a.Prev1IsChar=!1}function Bd(a){a.BackPrev=0,a.Prev1IsChar=!1}function Cd(){return Sf}function Dd(){}function Ed(a,b){return a.NumBitLevels=b,a.Models=s(Bf,0,-1,1<<b,1),a}function Fd(a,b){var c,d;for(d=1,c=a.NumBitLevels;0!=c;--c)d=(d<<1)+Td(b,a.Models,d);return d-(1<<a.NumBitLevels)}function Gd(a,b){var c,d,e,f;for(e=1,f=0,d=0;d<a.NumBitLevels;++d)c=Td(b,a.Models,e),e<<=1,e+=c,f|=c<<d;return f}function Hd(a,b,c,d){var e,f,g,h;for(g=1,h=0,f=0;d>f;++f)e=Td(c,a,b+g),g<<=1,g+=e,h|=e<<f;return h}function Id(){return Tf}function Jd(){}function Kd(a,b){return a.NumBitLevels=b,a.Models=s(Bf,0,-1,1<<b,1),a}function Ld(a,b,c){var d,e,f;for(f=1,e=a.NumBitLevels;0!=e;)--e,d=c>>>e&1,$d(b,a.Models,f,d),f=f<<1|d}function Md(a,b){var c,d,e,f;for(f=0,e=1,d=a.NumBitLevels;0!=d;)--d,c=b>>>d&1,f+=ee(a.Models[e],c),e=(e<<1)+c;return f}function Nd(a,b,c){var d,e,f;for(f=1,e=0;e<a.NumBitLevels;++e)d=1&c,$d(b,a.Models,f,d),f=f<<1|d,c>>=1}function Od(a,b){var c,d,e,f;for(f=0,e=1,d=a.NumBitLevels;0!=d;--d)c=1&b,b>>>=1,f+=ee(a.Models[e],c),e=e<<1|c;return f}function Pd(a,b,c,d,e){var f,g,h;for(h=1,g=0;d>g;++g)f=1&e,$d(c,a,b+h,f),h=h<<1|f,e>>=1}function Qd(a,b,c,d){var e,f,g,h;for(h=0,g=1,f=c;0!=f;--f)e=1&d,d>>>=1,Zd(),h+=Xe[(2047&(a[b+g]-e^-e))>>>2],g=g<<1|e;return h}function Rd(){return Uf}function Sd(){}function Td(a,b,c){var d,e;return e=b[c],d=(a.Range>>>11)*e,(-2147483648^a.Code)<(-2147483648^d)?(a.Range=d,b[c]=e+(2048-e>>>5)<<16>>16,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|ga(a.Stream),a.Range<<=8),0):(a.Range-=d,a.Code-=d,b[c]=e-(e>>>5)<<16>>16,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|ga(a.Stream),a.Range<<=8),1)}function Ud(a,b){var c,d,e;for(d=0,c=b;0!=c;--c)a.Range>>>=1,e=a.Code-a.Range>>>31,a.Code-=a.Range&e-1,d=d<<1|1-e,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|ga(a.Stream),a.Range<<=8);return d}function Vd(a){var b;for(a.Code=0,a.Range=-1,b=0;5>b;++b)a.Code=a.Code<<8|ga(a.Stream)}function Wd(a){var b;for(b=0;b<a.length;++b)a[b]=1024}function Xd(){return Vf}function Yd(){}function Zd(){Zd=se;var a,b,c,d;for(Xe=s(tf,0,-1,512,1),b=8;b>=0;--b)for(d=1<<9-b-1,a=1<<9-b,c=d;a>c;++c)Xe[c]=(b<<6)+(a-c<<6>>>9-b-1)}function $d(a,b,c,d){var e,f;f=b[c],e=(a.Range>>>11)*f,0==d?(a.Range=e,b[c]=f+(2048-f>>>5)<<16>>16):(a.Low=F(a.Low,H(N(e),He)),a.Range-=e,b[c]=f-(f>>>5)<<16>>16),0==(-16777216&a.Range)&&(a.Range<<=8,de(a))}function _d(a,b,c){var d;for(d=c-1;d>=0;--d)a.Range>>>=1,1==(b>>>d&1)&&(a.Low=F(a.Low,N(a.Range))),0==(-16777216&a.Range)&&(a.Range<<=8,de(a))}function ae(a){var b;for(b=0;5>b;++b)de(a)}function be(a){return F(F(N(a._cacheSize),a._position),Ce)}function ce(a){a._position=Ae,a.Low=Ae,a.Range=-1,a._cacheSize=1,a._cache=0}function de(a){var b,c;if(b=P(X(a.Low,32)),0!=b||I(a.Low,Ge)<0){a._position=F(a._position,N(a._cacheSize)),c=a._cache;do pa(a.Stream,c+b),c=255;while(0!=--a._cacheSize);a._cache=P(a.Low)>>>24}++a._cacheSize,a.Low=V(H(a.Low,Ee),8)}function ee(a,b){return Zd(),Xe[(2047&(a-b^-b))>>>2]}function fe(a){Zd();var b;for(b=0;b<a.length;++b)a[b]=1024}function ge(){return Wf}function he(){}function ie(a){var b,c,d,e,f;for(b=Za(new _a),c=0;c<a.length;++c)if(d=255&a[c],0==(128&d)){if(0==d)throw La(new Na,"invalid UTF-8");o(b.data,String.fromCharCode(65535&d))}else if(192==(224&d)){if(c+1>=a.length)throw La(new Na,"invalid UTF-8");if(e=255&a[++c],128!=(192&e))throw La(new Na,"invalid UTF-8");n(b.data,String.fromCharCode((31&d)<<6&65535|63&e))}else{if(224!=(240&d))throw La(new Na,"invalid UTF-8");if(c+2>=a.length)throw La(new Na,"invalid UTF-8");if(e=255&a[++c],128!=(192&e))throw La(new Na,"invalid UTF-8");if(f=255&a[++c],128!=(192&f))throw La(new Na,"invalid UTF-8");o(b.data,String.fromCharCode(65535&((15&d)<<12|(63&e)<<6|63&f)))}return p(b.data)}function je(a){var b,c,d,e,f,g,h;for(h=a.length,g=s(nf,0,-1,h,1),Xa(a,0,h,g,0),c=g,e=0,f=0;f<a.length;++f)b=c[f],b>=1&&127>=b?++e:e+=0==b||b>=128&&2047>=b?2:3;for(d=s(ff,0,-1,e,1),e=0,f=0;f<a.length;++f)b=c[f],b>=1&&127>=b?d[e++]=b<<24>>24:0==b||b>=128&&2047>=b?(d[e++]=(192|b>>6&31)<<24>>24,
d[e++]=(128|63&b)<<24>>24):(d[e++]=(224|b>>12&15)<<24>>24,d[e++]=(128|b>>6&63)<<24>>24,d[e++]=(128|63&b)<<24>>24);return d}function ke(a){return a}function le(a){return a[1]+a[0]}function me(){function b(){var i;for(d=(new Date).getTime();eb(h.c);)if(c=le(h.c.chunker.inBytesProcessed)/le(h.c.length_0),(new Date).getTime()-d>200)return g?g(c):"undefined"!=typeof e&&a(c,e),setTimeout(b,0),!1;g?g(1):"undefined"!=typeof e&&a(1,e),i=oa(h.c.output).slice(0),f?f(i):"undefined"!=typeof e&&postMessage({action:we,callback_num:e,result:i})}var c,d,e,f,g,h=ke(new pe),i=arguments[0],j=arguments[1];"function"==typeof arguments[2]?(f=arguments[2],"function"==typeof arguments[3]&&(g=arguments[3])):e=arguments[2],h.mode=bg(j),h.c=ib(new kb,je(i),h.mode),g?g(0):"undefined"!=typeof e&&a(0,e),setTimeout(b,1)}function ne(){function b(){var d;for(e=(new Date).getTime();lb(i.d);)if(c=le(i.d.chunker.decoder.nowPos64)/le(i.d.length_0),(new Date).getTime()-e>200)return h?h(c):"undefined"!=typeof f&&a(c,f),setTimeout(b,0),!1;h?h(1):"undefined"!=typeof f&&a(1,f),d=ie(oa(i.d.output)),g?g(d):"undefined"!=typeof f&&postMessage({action:xe,callback_num:f,result:d})}var c,d,e,f,g,h,i=ke(new pe),j=arguments[0];"function"==typeof arguments[1]?(g=arguments[1],"function"==typeof arguments[2]&&(h=arguments[2])):f=arguments[1],d=t(ff,0,-1,j),i.d=pb(new rb,d),h?h(0):"undefined"!=typeof f&&a(0,f),setTimeout(b,0)}function oe(){return ag}function pe(){}function qe(){!!$stats&&$stats({moduleName:te,subSystem:"startup",evtGroup:"moduleStartup",millis:(new Date).getTime(),type:"onModuleLoadStart",className:"org.dellroad.lzma.demo.client.LZMADemo"})}function re(a,b,c){if(te=b,ue=c,a)try{qe()}catch(d){a(b)}else qe()}function se(){}var te,ue,ve,we=1,xe=2,ye=[0,-0x8000000000000000],ze=[4294967295,-4294967296],Ae=[0,0],Be=[1,0],Ce=[4,0],De=[4096,0],Ee=[16777215,0],Fe=[16777216,0],Ge=[4278190080,0],He=[4294967295,0],Ie=[4294967295,0x7fffffff00000000];ve=c.prototype={},ve.getClass$=b,ve.typeMarker$=se,ve.typeId$=1,ve=e.prototype=new c,ve.getClass$=d,ve.typeId$=3,ve.detailMessage=null,ve=g.prototype=new e,ve.getClass$=f,ve.typeId$=4,ve=j.prototype=new g,ve.getClass$=i,ve.typeId$=5,ve=m.prototype=new j,ve.getClass$=l,ve.typeId$=6,ve=v.prototype=new c,ve.getClass$=r,ve.typeId$=0,ve.arrayClass$=null,ve.length=0,ve.queryId$=0;var Je,Ke,Le,Me,Ne,Oe,Pe,Qe,Re,Se,Te,Ue=[{},{},{1:1},{2:1},{2:1},{2:1},{2:1},{2:1,10:1},{2:1},{2:1},{2:1},{2:1},{2:1},{2:1,11:1},{2:1},{2:1},{2:1},{4:1},{5:1},{6:1},{7:1},{8:1},{9:1}];ve=da.prototype=new c,ve.getClass$=ca,ve.typeId$=0,ve=ja.prototype=new da,ve.getClass$=ia,ve.typeId$=0,ve.buf=null,ve.count=0,ve.pos=0,ve=la.prototype=new c,ve.getClass$=ka,ve.typeId$=0,ve=sa.prototype=new la,ve.getClass$=ra,ve.typeId$=0,ve.buf=null,ve.count=0,ve=va.prototype=new g,ve.getClass$=ua,ve.typeId$=7,ve=ya.prototype=new j,ve.getClass$=xa,ve.typeId$=8,ve=Ba.prototype=new j,ve.getClass$=Aa,ve.typeId$=9,ve=Ga.prototype=new c,ve.getClass$=Fa,ve.typeId$=0,ve.typeName=null,ve=Ia.prototype=new j,ve.getClass$=Ha,ve.typeId$=12,ve=Ka.prototype=new c,ve.getClass$=Ja,ve.typeId$=0,ve=Na.prototype=new j,ve.getClass$=Ma,ve.typeId$=13,ve=Pa.prototype=new j,ve.getClass$=Oa,ve.typeId$=14,ve=Ra.prototype=new j,ve.getClass$=Qa,ve.typeId$=15,ve=Va.prototype=new j,ve.getClass$=Ua,ve.typeId$=16,ve=String.prototype,ve.getClass$=Ya,ve.typeId$=2,ve=_a.prototype=new c,ve.getClass$=$a,ve.typeId$=0,ve=db.prototype=new Ka,ve.getClass$=cb,ve.typeId$=0,ve.dictionarySize=0,ve.fb=0,ve.lc=0,ve.lp=0,ve.matchFinder=0,ve.pb=0,ve=hb.prototype=new c,ve.getClass$=gb,ve.typeId$=0,ve.chunker=null,ve=kb.prototype=new hb,ve.getClass$=jb,ve.typeId$=0,ve.output=null,ve=ob.prototype=new c,ve.getClass$=nb,ve.typeId$=0,ve.chunker=null,ve.exception=null,ve.length_0=Ae,ve=rb.prototype=new ob,ve.getClass$=qb,ve.typeId$=0,ve.output=null,ve=Bb.prototype=new c,ve.getClass$=Ab,ve.typeId$=0,ve._blockSize=0,ve._bufferBase=null,ve._bufferOffset=0,ve._keepSizeAfter=0,ve._keepSizeBefore=0,ve._pointerToLastSafePosition=0,ve._pos=0,ve._posLimit=0,ve._stream=null,ve._streamEndWasReached=!1,ve._streamPos=0,ve=Lb.prototype=new Bb,ve.getClass$=Kb,ve.typeId$=0,ve.HASH_ARRAY=!0,ve._cutValue=255,ve._cyclicBufferPos=0,ve._cyclicBufferSize=0,ve._hash=null,ve._hashMask=0,ve._hashSizeSum=0,ve._matchMaxLen=0,ve._son=null,ve.kFixHashSize=66560,ve.kMinMatchCheck=4,ve.kNumHashDirectBytes=0;var Ve;ve=Vb.prototype=new c,ve.getClass$=Ub,ve.typeId$=0,ve._buffer=null,ve._pos=0,ve._stream=null,ve._streamPos=0,ve._windowSize=0,ve=cc.prototype=new c,ve.getClass$=bc,ve.typeId$=0,ve.alive=!1,ve.decoder=null,ve.encoder=null,ve=mc.prototype=new c,ve.getClass$=lc,ve.typeId$=0,ve.m_DictionarySize=-1,ve.m_DictionarySizeCheck=-1,ve.m_PosStateMask=0,ve.nowPos64=Ae,ve.outSize=Ae,ve.prevByte=0,ve.rep0=0,ve.rep1=0,ve.rep2=0,ve.rep3=0,ve.state=0,ve=sc.prototype=new c,ve.getClass$=rc,ve.typeId$=0,ve.m_NumPosStates=0,ve=xc.prototype=new c,ve.getClass$=wc,ve.typeId$=0,ve.m_Coders=null,ve.m_NumPosBits=0,ve.m_NumPrevBits=0,ve.m_PosMask=0,ve=Cc.prototype=new c,ve.getClass$=Bc,ve.typeId$=17,ve=cd.prototype=new c,ve.getClass$=bd,ve.typeId$=0,ve._additionalOffset=0,ve._alignPriceCount=0,ve._dictionarySize=4194304,ve._dictionarySizePrev=-1,ve._distTableSize=44,ve._finished=!1,ve._inStream=null,ve._longestMatchLength=0,ve._longestMatchWasFound=!1,ve._matchFinder=null,ve._matchFinderType=1,ve._matchPriceCount=0,ve._needReleaseMFStream=!1,ve._numDistancePairs=0,ve._numFastBytes=32,ve._numFastBytesPrev=-1,ve._numLiteralContextBits=3,ve._numLiteralPosStateBits=0,ve._optimumCurrentIndex=0,ve._optimumEndIndex=0,ve._posStateBits=2,ve._posStateMask=3,ve._previousByte=0,ve._state=0,ve._writeEndMark=!1,ve.backRes=0,ve.nowPos64=Ae;var We;ve=id.prototype=new c,ve.getClass$=hd,ve.typeId$=0,ve=od.prototype=new id,ve.getClass$=nd,ve.typeId$=0,ve._tableSize=0,ve=td.prototype=new c,ve.getClass$=sd,ve.typeId$=0,ve.m_Coders=null,ve.m_NumPosBits=0,ve.m_NumPrevBits=0,ve.m_PosMask=0,ve=zd.prototype=new c,ve.getClass$=yd,ve.typeId$=18,ve=Dd.prototype=new c,ve.getClass$=Cd,ve.typeId$=19,ve.BackPrev=0,ve.BackPrev2=0,ve.Backs0=0,ve.Backs1=0,ve.Backs2=0,ve.Backs3=0,ve.PosPrev=0,ve.PosPrev2=0,ve.Prev1IsChar=!1,ve.Prev2=!1,ve.Price=0,ve.State=0,ve=Jd.prototype=new c,ve.getClass$=Id,ve.typeId$=20,ve.Models=null,ve.NumBitLevels=0,ve=Sd.prototype=new c,ve.getClass$=Rd,ve.typeId$=21,ve.Models=null,ve.NumBitLevels=0,ve=Yd.prototype=new c,ve.getClass$=Xd,ve.typeId$=0,ve.Code=0,ve.Range=0,ve.Stream=null,ve=he.prototype=new c,ve.getClass$=ge,ve.typeId$=0,ve.Low=Ae,ve.Range=0,ve.Stream=null,ve._cache=0,ve._cacheSize=0,ve._position=Ae;var Xe;ve=pe.prototype=new c,ve.getClass$=oe,ve.typeId$=0,ve.c=null,ve.d=null;var Ye=Da("java.lang.","Object"),Ze=Da("java.lang.","Throwable"),$e=Da("java.lang.","Exception"),_e=Da("java.lang.","RuntimeException"),af=Da("com.google.gwt.core.client.","JavaScriptException"),bf=Da("com.google.gwt.core.client.","JavaScriptObject$"),cf=Ca("","[[D"),df=Da("java.io.","InputStream"),ef=Da("java.io.","ByteArrayInputStream"),ff=Ca("","[B"),gf=Da("java.io.","OutputStream"),hf=Da("java.io.","ByteArrayOutputStream"),jf=Da("java.io.","IOException"),kf=Da("java.lang.","Enum"),lf=Da("java.lang.","ArithmeticException"),mf=Da("java.lang.","ArrayStoreException"),nf=Ca("","[C"),of=Da("java.lang.","Class"),pf=Da("java.lang.","ClassCastException"),qf=Da("java.lang.","IllegalArgumentException"),rf=Da("java.lang.","IllegalStateException"),sf=Da("java.lang.","IndexOutOfBoundsException"),tf=Ca("","[I"),uf=Da("java.lang.","NullPointerException"),vf=Da("java.lang.","String"),wf=Da("java.lang.","StringBuilder"),xf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZ.","InWindow"),yf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZ.","BinTree"),zf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZ.","OutWindow"),Af=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Chunker"),Bf=Ca("","[S"),Cf=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeDecoder;"),Df=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder"),Ef=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LenDecoder"),Ff=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder$Decoder2;"),Gf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder"),Hf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder$Decoder2"),If=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$Optimal;"),Jf=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeEncoder;"),Kf=Ca("","[J"),Lf=Ca("","[Z"),Mf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder"),Nf=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder$Encoder2;"),Of=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder"),Pf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder$Encoder2"),Qf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LenEncoder"),Rf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LenPriceTableEncoder"),Sf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$Optimal"),Tf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeDecoder"),Uf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeEncoder"),Vf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","Decoder"),Wf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","Encoder"),Xf=Ea("org.dellroad.lzma.client.","CompressionMode"),Yf=Da("org.dellroad.lzma.client.","LZMACompressor"),Zf=Da("org.dellroad.lzma.client.","LZMAByteArrayCompressor"),$f=Da("org.dellroad.lzma.client.","LZMADecompressor"),_f=Da("org.dellroad.lzma.client.","LZMAByteArrayDecompressor"),ag=Da("org.dellroad.lzma.demo.client.","LZMADemo");re(function(){},"lzma_demo","");var bg=function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}var b=[{dictionarySize:16,fb:64,matchFinder:0,lc:3,lp:0,pb:2},{dictionarySize:20,fb:64,matchFinder:0,lc:3,lp:0,pb:2},{dictionarySize:19,fb:64,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:20,fb:64,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:21,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:22,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:23,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:24,fb:255,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:25,fb:255,matchFinder:1,lc:3,lp:0,pb:2}];return function(c){return a(c)?1>c?c=1:c>9&&(c=9):c=1,b[c-1]}}();return{compress:me,decompress:ne}}();this.LZMA=f,e("undefined"!=typeof f?f:window.LZMA)}).call(a,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],432:[function(a,b,c){(function(c){jQuery=c.jQuery=a("jquery");(function(a,b,c){!function(a){function b(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=0,g=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),g=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(g=0,f=-1*e),void 0!==c.wheelDeltaY&&(g=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120),d.unshift(b,e,f,g),(a.event.dispatch||a.event.handle).apply(this,d)}var c=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var d=c.length;d;)a.event.fixHooks[c[--d]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=c.length;a;)this.addEventListener(c[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=c.length;a;)this.removeEventListener(c[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery)}).call(c,b,void 0,void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:"jquery"}],433:[function(a,b,c){(function(c){jQuery=c.jQuery=a("jquery");(function(a,b,c){!function(a){function b(){this===e.elem&&(e.pos=[-260,-260],e.elem=!1,f=3)}var c,d,e={pos:[-260,-260]},f=3,g=document,h=g.documentElement,i=g.body;a.event.special.mwheelIntent={setup:function(){var c=a(this).on("mousewheel",a.event.special.mwheelIntent.handler);return this!==g&&this!==h&&this!==i&&c.on("mouseleave",b),c=null,!0},teardown:function(){return a(this).off("mousewheel",a.event.special.mwheelIntent.handler).off("mouseleave",b),!0},handler:function(b,g){var h=[b.clientX,b.clientY];return this===e.elem||Math.abs(e.pos[0]-h[0])>f||Math.abs(e.pos[1]-h[1])>f?(e.elem=this,e.pos=h,f=250,clearTimeout(d),d=setTimeout(function(){f=10},200),clearTimeout(c),c=setTimeout(function(){f=3},1500),b=a.extend({},b,{type:"mwheelIntent"}),a.event.dispatch.apply(this,arguments)):void 0}},a.fn.extend({mwheelIntent:function(a){return a?this.on("mwheelIntent",a):this.trigger("mwheelIntent")},unmwheelIntent:function(a){return this.off("mwheelIntent",a)}}),a(function(){i=g.body,a(g).on("mwheelIntent.mwheelIntentDefault",a.noop)})}(jQuery)}).call(c,b,void 0,void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:"jquery"}],434:[function(require,module,exports){(function(global){var __browserify_shim_require__=require;(function browserifyShim(module,exports,require,define,browserify_shim__define__module__export__){!function(a,b,c){b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l=document||{},m=l.documentElement||{},n=m[h],o=n?h:i,p=Array.prototype.slice,q=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,r=/mouse.*(wheel|scroll)/i,s=/^text/i,t=/^touch|^gesture/i,u={one:1},v=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(n?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend MSPointerUp MSPointerDown MSPointerCancel MSPointerMove MSPointerOver MSPointerOut pointerup pointerdown pointermove pointercancelmessage readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),w=function(){function a(a,b){for(;null!==(b=b.parentNode);)if(b===a)return!0;return!1}function b(b){var c=b.relatedTarget;return c?c!==this&&"xul"!==c.prefix&&!/document/.test(this.toString())&&!a(this,c):null===c}return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=b.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),d=a.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),f=a.concat(["data"]),g=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),h="preventDefault",i=function(a){return function(){a[h]?a[h]():a.returnValue=!1}},j="stopPropagation",k=function(a){return function(){a[j]?a[j]():a.cancelBubble=!0}},n=function(a){return function(){a[h](),a[j](),a.stopped=!0}},o=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(p,u){var v={originalEvent:p,isNative:u};if(!p)return v;var w,x=p.type,y=p.target||p.srcElement;return v[h]=i(p),v[j]=k(p),v.stop=n(v),v.target=y&&3===y.nodeType?y.parentNode:y,u&&(-1!==x.indexOf("key")?(w=d,v.keyCode=p.which||p.keyCode):q.test(x)?(w=b,v.rightClick=3===p.which||2===p.button,v.pos={x:0,y:0},p.pageX||p.pageY?(v.clientX=p.pageX,v.clientY=p.pageY):(p.clientX||p.clientY)&&(v.clientX=p.clientX+l.body.scrollLeft+m.scrollLeft,v.clientY=p.clientY+l.body.scrollTop+m.scrollTop),e.test(x)&&(v.relatedTarget=p.relatedTarget||p[("mouseover"===x?"from":"to")+"Element"])):t.test(x)?w=g:r.test(x)?w=c:s.test(x)&&(w=f),o(p,v,w||a)),v}}(),y=function(a,b){return n||b||a!==l&&a!==c?a:m},z=function(){function a(a,b,c,d,e){this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=w[b],this.isNative=v[b]&&a[o],this.eventType=n||this.isNative?b:"propertychange",this.customType=!n&&!this.isNative&&b,this.target=y(a,this.isNative),this.eventSupport=this.target[o]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return!(this.element!==a||b&&this.original!==b||c&&this.handler!==c)}},a}(),A=function(){var a={},b=function(c,d,e,f,g){if(d&&"*"!==d){var h,i=0,j=a["$"+d],k="*"===c;if(!j)return;for(h=j.length;h>i;i++)if((k||j[i].matches(c,e,f))&&!g(j[i],j,i,d))return}else for(var l in a)"$"===l.charAt(0)&&b(c,l.substr(1),e,f,g)},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),0===c.length&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)"$"===b.charAt(0)&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),B=n?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&null===a["_on"+e]&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},C=function(a,b,d){return function(e){return e=x(e||((this.ownerDocument||this.document||this).parentWindow||c).event,!0),b.apply(a,[e].concat(d))}},D=function(a,b,d,e,f,g){return function(h){(e?e.apply(this,arguments):n?!0:h&&h.propertyName==="_on"+d||!h)&&(h&&(h=x(h||((this.ownerDocument||this.document||this).parentWindow||c).event,g)),b.apply(a,!h||f&&0!==f.length?p.call(arguments,h?0:1).concat(f):arguments))}},E=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},F=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=A.get(a,i,c);for(e=0,f=j.length;f>e;e++)j[e].inNamespaces(d)&&((h=j[e]).eventSupport&&B(h.target,h.eventType,h.handler,!1,h.type),A.del(h))},G=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");return A.has(a,i,c)?a:("unload"===i&&(c=E(F,a,i,c,d)),w[i]&&(w[i].condition&&(c=D(a,c,i,w[i].condition,!0)),i=w[i].base||i),h=A.put(new z(a,i,c,d,j[0]&&j)),h.handler=h.isNative?C(a,h.handler,e):D(a,h.handler,i,!1,e,!1),void(h.eventSupport&&B(h.target,h.eventType,h.handler,!0,h.customType)))},H=function(a,b,c){return function(d){var e,f,g="string"==typeof a?c(a,this):a;for(e=d.target;e&&e!==this;e=e.parentNode)for(f=g.length;f--;)if(g[f]===e)return b.apply(e,arguments)}},I=function(a,b,c){var d,e,h,i,j=F,k=b&&"string"==typeof b;if(k&&b.indexOf(" ")>0){for(b=b.split(" "),i=b.length;i--;)I(a,b[i],c);return a}if(e=k&&b.replace(g,""),e&&w[e]&&(e=w[e].type),!b||k)(h=k&&b.replace(f,""))&&(h=h.split(".")),j(a,e,c,h);else if("function"==typeof b)j(a,null,b);else for(d in b)b.hasOwnProperty(d)&&I(a,d,b[d]);return a},J=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&"string"==typeof c;if(b&&!c&&"object"==typeof b)for(f in b)b.hasOwnProperty(f)&&J.apply(this,[a,f,b[f]]);else for(i=arguments.length>3?p.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=H(b,j=d,e))&&(i=p.call(i,1)),this===u&&(c=E(I,a,b,c,j)),h=g.length;h--;)G(a,g[h],c,j,i);return a},K=function(){return J.apply(u,arguments)},L=n?function(a,b,d){var e=l.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=y(c,a),a?c.fireEvent("on"+b,l.createEventObject()):c["_on"+b]++},M=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;)if(b=k[d].replace(g,""),(i=k[d].replace(f,""))&&(i=i.split(".")),i||c||!a[o])for(j=A.get(a,b),c=[!1].concat(c),e=0,h=j.length;h>e;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c);else L(v[b],b,a);return a},N=function(a,b,c){for(var d=0,e=A.get(b,c),f=e.length;f>d;d++)e[d].original&&J(a,e[d].type,e[d].original);return a},O={add:J,one:K,remove:I,clone:N,fire:M,noConflict:function(){return b[a]=d,this}};if(c[i]){var P=function(){var a,b=A.entries();for(a in b)b[a].type&&"unload"!==b[a].type&&I(b[a].element,b[a].type);c[k]("onunload",P),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",P)}return O});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(a){function b(a){if(a=k(a),l.hasOwnProperty(a))return l[a];var b=a.match(n);return b?String.fromCharCode(parseInt(b[1],10)):(b=a.match(o))?String.fromCharCode(parseInt(b[1],16)):""}function c(a,c){return b(c)}function d(a){return a.replace(p,"")}function e(a){return a.replace(q,c)}function f(a){return a.replace(r,"&amp;").replace(t,"&lt;").replace(u,"&gt;").replace(v,"&#34;").replace(w,"&#61;")}function g(a){return a.replace(s,"&amp;$1").replace(t,"&lt;").replace(u,"&gt;")}function h(b){return function(c,f){c=String(c);var h=null,i=!1,j=[],l=void 0,m=void 0,n=void 0;for(b.startDoc&&b.startDoc(f);c;){var o=c.match(i?x:y);if(c=c.substring(o[0].length),i){if(o[1]){var p,q=k(o[1]);if(o[2]){var r=o[3];switch(r.charCodeAt(0)){case 34:case 39:r=r.substring(1,r.length-1)}p=e(d(r))}else p=q;j.push(q,p)}else if(o[4]){if(void 0!==m&&(n?b.startTag&&b.startTag(l,j,f):b.endTag&&b.endTag(l,f)),n&&m&(a.eflags.CDATA|a.eflags.RCDATA)){h=null===h?k(c):h.substring(h.length-c.length);var s=h.indexOf("</"+l);0>s&&(s=c.length),s&&(m&a.eflags.CDATA?b.cdata&&b.cdata(c.substring(0,s),f):b.rcdata&&b.rcdata(g(c.substring(0,s)),f),c=c.substring(s))}l=m=n=void 0,j.length=0,i=!1}}else if(o[1])b.pcdata&&b.pcdata(o[0],f);else if(o[3])n=!o[2],i=!0,l=k(o[3]),m=a.ELEMENTS.hasOwnProperty(l)?a.ELEMENTS[l]:void 0;else if(o[4])b.pcdata&&b.pcdata(o[4],f);else if(o[5]&&b.pcdata){var t=o[5];b.pcdata("<"===t?"&lt;":">"===t?"&gt;":"&amp;",f)}}b.endDoc&&b.endDoc(f)}}function i(b){var c,d;return h({startDoc:function(a){c=[],d=!1},startTag:function(e,g,h){if(!d&&a.ELEMENTS.hasOwnProperty(e)){var i=a.ELEMENTS[e];if(!(i&a.eflags.FOLDABLE)){if(i&a.eflags.UNSAFE)return void(d=!(i&a.eflags.EMPTY));if(g=b(e,g)){i&a.eflags.EMPTY||c.push(e),h.push("<",e);for(var j=0,k=g.length;k>j;j+=2){var l=g[j],m=g[j+1];null!==m&&void 0!==m&&h.push(" ",l,'="',f(m),'"')}h.push(">")}}}},endTag:function(b,e){if(d)return void(d=!1);if(a.ELEMENTS.hasOwnProperty(b)){var f=a.ELEMENTS[b];if(!(f&(a.eflags.UNSAFE|a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0&&c[g]!==b;);if(0>g)return;for(var i=c.length;--i>g;){var h=c[i];a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||e.push("</",h,">")}c.length=g,e.push("</",b,">")}}},pcdata:function(a,b){d||b.push(a)},rcdata:function(a,b){d||b.push(a)},cdata:function(a,b){d||b.push(a)},endDoc:function(a){for(var b=c.length;--b>=0;)a.push("</",c[b],">");c.length=0}})}function j(b,c,d){var e=[];return i(function(b,e){for(var f=0;f<e.length;f+=2){var g,h=e[f],i=e[f+1],j=null;if(g=b+"::"+h,(a.ATTRIBS.hasOwnProperty(g)||(g="*::"+h,a.ATTRIBS.hasOwnProperty(g)))&&(j=a.ATTRIBS[g]),null!==j)switch(j){case a.atype.NONE:break;case a.atype.SCRIPT:case a.atype.STYLE:i=null;break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:i=d?d(i):i;break;case a.atype.URI:var k=(""+i).match(z);i=k&&(!k[1]||m.test(k[1]))?c&&c(i):null;break;case a.atype.URI_FRAGMENT:i&&"#"===i.charAt(0)?(i=d?d(i):i,i&&(i="#"+i)):i=null;break;default:i=null}else i=null;e[f+1]=i}return e})(b,e),e.join("")}var k;k="script"==="SCRIPT".toLowerCase()?function(a){return a.toLowerCase()}:function(a){return a.replace(/[A-Z]/g,function(a){return String.fromCharCode(32|a.charCodeAt(0))})};var l={lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',apos:"'"},m=/^(?:https?|mailto|data)$/i,n=/^#(\d+)$/,o=/^#x([0-9A-Fa-f]+)$/,p=/\0/g,q=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,r=/&/g,s=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,t=/</g,u=/>/g,v=/\"/g,w=/\=/g,x=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),y=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),z=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:f,makeHtmlSanitizer:i,makeSaxParser:h,normalizeRCData:g,sanitize:j,unescapeEntities:e}}(html4),html_sanitize=html.sanitize;"undefined"!=typeof window&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0,function(a,b,c){b[a]=c()}("reqwest",this,function(){function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,twoHundo.test(a.request.status)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");
return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript","undefined"==typeof j.onreadystatechange||l||(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},j.src=d,j.async=!0,head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,a.error&&a.error({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=xhr(),c.open(e,f,!0),setHeaders(c,d),setCredentials(c,d),c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);self._fulfillmentHandlers.length>0;)self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(a,b,c){for(self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return this._fulfilled?a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b,c,d,e="",f=encodeURIComponent,g=function(a,b){e+=f(a)+"="+f(b)+"&"};if(isArray(a))for(b=0;a&&b<a.length;b++)g(a[b].name,a[b].value);else for(c in a)if(Object.hasOwnProperty.call(a,c))if(d=a[c],isArray(d))for(b=0;b<d.length;b++)g(c,d[b]);else g(c,a[c]);return e.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest}),wax=wax||{},wax.attribution=function(){var a={},b=document.createElement("div");return b.className="map-attribution",a.content=function(a){return"undefined"==typeof a?b.innerHTML:(b.innerHTML=wax.u.sanitize(a),this)},a.element=function(){return b},a.init=function(){return this},a},wax=wax||{},wax.bwdetect=function(a,b){function c(){wax.bw=-1;var a=new Image;a.src=f;var b=!0,c=setTimeout(function(){b&&-1==wax.bw&&(d.bw(0),b=!1)},e);a.onload=function(){b&&-1==wax.bw&&(clearTimeout(c),d.bw(1),b=!1)}}var d={},e=a.threshold||400,f="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +new Date,g=1,h=void 0===a.auto?!0:a.auto;return d.bw=function(a){if(!arguments.length)return g;wax.bwlisteners&&wax.bwlisteners.length&&function(){for(listeners=wax.bwlisteners,wax.bwlisteners=[],i=0;i<listeners;i++)listeners[i](a)}(),wax.bw=a,g!=(g=a)&&b(a)},d.add=function(){return h&&c(),this},-1==wax.bw?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(d.bw)):void 0!==wax.bw?d.bw(wax.bw):d.add(),d},wax.formatter=function(x){var formatter={},f;if(x&&"string"==typeof x)try{eval("f = "+x)}catch(e){console&&console.log(e)}else f=x&&"function"==typeof x?x:function(){};return formatter.format=function(a,b){try{return wax.u.sanitize(f(a,b))}catch(c){console&&console.log(c)}},formatter},wax.gi=function(a,b){function c(a){return a>=93&&a--,a>=35&&a--,a-=32}b=b||{};var d={},e=b.resolution||4,f=b.tileSize||256;return d.grid_tile=function(){return a},d.getKey=function(b,d){return a&&a.grid&&!(0>d||0>b||Math.floor(d)>=f||Math.floor(b)>=f)?c(a.grid[Math.floor(d/e)].charCodeAt(Math.floor(b/e))):void 0},d.gridFeature=function(b,c){var d=this.getKey(b,c),e=a.keys;return e&&e[d]&&a.data[e[d]]?a.data[e[d]]:void 0},d.tileFeature=function(b,c,d){if(a){var e=wax.u.offset(d);return feature=this.gridFeature(b-e.left,c-e.top),feature}},d},wax.gm=function(){function a(a){return"string"==typeof a&&(a=[a]),function(b){if(b){var c=new RegExp(e.tileRegexp()),d=c.exec(b);if(d)return a[parseInt(d[2],10)%a.length].replace(/\{z\}/g,d[1]).replace(/\{x\}/g,d[2]).replace(/\{y\}/g,d[3])}}}var b,c,d=4,e={},f=function(a){return a?a.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json"):void 0};return e.tileRegexp=function(){var a=b.tiles[0],c=a.indexOf("?");-1!==c&&(a=a.substr(0,c)),a=a.replace(/[\(\)\?\$\*\+\^]/g,"."),0===a.indexOf("https")?a=a.replace(":443","[:0-9]*"):0===a.indexOf("http")&&(a=a.replace(":80","[:0-9]*"));var d="";if(b.tiles.length>1)for(var e=b.tiles[0],f=b.tiles[1],g=0;g<e.length;++g)d+=e.charAt(g)!=f.charAt(g)?".":a.charAt(g)||"";else d=a;return d.replace(/\{x\}/,"(\\d+)").replace(/\{y\}/,"(\\d+)").replace(/\{z\}/,"(\\d+)")},e.formatter=function(a){return arguments.length?(c=wax.formatter(a),e):c},e.template=function(a){return arguments.length?(c=wax.template(a),e):c},e.gridUrl=function(b){return arguments.length?(f=b?"function"==typeof b?b:a(b):function(){return null},e):f},e.getGrid=function(a,b){var g=f(a);return c&&g?(wax.request.get(g,function(a,e){return a?b(a,null):void b(null,wax.gi(e,{formatter:c,resolution:d}))}),e):b(null,null)},e.tilejson=function(a){return arguments.length?(a.template?e.template(a.template):a.formatter?e.formatter(a.formatter):c=void 0,e.gridUrl(a.grids),a.resolution&&(d=a.resolution),b=a,e):b},e},wax=wax||{},wax.hash=function(a){function b(){return location.hash.substring(1)}function c(a){var b=window.location;b.replace(b.toString().replace(b.hash||/$/,"#"+a))}function d(b){for(var c=b.split("/"),d=0;d<c.length;d++)if(c[d]=Number(c[d]),isNaN(c[d]))return!0;return c.length<3?!0:void(3==c.length&&a.setCenterZoom(c))}function e(){var b=a.getCenterZoom();g!==b&&(g=b,c(g))}function f(a){a!==g&&d(g=a)&&e()}a=a||{};var g,h={},i=wax.u.throttle(e,500);return h.add=function(){return f(b()),a.bindChange(i),h},h.remove=function(){return a.unbindChange(i),h},h},wax=wax||{},wax.interaction=function(){function a(a){for(var b=i(),c=new RegExp(n.tileRegexp()),d=0;d<b.length;d++)if(a){var e=b[d][0]<=a.y&&b[d][0]+256>a.y&&b[d][1]<=a.x&&b[d][1]+256>a.x;if(e&&c.exec(b[d][2].src))return b[d][2]}return!1}function b(){return q?(window.clearTimeout(q),q=null,!0):!1}function c(a){if(!p){var b="MSPointerMove"!==a.type&&"pointermove"!==a.type?a:a.originalEvent,c=wax.u.eventoffset(b);o.screen_feature(c,function(b){b?bean.fire(o,"on",{parent:l(),data:b,formatter:n.formatter().format,e:a}):bean.fire(o,"off")})}}function d(a){p=!0;var b="MSPointerDown"!==a.type&&"pointerdown"!==a.type?a:a.originalEvent;h=wax.u.eventoffset(b),"mousedown"===a.type?(bean.add(document.body,"click",g),bean.add(document.body,"mouseup",e)):"touchstart"===a.type&&1===a.touches.length?(bean.remove(document.body,"click",g),bean.add(document.body,"click",g),bean.add(document.body,"touchEnd",e)):"MSPointerDown"===a.originalEvent.type&&a.originalEvent.touches&&1===a.originalEvent.touches.length?(bean.fire(o,"off"),bean.add(l(),v)):"pointerdown"===a.type&&a.originalEvent.touches&&1===a.originalEvent.touches.length?(bean.fire(o,"off"),bean.add(l(),w)):p=!1}function e(){p=!1}function f(){bean.remove(l(),u),bean.remove(l(),v),bean.remove(l(),w),p=!1}function g(a){var c={},d="MSPointerMove"!==a.type&&"MSPointerUp"!==a.type&&"pointerup"!==a.type&&"pointermove"!==a.type?a:a.originalEvent,e=wax.u.eventoffset(d);p=!1;for(var f in d)c[f]=d[f];if(bean.remove(document.body,"mouseup",g),bean.remove(l(),u),bean.remove(l(),v),bean.remove(l(),w),"touchend"===a.type)o.click(a,h);else if(e&&h)if("MSPointerMove"===c.type||"MSPointerUp"===c.type)c.changedTouches=[],o.click(c,e);else if("pointermove"===c.type||"pointerup"===c.type)o.click(c,e);else if(Math.round(e.y/r)===Math.round(h.y/r)&&Math.round(e.x/r)===Math.round(h.x/r)){if(s&&"touchmove"===c.type)return g;q?b():q=window.setTimeout(function(){q=null,o.click(c,e)},150)}return g}var h,i,j,k,l,m,n=wax.gm(),o={},p=!1,q=null,r=4,s=!1,t={mousemove:c,touchstart:d,mousedown:d},u={touchend:g,touchmove:g,touchcancel:f},v={MSPointerUp:g,MSPointerMove:g,MSPointerCancel:f},w={pointerup:g,pointermove:g,pointercancel:f};return o.discardTouchMove=function(a){return arguments.length?(s=a,o):s},o.click=function(a,b){o.screen_feature(b,function(b){b&&bean.fire(o,"on",{parent:l(),data:b,formatter:n.formatter().format,e:a})})},o.screen_feature=function(b,c){var d=a(b);d||c(null),n.getGrid(d.src,function(a,e){if(a||!e)return c(null);var f=e.tileFeature(b.x,b.y,d);c(f)})},o.attach=function(a){return arguments.length?(j=a,o):j},o.detach=function(a){return arguments.length?(k=a,o):k},o.map=function(a){return arguments.length?(m=a,j&&j(m),bean.add(l(),t),bean.add(l(),"touchstart",d),bean.add(l(),"MSPointerDown",d),bean.add(l(),"pointerdown",d),o):m},o.grid=function(a){return arguments.length?(i=a,o):i},o.remove=function(a){return k&&k(m),bean.remove(l(),t),bean.fire(o,"remove"),o},o.tilejson=function(a){return arguments.length?(n.tilejson(a),o):n.tilejson()},o.formatter=function(){return n.formatter()},o.on=function(a,b){return bean.add(o,a,b),o},o.off=function(a,b){return bean.remove(o,a,b),o},o.gridmanager=function(a){return arguments.length?(n=a,o):n},o.parent=function(a){return l=a,o},o};var wax=wax||{};wax.location=function(){function a(a){if("mousemove"!==a.e.type&&a.e.type){var b=a.formatter({format:"location"},a.data);b&&(window.location.href=b)}}var b={};return b.events=function(){return{on:a}},b};var wax=wax||{};if(wax.request={cache:{},locks:{},promises:{},get:function(a,b){if(this.cache[a])return b(this.cache[a][0],this.cache[a][1]);if(this.promises[a]=this.promises[a]||[],this.promises[a].push(b),!this.locks[a]){var c=this;this.locks[a]=!0,reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(b){c.locks[a]=!1,c.cache[a]=[null,b];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])},error:function(b){c.locks[a]=!1,c.cache[a]=[b,null];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])}})}}},wax.template=function(a){var b={};return b.format=function(a,b){throw new Error("mustache.js templates are no longer supported")},b},!wax)var wax={};wax.tilejson=function(a,b){reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:b,error:b})};var wax=wax||{};wax.u={offset:function(a){function b(){h(a);try{for(;a=a.offsetParent;)h(a)}catch(b){}}var c=a.offsetWidth||parseInt(a.style.width,10),d=a.offsetHeight||parseInt(a.style.height,10),e=document.body,f=0,g=0,h=function(a){if(a!==e&&a!==document.documentElement){f+=a.offsetTop,g+=a.offsetLeft;var b=a.style.transform||a.style.WebkitTransform||a.style.OTransform||a.style.MozTransform||a.style.msTransform;if(b){var c;if(c=b.match(/translate\((.+)px, (.+)px\)/))f+=parseInt(c[2],10),g+=parseInt(c[1],10);else if(c=b.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))f+=parseInt(c[2],10),g+=parseInt(c[1],10);else if(c=b.match(/matrix3d\(([\-\d,\s]+)\)/)){var d=c[1].split(",");f+=parseInt(d[13],10),g+=parseInt(d[12],10)}else(c=b.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))&&(f+=parseInt(c[2],10),g+=parseInt(c[1],10))}}};if("undefined"!=typeof a.getBoundingClientRect){var i=document.body,j=a.ownerDocument.documentElement,k=document.clientTop||i.clientTop||0,l=document.clientLeft||i.clientLeft||0,m=window.pageYOffset||j.scrollTop,n=window.pageXOffset||j.scrollLeft;try{var o=a.getBoundingClientRect();f=o.top+m-k,g=o.left+n-l}catch(p){b()}}else b();f+=e.offsetTop,g+=e.offsetLeft,f+=e.parentNode.offsetTop,g+=e.parentNode.offsetLeft;var q=document.defaultView?window.getComputedStyle(e.parentNode,null):e.parentNode.currentStyle;return e.parentNode.offsetTop===parseInt(q.marginTop,10)||isNaN(parseInt(q.marginTop,10))||(f+=parseInt(q.marginTop,10),g+=parseInt(q.marginLeft,10)),{top:f,left:g,height:d,width:c}},$:function(a){return"string"==typeof a?document.getElementById(a):a},eventoffset:function(a){return a||(a=window.event),"MSPointerMove"==a.type||"MSPointerDown"==a.type||"MSPointerUp"==a.type?{x:a.pageX+window.pageXOffset,y:a.pageY+window.pageYOffset}:a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX,y:a.clientY}:a.touches&&1===a.touches.length?{x:a.touches[0].pageX,y:a.touches[0].pageY}:void 0},limit:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),(c||!d)&&(d=setTimeout(g,b))}},throttle:function(a,b){return this.limit(a,b,!1)},sanitize:function(a){function b(a){return/^(https?:\/\/|data:image)/.test(a)?a:void 0}function c(a){return a}return a?html_sanitize(a,b,c):""}},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c,b.lat.toFixed(d),b.lng.toFixed(d)].join("/")},setCenterZoom:function(b){a.setView(new L.LatLng(b[1],b[2]),b[0])},bindChange:function(b){a.on("moveend",b)},unbindChange:function(b){a.off("moveend",b)}})},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.interaction=function(){function a(){g=!0}function b(){return!g&&e?e:e=function(a){var b=[];for(var c in a)if(a[c]._tiles)for(var d in a[c]._tiles){var e=a[c]._tiles[d];if(e.src){var f=wax.u.offset(e);b.push([f.top,f.left,e])}}return b}(f._layers)}function c(b){if(!arguments.length)return f;f=b;for(var c=["moveend"],d=0;d<c.length;d++)f.on(c[d],a)}function d(b){if(!arguments.length)return f;f=b;for(var c=["moveend"],d=0;d<c.length;d++)f.off(c[d],a)}var e,f,g=!1;return wax.interaction().attach(c).detach(d).parent(function(){return f._container}).grid(b)},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.connector=L.TileLayer.extend({initialize:function(a){a=a||{},a.minZoom=a.minzoom||0,a.maxZoom=a.maxzoom||22,L.TileLayer.prototype.initialize.call(this,a.tiles[0],a)}}),wax=wax||{},wax.g=wax.g||{},wax.g.attribution=function(a,b){b=b||{};var c,d={};return d.element=function(){return c.element()},d.appendTo=function(a){return wax.u.$(a).appendChild(c.element()),this},d.init=function(){return c=wax.attribution(),c.content(b.attribution),c.element().className="map-attribution map-g",this},d.init()},wax=wax||{},wax.g=wax.g||{},wax.g.bwdetect=function(a,b){b=b||{};var c=b.png||".png128",d=b.jpg||".jpg70";if(!a.mapTypes["mb-low"]){for(var e=a.mapTypes.mb,f={tiles:[],scheme:e.options.scheme,blankImage:e.options.blankImage,minzoom:e.minZoom,maxzoom:e.maxZoom,name:e.name,description:e.description},g=0;g<e.options.tiles.length;g++)f.tiles.push(e.options.tiles[g].replace(".png",c).replace(".jpg",d));m.mapTypes.set("mb-low",new wax.g.connector(f))}return wax.bwdetect(b,function(b){a.setMapTypeId(b?"mb":"mb-low")})},wax=wax||{},wax.g=wax.g||{},wax.g.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c.toFixed(2),b.lat().toFixed(d),b.lng().toFixed(d)].join("/")},setCenterZoom:function(b){a.setCenter(new google.maps.LatLng(b[1],b[2])),a.setZoom(b[0])},bindChange:function(b){google.maps.event.addListener(a,"idle",b)},unbindChange:function(b){google.maps.event.removeListener(a,"idle",b)}})},wax=wax||{},wax.g=wax.g||{},wax.g.interaction=function(){function a(){g=!0}function b(){if(!g&&e&&(e.length>0||!h))return e;e=[];var a=f.getZoom(),b=(wax.u.offset(f.getDiv()),function(b){if(b&&b.interactive){h=!0;for(var c in b.cache)if(c.split("/")[0]==a){var d=wax.u.offset(b.cache[c]);e.push([d.top,d.left,b.cache[c]])}}});for(var c in f.mapTypes)b(f.mapTypes[c]);return f.overlayMapTypes.forEach(b),e}function c(b){return arguments.length?(f=b,i=google.maps.event.addListener(f,"tileloaded",a),void(j=google.maps.event.addListener(f,"idle",a))):f}function d(a){i&&google.maps.event.removeListener(i),j&&google.maps.event.removeListener(j)}var e,f,g=!1,h=!1,i=null,j=null;return wax.interaction().attach(c).detach(d).discardTouchMove(!0).parent(function(){return f.getDiv()}).grid(b)};var wax=wax||{};wax.g=wax.g||{},wax.g.connector=function(a){a=a||{},this.options={tiles:a.tiles,scheme:a.scheme||"xyz",blankImage:a.blankImage||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},this.opacity=a.opacity||0,this.minZoom=a.minzoom||0,this.maxZoom=a.maxzoom||22,this.name=a.name||"",this.description=a.description||"",this.interactive=!0,this.tileSize=new google.maps.Size(256,256),this.cache={}},wax.g.connector.prototype.getTile=function(a,b,c){var d=b+"/"+a.x+"/"+a.y;if(!this.cache[d]){var e=this.cache[d]=new Image(256,256);this.cache[d].src=this.getTileUrl(a,b),this.cache[d].setAttribute("gTileKey",d),this.cache[d].setAttribute("style","opacity: "+this.opacity+"; filter: alpha(opacity="+100*this.opacity+");"),this.cache[d].onerror=function(){e.style.display="none"}}return this.cache[d]},wax.g.connector.prototype.releaseTile=function(a){var b=a.getAttribute("gTileKey");this.cache[b]&&delete this.cache[b],a.parentNode&&a.parentNode.removeChild(a)},wax.g.connector.prototype.getTileUrl=function(a,b){var c=Math.pow(2,b),d="tms"===this.options.scheme?c-1-a.y:a.y,e=a.x%c;return e=0>e?a.x%c+c:e,0>d?this.options.blankImage:this.options.tiles[parseInt(e+d,10)%this.options.tiles.length].replace(/\{z\}/g,b).replace(/\{x\}/g,e).replace(/\{y\}/g,d)},browserify_shim__define__module__export__("undefined"!=typeof wax?wax:window.wax)}).call(global,void 0,void 0,void 0,void 0,function(a){module.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"cartodb-deep-insights.js":[function(a,b,c){b.exports={VERSION:a("../package.json").version,createDashboard:a("./api/create-dashboard")}},{"../package.json":19,"./api/create-dashboard":20}],"cartodb.js":[function(a,b,c){var d=a("./cartodb.js");b.exports=d},{"./cartodb.js":219}]},{},["cartodb-deep-insights.js","cartodb.js"]);
//# sourceMappingURL=common_editor3.js.map